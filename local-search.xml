<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸ƒ.Reactå‚è€ƒ</title>
    <link href="/2023/11/20/React%E5%8F%82%E8%80%83/"/>
    <url>/2023/11/20/React%E5%8F%82%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>React-dom ä»…æ”¯æŒåœ¨ web åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼ˆåœ¨æµè§ˆå™¨ DOM ç¯å¢ƒä¸­è¿è¡Œï¼‰ã€‚æœ¬èŠ‚åˆ†ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼š</p><ul><li><a href="https://zh-hans.react.dev/reference/react-dom/hooks">Hook</a> - é€‚ç”¨äºåœ¨æµè§ˆå™¨ DOM ç¯å¢ƒä¸­è¿è¡Œçš„ web åº”ç”¨ç¨‹åºçš„ Hookã€‚</li><li><a href="https://zh-hans.react.dev/reference/react-dom/components">ç»„ä»¶</a> - React æ”¯æŒæ‰€æœ‰å†…ç½®çš„ HTML å’Œ SVG ç»„ä»¶ã€‚</li><li><a href="https://zh-hans.react.dev/reference/react-dom">API</a> - <code>react-dom</code> åŒ…å«ä»…åœ¨ Web åº”ç”¨ç¨‹åºä¸­æ”¯æŒçš„æ–¹æ³•ã€‚</li><li><a href="https://zh-hans.react.dev/reference/react-dom/client">å®¢æˆ·ç«¯ API</a> - <code>react-dom/client</code> API å…è®¸åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ä¸­ï¼‰å‘ˆç° React ç»„ä»¶ã€‚</li><li><a href="https://zh-hans.react.dev/reference/react-dom/server">æœåŠ¡å™¨ API</a> - <code>react-dom/server</code> API å…è®¸åœ¨æœåŠ¡å™¨ç«¯å°† React ç»„ä»¶æ¸²æŸ“ä¸º HTMLã€‚</li></ul><h1 id="React-å†…ç½®-Hook"><a href="#React-å†…ç½®-Hook" class="headerlink" title="React å†…ç½® Hook"></a>React å†…ç½® Hook</h1><p><strong>Hook</strong> å¯ä»¥å¸®åŠ©åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ä¸åŒçš„ React åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„ Hook æˆ–ä½¿ç”¨è‡ªå®šä¹‰ Hookã€‚</p><h2 id="1-State-Hook"><a href="#1-State-Hook" class="headerlink" title="1.State Hook"></a>1.State Hook</h2><p><mark>çŠ¶æ€å¸®åŠ©ç»„ä»¶ <a href="https://zh-hans.react.dev/learn/state-a-components-memory">â€œè®°ä½â€ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯</a></mark>ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¡¨å•ç»„ä»¶å¯ä»¥ä½¿ç”¨çŠ¶æ€å­˜å‚¨è¾“å…¥å€¼ï¼Œè€Œä¸€ä¸ªå›¾åƒåº“ç»„ä»¶å¯ä»¥ä½¿ç”¨çŠ¶æ€å­˜å‚¨æ‰€é€‰çš„å›¾åƒç´¢å¼•ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹ Hook ä»¥å‘ç»„ä»¶æ·»åŠ çŠ¶æ€ï¼š</p><ul><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useState"><code>useState</code></a> å£°æ˜å¯ä»¥ç›´æ¥æ›´æ–°çš„çŠ¶æ€å˜é‡ã€‚</li><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useReducer"><code>useReducer</code></a> åœ¨ <a href="https://zh-hans.react.dev/learn/extracting-state-logic-into-a-reducer">reducer å‡½æ•°</a> ä¸­å£°æ˜å¸¦æœ‰æ›´æ–°é€»è¾‘çš„ state å˜é‡ã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3uk3vvlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3uk3vvlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImageGallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><h2 id="2-Context-Hook"><a href="#2-Context-Hook" class="headerlink" title="2.Context Hook"></a>2.Context Hook</h2><p>ä¸Šä¸‹æ–‡å¸®åŠ©ç»„ä»¶ <a href="https://zh-hans.react.dev/learn/passing-props-to-a-component">ä»ç¥–å…ˆç»„ä»¶æ¥æ”¶ä¿¡æ¯ï¼Œè€Œæ— éœ€å°†å…¶ä½œä¸º props ä¼ é€’</a>ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºçš„é¡¶å±‚ç»„ä»¶å¯ä»¥å€ŸåŠ©ä¸Šä¸‹æ–‡å°† UI ä¸»é¢˜ä¼ é€’ç»™æ‰€æœ‰ä¸‹æ–¹çš„ç»„ä»¶ï¼Œæ— è®ºè¿™äº›ç»„ä»¶å±‚çº§æœ‰å¤šæ·±ã€‚</p><ul><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useContext"><code>useContext</code></a> è¯»å–è®¢é˜…ä¸Šä¸‹æ–‡ã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dug98dlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dug98dlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><h2 id="3-Ref-Hook"><a href="#3-Ref-Hook" class="headerlink" title="3.Ref Hook"></a>3.Ref Hook</h2><p>ref å…è®¸ç»„ä»¶ <a href="https://zh-hans.react.dev/learn/referencing-values-with-refs">ä¿å­˜ä¸€äº›ä¸ç”¨äºæ¸²æŸ“çš„ä¿¡æ¯</a>ï¼Œæ¯”å¦‚ DOM èŠ‚ç‚¹æˆ– timeout IDã€‚<mark>ä¸çŠ¶æ€ä¸åŒï¼Œæ›´æ–° ref ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶</mark>ã€‚ref æ˜¯ä» React èŒƒä¾‹ä¸­çš„â€œè„±å›´æœºåˆ¶â€ã€‚å½“éœ€è¦ä¸é React ç³»ç»Ÿå¦‚æµè§ˆå™¨å†…ç½® API ä¸€åŒå·¥ä½œæ—¶ï¼Œref å°†ä¼šéå¸¸æœ‰ç”¨ã€‚</p><ul><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useRef"><code>useRef</code></a> å£°æ˜ refã€‚ä½ å¯ä»¥åœ¨å…¶ä¸­ä¿å­˜ä»»ä½•å€¼ï¼Œ<mark>ä½†æœ€å¸¸ç”¨äºä¿å­˜ DOM èŠ‚ç‚¹</mark>ã€‚</li><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useImperativeHandle"><code>useImperativeHandle</code></a> è‡ªå®šä¹‰ä»ç»„ä»¶ä¸­æš´éœ²çš„ refï¼Œä½†æ˜¯å¾ˆå°‘ä½¿ç”¨ã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2in9kylqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2in9kylqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><h2 id="4-Effect-Hook"><a href="#4-Effect-Hook" class="headerlink" title="4.Effect Hook"></a>4.Effect Hook</h2><p>Effect å…è®¸ç»„ä»¶ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects">è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿå¹¶ä¸ä¹‹åŒæ­¥</a>ã€‚è¿™åŒ…æ‹¬å¤„ç†ç½‘ç»œã€æµè§ˆå™¨ã€DOMã€åŠ¨ç”»ã€ä½¿ç”¨ä¸åŒ UI åº“ç¼–å†™çš„å°éƒ¨ä»¶ä»¥åŠå…¶ä»–é React ä»£ç ã€‚</p><ul><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useEffect"><code>useEffect</code></a> å°†ç»„ä»¶è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4a7yprlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4a7yprlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>Effect æ˜¯ä» React èŒƒä¾‹ä¸­çš„â€œè„±å›´æœºåˆ¶â€ã€‚é¿å…ä½¿ç”¨ Effect åè°ƒåº”ç”¨ç¨‹åºçš„æ•°æ®æµã€‚<mark>å¦‚æœä¸éœ€è¦ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œé‚£ä¹ˆ <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect">å¯èƒ½ä¸éœ€è¦ Effect</a></mark>ã€‚</p><p><code>useEffect</code> æœ‰ä¸¤ä¸ªå¾ˆå°‘ä½¿ç”¨çš„å˜æ¢å½¢å¼ï¼Œå®ƒä»¬åœ¨æ‰§è¡Œæ—¶æœºæœ‰æ‰€ä¸åŒï¼š</p><ul><li><a href="https://zh-hans.react.dev/reference/react/useLayoutEffect"><code>useLayoutEffect</code></a> åœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•å‰æ‰§è¡Œï¼Œå¯ä»¥åœ¨æ­¤å¤„æµ‹é‡å¸ƒå±€ã€‚</li><li><a href="https://zh-hans.react.dev/reference/react/useInsertionEffect"><code>useInsertionEffect</code></a> åœ¨ React å¯¹ DOM è¿›è¡Œæ›´æ”¹ä¹‹å‰è§¦å‘ï¼Œåº“å¯ä»¥åœ¨æ­¤å¤„æ’å…¥åŠ¨æ€ CSSã€‚</li></ul><h2 id="5-æ€§èƒ½-Hook"><a href="#5-æ€§èƒ½-Hook" class="headerlink" title="5.æ€§èƒ½ Hook"></a>5.æ€§èƒ½ Hook</h2><p>ä¼˜åŒ–é‡æ–°æ¸²æŸ“æ€§èƒ½çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯è·³è¿‡ä¸å¿…è¦çš„å·¥ä½œã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å‘Šè¯‰ React é‡ç”¨ç¼“å­˜çš„è®¡ç®—ç»“æœï¼Œæˆ–è€…å¦‚æœæ•°æ®è‡ªä¸Šæ¬¡æ¸²æŸ“ä»¥æ¥æ²¡æœ‰æ›´æ”¹ï¼Œåˆ™è·³è¿‡é‡æ–°æ¸²æŸ“ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Hook è·³è¿‡è®¡ç®—å’Œä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼š</p><ol><li><p><mark>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a> ç¼“å­˜è®¡ç®—ä»£ä»·æ˜‚è´µçš„è®¡ç®—ç»“æœã€‚</mark></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0ehlzmlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0ehlzmlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, tab, theme &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> visibleTodos = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">filterTodos</span>(todos, tab), [todos, tab]);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useCallback"><code>useCallback</code></a> å°†å‡½æ•°ä¼ é€’ç»™ä¼˜åŒ–ç»„ä»¶ä¹‹å‰ç¼“å­˜å‡½æ•°å®šä¹‰ã€‚</mark><code>useCallback</code> æ˜¯ä¸€ä¸ªå…è®¸ä½ åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°çš„ React Hookã€‚</p><p><code>useCallback(fn, dependencies)</code>ï¼š</p><ul><li><p><code>fn</code>ï¼šæƒ³è¦ç¼“å­˜çš„å‡½æ•°ã€‚æ­¤å‡½æ•°å¯ä»¥æ¥å—ä»»ä½•å‚æ•°å¹¶ä¸”è¿”å›ä»»ä½•å€¼ã€‚React å°†ä¼šåœ¨åˆæ¬¡æ¸²æŸ“è€Œéè°ƒç”¨æ—¶è¿”å›è¯¥å‡½æ•°ã€‚å½“è¿›è¡Œä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œå¦‚æœ <code>dependencies</code> ç›¸æ¯”äºä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆ React å°†ä¼šè¿”å›ç›¸åŒçš„å‡½æ•°ã€‚å¦åˆ™ï¼ŒReact å°†è¿”å›åœ¨æœ€æ–°ä¸€æ¬¡æ¸²æŸ“ä¸­ä¼ å…¥çš„å‡½æ•°ï¼Œå¹¶ä¸”å°†å…¶ç¼“å­˜ä»¥ä¾¿ä¹‹åä½¿ç”¨ã€‚React ä¸ä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼Œè€Œæ˜¯è¿”å›æ­¤å‡½æ•°ã€‚ä½ å¯ä»¥è‡ªå·±å†³å®šä½•æ—¶è°ƒç”¨ä»¥åŠæ˜¯å¦è°ƒç”¨ã€‚</p></li><li><p><code>dependencies</code>ï¼šæœ‰å…³æ˜¯å¦æ›´æ–° <code>fn</code> çš„æ‰€æœ‰å“åº”å¼å€¼çš„ä¸€ä¸ªåˆ—è¡¨ã€‚å“åº”å¼å€¼åŒ…æ‹¬ propsã€stateï¼Œå’Œæ‰€æœ‰åœ¨ä½ ç»„ä»¶å†…éƒ¨ç›´æ¥å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœä½ çš„ä»£ç æ£€æŸ¥å·¥å…· <a href="https://zh-hans.react.dev/learn/editor-setup#linting">é…ç½®äº† React</a>ï¼Œé‚£ä¹ˆå®ƒå°†æ ¡éªŒæ¯ä¸€ä¸ªæ­£ç¡®æŒ‡å®šä¸ºä¾èµ–çš„å“åº”å¼å€¼ã€‚ä¾èµ–åˆ—è¡¨å¿…é¡»å…·æœ‰ç¡®åˆ‡æ•°é‡çš„é¡¹ï¼Œå¹¶ä¸”å¿…é¡»åƒ <code>[dep1, dep2, dep3]</code> è¿™æ ·ç¼–å†™ã€‚React ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> æ¯”è¾ƒæ¯ä¸€ä¸ªä¾èµ–å’Œå®ƒçš„ä¹‹å‰çš„å€¼ã€‚</p></li><li><p>åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œ<code>useCallback</code> è¿”å›ä½ å·²ç»ä¼ å…¥çš„ <code>fn</code> å‡½æ•°ã€‚</p><p>åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­, å¦‚æœä¾èµ–æ²¡æœ‰æ”¹å˜ï¼Œ<code>useCallback</code> è¿”å›ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­ç¼“å­˜çš„ <code>fn</code> å‡½æ•°ï¼›å¦åˆ™è¿”å›è¿™ä¸€æ¬¡æ¸²æŸ“ä¼ å…¥çš„ <code>fn</code>ã€‚</p></li></ul><p>æ³¨æ„ï¼š </p><ul><li><code>useCallback</code> æ˜¯ä¸€ä¸ª Hookï¼Œæ‰€ä»¥åº”è¯¥åœ¨ <strong>ç»„ä»¶çš„é¡¶å±‚</strong> æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ã€‚ä½ ä¸åº”åœ¨å¾ªç¯æˆ–è€…æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨å®ƒã€‚å¦‚æœä½ éœ€è¦è¿™æ ·åšï¼Œè¯·æ–°å»ºä¸€ä¸ªç»„ä»¶ï¼Œå¹¶å°† state ç§»å…¥å…¶ä¸­ã€‚</li><li>é™¤éæœ‰ç‰¹å®šçš„ç†ç”±ï¼ŒReact <strong>å°†ä¸ä¼šä¸¢å¼ƒå·²ç¼“å­˜çš„å‡½æ•°</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ä¸­ï¼Œå½“ç¼–è¾‘ç»„ä»¶æ–‡ä»¶æ—¶ï¼ŒReact ä¼šä¸¢å¼ƒç¼“å­˜ã€‚åœ¨ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¸­ï¼Œå¦‚æœä½ çš„ç»„ä»¶åœ¨åˆæ¬¡æŒ‚è½½ä¸­æš‚åœï¼ŒReact å°†ä¼šä¸¢å¼ƒç¼“å­˜ã€‚åœ¨æœªæ¥ï¼ŒReact å¯èƒ½ä¼šå¢åŠ æ›´å¤šåˆ©ç”¨äº†ä¸¢å¼ƒç¼“å­˜æœºåˆ¶çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ React æœªæ¥å†…ç½®äº†å¯¹è™šæ‹Ÿåˆ—è¡¨çš„æ”¯æŒï¼Œé‚£ä¹ˆåœ¨æ»šåŠ¨è¶…å‡ºè™šæ‹ŸåŒ–è¡¨è§†å£çš„é¡¹ç›®æ—¶ï¼ŒæŠ›å¼ƒç¼“å­˜æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦‚æœä½ ä¾èµ– <code>useCallback</code> ä½œä¸ºä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–é€”å¾„ï¼Œé‚£ä¹ˆè¿™äº›å¯¹ä½ ä¼šæœ‰å¸®åŠ©ã€‚å¦åˆ™è¯·è€ƒè™‘ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useState#im-trying-to-set-state-to-a-function-but-it-gets-called-instead">state å˜é‡</a> æˆ– <a href="https://zh-hans.react.dev/reference/react/useRef#avoiding-recreating-the-ref-contents">ref</a>ã€‚</li></ul><p>ç”¨æ³•ï¼š</p><ol><li><p><mark>è·³è¿‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“</mark>ï¼šå½“ä½ ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½çš„æ—¶å€™ï¼Œæœ‰æ—¶éœ€è¦ç¼“å­˜ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°ã€‚</p><p>ä¸ºäº†ç¼“å­˜ç»„ä»¶ä¸­å¤šæ¬¡æ¸²æŸ“çš„å‡½æ•°ï¼Œä½ éœ€è¦å°†å…¶å®šä¹‰åœ¨ <code>useCallback</code> Hook ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xibtwxlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xibtwxlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer, theme &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;, [productId, referrer]);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ä½ éœ€è¦ä¼ é€’ä¸¤ä¸ªå‚æ•°ç»™ <code>useCallback</code>ï¼š</p><ol><li>åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­éœ€è¦ç¼“å­˜çš„å‡½æ•°</li><li>å‡½æ•°å†…éƒ¨éœ€è¦ä½¿ç”¨åˆ°çš„æ‰€æœ‰ç»„ä»¶å†…éƒ¨å€¼çš„ ä¾èµ–åˆ—è¡¨ã€‚</li></ol><p>åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œåœ¨ <code>useCallback</code> å¤„æ¥æ”¶çš„ è¿”å›å‡½æ•° å°†ä¼šæ˜¯å·²ç»ä¼ å…¥çš„å‡½æ•°ã€‚</p><p>åœ¨ä¹‹åçš„æ¸²æŸ“ä¸­ï¼ŒReact å°†ä¼šä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> æŠŠ å½“å‰çš„ä¾èµ– å’Œå·²ä¼ å…¥ä¹‹å‰çš„ä¾èµ–è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¾èµ–æ”¹å˜ï¼Œ<code>useCallback</code> å°†ä¼šè¿”å›ä¸ä¹‹å‰ä¸€æ ·çš„å‡½æ•°ã€‚å¦åˆ™ <code>useCallback</code> å°†è¿”å› <strong>æ­¤æ¬¡</strong> æ¸²æŸ“ä¸­ä¼ é€’çš„å‡½æ•°ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>useCallback</code> åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜ä¸€ä¸ªå‡½æ•°ï¼Œç›´è‡³è¿™ä¸ªå‡½æ•°çš„ä¾èµ–å‘ç”Ÿæ”¹å˜ã€‚</p><p>å‡è®¾ä½ æ­£åœ¨ä» <code>ProductPage</code> ä¼ é€’ä¸€ä¸ª <code>handleSubmit</code> å‡½æ•°åˆ° <code>ShippingForm</code> ç»„ä»¶ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-on58m9lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-on58m9lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer, theme &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ShippingForm</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„ï¼Œåˆ‡æ¢ <code>theme</code> props åä¼šè®©åº”ç”¨åœæ»ä¸€å°ä¼šï¼Œä½†å¦‚æœå°† <code>&lt;ShippingForm /&gt;</code> ä» JSX ä¸­ç§»é™¤ï¼Œåº”ç”¨å°†ååº”è¿…é€Ÿã€‚è¿™å°±æç¤ºå°½åŠ›ä¼˜åŒ– <code>ShippingForm</code> ç»„ä»¶å°†ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p><mark>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œ React å°†é€’å½’æ¸²æŸ“å®ƒçš„æ‰€æœ‰å­ç»„ä»¶</mark>ï¼Œå› æ­¤æ¯å½“å›  <code>theme</code> æ›´æ”¹æ—¶è€Œ <code>ProductPage</code> ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œ<code>ShippingForm</code> ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚è¿™å¯¹äºä¸éœ€è¦å¤§é‡è®¡ç®—å»é‡æ–°æ¸²æŸ“çš„ç»„ä»¶æ¥è¯´å½±å“å¾ˆå°ã€‚ä½†å¦‚æœä½ å‘ç°æŸæ¬¡é‡æ–°æ¸²æŸ“å¾ˆæ…¢ï¼Œä½ å¯ä»¥å°† <code>ShippingForm</code> ç»„ä»¶åŒ…è£¹åœ¨ <a href="https://zh-hans.react.dev/reference/react/memo"><code>memo</code></a> ä¸­ã€‚å¦‚æœ props å’Œä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶ç›¸åŒï¼Œé‚£ä¹ˆ <code>ShippingForm</code> ç»„ä»¶å°†è·³è¿‡é‡æ–°æ¸²æŸ“ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jtfae6lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jtfae6lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; memo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ShippingForm</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">ShippingForm</span>(<span class="hljs-params">&#123; onSubmit &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;);<br></code></pre></td></tr></table></div></figure><p><strong>å½“ä»£ç åƒä¸Šé¢ä¸€æ ·æ”¹å˜åï¼Œå¦‚æœ props ä¸ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶ç›¸åŒï¼Œ<code>ShippingForm</code> å°†è·³è¿‡é‡æ–°æ¸²æŸ“</strong>ã€‚è¿™æ—¶ç¼“å­˜å‡½æ•°å°±å˜å¾—å¾ˆé‡è¦ã€‚å‡è®¾å®šä¹‰äº† <code>handleSubmit</code> è€Œæ²¡æœ‰å®šä¹‰ <code>useCallback</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8gcyillqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8gcyillqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer, theme &#125;</span>) &#123;<br>  <span class="hljs-comment">// æ¯å½“ theme æ”¹å˜æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸åŒçš„å‡½æ•°</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">orderDetails</span>) &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;<br>  <br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;/* è¿™å°†å¯¼è‡´ ShippingForm props æ°¸è¿œéƒ½ä¸ä¼šæ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”æ¯æ¬¡å®ƒéƒ½ä¼šé‡æ–°æ¸²æŸ“ */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ShippingForm</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸å­—é¢é‡å¯¹è±¡ <code>&#123;&#125;</code> æ€»æ˜¯ä¼šåˆ›å»ºæ–°å¯¹è±¡ç±»ä¼¼ï¼Œ<strong>åœ¨ JavaScript ä¸­ï¼Œ<code>function () &#123;&#125;</code> æˆ–è€… <code>() =&gt; &#123;&#125;</code> æ€»æ˜¯ä¼šç”Ÿæˆä¸åŒçš„å‡½æ•°</strong>ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿™æ„å‘³ç€ <code>ShippingForm</code> props å°†æ°¸è¿œä¸ä¼šæ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸” <a href="https://zh-hans.react.dev/reference/react/memo"><code>memo</code></a> å¯¹æ€§èƒ½çš„ä¼˜åŒ–æ°¸è¿œä¸ä¼šç”Ÿæ•ˆã€‚è€Œè¿™å°±æ˜¯ <code>useCallback</code> èµ·ä½œç”¨çš„åœ°æ–¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r6qbxflqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r6qbxflqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer, theme &#125;</span>) &#123;<br>  <span class="hljs-comment">// åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ç¼“å­˜å‡½æ•°</span><br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;, [productId, referrer]); <span class="hljs-comment">// åªè¦è¿™äº›ä¾èµ–æ²¡æœ‰æ”¹å˜</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;/* ShippingForm å°±ä¼šæ”¶åˆ°åŒæ ·çš„ props å¹¶ä¸”è·³è¿‡é‡æ–°æ¸²æŸ“ */&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ShippingForm</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>å°† <code>handleSubmit</code> ä¼ é€’ç»™ <code>useCallback</code> å°±å¯ä»¥ç¡®ä¿å®ƒåœ¨å¤šæ¬¡é‡æ–°æ¸²æŸ“ä¹‹é—´æ˜¯ç›¸åŒçš„å‡½æ•°</strong>ï¼Œç›´åˆ°ä¾èµ–å‘ç”Ÿæ”¹å˜ã€‚æ³¨æ„ï¼Œé™¤éå‡ºäºæŸç§ç‰¹å®šåŸå› ï¼Œå¦åˆ™ä¸å¿…å°†ä¸€ä¸ªå‡½æ•°åŒ…è£¹åœ¨ <code>useCallback</code> ä¸­ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ å°†å®ƒä¼ é€’åˆ°äº†åŒ…è£¹åœ¨ <a href="https://zh-hans.react.dev/reference/react/memo"><code>memo</code></a> ä¸­çš„ç»„ä»¶ï¼Œè¿™å…è®¸å®ƒè·³è¿‡é‡æ–°æ¸²æŸ“ã€‚</p><p>æ³¨æ„ï¼š</p><p><strong><code>useCallback</code> åªåº”ä½œç”¨äºæ€§èƒ½ä¼˜åŒ–</strong>ã€‚å¦‚æœä»£ç åœ¨æ²¡æœ‰å®ƒçš„æƒ…å†µä¸‹æ— æ³•è¿è¡Œï¼Œè¯·æ‰¾åˆ°æ ¹æœ¬é—®é¢˜å¹¶é¦–å…ˆä¿®å¤å®ƒï¼Œç„¶åå†ä½¿ç”¨ <code>useCallback</code>ã€‚</p><p>â€”â€”<code>useCallback</code> ä¸ <code>useMemo</code> æœ‰ä½•å…³ç³»ï¼Ÿ </p><p><a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a> ç»å¸¸ä¸ <code>useCallback</code> ä¸€åŒå‡ºç°ã€‚å½“å°è¯•ä¼˜åŒ–å­ç»„ä»¶æ—¶ï¼Œå®ƒä»¬éƒ½å¾ˆæœ‰ç”¨ã€‚ä»–ä»¬ä¼š <a href="https://en.wikipedia.org/wiki/Memoization">è®°ä½</a>ï¼ˆæˆ–è€…è¯´ï¼Œç¼“å­˜ï¼‰æ­£åœ¨ä¼ é€’çš„ä¸œè¥¿ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a30ps6lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a30ps6lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useMemo, useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> product = <span class="hljs-title function_">useData</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId);<br>  <span class="hljs-keyword">const</span> requirements = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-comment">//è°ƒç”¨å‡½æ•°å¹¶ç¼“å­˜ç»“æœ</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">computeRequirements</span>(product);<br>  &#125;, [product]);<br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123; <span class="hljs-comment">// ç¼“å­˜å‡½æ•°æœ¬èº«</span><br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;, [productId, referrer]);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ShippingForm</span> <span class="hljs-attr">requirements</span>=<span class="hljs-string">&#123;requirements&#125;</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åŒºåˆ«åœ¨äºä½ éœ€è¦ç¼“å­˜ <strong>ä»€ä¹ˆ</strong>:</p><ul><li><strong><a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a> ç¼“å­˜å‡½æ•°è°ƒç”¨çš„ç»“æœ</strong>ã€‚åœ¨è¿™é‡Œï¼Œå®ƒç¼“å­˜äº†è°ƒç”¨ <code>computeRequirements(product)</code> çš„ç»“æœã€‚é™¤é <code>product</code> å‘ç”Ÿæ”¹å˜ï¼Œå¦åˆ™å®ƒå°†ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™è®©ä½ å‘ä¸‹ä¼ é€’ <code>requirements</code> æ—¶è€Œæ— éœ€ä¸å¿…è¦åœ°é‡æ–°æ¸²æŸ“ <code>ShippingForm</code>ã€‚å¿…è¦æ—¶ï¼ŒReact å°†ä¼šè°ƒç”¨ä¼ å…¥çš„å‡½æ•°é‡æ–°è®¡ç®—ç»“æœã€‚</li><li><strong><code>useCallback</code> ç¼“å­˜å‡½æ•°æœ¬èº«</strong>ã€‚ä¸åƒ <code>useMemo</code>ï¼Œå®ƒä¸ä¼šè°ƒç”¨ä½ ä¼ å…¥çš„å‡½æ•°ã€‚ç›¸åï¼Œå®ƒç¼“å­˜æ­¤å‡½æ•°ã€‚ä»è€Œé™¤é <code>productId</code> æˆ– <code>referrer</code> å‘ç”Ÿæ”¹å˜ï¼Œ<code>handleSubmit</code> è‡ªå·±å°†ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚è¿™è®©ä½ å‘ä¸‹ä¼ é€’ <code>handleSubmit</code> å‡½æ•°è€Œæ— éœ€ä¸å¿…è¦åœ°é‡æ–°æ¸²æŸ“ <code>ShippingForm</code>ã€‚ç›´è‡³ç”¨æˆ·æäº¤è¡¨å•ï¼Œä½ çš„ä»£ç éƒ½å°†ä¸ä¼šè¿è¡Œã€‚</li></ul><p>å¦‚æœä½ å·²ç»ç†Ÿæ‚‰äº† <a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a>ï¼Œä½ å¯èƒ½å‘ç°å°† <code>useCallback</code> è§†ä¸ºä»¥ä¸‹å†…å®¹ä¼šå¾ˆæœ‰å¸®åŠ©ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gsj792lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gsj792lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// åœ¨ React å†…éƒ¨çš„ç®€åŒ–å®ç°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useCallback</span>(<span class="hljs-params">fn, dependencies</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> fn, dependencies);<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>ä»è®°å¿†åŒ–å›è°ƒä¸­æ›´æ–° state</mark>ï¼šæœ‰æ—¶ï¼Œä½ å¯èƒ½åœ¨è®°å¿†åŒ–å›è°ƒæ±‡ä¸­åŸºäºä¹‹å‰çš„ state æ¥æ›´æ–° stateã€‚</p><p>ä¸‹é¢çš„ <code>handleAddTodo</code> å‡½æ•°å°† <code>todos</code> æŒ‡å®šä¸ºä¾èµ–é¡¹ï¼Œå› ä¸ºå®ƒä¼šä»ä¸­è®¡ç®—ä¸‹ä¸€ä¸ª todosï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9ervoolqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9ervoolqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-keyword">const</span> handleAddTodo = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> newTodo = &#123; <span class="hljs-attr">id</span>: nextId++, text &#125;;<br>    <span class="hljs-title function_">setTodos</span>([...todos, newTodo]);<br>  &#125;, [todos]);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>æˆ‘ä»¬æœŸæœ›è®°å¿†åŒ–å‡½æ•°å…·æœ‰å°½å¯èƒ½å°‘çš„ä¾èµ–ï¼Œå½“ä½ è¯»å– state åªæ˜¯ä¸ºäº†è®¡ç®—ä¸‹ä¸€ä¸ª state æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ä¼ é€’ <a href="https://zh-hans.react.dev/reference/react/useState#updating-state-based-on-the-previous-state">updater function</a> ä»¥ç§»é™¤è¯¥ä¾èµ–ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-aur39nlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-aur39nlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-keyword">const</span> handleAddTodo = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">text</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> newTodo = &#123; <span class="hljs-attr">id</span>: nextId++, text &#125;;<br>    <span class="hljs-title function_">setTodos</span>(<span class="hljs-function"><span class="hljs-params">todos</span> =&gt;</span> [...todos, newTodo]);<br>  &#125;, []); <span class="hljs-comment">// âœ… ä¸éœ€è¦ todos ä¾èµ–é¡¹</span><br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>åœ¨è¿™é‡Œï¼Œå¹¶ä¸æ˜¯å°† <code>todos</code> ä½œä¸ºä¾èµ–é¡¹å¹¶åœ¨å†…éƒ¨è¯»å–å®ƒï¼Œè€Œæ˜¯ä¼ é€’ä¸€ä¸ªå…³äº <strong>å¦‚ä½•</strong> æ›´æ–° state çš„æŒ‡ç¤ºå™¨ (<code>todos =&gt; [...todos, newTodo]</code>) ç»™ Reactã€‚</p></li><li><p><mark>é˜²æ­¢é¢‘ç¹è§¦å‘ Effect </mark>ï¼šæœ‰æ—¶ï¼Œä½ æƒ³è¦åœ¨ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects">Effect</a> å†…éƒ¨è°ƒç”¨å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ej0bktlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ej0bktlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">createOptions</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">serverUrl</span>: <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>,<br>      <span class="hljs-attr">roomId</span>: roomId<br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">createOptions</span>();<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è¿™ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œ<a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">æ¯ä¸€ä¸ªå“åº”å€¼éƒ½å¿…é¡»å£°æ˜ä¸º Effect çš„ä¾èµ–</a>ã€‚ä½†æ˜¯å¦‚æœå°† <code>createOptions</code> å£°æ˜ä¸ºä¾èµ–ï¼Œå®ƒä¼šå¯¼è‡´ Effect ä¸æ–­é‡æ–°è¿æ¥åˆ°èŠå¤©å®¤ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yt6rsllqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yt6rsllqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">createOptions</span>();<br>  <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>  connection.<span class="hljs-title function_">connect</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>&#125;, [createOptions]); <span class="hljs-comment">// ğŸ”´ é—®é¢˜ï¼šè¿™ä¸ªä¾èµ–åœ¨æ¯ä¸€æ¬¡æ¸²æŸ“ä¸­éƒ½ä¼šå‘ç”Ÿæ”¹å˜</span><br><span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨ Effect ä¸­å°†è¦è°ƒç”¨çš„å‡½æ•°åŒ…è£¹åœ¨ <code>useCallback</code> ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2wg8kylqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2wg8kylqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> createOptions = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">serverUrl</span>: <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>,<br>      <span class="hljs-attr">roomId</span>: roomId<br>    &#125;;<br>  &#125;, [roomId]); <span class="hljs-comment">// âœ… ä»…å½“ roomId æ›´æ”¹æ—¶æ›´æ”¹</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">createOptions</span>();<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [createOptions]); <span class="hljs-comment">// âœ… ä»…å½“ createOptions æ›´æ”¹æ—¶æ›´æ”¹</span><br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è¿™å°†ç¡®ä¿å¦‚æœ <code>roomId</code> ç›¸åŒï¼Œ<code>createOptions</code> åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­ä¼šæ˜¯åŒä¸€ä¸ªå‡½æ•°ã€‚<strong>ä½†æ˜¯ï¼Œæœ€å¥½æ¶ˆé™¤å¯¹å‡½æ•°ä¾èµ–é¡¹çš„éœ€æ±‚</strong>ã€‚å°†ä½ çš„å‡½æ•°ç§»å…¥ Effect <strong>å†…éƒ¨</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nr6danlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nr6danlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">createOptions</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">// âœ… æ— éœ€ä½¿ç”¨å›è°ƒæˆ–å‡½æ•°ä¾èµ–ï¼</span><br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">serverUrl</span>: <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>,<br>        <span class="hljs-attr">roomId</span>: roomId<br>      &#125;;<br>    &#125;<br>    <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">createOptions</span>();<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]); <span class="hljs-comment">// âœ… ä»…å½“ roomId æ›´æ”¹æ—¶æ›´æ”¹</span><br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ä½ çš„ä»£ç å˜å¾—æ›´ç®€å•äº†å¹¶ä¸”ä¸éœ€è¦ <code>useCallback</code>ã€‚</p></li><li><p><mark>ä¼˜åŒ–è‡ªå®šä¹‰ Hook</mark>ï¼šå¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª <a href="https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks">è‡ªå®šä¹‰ Hook</a>ï¼Œå»ºè®®å°†å®ƒè¿”å›çš„ä»»ä½•å‡½æ•°åŒ…è£¹åœ¨ <code>useCallback</code> ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s3fd4llqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s3fd4llqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useRouter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; dispatch &#125; = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">RouterStateContext</span>);<br>  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">url</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;navigate&#x27;</span>, url &#125;);<br>  &#125;, [dispatch]);<br>  <span class="hljs-keyword">const</span> goBack = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;back&#x27;</span> &#125;);<br>  &#125;, [dispatch]);<br>  <span class="hljs-keyword">return</span> &#123;<br>    navigate,<br>    goBack,<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ç¡®ä¿äº† Hook çš„ä½¿ç”¨è€…åœ¨éœ€è¦æ—¶èƒ½å¤Ÿä¼˜åŒ–è‡ªå·±çš„ä»£ç ã€‚</p><hr><p>â€”â€”æˆ‘çš„ç»„ä»¶æ¯ä¸€æ¬¡æ¸²æŸ“æ—¶, <code>useCallback</code> éƒ½è¿”å›äº†å®Œå…¨ä¸åŒçš„å‡½æ•°?</p><p>ç¡®ä¿ä½ å·²ç»å°†ä¾èµ–æ•°ç»„æŒ‡å®šä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼</p><p>å¦‚æœä½ å¿˜è®°ä½¿ç”¨ä¾èµ–æ•°ç»„ï¼Œ<code>useCallback</code> æ¯ä¸€æ¬¡éƒ½å°†è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7tdo64lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7tdo64lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;); <span class="hljs-comment">// ğŸ”´ æ¯ä¸€æ¬¡éƒ½è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼šæ²¡æœ‰ä¾èµ–é¡¹æ•°ç»„</span><br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å°†ä¾èµ–é¡¹æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ›´æ­£ç‰ˆæœ¬ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w0eeielqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w0eeielqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; productId, referrer &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/product/&#x27;</span> + productId + <span class="hljs-string">&#x27;/buy&#x27;</span>, &#123;<br>      referrer,<br>      orderDetails,<br>    &#125;);<br>  &#125;, [productId, referrer]); <span class="hljs-comment">// âœ… å¿…è¦æ—¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°</span><br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>å¦‚æœè¿™æ²¡æœ‰å¸®åŠ©ï¼Œé‚£ä¹ˆé—®é¢˜æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªä¾èµ–é¡¹ä¸ä¹‹å‰çš„æ¸²æŸ“ä¸åŒã€‚ä½ å¯ä»¥é€šè¿‡æ‰‹åŠ¨å°†ä¾èµ–é¡¹è®°å½•åˆ°æ§åˆ¶å°æ¥è°ƒè¯•æ­¤é—®é¢˜ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yr4vuilqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yr4vuilqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js">  <span class="hljs-keyword">const</span> handleSubmit = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">orderDetails</span>) =&gt;</span> &#123;<br><br>    <span class="hljs-comment">// ..</span><br><br>  &#125;, [productId, referrer]);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([productId, referrer]);<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼Œä½ å¯ä»¥åœ¨æ§åˆ¶å°ä¸­å³é”®å•å‡»æ¥è‡ªä¸åŒé‡æ–°æ¸²æŸ“çš„æ•°ç»„ï¼Œå¹¶ä¸ºå®ƒä»¬é€‰æ‹©â€œå­˜å‚¨ä¸ºå…¨å±€å˜é‡â€ã€‚å‡è®¾ç¬¬ä¸€ä¸ªè¢«ä¿å­˜ä¸º <code>temp1</code>ï¼Œç¬¬äºŒä¸ªè¢«ä¿å­˜ä¸º <code>temp2</code>ï¼Œç„¶åä½ å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ä¸¤ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªä¾èµ–é¡¹æ˜¯å¦ç›¸åŒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7pvsm7lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7pvsm7lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(temp1[<span class="hljs-number">0</span>], temp2[<span class="hljs-number">0</span>]); <span class="hljs-comment">// æ•°ç»„ä¹‹é—´çš„ç¬¬ä¸€ä¸ªä¾èµ–å…³ç³»æ˜¯å¦ç›¸åŒï¼Ÿ</span><br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(temp1[<span class="hljs-number">1</span>], temp2[<span class="hljs-number">1</span>]); <span class="hljs-comment">// æ•°ç»„ä¹‹é—´çš„ç¬¬äºŒä¸ªä¾èµ–å…³ç³»æ˜¯å¦ç›¸åŒï¼Ÿ</span><br><br><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(temp1[<span class="hljs-number">2</span>], temp2[<span class="hljs-number">2</span>]); <span class="hljs-comment">// æ•°ç»„ä¹‹é—´çš„æ¯ä¸€ä¸ªä¾èµ–å…³ç³»æ˜¯å¦ç›¸åŒ...</span><br></code></pre></td></tr></table></div></figure><p>å½“ä½ å‘ç°æ˜¯æŸä¸€ä¸ªä¾èµ–æ€§ç ´åè®°å¿†åŒ–æ—¶ï¼Œè¯·å°è¯•å°†å…¶åˆ é™¤ï¼Œæˆ–è€… <a href="https://zh-hans.react.dev/reference/react/useMemo#memoizing-a-dependency-of-another-hook">ä¹Ÿå¯¹å…¶è¿›è¡Œè®°å¿†åŒ–</a>ã€‚</p><p>â€”â€”æˆ‘éœ€è¦åœ¨å¾ªç¯ä¸­ä¸ºæ¯ä¸€ä¸ªåˆ—è¡¨é¡¹è°ƒç”¨ <code>useCallback</code> å‡½æ•°ï¼Œä½†æ˜¯è¿™ä¸è¢«å…è®¸ï¼Ÿ</p><p>å‡è®¾ <code>Chart</code> ç»„ä»¶è¢«åŒ…è£¹åœ¨ <a href="https://zh-hans.react.dev/reference/react/memo"><code>memo</code></a> ä¸­ã€‚ä½ å¸Œæœ›åœ¨ <code>ReportList</code> ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶è·³è¿‡é‡æ–°æ¸²æŸ“åˆ—è¡¨ä¸­çš„æ¯ä¸ª <code>Chart</code>ã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½åœ¨å¾ªç¯ä¸­è°ƒç”¨ <code>useCallback</code>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-i09m8plqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-i09m8plqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ReportList</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>     &#123;items.map(item =&gt; &#123;</span><br><span class="language-xml">        // ğŸ”´ ä½ ä¸èƒ½åœ¨å¾ªç¯ä¸­è°ƒç”¨ useCallbackï¼š</span><br><span class="language-xml">        const handleClick = useCallback(() =&gt; &#123;</span><br><span class="language-xml">          sendReport(item)</span><br><span class="language-xml">        &#125;, [item]);</span><br><span class="language-xml">        return (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">figure</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Chart</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span></span><br><span class="language-xml">        );</span><br><span class="language-xml">      &#125;)&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç›¸åï¼Œä¸ºå•ä¸ªé¡¹ç›®æå–ä¸€ä¸ªç»„ä»¶ï¼Œç„¶åä½¿ç”¨ <code>useCallback</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9pmxnxlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9pmxnxlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ReportList</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span></span><br><span class="language-xml">      &#123;items.map(item =&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Report</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span> /&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span><br>  );<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Report</span>(<span class="hljs-params">&#123; item &#125;</span>) &#123;<br>  <span class="hljs-comment">// âœ… åœ¨æœ€é¡¶å±‚è°ƒç”¨ useCallback</span><br>  <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">sendReport</span>(item)<br>  &#125;, [item]);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Chart</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…ï¼Œä½ å¯ä»¥åˆ é™¤æœ€åä¸€ä¸ªä»£ç æ®µä¸­çš„ <code>useCallback</code>ï¼Œå¹¶å°† <code>Report</code> æœ¬èº«åŒ…è£…åœ¨ <a href="https://zh-hans.react.dev/reference/react/memo"><code>memo</code></a> ä¸­ã€‚å¦‚æœ <code>item</code> props æ²¡æœ‰æ›´æ”¹ï¼Œ<code>Report</code> å°†è·³è¿‡é‡æ–°æ¸²æŸ“ï¼Œå› æ­¤ <code>Chart</code> ä¹Ÿå°†è·³è¿‡é‡æ–°æ¸²æŸ“ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-uc9974lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-uc9974lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ReportList</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Report</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">Report</span>(<span class="hljs-params">&#123; item &#125;</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">sendReport</span>(item);<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">figure</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Chart</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">figure</span>&gt;</span></span><br>  );<br>&#125;);<br></code></pre></td></tr></table></div></figure></li></ol></li></ol><p>æœ‰æ—¶ç”±äºå±å¹•ç¡®å®éœ€è¦æ›´æ–°ï¼Œæ— æ³•è·³è¿‡é‡æ–°æ¸²æŸ“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å°†å¿…é¡»åŒæ­¥çš„é˜»å¡æ›´æ–°ï¼ˆæ¯”å¦‚ä½¿ç”¨è¾“å…¥æ³•è¾“å…¥å†…å®¹ï¼‰ä¸ä¸éœ€è¦é˜»å¡ç”¨æˆ·ç•Œé¢çš„éé˜»å¡æ›´æ–°ï¼ˆæ¯”å¦‚æ›´æ–°å›¾è¡¨ï¼‰åˆ†ç¦»ä»¥æé«˜æ€§èƒ½ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹ Hook å¤„ç†æ¸²æŸ“ä¼˜å…ˆçº§ï¼š</p><ul><li><a href="https://zh-hans.react.dev/reference/react/useTransition"><code>useTransition</code></a> å…è®¸å°†çŠ¶æ€è½¬æ¢æ ‡è®°ä¸ºéé˜»å¡ï¼Œå¹¶å…è®¸å…¶ä»–æ›´æ–°ä¸­æ–­å®ƒã€‚</li><li><a href="https://zh-hans.react.dev/reference/react/useDeferredValue"><code>useDeferredValue</code></a> å…è®¸å»¶è¿Ÿæ›´æ–° UI çš„éå…³é”®éƒ¨åˆ†ï¼Œä»¥è®©å…¶ä»–éƒ¨åˆ†å…ˆæ›´æ–°ã€‚</li></ul><h2 id="6-èµ„æº-Hook"><a href="#6-èµ„æº-Hook" class="headerlink" title="6.èµ„æº Hook"></a>6.èµ„æº Hook</h2><p>èµ„æºå¯ä»¥è¢«ç»„ä»¶è®¿é—®ï¼Œè€Œæ— éœ€å°†å®ƒä»¬ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œç»„ä»¶å¯ä»¥ä» Promise ä¸­è¯»å–æ¶ˆæ¯ï¼Œæˆ–ä»ä¸Šä¸‹æ–‡ä¸­è¯»å–æ ·å¼ä¿¡æ¯ã€‚</p><p>Promise å¯¹è±¡è¡¨ç¤ºå¼‚æ­¥æ“ä½œæœ€ç»ˆçš„å®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰ä»¥åŠå…¶ç»“æœå€¼ã€‚</p><p>ä¸€ä¸ª <strong><code>Promise</code></strong> æ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªåœ¨åˆ›å»º promise æ—¶ä¸ä¸€å®šå·²çŸ¥çš„å€¼ã€‚å®ƒå…è®¸ä½ å°†å¤„ç†ç¨‹åºä¸å¼‚æ­¥æ“ä½œçš„æœ€ç»ˆæˆåŠŸå€¼æˆ–å¤±è´¥åŸå› å…³è”èµ·æ¥ã€‚è¿™ä½¿å¾—å¼‚æ­¥æ–¹æ³•å¯ä»¥åƒåŒæ­¥æ–¹æ³•ä¸€æ ·è¿”å›å€¼ï¼šå¼‚æ­¥æ–¹æ³•ä¸ä¼šç«‹å³è¿”å›æœ€ç»ˆå€¼ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª <em>promise</em>ï¼Œä»¥ä¾¿åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ç‚¹æä¾›è¯¥å€¼ã€‚</p><p>ä¸€ä¸ª <code>Promise</code> å¿…ç„¶å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li>å¾…å®šï¼ˆpendingï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢æ²¡æœ‰è¢«å…‘ç°ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»ã€‚</li><li>å·²å…‘ç°ï¼ˆfulfilledï¼‰ï¼šæ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆã€‚</li><li>å·²æ‹’ç»ï¼ˆrejectedï¼‰ï¼šæ„å‘³ç€æ“ä½œå¤±è´¥ã€‚</li></ul><p>ä¸€ä¸ªå¾…å®šçš„ Promise <em>æœ€ç»ˆçŠ¶æ€</em>å¯ä»¥æ˜¯<em>å·²å…‘ç°</em>å¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œæˆ–è€…æ˜¯<em>å·²æ‹’ç»</em>å¹¶è¿”å›ä¸€ä¸ªåŸå› ï¼ˆé”™è¯¯ï¼‰ã€‚å½“å…¶ä¸­ä»»æ„ä¸€ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œé€šè¿‡ Promise çš„ <code>then</code> æ–¹æ³•ä¸²è”çš„å¤„ç†ç¨‹åºå°†è¢«è°ƒç”¨ã€‚å¦‚æœç»‘å®šç›¸åº”å¤„ç†ç¨‹åºæ—¶ Promise å·²ç»å…‘ç°æˆ–æ‹’ç»ï¼Œè¿™å¤„ç†ç¨‹åºå°†è¢«ç«‹å³è°ƒç”¨ï¼Œå› æ­¤åœ¨å¼‚æ­¥æ“ä½œå®Œæˆå’Œç»‘å®šå¤„ç†ç¨‹åºä¹‹é—´ä¸å­˜åœ¨ç«æ€æ¡ä»¶ã€‚</p><p>å¦‚æœä¸€ä¸ª Promise å·²ç»è¢«å…‘ç°æˆ–æ‹’ç»ï¼Œå³ä¸å†å¤„äºå¾…å®šçŠ¶æ€ï¼Œé‚£ä¹ˆåˆ™ç§°ä¹‹ä¸ºå·²<em>æ•²å®šï¼ˆsettledï¼‰</em>ã€‚</p><p>ä½ è¿˜ä¼šå¬åˆ°ä½¿ç”¨<em>å·²è§£å†³</em>ï¼ˆresolvedï¼‰è¿™ä¸ªæœ¯è¯­æ¥æè¿° Promiseâ€”â€”è¿™æ„å‘³ç€è¯¥ Promise å·²ç»æ•²å®šï¼ˆsettledï¼‰ï¼Œæˆ–ä¸ºäº†åŒ¹é…å¦ä¸€ä¸ª Promise çš„æœ€ç»ˆçŠ¶æ€è€Œè¢«â€œé”å®šï¼ˆlock-inï¼‰â€ï¼Œè¿›ä¸€æ­¥è§£å†³æˆ–æ‹’ç»å®ƒéƒ½æ²¡æœ‰å½±å“ã€‚</p><img src="image-20231230201957024.png" alt="image-20231230201957024" style="zoom:50%;" /><p>ä½¿ç”¨ä»¥ä¸‹ Hook ä»¥ä»èµ„æºä¸­è¯»å–å€¼ï¼š</p><ul><li><a href="https://zh-hans.react.dev/reference/react/use"><code>use</code></a> å…è®¸è¯»å–åƒ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> æˆ– <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context">ä¸Šä¸‹æ–‡context</a> è¿™æ ·çš„èµ„æºçš„å€¼ã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jv271slqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jv271slqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageComponent</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> message = <span class="hljs-title function_">use</span>(messagePromise);<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸å…¶ä»– React Hook ä¸åŒçš„æ˜¯ï¼Œ<mark>å¯ä»¥åœ¨å¾ªç¯å’Œæ¡ä»¶è¯­å¥ï¼ˆå¦‚ <code>if</code>ï¼‰ä¸­è°ƒç”¨ <code>use</code></mark>ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨ <code>use</code> çš„å‡½æ•°ä»ç„¶å¿…é¡»æ˜¯ä¸€ä¸ªç»„ä»¶æˆ– Hookã€‚</p><p>å½“ä½¿ç”¨ Promise è°ƒç”¨ <code>use</code> Hook æ—¶ï¼Œå®ƒä¼šä¸ <a href="https://zh-hans.react.dev/reference/react/Suspense"><code>Suspense</code></a> å’Œ <a href="https://zh-hans.react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary">é”™è¯¯è¾¹ç•Œ</a> é›†æˆã€‚å½“ä¼ é€’ç»™ <code>use</code> çš„ Promise å¤„äº pending æ—¶ï¼Œè°ƒç”¨ <code>use</code> çš„ç»„ä»¶ä¹Ÿä¼š <strong>æŒ‚èµ·</strong>ã€‚å¦‚æœè°ƒç”¨ <code>use</code> çš„ç»„ä»¶è¢«åŒ…è£…åœ¨ Suspense è¾¹ç•Œå†…ï¼Œå°†æ˜¾ç¤ºåå¤‡ UIã€‚ä¸€æ—¦ Promise è¢«è§£å†³ï¼ŒSuspense åå¤‡æ–¹æ¡ˆå°†è¢«ä½¿ç”¨ <code>use</code> Hook è¿”å›çš„æ•°æ®æ›¿æ¢ã€‚å¦‚æœä¼ é€’ç»™ <code>use</code> çš„ Promise è¢«æ‹’ç»ï¼Œå°†æ˜¾ç¤ºæœ€è¿‘é”™è¯¯è¾¹ç•Œçš„åå¤‡ UIã€‚</p><p><code>use</code> Hook è¿”å›ä»èµ„æºä¸­è¯»å–çš„å€¼ï¼Œç±»ä¼¼äº fullfilled <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> æˆ– <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context">context</a>ã€‚</p><p>æ³¨æ„ï¼š </p><ul><li><code>use</code> Hook å¿…é¡»åœ¨ç»„ä»¶æˆ– Hook å†…éƒ¨è°ƒç”¨ã€‚</li><li>åœ¨ <a href="https://zh-hans.react.dev/reference/react/use-server">æœåŠ¡å™¨ç»„ä»¶</a> ä¸­è·å–æ•°æ®æ—¶ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ <code>async</code> å’Œ <code>await</code> è€Œä¸æ˜¯ <code>use</code>ã€‚<mark><code>async</code> å’Œ <code>await</code> ä¼šä»è°ƒç”¨ <code>await</code> çš„ç‚¹å¼€å§‹æ¸²æŸ“ï¼Œè€Œ <code>use</code> ä¼šåœ¨æ•°æ®è·å–åˆ°åé‡æ–°æ¸²æŸ“ç»„ä»¶</mark>ã€‚</li><li>åœ¨ <a href="https://zh-hans.react.dev/reference/react/use-server">æœåŠ¡å™¨ç»„ä»¶</a> ä¸­åˆ›å»º Promise å¹¶å°†å…¶ä¼ é€’ç»™ <a href="https://zh-hans.react.dev/reference/react/use-client">å®¢æˆ·ç«¯ç»„ä»¶</a> ä¼˜äºåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­åˆ›å»º Promiseã€‚<mark>åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­åˆ›å»ºçš„ Promise æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºã€‚ä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’åˆ°å®¢æˆ·ç«¯ç»„ä»¶çš„ Promise åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¿æŒç¨³å®š</mark>ã€‚</li></ul><p>ç”¨æ³•ï¼š</p><ol><li><p>ä½¿ç”¨ <code>use</code> è¯»å– contextï¼šå½“ <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context">context</a> è¢«ä¼ é€’ç»™ <code>use</code> æ—¶ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº<a href="https://zh-hans.react.dev/reference/react/useContext"><code>useContext</code></a>ã€‚è€Œ <code>useContext</code> å¿…é¡»åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ï¼Œ<code>use</code> å¯ä»¥åœ¨æ¡ä»¶è¯­å¥å¦‚ <code>if</code> å’Œå¾ªç¯å¦‚ <code>for</code> å†…è°ƒç”¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>use</code> æ¯” <code>useContext</code>æ›´åŠ çµæ´»ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-muums1lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-muums1lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; use &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p><code>use</code> è¿”å›ä¼ é€’çš„ context çš„ context å€¼ã€‚React ä¼šæœç´¢ç»„ä»¶æ ‘å¹¶æ‰¾åˆ° <strong>æœ€æ¥è¿‘çš„ context provider</strong> ä»¥ç¡®å®šéœ€è¦è¿”å›çš„ context å€¼ã€‚</p><p>å¦‚æœè¦å°†ä¸Šä¸‹æ–‡ä¼ é€’ç»™ <code>Button</code>ï¼Œè¯·å°†å…¶æˆ–å…¶çˆ¶ç»„ä»¶ä¹‹ä¸€åŒ…è£…åœ¨ç›¸åº”çš„ context provdier å†…ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ummxy5lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ummxy5lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyPage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;dark&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// â€¦â€¦åœ¨è¿™é‡Œé¢æ¸²æŸ“æŒ‰é’®â€¦â€¦</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ— è®ºåœ¨ provider å’Œ <code>Button</code> ä¹‹é—´æœ‰å¤šå°‘å±‚ç»„ä»¶ï¼Œéƒ½ä¸ä¼šæœ‰å½±å“ã€‚å½“ <code>Form</code> å†…çš„ä»»ä½•ä½ç½®çš„ <code>Button</code> è°ƒç”¨ <code>use(ThemeContext)</code> æ—¶ï¼Œå®ƒå°†æ¥æ”¶åˆ°å€¼ä¸º <code>&quot;dark&quot;</code>ã€‚</p><p>ä¸åŒäº <a href="https://zh-hans.react.dev/reference/react/useContext"><code>useContext</code></a>ï¼Œ<code>use</code> å¯ä»¥åœ¨æ¡ä»¶è¯­å¥å’Œå¾ªç¯ä¸­è°ƒç”¨ï¼Œæ¯”å¦‚ <code>if</code>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vrplwzlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vrplwzlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">HorizontalRule</span>(<span class="hljs-params">&#123; show &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (show) &#123;<br>    <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">hr</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;theme&#125;</span> /&gt;</span></span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>if</code> è¯­å¥å†…éƒ¨è°ƒç”¨äº† <code>use</code>ï¼Œå…è®¸æœ‰æ¡ä»¶åœ°ä» context ä¸­è¯»å–å€¼ã€‚</p><p>ä¸ <code>useContext</code> ç±»ä¼¼ï¼Œ<code>use(context)</code> å§‹ç»ˆæŸ¥æ‰¾è°ƒç”¨å®ƒçš„ç»„ä»¶ä¸Šæ–¹æœ€è¿‘çš„ context providerã€‚å®ƒå‘ä¸Šæœç´¢å¹¶å¿½ç•¥è°ƒç”¨ <code>use(context)</code> çš„ç»„ä»¶ä¸­çš„ context providerã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t23qpnlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t23qpnlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext, use &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;light&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Panel</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Welcome&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">show</span>=<span class="hljs-string">&#123;true&#125;</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">show</span>=<span class="hljs-string">&#123;false&#125;</span>&gt;</span>Log in<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Panel</span>(<span class="hljs-params">&#123; title, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-keyword">const</span> className = <span class="hljs-string">&#x27;panel-&#x27;</span> + theme;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; show, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (show) &#123;<br>    <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">ThemeContext</span>);<br>    <span class="hljs-keyword">const</span> className = <span class="hljs-string">&#x27;button-&#x27;</span> + theme;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>    );<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231120171744803.png" alt="image-20231120171744803" style="zoom:50%;" /></li><li><p><mark>å°†æ•°æ®ä»æœåŠ¡å™¨æµå¼ä¼ é€’ç»™å®¢æˆ·ç«¯</mark>ï¼šæ•°æ®å¯ä»¥é€šè¿‡å°† Promise ä½œä¸º prop ä» æœåŠ¡å™¨ç»„ä»¶ ä¼ é€’åˆ° å®¢æˆ·ç«¯ç»„ä»¶ ä»¥ä»æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v20zuclqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v20zuclqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; fetchMessage &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./lib.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Message</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./message.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> messagePromise = <span class="hljs-title function_">fetchMessage</span>();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span>&gt;</span>waiting for message...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">messagePromise</span>=<span class="hljs-string">&#123;messagePromise&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å®¢æˆ·ç«¯ç»„ä»¶å°† ä» prop ä¸­æ¥æ”¶åˆ°çš„ Promise  ä¼ é€’ç»™ <code>use</code> Hookã€‚è¿™å…è®¸ å®¢æˆ·ç«¯ç»„ä»¶ ä»æœ€åˆç”±æœåŠ¡å™¨ç»„ä»¶åˆ›å»ºçš„ Promise ä¸­è¯»å–å€¼ã€‚</p><p>Message.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n3xvewlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n3xvewlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-string">&#x27;use client&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; use &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> messageContent = <span class="hljs-title function_">use</span>(messagePromise);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here is the message: &#123;messageContent&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç”±äº <code>Message</code> è¢«åŒ…è£¹åœ¨ <a href="https://zh-hans.react.dev/reference/react/Suspense"><code>Suspense</code></a> ä¸­ï¼Œæ‰€ä»¥åœ¨ Promise è§£å†³ä¹‹å‰å°†æ˜¾ç¤ºåå¤‡æ–¹æ¡ˆã€‚å½“ Promise è¢«è§£å†³åï¼Œ<code>use</code> Hook å°†è¯»å–å€¼ï¼Œç„¶å <code>Message</code> ç»„ä»¶å°†æ›¿æ¢ Suspense åå¤‡æ–¹æ¡ˆã€‚</p><p>Message.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x7y12alqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x7y12alqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-string">&quot;use client&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; use, <span class="hljs-title class_">Suspense</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> messageContent = <span class="hljs-title function_">use</span>(messagePromise);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here is the message: &#123;messageContent&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageContainer</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span>&gt;</span>âŒ›Downloading message...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">messagePromise</span>=<span class="hljs-string">&#123;messagePromise&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="message.gif" alt="message" style="zoom:50%;" /><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">å°†æ¥è‡ªæœåŠ¡å™¨ç»„ä»¶çš„ Promise ä¼ é€’è‡³å®¢æˆ·ç«¯ç»„ä»¶æ—¶ï¼Œå…¶è§£æå€¼å¿…é¡»å¯åºåˆ—åŒ–ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’ã€‚åƒå‡½æ•°è¿™æ ·çš„æ•°æ®ç±»å‹ä¸å¯åºåˆ—åŒ–ï¼Œä¸èƒ½æˆä¸ºè¿™ç§ Promise çš„è§£æå€¼ã€‚</p><p>â€”â€”åº”è¯¥åœ¨æœåŠ¡å™¨ç»„ä»¶è¿˜æ˜¯å®¢æˆ·ç«¯ç»„ä»¶è§£æ Promiseï¼Ÿ </p><p>Promise å¯ä»¥ä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’è‡³å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­ä½¿ç”¨ <code>use</code> Hook è§£æå®ƒã€‚ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç»„ä»¶ä¸­ä½¿ç”¨ <code>await</code> è§£æ Promiseï¼Œå¹¶å°†æ‰€éœ€çš„æ•°æ®ä½œä¸º prop ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ydg1yflqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ydg1yflqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> messageContent = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchMessage</span>();<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">messageContent</span>=<span class="hljs-string">&#123;messageContent&#125;</span> /&gt;</span></span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯<mark>åœ¨ <a href="https://zh-hans.react.dev/reference/react/components#server-components">æœåŠ¡å™¨ç»„ä»¶</a> ä¸­ä½¿ç”¨ <code>await</code> ä¼šåœ¨ <code>await</code> æ‰§è¡Œå®Œæˆå‰é˜»å¡æ¸²æŸ“ã€‚è€Œå°† Promise ä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’åˆ°å®¢æˆ·ç«¯ç»„ä»¶å¯ä»¥é˜²æ­¢ Promise é˜»å¡æœåŠ¡å™¨ç»„ä»¶æ¸²æŸ“</mark>ã€‚</p></li><li><p>å¤„ç† rejected Promiseï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™ <code>use</code> çš„ Promise å¯èƒ½ä¼šè¢«æ‹’ç»ï¼ˆrejectedï¼‰ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç† rejected Promiseï¼š</p><ol><li><p><mark>ä½¿ç”¨é”™è¯¯è¾¹ç•Œå°†é”™è¯¯å±•ç¤ºç»™ç”¨æˆ·</mark>ï¼šå¦‚æœå¸Œæœ›åœ¨ Promise è¢«æ‹’ç»ï¼ˆrejectedï¼‰æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary">é”™è¯¯è¾¹ç•Œ</a>ã€‚å¦‚æœéœ€è¦ä½¿ç”¨é”™è¯¯è¾¹ç•Œï¼Œè¯·å°†è°ƒç”¨ <code>use</code> Hook çš„ç»„ä»¶åŒ…è£…åœ¨é”™è¯¯è¾¹ç•Œä¸­ã€‚å¦‚æœä¼ é€’ç»™ <code>use</code> çš„ Promise è¢«æ‹’ç»ï¼ˆrejectedï¼‰ï¼Œå°†æ˜¾ç¤ºé”™è¯¯è¾¹ç•Œçš„åå¤‡æ–¹æ¡ˆã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-aluyfulqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-aluyfulqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-string">&quot;use client&quot;</span>;<br><br><span class="hljs-keyword">import</span> &#123; use, <span class="hljs-title class_">Suspense</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ErrorBoundary</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-error-boundary&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageContainer</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span>&gt;</span>âš ï¸Something went wrong<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span>&gt;</span>âŒ›Downloading message...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">messagePromise</span>=<span class="hljs-string">&#123;messagePromise&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; messagePromise &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">use</span>(messagePromise);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Here is the message: &#123;content&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="reject.gif" alt="reject" style="zoom:50%;" /></li><li><p><mark>ä½¿ç”¨ <code>Promise.catch</code> æä¾›æ›¿ä»£å€¼</mark>ï¼šå¦‚æœå¸Œæœ›åœ¨ä¼ é€’ç»™ <code>use</code> çš„ Promise è¢«æ‹’ç»ï¼ˆrejectedï¼‰æ—¶æä¾›æ›¿ä»£å€¼ï¼Œå¯ä»¥ä½¿ç”¨ Promise çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>catch</code></a> æ–¹æ³•ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-efzu9glqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-efzu9glqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Message</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./message.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> messagePromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">reject</span>();<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;no new message found.&quot;</span>;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">p</span>&gt;</span>waiting for message...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> <span class="hljs-attr">messagePromise</span>=<span class="hljs-string">&#123;messagePromise&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¦ä½¿ç”¨ Promise çš„ <code>catch</code> æ–¹æ³•ï¼Œè¯·åœ¨ Promise å¯¹è±¡ä¸Šè°ƒç”¨ <code>catch</code>ã€‚<code>catch</code> æ¥å—ä¸€ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ¥å—é”™è¯¯æ¶ˆæ¯ä½œä¸ºå‚æ•°çš„å‡½æ•°ã€‚ç”±ä¼ é€’ç»™ <code>catch</code> çš„å‡½æ•° è¿”å› çš„ä»»ä½•å†…å®¹éƒ½å°†è§†ä¸º Promise çš„è§£å†³å€¼ã€‚</p><p>ä¸èƒ½åœ¨ try-catch å—ä¸­è°ƒç”¨ <code>use</code>ã€‚å¯ä»¥é€‰æ‹©å°†ç»„ä»¶ <a href="https://zh-hans.react.dev/reference/react/use#displaying-an-error-to-users-with-error-boundary">åŒ…è£…åœ¨é”™è¯¯è¾¹ç•Œä¸­</a>ï¼Œæˆ–è€… <a href="https://zh-hans.react.dev/reference/react/use#providing-an-alternative-value-with-promise-catch">ä½¿ç”¨ Promise <code>.catch</code> æ–¹æ³•æä¾›æ›¿ä»£å€¼ç»™ <code>use</code></a>ã€‚</p></li></ol></li></ol><p>è¦ä¹ˆåœ¨ React ç»„ä»¶æˆ– Hook å‡½æ•°ä¹‹å¤–è°ƒç”¨ <code>use</code>ï¼Œæˆ–è€…åœ¨ try-catch å—ä¸­è°ƒç”¨ <code>use</code>ã€‚å¦‚æœä½ åœ¨ try-catch å—ä¸­è°ƒç”¨ <code>use</code>ï¼Œè¯·å°†ç»„ä»¶åŒ…è£¹åœ¨é”™è¯¯è¾¹ç•Œä¸­ï¼Œæˆ–è€…ä½¿ç”¨ Promise çš„ <code>catch</code> æ–¹æ³•æ¥æ•è·é”™è¯¯å¹¶æä¾›ç»™æ›¿ä»£å€¼ã€‚</p><p><mark>å¦‚æœåœ¨ React ç»„ä»¶æˆ– Hook å‡½æ•°ä¹‹å¤–è°ƒç”¨ <code>use</code>ï¼Œè¯·å°† <code>use</code> è°ƒç”¨ç§»è‡³ React ç»„ä»¶æˆ– Hook å‡½æ•°ä¸­f</mark>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-73h6nvlqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-73h6nvlqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageComponent</span>(<span class="hljs-params">&#123;messagePromise&#125;</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">download</span>(<span class="hljs-params"></span>) &#123;<br>    &lt;!--  âŒ è°ƒç”¨ <span class="hljs-string">`use`</span> çš„å‡½æ•°ä¸æ˜¯ç»„ä»¶æˆ–è€… <span class="hljs-title class_">Hook</span> --&gt; <br>    <span class="hljs-keyword">const</span> message = <span class="hljs-title function_">use</span>(messagePromise);<br>    <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ç›¸åï¼Œè¯·åœ¨ä»»ä½•ç»„ä»¶å°é—­åŒºåŸŸä¹‹å¤–è°ƒç”¨ <code>use</code>ï¼Œè€Œè°ƒç”¨ <code>use</code> çš„å‡½æ•°æœ¬èº«åº”ä¸ºç»„ä»¶æˆ– Hookã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zs4dm8lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zs4dm8lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MessageComponent</span>(<span class="hljs-params">&#123;messagePromise&#125;</span>) &#123;<br>  &lt;!--  âœ… <span class="hljs-string">`use`</span> æ­£åœ¨ç»„ä»¶å†…è¢«è°ƒç”¨ --&gt; <br>  <span class="hljs-keyword">const</span> message = <span class="hljs-title function_">use</span>(messagePromise);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><h2 id="7-å…¶ä»–-Hook"><a href="#7-å…¶ä»–-Hook" class="headerlink" title="7.å…¶ä»– Hook"></a>7.å…¶ä»– Hook</h2><p>è¿™äº› Hook ä¸»è¦é€‚ç”¨äºåº“ä½œè€…ï¼Œä¸å¸¸åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨ã€‚</p><ul><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useDebugValue"><code>useDebugValue</code></a> è‡ªå®šä¹‰ React å¼€å‘è€…å·¥å…·ä¸ºè‡ªå®šä¹‰ Hook æ·»åŠ çš„æ ‡ç­¾ã€‚</li><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useId"><code>useId</code></a> å°†å”¯ä¸€çš„ ID ä¸ç»„ä»¶ç›¸å…³è”ï¼Œå…¶é€šå¸¸ä¸å¯è®¿é—®æ€§ API ä¸€èµ·ä½¿ç”¨ã€‚</li><li>ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a> è®¢é˜…å¤–éƒ¨ storeã€‚</li></ul><h2 id="8-è‡ªå®šä¹‰-Hook"><a href="#8-è‡ªå®šä¹‰-Hook" class="headerlink" title="8.è‡ªå®šä¹‰ Hook"></a>8.è‡ªå®šä¹‰ Hook</h2><p>å¼€å‘è€…å¯ä»¥ <a href="https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks#extracting-your-own-custom-hook-from-a-component">è‡ªå®šä¹‰ Hook</a> ä½œä¸º JavaScript å‡½æ•°ã€‚</p><p>useContextï¼š<a href="https://zh-hans.react.dev/reference/react/useContext">https://zh-hans.react.dev/reference/react/useContext</a></p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
      <tag>Hook</tag>
      
      <tag>ç»„ä»¶</tag>
      
      <tag>API</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…­.Reactæ•™ç¨‹</title>
    <link href="/2023/11/01/React%E6%95%99%E7%A8%8B/"/>
    <url>/2023/11/01/React%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>Reactå®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼š<a href="https://zh-hans.react.dev/learn/react-developer-tools">https://zh-hans.react.dev/learn/react-developer-tools</a></p><p>å®˜æ–¹Githubä»“åº“ï¼š<a href="https://github.com/reactjs/zh-hans.react.dev">https://github.com/reactjs/zh-hans.react.dev</a></p><p>å‰ç«¯åœ¨çº¿ç¼–è¾‘å™¨å…¬å¼€æ²™ç›’ï¼š<a href="https://codesandbox.io/dashboard/recent?workspace=44913078-bd56-4551-abd7-4139b7ec6366">https://codesandbox.io/dashboard/recent?workspace=44913078-bd56-4551-abd7-4139b7ec6366</a></p><p>æœ¬åœ°å¯åŠ¨é¡¹ç›®ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0qo1n9lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0qo1n9lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g yarn<br>yarn <br>yarn dev<br></code></pre></td></tr></table></div></figure><img src="image-20231030163722152.png" alt="image-20231030163722152" style="zoom:50%;" /><img src="image-20231030164520318.png" alt="image-20231030164520318" style="zoom:50%;" /><img src="image-20231030164705426.png" alt="image-20231030164705426" style="zoom:50%;" /><p>å®‰è£…æ‰©å±•ESLintã€ JavaScript ä»£ç æ£€æŸ¥å·¥å…·ã€‘ï¼ŒPrettier</p><p>ä¿å­˜å¹¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼š</p><ol><li>æŒ‰å¿«æ·é”® <code>Ctrl/Cmd + Shift + P</code>.</li><li>è¾“å…¥ â€œsettingsâ€</li><li>æŒ‰å›è½¦é”®</li><li>åœ¨æœç´¢æ , è¾“å…¥ â€œformat on saveâ€</li><li>ç¡®ä¿å‹¾é€‰ â€œformat on saveâ€ é€‰é¡¹</li></ol><p>Chromeæ’ä»¶ï¼š<code>React Developer Tools</code></p><img src="image-20231101175313970.png" alt="image-20231101175313970" style="zoom:50%;" /><img src="image-20231101175344676.png" alt="image-20231101175344676" style="zoom:50%;" /><h1 id="ä¸€-ä½¿ç”¨TypeScript"><a href="#ä¸€-ä½¿ç”¨TypeScript" class="headerlink" title="ä¸€.ä½¿ç”¨TypeScript"></a>ä¸€.ä½¿ç”¨TypeScript</h1><p>TypeScriptå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.typescriptlang.org/zh/docs/handbook/">https://www.typescriptlang.org/zh/docs/handbook/</a></p><p>TypeScript æ˜¯ä¸€ç§å‘ JavaScript ä»£ç æ·»åŠ ç±»å‹å®šä¹‰çš„å¸¸ç”¨æ–¹æ³•ã€‚TypeScript å¤©ç„¶æ”¯æŒ JSXâ€”â€”åªéœ€åœ¨é¡¹ç›®ä¸­æ·»åŠ  <a href="https://www.npmjs.com/package/@types/react"><code>@types/react</code></a> å’Œ <a href="https://www.npmjs.com/package/@types/react-dom"><code>@types/react-dom</code></a> å³å¯è·å¾—å®Œæ•´çš„ React Web æ”¯æŒã€‚</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hz1hinlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hz1hinlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @types/react @types/react-dom<br></code></pre></td></tr></table></div></figure><p>ç„¶ååœ¨ <code>tsconfig.json</code> ä¸­è®¾ç½®ä»¥ä¸‹ç¼–è¯‘å™¨é€‰é¡¹ï¼š</p><ol><li>å¿…é¡»åœ¨ <a href="https://www.typescriptlang.org/tsconfig/#lib"><code>lib</code></a> ä¸­åŒ…å« <code>dom</code>ï¼ˆæ³¨æ„ï¼šå¦‚æœæ²¡æœ‰æŒ‡å®š <code>lib</code> é€‰é¡¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåŒ…å« <code>dom</code>ï¼‰ã€‚</li><li><a href="https://www.typescriptlang.org/tsconfig/#jsx"><code>jsx</code></a> å¿…é¡»è®¾ç½®ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„é€‰é¡¹ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œ<code>preserve</code> åº”è¯¥è¶³å¤Ÿäº†ã€‚ å¦‚æœä½ æ­£åœ¨å‘å¸ƒä¸€ä¸ªåº“ï¼Œè¯·æŸ¥é˜… <a href="https://www.typescriptlang.org/tsconfig/#jsx"><code>jsx</code> æ–‡æ¡£</a> ä»¥é€‰æ‹©åˆé€‚çš„å€¼ã€‚</li></ol><p>ä¸ºæŒ‰é’®çš„ <code>title</code> æ·»åŠ ä¸€ä¸ªæè¿°ç±»å‹ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sc4ghflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sc4ghflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params">&#123; title &#125;: &#123; title: <span class="hljs-built_in">string</span> &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ç§å†…è”è¯­æ³•æ˜¯ä¸ºç»„ä»¶æä¾›ç±»å‹çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†æ˜¯ä¸€æ—¦ä½ å¼€å§‹æè¿°å‡ ä¸ªå­—æ®µï¼Œå®ƒå¯èƒ½å˜å¾—éš¾ä»¥ç®¡ç†ã€‚ç›¸åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>interface</code> æˆ– <code>type</code> æ¥æè¿°ç»„ä»¶çš„ propsï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cnubi2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cnubi2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyButtonProps</span> &#123;<br>  <span class="hljs-comment">/* æŒ‰é’®æ–‡å­— */</span><br>  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-comment">/* æŒ‰é’®æ˜¯å¦ç¦ç”¨ */</span><br>  <span class="hljs-attr">disabled</span>: <span class="hljs-built_in">boolean</span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params">&#123; title, disabled &#125;: MyButtonProps</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;disabled&#125;</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to my app<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;æˆ‘æ˜¯ä¸€ä¸ªç¦ç”¨æŒ‰é’®&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;true&#125;/</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸º state æ˜¾å¼æä¾›ä¸€ä¸ªç±»å‹ï¼Œä½ å¯ä»¥é€šè¿‡ä¸º <code>useState</code> è°ƒç”¨æä¾›ä¸€ä¸ªç±»å‹å‚æ•°æ¥å®ç°ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ouzwo5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ouzwo5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// æ˜¾å¼è®¾ç½®ç±»å‹ä¸º &quot;boolean&quot;</span><br><span class="hljs-keyword">const</span> [enabled, setEnabled] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></div></figure><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å½“ä½ æœ‰ä¸€ä¸ªè”åˆç±»å‹æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦æä¾›ä¸€ä¸ª <code>type</code>ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œçš„ <code>status</code> å¯ä»¥æ˜¯å‡ ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ä¹‹ä¸€ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bp2d88lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bp2d88lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-string">&quot;idle&quot;</span> | <span class="hljs-string">&quot;loading&quot;</span> | <span class="hljs-string">&quot;success&quot;</span> | <span class="hljs-string">&quot;error&quot;</span>;<br><br><span class="hljs-keyword">const</span> [status, setStatus] = useState&lt;<span class="hljs-title class_">Status</span>&gt;(<span class="hljs-string">&quot;idle&quot;</span>);<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…ï¼Œå¦‚ <a href="http://localhost:3000/learn/choosing-the-state-structure#principles-for-structuring-state">é€‰æ‹© state ç»“æ„åŸåˆ™</a> ä¸­æ¨èçš„ï¼Œä½ å¯ä»¥å°†ç›¸å…³çš„ state ä½œä¸ºä¸€ä¸ªå¯¹è±¡åˆ†ç»„ï¼Œå¹¶é€šè¿‡å¯¹è±¡ç±»å‹æè¿°ä¸åŒçš„å¯èƒ½æ€§ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1a6qhvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1a6qhvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">RequestState</span> =<br>  | &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;idle&#x27;</span> &#125;<br>  | &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;loading&#x27;</span> &#125;<br>  | &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span> &#125;<br>  | &#123; <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-attr">error</span>: <span class="hljs-title class_">Error</span> &#125;;<br><br><span class="hljs-keyword">const</span> [requestState, setRequestState] = useState&lt;<span class="hljs-title class_">RequestState</span><br></code></pre></td></tr></table></div></figure><p><code>useReducer</code>æ¥å—ä¸€ä¸ª reducer å‡½æ•°å’Œä¸€ä¸ªåˆå§‹ state ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†ä»åˆå§‹ state æ¨æ–­å‡º reducer å‡½æ•°çš„ç±»å‹ã€‚ä½ å¯ä»¥é€‰æ‹©æ€§åœ°ä¸º <code>useReducer</code> æä¾›ç±»å‹å‚æ•°ä»¥ä¸º state æä¾›ç±»å‹ã€‚ä½†æ˜¯æ›´é«˜çš„åšæ³•ä»ç„¶æ˜¯åœ¨åˆå§‹ state ä¸Šæ·»åŠ ç±»å‹ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-87zoj7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-87zoj7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123;useReducer&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">State</span> &#123;<br>   <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> <br>&#125;;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">CounterAction</span> =<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;reset&quot;</span> &#125;<br>  | &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;setCount&quot;</span>; <span class="hljs-attr">value</span>: <span class="hljs-title class_">State</span>[<span class="hljs-string">&quot;count&quot;</span>] &#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">initialState</span>: <span class="hljs-title class_">State</span> = &#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">stateReducer</span>(<span class="hljs-params">state: State, action: CounterAction</span>): <span class="hljs-title class_">State</span> &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;reset&quot;</span>:<br>      <span class="hljs-keyword">return</span> initialState;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;setCount&quot;</span>:<br>      <span class="hljs-keyword">return</span> &#123; ...state, <span class="hljs-attr">count</span>: action.<span class="hljs-property">value</span> &#125;;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Unknown action&quot;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(stateReducer, initialState);<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addFive</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;setCount&quot;</span>, <span class="hljs-attr">value</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">5</span> &#125;);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;reset&quot;</span> &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°æˆ‘çš„è®¡æ•°å™¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¡æ•°ï¼š &#123;state.count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;addFive&#125;</span>&gt;</span>åŠ  5<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;reset&#125;</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231101152507530.png" alt="image-20231101152507530" style="zoom:50%;" /><hr><p><a href="http://localhost:3000/reference/react/useContext"><code>useContext</code></a> æ˜¯ä¸€ç§æ— éœ€é€šè¿‡ç»„ä»¶ä¼ é€’ props è€Œå¯ä»¥ç›´æ¥åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®çš„æŠ€æœ¯ã€‚å®ƒæ˜¯é€šè¿‡åˆ›å»º provider ç»„ä»¶ä½¿ç”¨ï¼Œé€šå¸¸è¿˜ä¼šåˆ›å»ºä¸€ä¸ª hook ä»¥åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨è¯¥å€¼ã€‚</p><p>ä»ä¼ é€’ç»™ <code>createContext</code> è°ƒç”¨çš„å€¼æ¨æ–­ context æä¾›çš„å€¼çš„ç±»å‹ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sni9s0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sni9s0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; createContext, useContext, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Theme</span> = <span class="hljs-string">&quot;light&quot;</span> | <span class="hljs-string">&quot;dark&quot;</span> | <span class="hljs-string">&quot;system&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = createContext&lt;<span class="hljs-title class_">Theme</span>&gt;(<span class="hljs-string">&quot;system&quot;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useGetTheme</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [theme, setTheme] = useState&lt;<span class="hljs-title class_">Theme</span>&gt;(<span class="hljs-string">&#x27;light&#x27;</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;theme&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useGetTheme</span>();<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å½“å‰ä¸»é¢˜ï¼š&#123;theme&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231101155923881.png" alt="image-20231101155923881" style="zoom:50%;" /><p>å½“ä½ æ²¡æœ‰ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼æ—¶ï¼Œè¿™ç§æŠ€æœ¯æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ<code>null</code> ä½œä¸ºé»˜è®¤å€¼å¯èƒ½æ„Ÿè§‰æ˜¯åˆç†çš„ã€‚ä½†æ˜¯ï¼Œä¸ºäº†è®©ç±»å‹ç³»ç»Ÿç†è§£ä½ çš„ä»£ç ï¼Œä½ éœ€è¦åœ¨ <code>createContext</code> ä¸Šæ˜¾å¼è®¾ç½® <code>ContextShape | null</code>ã€‚</p><p>è¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦åœ¨ context consumer ä¸­æ¶ˆé™¤ <code>| null</code> çš„ç±»å‹ã€‚æˆ‘ä»¬å»ºè®®è®© hook åœ¨è¿è¡Œæ—¶æ£€æŸ¥å®ƒçš„å­˜åœ¨ï¼Œå¹¶åœ¨ä¸å­˜åœ¨æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q28gaulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q28gaulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; createContext, useContext, useState, useMemo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½†ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªæ›´å¤æ‚çš„å¯¹è±¡</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">ComplexObject</span> = &#123;<br>  <span class="hljs-attr">kind</span>: <span class="hljs-built_in">string</span><br>&#125;;<br><br><span class="hljs-comment">// ä¸Šä¸‹æ–‡åœ¨ç±»å‹ä¸­åˆ›å»ºä¸º `| null`ï¼Œä»¥å‡†ç¡®åæ˜ é»˜è®¤å€¼ã€‚</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Context</span> = createContext&lt;<span class="hljs-title class_">ComplexObject</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// è¿™ä¸ª hook ä¼šåœ¨è¿è¡Œæ—¶æ£€æŸ¥ context æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åœ¨ä¸å­˜åœ¨æ—¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useGetComplexObject</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-built_in">object</span> = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Context</span>);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">object</span>) &#123; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;useGetComplexObject must be used within a Provider&quot;</span>) &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-built_in">object</span> = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> (&#123; <span class="hljs-attr">kind</span>: <span class="hljs-string">&quot;complex&quot;</span> &#125;), []);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Context.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;object&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyComponent</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Context.Provider</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-built_in">object</span> = <span class="hljs-title function_">useGetComplexObject</span>();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Current object: &#123;object.kind&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p><a href="http://localhost:3000/reference/react/useMemo"><code>useMemo</code></a> ä¼šä»å‡½æ•°è°ƒç”¨ä¸­åˆ›å»º&#x2F;é‡æ–°è®¿é—®è®°å¿†åŒ–å€¼ï¼Œåªæœ‰åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ å…¥çš„ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è¿è¡Œè¯¥å‡½æ•°ã€‚å‡½æ•°çš„ç±»å‹æ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°ä¸­å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œæ¨æ–­çš„ï¼Œå¦‚æœå¸Œæœ›æ˜ç¡®æŒ‡å®šï¼Œå¯ä»¥ä¸ºè¿™ä¸ªé’©å­æä¾›ä¸€ä¸ªç±»å‹å‚æ•°ä»¥æŒ‡å®šå‡½æ•°ç±»å‹ã€‚</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y2p8sylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y2p8sylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// ä» filterTodos çš„è¿”å›å€¼æ¨æ–­ visibleTodos çš„ç±»å‹</span><br><span class="hljs-keyword">const</span> visibleTodos = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">filterTodos</span>(todos, tab), <br></code></pre></td></tr></table></div></figure><hr><p><a href="http://localhost:3000/reference/react/useCallback"><code>useCallback</code></a> ä¼šåœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä¼ å…¥çš„ä¾èµ–é¡¹ä¿æŒä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¸ºå‡½æ•°æä¾›ç›¸åŒçš„å¼•ç”¨ã€‚ä¸ <code>useMemo</code> ç±»ä¼¼ï¼Œå‡½æ•°çš„ç±»å‹æ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°ä¸­å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œæ¨æ–­çš„ï¼Œå¦‚æœå¸Œæœ›æ˜ç¡®æŒ‡å®šï¼Œå¯ä»¥ä¸ºè¿™ä¸ªé’©å­æä¾›ä¸€ä¸ªç±»å‹å‚æ•°ä»¥æŒ‡å®šå‡½æ•°ç±»å‹ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-093fcplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-093fcplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;, [todos]);<br></code></pre></td></tr></table></div></figure><p>å½“åœ¨ TypeScript ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ <code>useCallback</code> éœ€è¦ä¸ºå›è°ƒå‡½æ•°ä¸­çš„å‚æ•°æ·»åŠ ç±»å‹æ³¨è§£ã€‚è¿™æ˜¯å› ä¸ºå›è°ƒå‡½æ•°çš„ç±»å‹æ˜¯æ ¹æ®å‡½æ•°çš„è¿”å›å€¼è¿›è¡Œæ¨æ–­çš„â€”â€”å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œé‚£ä¹ˆç±»å‹å°±ä¸èƒ½å®Œå…¨ç†è§£ã€‚</p><p>æ ¹æ®è‡ªèº«çš„ä»£ç é£æ ¼åå¥½ï¼Œä½ å¯ä»¥ä½¿ç”¨ React ç±»å‹ä¸­çš„ <code>*EventHandler</code> å‡½æ•°ä»¥åœ¨å®šä¹‰å›è°ƒå‡½æ•°çš„åŒæ—¶ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºæä¾›ç±»å‹æ³¨è§£ï¼š</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-12zez2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-12zez2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; useState, useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&quot;Change me&quot;</span>);<br>  <span class="hljs-keyword">const</span> handleChange = useCallback&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">ChangeEventHandler</span>&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;&gt;(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setValue</span>(event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">value</span>);<br><br>  &#125;, [setValue])<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å€¼ï¼š &#123;value&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>åœ¨ React ä¸­å¤„ç† DOM äº‹ä»¶æ—¶ï¼Œäº‹ä»¶çš„ç±»å‹é€šå¸¸å¯ä»¥ä»äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ¨æ–­å‡ºæ¥ã€‚ä½†æ˜¯ï¼Œå½“ä½ æƒ³æå–ä¸€ä¸ªå‡½æ•°ä»¥ä¼ é€’ç»™äº‹ä»¶å¤„ç†ç¨‹åºæ—¶ï¼Œä½ éœ€è¦æ˜ç¡®è®¾ç½®äº‹ä»¶çš„ç±»å‹ã€‚</p><figure class="highlight tsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bwjc66lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bwjc66lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&quot;Change me&quot;</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">event: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) &#123;<br>    <span class="hljs-title function_">setValue</span>(event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å€¼ï¼š &#123;value&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231101170008390.png" alt="image-20231101170008390" style="zoom:50%;" /><p>æè¿°ç»„ä»¶çš„å­å…ƒç´ æœ‰ä¸¤ç§å¸¸è§æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ <code>React.ReactNode</code> ç±»å‹ï¼Œè¿™æ˜¯å¯ä»¥åœ¨ JSX ä¸­ä½œä¸ºå­å…ƒç´ ä¼ é€’çš„æ‰€æœ‰å¯èƒ½ç±»å‹çš„å¹¶é›†ï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-k0hue4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-k0hue4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ModalRendererProps</span> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å¯¹å­å…ƒç´ çš„ä¸€ä¸ªéå¸¸å®½æ³›çš„å®šä¹‰ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>React.ReactElement</code> ç±»å‹ï¼Œå®ƒåªåŒ…æ‹¬ JSX å…ƒç´ ï¼Œè€Œä¸åŒ…æ‹¬ JavaScript åŸå§‹ç±»å‹ï¼Œå¦‚ string æˆ– numberï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-92ldpnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-92ldpnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ModalRendererProps</span> &#123;<br>  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactElement</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„ï¼Œä½ ä¸èƒ½ä½¿ç”¨ TypeScript æ¥æè¿°å­å…ƒç´ æ˜¯æŸç§ç±»å‹çš„ JSX å…ƒç´ ï¼Œæ‰€ä»¥ä½ ä¸èƒ½ä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥æè¿°ä¸€ä¸ªåªæ¥å— <code>&lt;li&gt;</code> å­å…ƒç´ çš„ç»„ä»¶ã€‚</p><p>å½“åœ¨ React ä¸­ä½¿ç”¨å†…è”æ ·å¼æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>React.CSSProperties</code> æ¥æè¿°ä¼ é€’ç»™ <code>style</code> å±æ€§çš„å¯¹è±¡ã€‚è¿™ä¸ªç±»å‹æ˜¯æ‰€æœ‰å¯èƒ½çš„ CSS å±æ€§çš„å¹¶é›†ï¼Œå®ƒèƒ½ç¡®ä¿ä½ ä¼ é€’ç»™ <code>style</code> å±æ€§çš„æ˜¯æœ‰æ•ˆçš„ CSS å±æ€§ï¼Œå¹¶ä¸”ä½ èƒ½åœ¨ç¼–è¾‘å™¨ä¸­è·å¾—æ ·å¼ç¼–ç æç¤ºã€‚</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9uc61ylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9uc61ylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyComponentProps</span> &#123;<br>  <span class="hljs-attr">style</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><h1 id="äºŒ-å…¥é—¨"><a href="#äºŒ-å…¥é—¨" class="headerlink" title="äºŒ.å…¥é—¨"></a>äºŒ.å…¥é—¨</h1><p>React åº”ç”¨ç¨‹åºæ˜¯ç”± ç»„ä»¶ ç»„æˆçš„ã€‚ä¸€ä¸ªç»„ä»¶æ˜¯ UIï¼ˆç”¨æˆ·ç•Œé¢ï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„é€»è¾‘å’Œå¤–è§‚ã€‚ç»„ä»¶å¯ä»¥å°åˆ°ä¸€ä¸ªæŒ‰é’®ï¼Œä¹Ÿå¯ä»¥å¤§åˆ°æ•´ä¸ªé¡µé¢ã€‚</p><p><mark>React ç»„ä»¶æ˜¯è¿”å›æ ‡ç­¾çš„ JavaScript å‡½æ•°</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-pi6p2qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-pi6p2qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>I&#x27;m a button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è‡³æ­¤ï¼Œä½ å·²ç»å£°æ˜äº† <code>MyButton</code>ï¼Œç°åœ¨æŠŠå®ƒåµŒå¥—åˆ°å¦ä¸€ä¸ªç»„ä»¶ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0d42yglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0d42yglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to my app<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">React æ˜¯å¸¸è§„çš„ JavaScript å‡½æ•°ï¼Œé™¤äº†ï¼š<br />1. å®ƒä»¬çš„åå­—æ€»æ˜¯ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚<br />2. å®ƒä»¬è¿”å› JSX æ ‡ç­¾ã€‚</p><p><mark>React ç»„ä»¶å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œè€Œ HTML æ ‡ç­¾åˆ™å¿…é¡»æ˜¯å°å†™å­—æ¯ã€‚</mark></p><p>æ‰€ä½¿ç”¨çš„æ ‡ç­¾è¯­æ³•è¢«ç§°ä¸º <em>JSX</em>ã€‚</p><p>JSX æ¯” HTML æ›´åŠ ä¸¥æ ¼ã€‚ä½ å¿…é¡»é—­åˆæ ‡ç­¾ï¼Œå¦‚ <code>&lt;br /&gt;</code>ã€‚ä½ çš„ç»„ä»¶ä¹Ÿä¸èƒ½è¿”å›å¤šä¸ª JSX æ ‡ç­¾ã€‚ä½ å¿…é¡»å°†å®ƒä»¬åŒ…è£¹åˆ°ä¸€ä¸ªå…±äº«çš„çˆ¶çº§ä¸­ï¼Œæ¯”å¦‚ <code>&lt;div&gt;...&lt;/div&gt;</code> æˆ–ä½¿ç”¨ç©ºçš„ <code>&lt;&gt;...&lt;/&gt;</code> åŒ…è£¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-u61grtlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-u61grtlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AboutPage</span>(<span class="hljs-params"></span>) &#123;<br> <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello there.<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>How do you do?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¯ä»¥ä½¿ç”¨ <code>className</code> æ¥æŒ‡å®šä¸€ä¸ª CSS çš„ classã€‚å®ƒä¸ HTML çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/class"><code>class</code></a> å±æ€§çš„å·¥ä½œæ–¹å¼ç›¸åŒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rd4h02lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rd4h02lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;img className=<span class="hljs-string">&quot;avatar&quot;</span> /&gt;<br></code></pre></td></tr></table></div></figure><p>React å¹¶æ²¡æœ‰è§„å®šä½ å¦‚ä½•æ·»åŠ  CSS æ–‡ä»¶ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ HTML çš„ <code>&lt;link&gt;</code> æ ‡ç­¾ã€‚</p><p class="note note-warning" style="border-left: 4px solid #f0ad4e;padding: 10px 15px;color: #777;background-color: #fdf8ea;">å¤§æ‹¬å·æ˜¯{}</p><p>JSX ä¼šè®©ä½ æŠŠæ ‡ç­¾æ”¾åˆ° JavaScript ä¸­ã€‚è€Œå¤§æ‹¬å·ä¼šè®©ä½  â€œå›åˆ°â€ JavaScript ä¸­ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä»ä½ çš„ä»£ç ä¸­åµŒå…¥ä¸€äº›å˜é‡å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œè¿™å°†æ˜¾ç¤º <code>user.name</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ehqmxjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ehqmxjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    &#123;user.name&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>ä½ è¿˜å¯ä»¥å°† JSX å±æ€§ â€œè½¬ä¹‰åˆ° JavaScriptâ€ï¼Œä½†ä½ å¿…é¡»ä½¿ç”¨å¤§æ‹¬å· è€Œé å¼•å·ã€‚ä¾‹å¦‚ï¼Œ<code>className=&quot;avatar&quot;</code> æ˜¯å°† <code>&quot;avatar&quot;</code> å­—ç¬¦ä¸²ä¼ é€’ç»™ <code>className</code>ï¼Œä½œä¸º CSS çš„ classã€‚ä½† <code>src=&#123;user.imageUrl&#125;</code> ä¼šè¯»å– JavaScript çš„ <code>user.imageUrl</code> å˜é‡ï¼Œç„¶åå°†è¯¥å€¼ä½œä¸º <code>src</code> å±æ€§ä¼ é€’ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bl5eyclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bl5eyclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;user.imageUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">  /&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>ä½ ä¹Ÿå¯ä»¥æŠŠæ›´ä¸ºå¤æ‚çš„è¡¨è¾¾å¼æ”¾å…¥ JSX çš„å¤§æ‹¬å·å†…ï¼Œä¾‹å¦‚ <a href="https://javascript.info/operators#string-concatenation-with-binary">å­—ç¬¦ä¸²æ‹¼æ¥</a>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-j32b1glqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-j32b1glqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> user = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Hedy Lamarr&#x27;</span>,<br>  <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">&#x27;https://i.imgur.com/yXOvdOSs.jpg&#x27;</span>,<br>  <span class="hljs-attr">imageSize</span>: <span class="hljs-number">90</span>,<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;user.imageUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">Photo</span> <span class="hljs-attr">of</span> &#x27; + <span class="hljs-attr">user.name</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">width:</span> <span class="hljs-attr">user.imageSize</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">height:</span> <span class="hljs-attr">user.imageSize</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>style=&#123;&#123;&#125;&#125;</code> å¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯­æ³•ï¼Œè€Œæ˜¯ <code>style=&#123; &#125;</code> JSX å¤§æ‹¬å·å†…çš„ä¸€ä¸ªæ™®é€š <code>&#123;&#125;</code> å¯¹è±¡ã€‚å½“ä½ çš„æ ·å¼ä¾èµ–äº JavaScript å˜é‡æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>style</code> å±æ€§ã€‚</p><hr><p><mark>æ¡ä»¶æ¸²æŸ“</mark>ï¼šReact æ²¡æœ‰ç‰¹æ®Šçš„è¯­æ³•æ¥ç¼–å†™æ¡ä»¶è¯­å¥ï¼Œå› æ­¤ä½ ä½¿ç”¨çš„å°±æ˜¯æ™®é€šçš„ JavaScript ä»£ç ã€‚ä¾‹å¦‚ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/if...else"><code>if</code></a> è¯­å¥æ ¹æ®æ¡ä»¶å¼•å…¥ JSXï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8vt5uxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8vt5uxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> content;<br><br><span class="hljs-keyword">if</span> (isLoggedIn) &#123;<br>  content = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span></span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  content = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoginForm</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    &#123;content&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ å–œæ¬¢æ›´ä¸ºç´§å‡‘çš„ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">æ¡ä»¶ <code>?</code> è¿ç®—ç¬¦</a>ã€‚ä¸ <code>if</code> ä¸åŒçš„æ˜¯ï¼Œå®ƒå·¥ä½œäº JSX å†…éƒ¨ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tjtxpslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tjtxpslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>  &#123;isLoggedIn ? (<br>    <span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span><br>  ) : (<br>   <span class="hljs-tag">&lt;<span class="hljs-name">LoginForm</span> /&gt;</span><br>  )&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>å½“ä½ ä¸éœ€è¦ <code>else</code> åˆ†æ”¯æ—¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND#short-circuit_evaluation">é€»è¾‘ <code>&amp;&amp;</code> è¯­æ³•</a>ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8guacwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8guacwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>  &#123;isLoggedIn &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span>&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p><mark>æ¸²æŸ“åˆ—è¡¨</mark>ï¼šä¾‹å¦‚ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for"><code>for</code> å¾ªç¯</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/map">array çš„ <code>map()</code> å‡½æ•°</a> æ¥æ¸²æŸ“ç»„ä»¶åˆ—è¡¨ã€‚</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªäº§å“æ•°ç»„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-h5cci8lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-h5cci8lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> products = [<br><br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Cabbage&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> &#125;,<br><br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Garlic&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> &#125;,<br><br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Apple&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">3</span> &#125;,<br><br>];<br></code></pre></td></tr></table></div></figure><p>åœ¨ä½ çš„ç»„ä»¶ä¸­ï¼Œä½¿ç”¨ <code>map()</code> å‡½æ•°å°†è¿™ä¸ªæ•°ç»„è½¬æ¢ä¸º <code>&lt;li&gt;</code> æ ‡ç­¾æ„æˆçš„åˆ—è¡¨:</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3q6o7tlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3q6o7tlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ShoppingList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> listItems = products.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;product.id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">color:</span> <span class="hljs-attr">product.isFruit</span> ? &#x27;<span class="hljs-attr">magenta</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">darkgreen</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    &gt;</span></span><br><span class="language-xml">      &#123;product.title&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>&#123;listItems&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p> <code>&lt;li&gt;</code> æœ‰ä¸€ä¸ª <code>key</code> å±æ€§ã€‚å¯¹äºåˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä½ éƒ½åº”è¯¥ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ•°å­—ç»™ <code>key</code>ï¼Œç”¨äºåœ¨å…¶å…„å¼ŸèŠ‚ç‚¹ä¸­å”¯ä¸€æ ‡è¯†è¯¥å…ƒç´ ã€‚</p><p>è¿™äº› key ä¼šå‘Šè¯‰ Reactï¼Œæ¯ä¸ªç»„ä»¶å¯¹åº”ç€æ•°ç»„é‡Œçš„å“ªä¸€é¡¹ï¼Œæ‰€ä»¥ React å¯ä»¥æŠŠå®ƒä»¬åŒ¹é…èµ·æ¥ã€‚è¿™åœ¨æ•°ç»„é¡¹è¿›è¡Œç§»åŠ¨ï¼ˆä¾‹å¦‚æ’åºï¼‰ã€æ’å…¥æˆ–åˆ é™¤ç­‰æ“ä½œæ—¶éå¸¸é‡è¦ã€‚ä¸€ä¸ªåˆé€‚çš„ <code>key</code> å¯ä»¥å¸®åŠ© React æ¨æ–­å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»è€Œå¾—ä»¥æ­£ç¡®åœ°æ›´æ–° DOM æ ‘ã€‚</p><p>ç”¨ä½œ key çš„å€¼åº”è¯¥åœ¨æ•°æ®ä¸­æå‰å°±å‡†å¤‡å¥½ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶æ‰éšæ‰‹ç”Ÿæˆã€‚</p><hr><p><mark>å“åº”äº‹ä»¶</mark>ï¼šé€šè¿‡åœ¨ç»„ä»¶ä¸­å£°æ˜ äº‹ä»¶å¤„ç† å‡½æ•°æ¥å“åº”äº‹ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rrdhjllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rrdhjllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;You clicked me!&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      Click me</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p class="note note-danger" style="border-left: 4px solid #d9534f;padding: 10px 15px;color: #777;background-color: #fcf1f2;">onClick={handleClick} çš„ç»“å°¾æ²¡æœ‰å°æ‹¬å·ï¼ä¸è¦ è°ƒç”¨ äº‹ä»¶å¤„ç†å‡½æ•°ï¼šä½ åªéœ€ æŠŠå‡½æ•°ä¼ é€’ç»™äº‹ä»¶ å³å¯ã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ React ä¼šè°ƒç”¨ä½ ä¼ é€’çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p><hr><p><mark>æ›´æ–°ç•Œé¢</mark>ï¼šä» React å¼•å…¥ <a href="http://localhost:3000/reference/react/useState"><code>useState</code></a>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-k7zn6plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-k7zn6plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ä½ å¯ä»¥åœ¨ä½ çš„ç»„ä»¶ä¸­å£°æ˜ä¸€ä¸ª state å˜é‡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oguljllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oguljllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ å°†ä» <code>useState</code> ä¸­è·å¾—ä¸¤æ ·ä¸œè¥¿ï¼šå½“å‰çš„ stateï¼ˆ<code>count</code>ï¼‰ï¼Œä»¥åŠç”¨äºæ›´æ–°å®ƒçš„å‡½æ•°ï¼ˆ<code>setCount</code>ï¼‰ã€‚</p><p>ç¬¬ä¸€æ¬¡æ˜¾ç¤ºæŒ‰é’®æ—¶ï¼Œ<code>count</code> çš„å€¼ä¸º <code>0</code>ï¼Œå› ä¸ºä½ æŠŠ <code>0</code> ä¼ ç»™äº† <code>useState()</code>ã€‚å½“ä½ æƒ³æ”¹å˜ state æ—¶ï¼Œè°ƒç”¨ <code>setCount()</code> å¹¶å°†æ–°çš„å€¼ä¼ é€’ç»™å®ƒã€‚ç‚¹å‡»è¯¥æŒ‰é’®è®¡æ•°å™¨å°†é€’å¢ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ryw16elqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ryw16elqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      Clicked &#123;count&#125; times</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ å¤šæ¬¡æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¼šæ‹¥æœ‰è‡ªå·±çš„ stateã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fxkyn4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fxkyn4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Counters that update separately<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      Clicked &#123;count&#125; times</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231101143311372-1698820394429-1.png" alt="image-20231101143311372" style="zoom:50%;" /><p>æ¯ä¸ªæŒ‰é’®ä¼š â€œè®°ä½â€ è‡ªå·±çš„ <code>count</code>ï¼Œè€Œä¸å½±å“å…¶ä»–æŒ‰é’®ã€‚</p><img src="image-20231101144402210.png" alt="image-20231101144402210" style="zoom:50%;" /><hr><p><mark>ä½¿ç”¨hook</mark>ï¼šä»¥ <code>use</code> å¼€å¤´çš„å‡½æ•°è¢«ç§°ä¸º Hookã€‚<code>useState</code> æ˜¯ React æä¾›çš„ä¸€ä¸ªå†…ç½® Hookã€‚Hook æ¯”æ™®é€šå‡½æ•°æ›´ä¸ºä¸¥æ ¼ã€‚ä½ åªèƒ½åœ¨ä½ çš„ç»„ä»¶ï¼ˆæˆ–å…¶ä»– Hookï¼‰çš„ é¡¶å±‚ è°ƒç”¨ Hookã€‚å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªæ¡ä»¶æˆ–å¾ªç¯ä¸­ä½¿ç”¨ <code>useState</code>ï¼Œè¯·æå–ä¸€ä¸ªæ–°çš„ç»„ä»¶å¹¶åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨å®ƒã€‚</p><hr><p><mark>ç»„ä»¶é—´å…±äº«æ•°æ®</mark>ï¼šä¸ºäº†ä½¿å¾— <code>MyButton</code> ç»„ä»¶æ˜¾ç¤ºç›¸åŒçš„ <code>count</code> å¹¶ä¸€èµ·æ›´æ–°ï¼Œä½ éœ€è¦å°†å„ä¸ªæŒ‰é’®çš„ state â€œå‘ä¸Šâ€ ç§»åŠ¨åˆ°æœ€æ¥è¿‘åŒ…å«æ‰€æœ‰æŒ‰é’®çš„ç»„ä»¶ä¹‹ä¸­ã€‚</p><img src="image-20231101144445700.png" alt="image-20231101144445700" style="zoom:50%;" /><p>æ­¤åˆ»ï¼Œå½“ä½ ç‚¹å‡»ä»»ä½•ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œ<code>MyApp</code> ä¸­çš„ <code>count</code> éƒ½å°†æ”¹å˜ï¼ŒåŒæ—¶ä¼šæ”¹å˜ <code>MyButton</code> ä¸­çš„ä¸¤ä¸ª countã€‚</p><p>é¦–å…ˆï¼Œå°† <code>MyButton</code> çš„ state ä¸Šç§»åˆ° <code>MyApp</code> ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nbwfx6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nbwfx6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Counters that update separately<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// ... we&#x27;re moving code from here ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ¥ç€ï¼Œå°† <code>MyApp</code> ä¸­çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°ä»¥åŠ state ä¸€åŒå‘ä¸‹ä¼ é€’åˆ° æ¯ä¸ª <code>MyButton</code> ä¸­ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xdhravlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xdhravlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Counters that update together<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¼ é€’çš„ä¿¡æ¯è¢«ç§°ä½œ propã€‚æ­¤æ—¶ <code>MyApp</code> ç»„ä»¶åŒ…å«äº† <code>count</code> state ä»¥åŠ <code>handleClick</code> äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸º prop ä¼ é€’ç»™ äº†æ¯ä¸ªæŒ‰é’®ã€‚</p><p>æœ€åï¼Œæ”¹å˜ <code>MyButton</code> ä»¥ è¯»å– ä»çˆ¶ç»„ä»¶ä¼ é€’æ¥çš„ propï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-z38w9glqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-z38w9glqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params">&#123; count, onClick &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span></span><br><span class="language-xml">      Clicked &#123;count&#125; times</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œ<code>onClick</code> å¤„ç†ç¨‹åºä¼šå¯åŠ¨ã€‚æ¯ä¸ªæŒ‰é’®çš„ <code>onClick</code> prop ä¼šè¢«è®¾ç½®ä¸º <code>MyApp</code> å†…çš„ <code>handleClick</code> å‡½æ•°ï¼Œæ‰€ä»¥å‡½æ•°å†…çš„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¯¥ä»£ç ä¼šè°ƒç”¨ <code>setCount(count + 1)</code>ï¼Œä½¿å¾— state å˜é‡ <code>count</code> é€’å¢ã€‚æ–°çš„ <code>count</code> å€¼ä¼šè¢«ä½œä¸º prop ä¼ é€’ç»™æ¯ä¸ªæŒ‰é’®ï¼Œå› æ­¤å®ƒä»¬æ¯æ¬¡å±•ç¤ºçš„éƒ½æ˜¯æœ€æ–°çš„å€¼ã€‚è¿™è¢«ç§°ä¸ºâ€œ<mark>çŠ¶æ€æå‡</mark>â€ã€‚é€šè¿‡å‘ä¸Šç§»åŠ¨ stateï¼Œæˆ‘ä»¬å®ç°äº†åœ¨ç»„ä»¶é—´å…±äº«å®ƒã€‚</p><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s5310ylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s5310ylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Counters that update together<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyButton</span> <span class="hljs-attr">count</span>=<span class="hljs-string">&#123;count&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyButton</span>(<span class="hljs-params">&#123; count, onClick &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span></span><br><span class="language-xml">      Clicked &#123;count&#125; times</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231101145014997.png" alt="image-20231101145014997" style="zoom:50%;" /><h1 id="ä¸‰-æè¿°ç”¨æˆ·ç•Œé¢UI"><a href="#ä¸‰-æè¿°ç”¨æˆ·ç•Œé¢UI" class="headerlink" title="ä¸‰.æè¿°ç”¨æˆ·ç•Œé¢UI"></a>ä¸‰.æè¿°ç”¨æˆ·ç•Œé¢UI</h1><h2 id="1-ç¬¬ä¸€ä¸ªç»„ä»¶"><a href="#1-ç¬¬ä¸€ä¸ªç»„ä»¶" class="headerlink" title="1.ç¬¬ä¸€ä¸ªç»„ä»¶"></a>1.ç¬¬ä¸€ä¸ªç»„ä»¶</h2><p>React åº”ç”¨æ˜¯ç”±è¢«ç§°ä¸º ç»„ä»¶ çš„ç‹¬ç«‹ UI ç‰‡æ®µæ„å»ºè€Œæˆã€‚React ç»„ä»¶æœ¬è´¨ä¸Šæ˜¯å¯ä»¥ä»»æ„æ·»åŠ æ ‡ç­¾çš„ JavaScript å‡½æ•°ã€‚ç»„ä»¶å¯ä»¥å°åˆ°ä¸€ä¸ªæŒ‰é’®ï¼Œä¹Ÿå¯ä»¥å¤§åˆ°æ˜¯æ•´ä¸ªé¡µé¢ã€‚</p><p>React å…è®¸ä½ å°†æ ‡ç­¾ã€CSS å’Œ JavaScript ç»„åˆæˆè‡ªå®šä¹‰â€œç»„ä»¶â€ï¼Œå³ åº”ç”¨ç¨‹åºä¸­å¯å¤ç”¨çš„ UI å…ƒç´ ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yqmj13lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yqmj13lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Amazing scientists<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¼€æºUIç»„ä»¶ä»“åº“ï¼š<a href="https://github.com/mui">https://github.com/mui</a></p><p>material-uiæ–‡æ¡£ï¼š<a href="https://mui.com/material-ui">https://mui.com/material-ui</a></p><p>React ç»„ä»¶æ˜¯ä¸€æ®µå¯ä»¥ ä½¿ç”¨æ ‡ç­¾è¿›è¡Œæ‰©å±• çš„ JavaScript å‡½æ•°ã€‚</p><p>æ„å»ºç»„ä»¶çš„æ–¹æ³•ï¼š</p><ol><li><p>å¯¼å‡ºç»„ä»¶ï¼š <code>export default</code> å‰ç¼€æ˜¯ä¸€ç§ <a href="https://developer.mozilla.org/docs/web/javascript/reference/statements/export">JavaScript æ ‡å‡†è¯­æ³•</a>ï¼ˆé React çš„ç‰¹æ€§ï¼‰ã€‚å®ƒå…è®¸ä½ æ ‡ç­¾ä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä¸»è¦å‡½æ•°ä»¥ä¾¿ä½ ä»¥åå¯ä»¥ä»å…¶ä»–æ–‡ä»¶å¼•å…¥å®ƒã€‚</p></li><li><p>å®šä¹‰å‡½æ•°ï¼š ä½¿ç”¨ <code>function Profile() &#123; &#125;</code> å®šä¹‰åä¸º <code>Profile</code> çš„ JavaScript å‡½æ•°ã€‚</p><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">React ç»„ä»¶æ˜¯å¸¸è§„çš„ JavaScript å‡½æ•°ï¼Œä½† ç»„ä»¶çš„åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œå¦åˆ™å®ƒä»¬å°†æ— æ³•è¿è¡Œï¼</p></li><li><p>æ·»åŠ æ ‡ç­¾ï¼šè¿™ä¸ªç»„ä»¶è¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>src</code> å’Œ <code>alt</code> å±æ€§çš„ <code>&lt;img /&gt;</code> æ ‡ç­¾ã€‚<code>&lt;img /&gt;</code> å†™å¾—åƒ HTMLï¼Œä½†å®é™…ä¸Šæ˜¯ JavaScriptï¼è¿™ç§è¯­æ³•è¢«ç§°ä¸º <a href="http://localhost:3000/learn/writing-markup-with-jsx">JSX</a>ï¼Œå®ƒå…è®¸ä½ åœ¨ JavaScript ä¸­åµŒå…¥ä½¿ç”¨æ ‡ç­¾ã€‚</p><p>è¿”å›è¯­å¥å¯ä»¥å…¨å†™åœ¨ä¸€è¡Œä¸Šï¼Œå¦‚ä¸‹é¢ç»„ä»¶ä¸­æ‰€ç¤ºï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dyy88zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dyy88zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span>;<br></code></pre></td></tr></table></div></figure><p><mark>å¦‚æœä½ çš„æ ‡ç­¾å’Œ <code>return</code> å…³é”®å­—ä¸åœ¨åŒä¸€è¡Œï¼Œåˆ™å¿…é¡»æŠŠå®ƒåŒ…è£¹åœ¨ä¸€å¯¹æ‹¬å·ä¸­</mark>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-caq3p2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-caq3p2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>æ²¡æœ‰æ‹¬å·åŒ…è£¹çš„è¯ï¼Œä»»ä½•åœ¨ <code>return</code> ä¸‹ä¸€è¡Œçš„ä»£ç éƒ½<a href="https://stackoverflow.com/questions/2846283/what-are-the-rules-for-javascripts-automatic-semicolon-insertion-asi">å°†è¢«å¿½ç•¥</a>ï¼</p></li></ol><p>ç°åœ¨ä½ å·²ç»å®šä¹‰äº† <code>Profile</code> ç»„ä»¶ï¼Œä½ å¯ä»¥åœ¨å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å¯¼å‡ºä¸€ä¸ªå†…éƒ¨ä½¿ç”¨äº†å¤šä¸ª <code>Profile</code> ç»„ä»¶çš„ <code>Gallery</code> ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-egtqrrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-egtqrrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>äº†ä¸èµ·çš„ç§‘å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åŒºåˆ«ï¼š</p><ul><li><code>&lt;section&gt;</code> æ˜¯å°å†™çš„ï¼Œæ‰€ä»¥ React çŸ¥é“æˆ‘ä»¬æŒ‡çš„æ˜¯ HTML æ ‡ç­¾ã€‚</li><li><code>&lt;Profile /&gt;</code> ä»¥å¤§å†™ <code>P</code> å¼€å¤´ï¼Œæ‰€ä»¥ React çŸ¥é“æˆ‘ä»¬æƒ³è¦ä½¿ç”¨åä¸º <code>Profile</code> çš„ç»„ä»¶ã€‚</li></ul><p> <code>Profile</code> åŒ…å«æ›´å¤šçš„ HTMLï¼š<code>&lt;img /&gt;</code>ã€‚è¿™æ˜¯æµè§ˆå™¨æœ€åæ‰€çœ‹åˆ°çš„ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a9yb2clqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a9yb2clqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>äº†ä¸èµ·çš„ç§‘å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/MK3eW3As.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Katherine Johnson&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>å› ä¸º <code>Profile</code> ç»„ä»¶åœ¨ <code>Gallery</code> ç»„ä»¶ä¸­æ¸²æŸ“â€”â€”ç”šè‡³å¥½å‡ æ¬¡ï¼â€”â€”æˆ‘ä»¬å¯ä»¥è®¤ä¸º <code>Gallery</code> æ˜¯ä¸€ä¸ª çˆ¶ç»„ä»¶ï¼Œå°†æ¯ä¸ª <code>Profile</code> æ¸²æŸ“ä¸ºä¸€ä¸ªâ€œå­©å­â€ã€‚è¿™æ˜¯ React çš„ç¥å¥‡ä¹‹å¤„ï¼šä½ å¯ä»¥åªå®šä¹‰ç»„ä»¶ä¸€æ¬¡ï¼Œç„¶åæŒ‰éœ€å¤šå¤„å’Œå¤šæ¬¡ä½¿ç”¨ã€‚</p><p>ç»„ä»¶å¯ä»¥æ¸²æŸ“å…¶ä»–ç»„ä»¶ï¼Œä½†æ˜¯ è¯·ä¸è¦åµŒå¥—ä»–ä»¬çš„å®šä¹‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-msljlplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-msljlplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-comment">// ğŸ”´ æ°¸è¿œä¸è¦åœ¨ç»„ä»¶ä¸­å®šä¹‰ç»„ä»¶</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-comment">// ...</span><br>&#125;<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸Šé¢è¿™æ®µä»£ç  <a href="http://localhost:3000/learn/preserving-and-resetting-state#different-components-at-the-same-position-reset-state">éå¸¸æ…¢ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´ bug äº§ç”Ÿ</a>ã€‚å› æ­¤ï¼Œä½ åº”è¯¥åœ¨é¡¶å±‚å®šä¹‰æ¯ä¸ªç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0id17zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0id17zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>&#125;<br><br><span class="hljs-comment">// âœ… åœ¨é¡¶å±‚å£°æ˜ç»„ä»¶</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“å­ç»„ä»¶éœ€è¦ä½¿ç”¨çˆ¶ç»„ä»¶çš„æ•°æ®æ—¶ï¼Œä½ éœ€è¦ <a href="http://localhost:3000/learn/passing-props-to-a-component">é€šè¿‡ props çš„å½¢å¼è¿›è¡Œä¼ é€’</a>ï¼Œè€Œä¸æ˜¯åµŒå¥—å®šä¹‰ã€‚</p><h2 id="2-ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º"><a href="#2-ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º" class="headerlink" title="2.ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º"></a>2.ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º</h2><p>å¯¹ç»„ä»¶è¿›è¡Œæ‹†åˆ†ï¼š</p><ol><li><p>åˆ›å»º ä¸€ä¸ªæ–°çš„ JS æ–‡ä»¶æ¥å­˜æ”¾è¯¥ç»„ä»¶ã€‚</p></li><li><p>å¯¼å‡º è¯¥æ–‡ä»¶ä¸­çš„å‡½æ•°ç»„ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/export#using_the_default_export">é»˜è®¤å¯¼å‡º</a> æˆ– <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/export#using_named_exports">å…·åå¯¼å‡º</a>ï¼‰</p><ul><li><p>JavaScript é‡Œä¸¤ä¸ªä¸»è¦ç”¨æ¥å¯¼å‡ºå€¼çš„æ–¹å¼ï¼šé»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­åªç”¨åˆ°äº†é»˜è®¤å¯¼å‡ºã€‚ä½†ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé€‰æ‹©ä½¿ç”¨å…¶ä¸­ä¸€ç§ï¼Œæˆ–è€…ä¸¤ç§éƒ½ä½¿ç”¨ã€‚</p><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">åŒä¸€ä¸ªæ–‡ä»¶é‡Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªé»˜è®¤å¯¼å‡ºï¼Œä½†æ˜¯å¯ä»¥æœ‰ä»»æ„å¤šä¸ª å…·åå¯¼å‡ºã€‚</p><img src="image-20231103111403523.png" alt="image-20231103111403523" style="zoom:50%;" /><p>ç»„ä»¶çš„å¯¼å‡ºæ–¹å¼å†³å®šäº†å…¶å¯¼å…¥æ–¹å¼ã€‚å½“ä½ ç”¨é»˜è®¤å¯¼å…¥çš„æ–¹å¼ï¼Œå¯¼å…¥å…·åå¯¼å‡ºçš„ç»„ä»¶æ—¶ï¼Œå°±ä¼šæŠ¥é”™ã€‚å¦‚ä¸‹è¡¨æ ¼å¯ä»¥å¸®ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬ï¼š</p><table><thead><tr><th>è¯­æ³•</th><th>å¯¼å‡ºè¯­å¥</th><th>å¯¼å…¥è¯­å¥</th></tr></thead><tbody><tr><td>é»˜è®¤</td><td><code>export default function Button() &#123;&#125;</code></td><td><code>import Button from &#39;./Button.js&#39;;</code></td></tr><tr><td>å…·å</td><td><code>export function Button() &#123;&#125;</code></td><td><code>import &#123; Button &#125; from &#39;./Button.js&#39;;</code></td></tr></tbody></table><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">å½“ä½¿ç”¨é»˜è®¤å¯¼å…¥æ—¶ï¼Œä½ å¯ä»¥åœ¨ `import` è¯­å¥åé¢è¿›è¡Œä»»æ„å‘½åã€‚æ¯”å¦‚ `import Banana from './Button.js'`ï¼Œå¦‚æ­¤ä½ èƒ½è·å¾—ä¸é»˜è®¤å¯¼å‡ºä¸€è‡´çš„å†…å®¹ã€‚ç›¸åï¼Œå¯¹äºå…·åå¯¼å…¥ï¼Œå¯¼å…¥å’Œå¯¼å‡ºçš„åå­—å¿…é¡»ä¸€è‡´ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°å…¶ä¸º å…·å å¯¼å…¥çš„åŸå› ï¼</p><p>é€šå¸¸ï¼Œæ–‡ä»¶ä¸­ä»…åŒ…å«ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œäººä»¬ä¼šé€‰æ‹©é»˜è®¤å¯¼å‡ºï¼Œè€Œå½“æ–‡ä»¶ä¸­åŒ…å«å¤šä¸ªç»„ä»¶æˆ–æŸä¸ªå€¼éœ€è¦å¯¼å‡ºæ—¶ï¼Œåˆ™ä¼šé€‰æ‹©å…·åå¯¼å‡ºã€‚ æ— è®ºé€‰æ‹©å“ªç§æ–¹å¼ï¼Œè¯·è®°å¾—ç»™ä½ çš„ç»„ä»¶å’Œç›¸åº”çš„æ–‡ä»¶å‘½åä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—ã€‚æˆ‘ä»¬ä¸å»ºè®®åˆ›å»ºæœªå‘½åçš„ç»„ä»¶ï¼Œæ¯”å¦‚ <code>export default () =&gt; &#123;&#125;</code>ï¼Œå› ä¸ºè¿™æ ·ä¼šä½¿å¾—è°ƒè¯•å˜å¾—å¼‚å¸¸å›°éš¾ã€‚</p></li></ul></li><li><p>åœ¨éœ€è¦ä½¿ç”¨è¯¥ç»„ä»¶çš„æ–‡ä»¶ä¸­ å¯¼å…¥ï¼ˆå¯ä»¥æ ¹æ®ç›¸åº”çš„å¯¼å‡ºæ–¹å¼ä½¿ç”¨ <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#importing_defaults">é»˜è®¤å¯¼å…¥</a> æˆ– <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/import#import_a_single_export_from_a_module">å…·åå¯¼å…¥</a>ï¼‰ã€‚</p></li></ol><p>è¿™é‡Œå°† <code>Profile</code> ç»„ä»¶å’Œ <code>Gallery</code> ç»„ä»¶ï¼Œä» <code>App.js</code> æ–‡ä»¶ä¸­ç§»åŠ¨åˆ°äº† <code>Gallery.js</code> æ–‡ä»¶ä¸­ã€‚ä¿®æ”¹åï¼Œå³å¯åœ¨ <code>App.js</code> ä¸­å¯¼å…¥ <code>Gallery.js</code> ä¸­çš„ <code>Gallery</code> ç»„ä»¶ï¼š</p><p>App.jsï¼šæ— è®ºæ˜¯ .&#x2F;Gallery.js è¿˜æ˜¯ .&#x2F;Galleryï¼Œåœ¨ React é‡Œéƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯å‰è€…æ›´ç¬¦åˆ åŸç”Ÿ ES æ¨¡å—ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g0nyahlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g0nyahlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Gallery</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Gallery.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Gallery</span> /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Gallery.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x0rf5zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x0rf5zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/QIrZWGIs.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Alan L. Hart&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>äº†ä¸èµ·çš„ç§‘å­¦å®¶ä»¬<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Profile</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Gallery.js</p><ul><li>å®šä¹‰äº† <code>Profile</code> ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ä»…åœ¨è¯¥æ–‡ä»¶å†…ä½¿ç”¨ï¼Œæ²¡æœ‰è¢«å¯¼å‡ºã€‚</li><li>ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°† <code>Gallery</code> ç»„ä»¶å¯¼å‡º</li></ul><p>App.js</p><ul><li>ä½¿ç”¨ é»˜è®¤å¯¼å…¥ çš„æ–¹å¼ï¼Œä» <code>Gallery.js</code> ä¸­å¯¼å…¥ <code>Gallery</code> ç»„ä»¶ã€‚</li><li>ä½¿ç”¨ é»˜è®¤å¯¼å‡º çš„æ–¹å¼ï¼Œå°†æ ¹ç»„ä»¶ <code>App</code> å¯¼å‡ºã€‚</li></ul><h2 id="3-ä½¿ç”¨JSXä¹¦å†™æ ‡ç­¾è¯­è¨€"><a href="#3-ä½¿ç”¨JSXä¹¦å†™æ ‡ç­¾è¯­è¨€" class="headerlink" title="3.ä½¿ç”¨JSXä¹¦å†™æ ‡ç­¾è¯­è¨€"></a>3.ä½¿ç”¨JSXä¹¦å†™æ ‡ç­¾è¯­è¨€</h2><p>JSX æ˜¯ JavaScript è¯­æ³•æ‰©å±•ï¼Œå¯ä»¥è®©ä½ åœ¨ JavaScript æ–‡ä»¶ä¸­ä¹¦å†™ç±»ä¼¼ HTML çš„æ ‡ç­¾ã€‚</p><p>éšç€ Web çš„äº¤äº’æ€§è¶Šæ¥è¶Šå¼ºï¼Œé€»è¾‘è¶Šæ¥è¶Šå†³å®šé¡µé¢ä¸­çš„å†…å®¹ã€‚JavaScript è´Ÿè´£ HTML çš„å†…å®¹ï¼è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ åœ¨ React ä¸­ï¼Œæ¸²æŸ“é€»è¾‘å’Œæ ‡ç­¾å…±åŒå­˜åœ¨äºåŒä¸€ä¸ªåœ°æ–¹â€”â€”ç»„ä»¶ã€‚</p><p>å°†ä¸€ä¸ªæŒ‰é’®çš„æ¸²æŸ“é€»è¾‘å’Œæ ‡ç­¾æ”¾åœ¨ä¸€èµ·å¯ä»¥ç¡®ä¿å®ƒä»¬åœ¨æ¯æ¬¡ç¼–è¾‘æ—¶éƒ½èƒ½ä¿æŒäº’ç›¸åŒæ­¥ã€‚åä¹‹ï¼Œå½¼æ­¤æ— å…³çš„ç»†èŠ‚æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œä¾‹å¦‚æŒ‰é’®çš„æ ‡ç­¾å’Œä¾§è¾¹æ çš„æ ‡ç­¾ã€‚è¿™æ ·æˆ‘ä»¬åœ¨ä¿®æ”¹å…¶ä¸­ä»»æ„ä¸€ä¸ªç»„ä»¶æ—¶ä¼šæ›´å®‰å…¨ã€‚</p><p>æ¯ä¸ª React ç»„ä»¶éƒ½æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€äº›æ ‡ç­¾ï¼ŒReact ä¼šå°†è¿™äº›æ ‡ç­¾æ¸²æŸ“åˆ°æµè§ˆå™¨ä¸Šã€‚</p><p>JSX and React æ˜¯ç›¸äº’ç‹¬ç«‹çš„ ä¸œè¥¿ã€‚ä½†å®ƒä»¬ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œä½†ä½  å¯ä»¥ å•ç‹¬ä½¿ç”¨å®ƒä»¬ä¸­çš„ä»»æ„ä¸€ä¸ªï¼ŒJSX æ˜¯ä¸€ç§è¯­æ³•æ‰©å±•ï¼Œè€Œ React åˆ™æ˜¯ä¸€ä¸ª JavaScript çš„åº“ã€‚</p><p>JSX è§„åˆ™ï¼š</p><ol><li><p><mark>åªèƒ½è¿”å›ä¸€ä¸ªæ ¹å…ƒç´ </mark>ï¼šå¦‚æœæƒ³è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒ…å«å¤šä¸ªå…ƒç´ ï¼Œéœ€è¦ç”¨ä¸€ä¸ªçˆ¶æ ‡ç­¾æŠŠå®ƒä»¬åŒ…è£¹èµ·æ¥ã€‚å¦‚æœä½ ä¸æƒ³åœ¨æ ‡ç­¾ä¸­å¢åŠ ä¸€ä¸ªé¢å¤–çš„ <code>&lt;div&gt;</code>ï¼Œå¯ä»¥ç”¨ <code>&lt;&gt;</code> å’Œ <code>&lt;/&gt;</code> å…ƒç´ æ¥ä»£æ›¿ã€‚è¿™ä¸ªç©ºæ ‡ç­¾è¢«ç§°ä½œ *<a href="http://localhost:3000/reference/react/Fragment">Fragment</a>*ã€‚React Fragment å…è®¸ä½ å°†å­å…ƒç´ åˆ†ç»„ï¼Œè€Œä¸ä¼šåœ¨ HTML ç»“æ„ä¸­æ·»åŠ é¢å¤–èŠ‚ç‚¹ã€‚</p><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">ä¸ºä»€ä¹ˆå¤šä¸ª JSX æ ‡ç­¾éœ€è¦è¢«ä¸€ä¸ªçˆ¶å…ƒç´ åŒ…è£¹ï¼šJSX è™½ç„¶çœ‹èµ·æ¥å¾ˆåƒ HTMLï¼Œä½†åœ¨åº•å±‚å…¶å®è¢«è½¬åŒ–ä¸ºäº† JavaScript å¯¹è±¡ï¼Œä½ ä¸èƒ½åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›å¤šä¸ªå¯¹è±¡ï¼Œé™¤éç”¨ä¸€ä¸ªæ•°ç»„æŠŠä»–ä»¬åŒ…è£…èµ·æ¥ã€‚</p></li><li><p><mark>æ ‡ç­¾å¿…é¡»æ­£ç¡®é—­åˆ</mark>ï¼šåƒ <code>&lt;img&gt;</code> è¿™æ ·çš„è‡ªé—­åˆæ ‡ç­¾å¿…é¡»ä¹¦å†™æˆ <code>&lt;img /&gt;</code>ï¼Œè€Œåƒ <code>&lt;li&gt;oranges</code> è¿™æ ·åªæœ‰å¼€å§‹æ ‡ç­¾çš„å…ƒç´ å¿…é¡»å¸¦æœ‰é—­åˆæ ‡ç­¾ï¼Œéœ€è¦æ”¹ä¸º <code>&lt;li&gt;oranges&lt;/li&gt;</code>ã€‚</p></li><li><p><mark>ä½¿ç”¨é©¼å³°å¼å‘½åæ³•ç»™å¤§éƒ¨åˆ†å±æ€§å‘½å</mark>ï¼šJSX æœ€ç»ˆä¼šè¢«è½¬åŒ–ä¸º JavaScriptï¼Œè€Œ JSX ä¸­çš„å±æ€§ä¹Ÿä¼šå˜æˆ JavaScript å¯¹è±¡ä¸­çš„é”®å€¼å¯¹ã€‚åœ¨ä½ è‡ªå·±çš„ç»„ä»¶ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦ç”¨å˜é‡çš„æ–¹å¼è¯»å–è¿™äº›å±æ€§çš„æ—¶å€™ã€‚ä½† JavaScript å¯¹å˜é‡çš„å‘½åæœ‰é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œ<mark>å˜é‡åç§°ä¸èƒ½åŒ…å« <code>-</code> ç¬¦å·æˆ–è€…åƒ <code>class</code> è¿™æ ·çš„ä¿ç•™å­—</mark>ã€‚</p></li></ol><p>  è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ React ä¸­ï¼Œå¤§éƒ¨åˆ† HTML å’Œ SVG å±æ€§éƒ½ç”¨é©¼å³°å¼å‘½åæ³•è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œéœ€è¦ç”¨ <code>strokeWidth</code> ä»£æ›¿ <code>stroke-width</code>ã€‚ç”±äº <code>class</code> æ˜¯ä¸€ä¸ªä¿ç•™å­—ï¼Œæ‰€ä»¥åœ¨ React ä¸­éœ€è¦ç”¨ <code>className</code> æ¥ä»£æ›¿ã€‚è¿™ä¹Ÿæ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/className">DOM å±æ€§ä¸­çš„å‘½å</a>:</p>  <figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wxgqwzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wxgqwzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span>   <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/yXOvdOSs.jpg&quot;</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Hedy Lamarr&quot;</span> </span><br><span class="hljs-tag">  <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;photo&quot;</span></span><br><span class="hljs-tag">/&gt;</span><br></code></pre></td></tr></table></div></figure><p> ä½ å¯ä»¥ <a href="http://localhost:3000/reference/react-dom/components/common">åœ¨ React DOM å…ƒç´ ä¸­æ‰¾åˆ°æ‰€æœ‰å¯¹åº”çš„å±æ€§</a>ã€‚</p><p>ç”±äºå†å²åŸå› ï¼Œ<a href="https://developer.mozilla.org/docs/Web/Accessibility/ARIA"><code>aria-*</code></a> å’Œ <a href="https://developer.mozilla.org/docs/Learn/HTML/Howto/Use_data_attributes"><code>data-*</code></a> å±æ€§æ˜¯ä»¥å¸¦ <code>-</code> ç¬¦å·çš„ HTML æ ¼å¼ä¹¦å†™çš„ã€‚</p><p>HTMLâ†’JSXè½¬åŒ–å™¨ï¼š<a href="https://transform.tools/html-to-jsx">https://transform.tools/html-to-jsx</a></p><h2 id="4-åœ¨-JSX-ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨-JavaScript"><a href="#4-åœ¨-JSX-ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨-JavaScript" class="headerlink" title="4.åœ¨ JSX ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨ JavaScript"></a>4.åœ¨ JSX ä¸­é€šè¿‡å¤§æ‹¬å·ä½¿ç”¨ JavaScript</h2><p>å½“ä½ æƒ³æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§ä¼ é€’ç»™ JSX æ—¶ï¼ŒæŠŠå®ƒæ”¾åˆ°å•å¼•å·æˆ–åŒå¼•å·ä¸­ï¼š<code>src=&quot;https://i.imgur.com/7vQD0fPs.jpg&quot;</code></p><p>å¦‚æœä½ æƒ³è¦åŠ¨æ€åœ°æŒ‡å®š <code>src</code> æˆ– <code>alt</code> çš„å€¼å‘¢ï¼Ÿä½ å¯ä»¥ ç”¨ <code>&#123;</code> å’Œ <code>&#125;</code> æ›¿ä»£ <code>&quot;</code> å’Œ <code>&quot;</code> ä»¥ä½¿ç”¨ JavaScript å˜é‡ ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bwnln6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bwnln6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> avatar = <span class="hljs-string">&#x27;https://i.imgur.com/7vQD0fPs.jpg&#x27;</span>;<br>  <span class="hljs-keyword">const</span> description = <span class="hljs-string">&#x27;Gregorio Y. Zara&#x27;</span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;avatar&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;description&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><mark>å¤§æ‹¬å·å†…çš„ä»»ä½• JavaScript è¡¨è¾¾å¼éƒ½èƒ½æ­£å¸¸è¿è¡Œ</mark>ï¼ŒåŒ…æ‹¬åƒ <code>formatDate()</code> è¿™æ ·çš„å‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qfdyh3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qfdyh3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> today = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(<br>    <span class="hljs-string">&#x27;zh-CN&#x27;</span>,<br>    &#123; <span class="hljs-attr">weekday</span>: <span class="hljs-string">&#x27;long&#x27;</span> &#125;<br>  ).<span class="hljs-title function_">format</span>(date);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>To Do List for &#123;formatDate(today)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ JSX ä¸­ï¼Œåªèƒ½åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ä¸­ä½¿ç”¨å¤§æ‹¬å·ï¼š</p><ol><li><mark>ç”¨ä½œ JSX æ ‡ç­¾å†…çš„æ–‡æœ¬</mark>ï¼š<code>&lt;h1&gt;&#123;name&#125;&#39;s To Do List&lt;/h1&gt;</code> æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ <code>&lt;&#123;tag&#125;&gt;Gregorio Y. Zara&#39;s To Do List&lt;/&#123;tag&#125;&gt;</code> æ— æ•ˆã€‚</li><li><mark>ç”¨ä½œç´§è·Ÿåœ¨ <code>=</code> ç¬¦å·åçš„ å±æ€§</mark>ï¼š<code>src=&#123;avatar&#125;</code> ä¼šè¯»å– <code>avatar</code> å˜é‡ï¼Œä½†æ˜¯ <code>src=&quot;&#123;avatar&#125;&quot;</code> åªä¼šä¼ ä¸€ä¸ªå­—ç¬¦ä¸² <code>&#123;avatar&#125;</code>ã€‚</li></ol><p><mark>åŒå¤§æ‹¬å·</mark>ï¼šé™¤äº†å­—ç¬¦ä¸²ã€æ•°å­—å’Œå…¶å®ƒ JavaScript è¡¨è¾¾å¼ï¼Œä½ ç”šè‡³å¯ä»¥åœ¨ JSX ä¸­ä¼ é€’å¯¹è±¡ã€‚å¯¹è±¡ä¹Ÿç”¨å¤§æ‹¬å·è¡¨ç¤ºï¼Œä¾‹å¦‚ <code>&#123; name: &quot;Hedy Lamarr&quot;, inventions: 5 &#125;</code>ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½åœ¨ JSX ä¸­ä¼ é€’ï¼Œä½ å¿…é¡»ç”¨å¦ä¸€å¯¹é¢å¤–çš„å¤§æ‹¬å·åŒ…è£¹å¯¹è±¡ï¼š<code>person=&#123;&#123; name: "Hedy Lamarr", inventions: 5 &#125;&#125;</code>ã€‚</p><p>React ä¸è¦æ±‚ä½ ä½¿ç”¨å†…è”æ ·å¼ï¼ˆä½¿ç”¨ CSS ç±»å°±èƒ½æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µï¼‰ã€‚ä½†æ˜¯å½“ä½ éœ€è¦å†…è”æ ·å¼çš„æ—¶å€™ï¼Œä½ å¯ä»¥ç»™ <code>style</code> å±æ€§ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0ae5kslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0ae5kslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              &#123;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">backgroundColor:</span> &#x27;<span class="hljs-attr">black</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">color:</span> &#x27;<span class="hljs-attr">pink</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">    &#125;</span></span><br><span class="hljs-tag"><span class="language-xml">          &#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Improve the videophone<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Prepare aeronautics lectures<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Work on the alcohol-fuelled engine<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å†…è” <code>style</code> å±æ€§ ä½¿ç”¨é©¼å³°å‘½åæ³•ç¼–å†™ã€‚ä¾‹å¦‚ï¼ŒHTML <code>&lt;ul style=&quot;background-color: black&quot;&gt;</code> åœ¨ä½ çš„ç»„ä»¶é‡Œåº”è¯¥å†™æˆ <code>&lt;ul style=&#123;&#123; backgroundColor: 'black' &#125;&#125;&gt;</code>ã€‚</p><p>å¯ä»¥å°†å¤šä¸ªè¡¨è¾¾å¼åˆå¹¶åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œåœ¨ JSX çš„å¤§æ‹¬å·å†…åˆ†åˆ«ä½¿ç”¨å®ƒä»¬ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-86lnbvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-86lnbvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> person = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Gregorio Y. Zara&#x27;</span>,<br>  <span class="hljs-attr">theme</span>: &#123;<br>    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;black&#x27;</span>,<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;pink&#x27;</span><br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;person.theme&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;person.name&#125;&#x27;s Todos<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span>       <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span>     <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/7vQD0fPs.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Gregorio Y. Zara&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><h2 id="5-å°†propsä¼ é€’ç»™ç»„ä»¶"><a href="#5-å°†propsä¼ é€’ç»™ç»„ä»¶" class="headerlink" title="5.å°†propsä¼ é€’ç»™ç»„ä»¶"></a>5.å°†propsä¼ é€’ç»™ç»„ä»¶</h2><p>React ç»„ä»¶ä½¿ç”¨ props æ¥äº’ç›¸é€šä¿¡ã€‚æ¯ä¸ªçˆ¶ç»„ä»¶éƒ½å¯ä»¥æä¾› props ç»™å®ƒçš„å­ç»„ä»¶ï¼Œä»è€Œå°†ä¸€äº›ä¿¡æ¯ä¼ é€’ç»™å®ƒã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hhs7mjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hhs7mjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/1bX5QH6.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Lin Lanying&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;100&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;100&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å‘ç»„ä»¶ä¼ é€’propsï¼š</p><ol><li><p><mark>å°† props ä¼ é€’ç»™å­ç»„ä»¶</mark>ï¼š<code>person</code>ï¼ˆä¸€ä¸ªå¯¹è±¡ï¼‰å’Œ <code>size</code>ï¼ˆä¸€ä¸ªæ•°å­—ï¼‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-82yblelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-82yblelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">person</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">name:</span> &#x27;<span class="hljs-attr">Lin</span> <span class="hljs-attr">Lanying</span>&#x27;, <span class="hljs-attr">imageId:</span> &#x27;<span class="hljs-attr">1bX5QH6</span>&#x27; &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;100&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>åœ¨å­ç»„ä»¶ä¸­è¯»å– props</mark>ï¼šåœ¨ <code>function Avatar</code> ä¹‹åç›´æ¥åˆ—å‡ºå®ƒä»¬çš„åå­— <code>person, size</code> æ¥è¯»å–è¿™äº› propsã€‚è¿™äº› props åœ¨ <code>(&#123;</code> å’Œ <code>&#125;)</code> ä¹‹é—´ï¼Œå¹¶ç”±é€—å·åˆ†éš”ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ngz4i3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ngz4i3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">&#123; person, size &#125;</span>) &#123;<br>  <span class="hljs-comment">// åœ¨è¿™é‡Œ person å’Œ size æ˜¯å¯è®¿é—®çš„</span><br>&#125;<br></code></pre></td></tr></table></div></figure></li></ol><p>props æ­£æ˜¯ ç»„ä»¶çš„å”¯ä¸€å‚æ•°ï¼ React ç»„ä»¶å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œä¸€ä¸ª <code>props</code> å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2y3h6ylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2y3h6ylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">let</span> person = props.<span class="hljs-property">person</span>;<br>  <span class="hljs-keyword">let</span> size = props.<span class="hljs-property">size</span>;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>é€šå¸¸ä½ ä¸éœ€è¦æ•´ä¸ª <code>props</code> å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥å°†å®ƒè§£æ„ä¸ºå•ç‹¬çš„ propsã€‚&gt;å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶</li></p><p>åœ¨å£°æ˜ props æ—¶ï¼Œ ä¸è¦å¿˜è®° <code>(</code> å’Œ <code>)</code> ä¹‹é—´çš„ä¸€å¯¹èŠ±æ‹¬å· <code>&#123;</code> å’Œ <code>&#125;</code>  ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-69mzqvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-69mzqvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">&#123; person, size &#125;</span>) &#123;<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ç§è¯­æ³•è¢«ç§°ä¸º <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Unpacking_fields_from_objects_passed_as_a_function_parameter">â€œè§£æ„â€</a>ï¼Œç­‰ä»·äºäºä»å‡½æ•°å‚æ•°ä¸­è¯»å–å±æ€§ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-z146k6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-z146k6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-keyword">let</span> person = props.<span class="hljs-property">person</span>;<br>    <span class="hljs-keyword">let</span> size = props.<span class="hljs-property">size</span>;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ æƒ³åœ¨æ²¡æœ‰æŒ‡å®šå€¼çš„æƒ…å†µä¸‹ç»™ prop ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å‚æ•°åé¢å†™ <code>=</code> å’Œé»˜è®¤å€¼æ¥è¿›è¡Œè§£æ„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3f4cqalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3f4cqalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">&#123; person, size = <span class="hljs-number">100</span> &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ï¼Œ å¦‚æœ <code>&lt;Avatar person=&#123;...&#125; /&gt;</code> æ¸²æŸ“æ—¶æ²¡æœ‰ <code>size</code> propï¼Œ  <code>size</code> å°†è¢«èµ‹å€¼ä¸º <code>100</code>ã€‚</p><p>é»˜è®¤å€¼ä»…åœ¨ç¼ºå°‘ <code>size</code> prop æˆ– <code>size=&#123;undefined&#125;</code> æ—¶ç”Ÿæ•ˆã€‚ ä½†æ˜¯<mark>å¦‚æœä½ ä¼ é€’äº† <code>size=&#123;null&#125;</code> æˆ– <code>size=&#123;0&#125;</code>ï¼Œé»˜è®¤å€¼å°†ä¸è¢«ä½¿ç”¨ã€‚</mark></p><p>é‡å¤ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oidf1ulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oidf1ulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">&#123; person, size, isSepia, thickBorder &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">person</span>=<span class="hljs-string">&#123;person&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;size&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isSepia</span>=<span class="hljs-string">&#123;isSepia&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">thickBorder</span>=<span class="hljs-string">&#123;thickBorder&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ”¹ä¸º<mark>ä½¿ç”¨ JSX å±•å¼€è¯­æ³•ä¼ é€’ props</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ylgrzelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ylgrzelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¼šå°† <code>Profile</code> çš„æ‰€æœ‰ props è½¬å‘åˆ° <code>Avatar</code>ï¼Œè€Œä¸åˆ—å‡ºæ¯ä¸ªåå­—ã€‚</p><p>è¯·å…‹åˆ¶åœ°ä½¿ç”¨å±•å¼€è¯­æ³•ã€‚ å¦‚æœä½ åœ¨æ‰€æœ‰å…¶ä»–ç»„ä»¶ä¸­éƒ½ä½¿ç”¨å®ƒï¼Œé‚£å°±æœ‰é—®é¢˜äº†ã€‚ é€šå¸¸ï¼Œå®ƒè¡¨ç¤ºä½ åº”è¯¥æ‹†åˆ†ç»„ä»¶ï¼Œå¹¶å°†å­ç»„ä»¶ä½œä¸º JSX ä¼ é€’ã€‚ </p><p><mark>å°† JSX ä½œä¸ºå­ç»„ä»¶ä¼ é€’</mark>ï¼šå½“æ‚¨å°†å†…å®¹åµŒå¥—åœ¨ JSX æ ‡ç­¾ä¸­æ—¶ï¼Œçˆ¶ç»„ä»¶å°†åœ¨åä¸º <code>children</code> çš„ prop ä¸­æ¥æ”¶åˆ°è¯¥å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ <code>Card</code> ç»„ä»¶å°†æ¥æ”¶ä¸€ä¸ªè¢«è®¾ä¸º <code>&lt;Avatar /&gt;</code> çš„ <code>children</code> prop å¹¶å°†å…¶åŒ…è£¹åœ¨ div ä¸­æ¸²æŸ“ã€‚</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7p4gytlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7p4gytlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Avatar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Avatar.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;100&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">person</span>=<span class="hljs-string">&#123;&#123;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">name:</span> &#x27;<span class="hljs-attr">Katsuko</span> <span class="hljs-attr">Saruhashi</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">imageId:</span> &#x27;<span class="hljs-attr">YfeOqp2</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Avatar.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-20dgjwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-20dgjwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; getImageUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Avatar</span>(<span class="hljs-params">&#123; person, size &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;avatar&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;getImageUrl(person)&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;person.name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">width</span>=<span class="hljs-string">&#123;size&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">height</span>=<span class="hljs-string">&#123;size&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>utils.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-onik83lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-onik83lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getImageUrl</span>(<span class="hljs-params">person, size = <span class="hljs-string">&#x27;s&#x27;</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="hljs-string">&#x27;https://i.imgur.com/&#x27;</span> +<br>    person.<span class="hljs-property">imageId</span> +<br>    size +<br>    <span class="hljs-string">&#x27;.jpg&#x27;</span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»æ”¶åˆ°ä¸åŒçš„ propsã€‚ Props å¹¶ä¸æ€»æ˜¯é™æ€çš„ï¼Props åæ˜ äº†ç»„ä»¶åœ¨ä»»ä½•æ—¶é—´ç‚¹çš„æ•°æ®ï¼Œå¹¶ä¸ä»…ä»…æ˜¯åœ¨å¼€å§‹æ—¶ã€‚</p><p>props æ˜¯ <a href="https://en.wikipedia.org/wiki/Immutable_object">ä¸å¯å˜çš„</a>ï¼ˆä¸€ä¸ªè®¡ç®—æœºç§‘å­¦æœ¯è¯­ï¼Œæ„æ€æ˜¯â€œä¸å¯æ”¹å˜â€ï¼‰ã€‚å½“ä¸€ä¸ªç»„ä»¶éœ€è¦æ”¹å˜å®ƒçš„ propsï¼ˆä¾‹å¦‚ï¼Œå“åº”ç”¨æˆ·äº¤äº’æˆ–æ–°æ•°æ®ï¼‰æ—¶ï¼Œå®ƒä¸å¾—ä¸â€œè¯·æ±‚â€å®ƒçš„çˆ¶ç»„ä»¶ä¼ é€’ ä¸åŒçš„ props â€”â€” ä¸€ä¸ªæ–°å¯¹è±¡ï¼å®ƒçš„æ—§ props å°†è¢«ä¸¢å¼ƒï¼Œæœ€ç»ˆ JavaScript å¼•æ“å°†å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚</p><p>ä¸è¦å°è¯•â€œæ›´æ”¹ propsâ€ã€‚ å½“ä½ éœ€è¦å“åº”ç”¨æˆ·è¾“å…¥ï¼ˆä¾‹å¦‚æ›´æ”¹æ‰€é€‰é¢œè‰²ï¼‰æ—¶ï¼Œä½ å¯ä»¥â€œè®¾ç½® stateâ€ã€‚</p><h2 id="6-æ¡ä»¶æ¸²æŸ“"><a href="#6-æ¡ä»¶æ¸²æŸ“" class="headerlink" title="6.æ¡ä»¶æ¸²æŸ“"></a>6.æ¡ä»¶æ¸²æŸ“</h2><p> React ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ JavaScript çš„ <code>if</code> è¯­å¥ã€<code>&amp;&amp;</code> å’Œ <code>? :</code> è¿ç®—ç¬¦ã€åˆç§°æ¡ä»¶è¿ç®—ç¬¦ï¼Œä¸‰ç›®è¿ç®—ç¬¦ã€‘æ¥é€‰æ‹©æ€§åœ°æ¸²æŸ“ JSXã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tdhyv5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tdhyv5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Item</span>(<span class="hljs-params">&#123; name, isPacked &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (isPacked) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; âœ”<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PackingList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Sally Ride çš„è¡Œææ¸…å•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">isPacked</span>=<span class="hljs-string">&#123;true&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;å®‡èˆªæœ&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">isPacked</span>=<span class="hljs-string">&#123;true&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;å¸¦é‡‘ç®”çš„å¤´ç›”&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">isPacked</span>=<span class="hljs-string">&#123;false&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Tam çš„ç…§ç‰‡&quot;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231103154214180.png" alt="image-20231103154214180" style="zoom:50%;" /><p>æ¡ä»¶è¿ç®—ç¬¦ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wh8v1glqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wh8v1glqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">if</span> (isPacked) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>&#123;name&#125; âœ”<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;<br><br>&#125;<br><span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span>&#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;<br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ranl5ylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ranl5ylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span></span><br><span class="language-xml">    &#123;isPacked ? name + &#x27; âœ”&#x27; : name&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>ä½¿ç”¨ <code>&amp;&amp;</code>ï¼Œä½ ä¹Ÿå¯ä»¥å®ç°ä»…å½“ <code>isPacked</code> ä¸º <code>true</code> æ—¶ï¼Œæ¸²æŸ“å‹¾é€‰ç¬¦å·ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2k5ky5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2k5ky5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span></span><br><span class="language-xml">    &#123;name&#125; &#123;isPacked &amp;&amp; &#x27;âœ”&#x27;&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>å½“ <code>isPacked</code> ä¸ºçœŸå€¼æ—¶ï¼Œåˆ™ï¼ˆ<code>&amp;&amp;</code>ï¼‰æ¸²æŸ“å‹¾é€‰ç¬¦å·ï¼Œå¦åˆ™ï¼Œä¸æ¸²æŸ“ã€‚</p><p>å½“ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND">JavaScript &amp;&amp; è¡¨è¾¾å¼</a> çš„å·¦ä¾§ï¼ˆæˆ‘ä»¬çš„æ¡ä»¶ï¼‰ä¸º <code>true</code> æ—¶ï¼Œå®ƒåˆ™è¿”å›å…¶å³ä¾§çš„å€¼ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œæ˜¯å‹¾é€‰ç¬¦å·ï¼‰ã€‚ä½†æ¡ä»¶çš„ç»“æœæ˜¯ <code>false</code>ï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼ä¼šå˜æˆ <code>false</code>ã€‚åœ¨ JSX é‡Œï¼ŒReact ä¼šå°† <code>false</code> è§†ä¸ºä¸€ä¸ªâ€œç©ºå€¼â€ï¼Œå°±åƒ <code>null</code> æˆ–è€… <code>undefined</code>ï¼Œè¿™æ · React å°±ä¸ä¼šåœ¨è¿™é‡Œè¿›è¡Œä»»ä½•æ¸²æŸ“ã€‚</p><p>åˆ‡å‹¿å°†æ•°å­—æ”¾åœ¨ <code>&amp;&amp;</code> å·¦ä¾§ï¼š<mark>JavaScript ä¼šè‡ªåŠ¨å°†å·¦ä¾§çš„å€¼è½¬æ¢æˆå¸ƒå°”ç±»å‹ä»¥åˆ¤æ–­æ¡ä»¶æˆç«‹ä¸å¦</mark>ã€‚ç„¶è€Œï¼Œå¦‚æœå·¦ä¾§æ˜¯ <code>0</code>ï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°†å˜æˆå·¦ä¾§çš„å€¼ï¼ˆ<code>0</code>ï¼‰ï¼ŒReact æ­¤æ—¶åˆ™ä¼šæ¸²æŸ“ <code>0</code> è€Œä¸æ˜¯ä¸è¿›è¡Œæ¸²æŸ“ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯ <code>messageCount &amp;&amp; &lt;p&gt;New messages&lt;/p&gt;</code>ã€‚å…¶åŸæœ¬æ˜¯æƒ³å½“ <code>messageCount</code> ä¸º 0 çš„æ—¶å€™ä¸è¿›è¡Œæ¸²æŸ“ï¼Œä½†å®é™…ä¸Šå´æ¸²æŸ“äº† <code>0</code>ã€‚</p><p>ä¸ºäº†æ›´æ­£ï¼Œå¯ä»¥å°†å·¦ä¾§çš„å€¼æ”¹æˆå¸ƒå°”ç±»å‹ï¼š<code>messageCount &gt; 0 &amp;&amp; &lt;p&gt;New messages&lt;/p&gt;</code>ã€‚</p><h2 id="7-æ¸²æŸ“åˆ—è¡¨"><a href="#7-æ¸²æŸ“åˆ—è¡¨" class="headerlink" title="7.æ¸²æŸ“åˆ—è¡¨"></a>7.æ¸²æŸ“åˆ—è¡¨</h2><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b5y1gjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b5y1gjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>é©¬é‡Œå¥¥Â·è«åˆ©çº³: åŒ–å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†: ç‰©ç†å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš: åŒ–å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡: å¤©ä½“ç‰©ç†å­¦å®¶<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-754k4wlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-754k4wlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> people = [<br>  <span class="hljs-string">&#x27;å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š: æ•°å­¦å®¶&#x27;</span>,<br>  <span class="hljs-string">&#x27;é©¬é‡Œå¥¥Â·è«åˆ©çº³: åŒ–å­¦å®¶&#x27;</span>,<br>  <span class="hljs-string">&#x27;ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†: ç‰©ç†å­¦å®¶&#x27;</span>,<br>  <span class="hljs-string">&#x27;ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš: åŒ–å­¦å®¶&#x27;</span>,<br>  <span class="hljs-string">&#x27;è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡: å¤©ä½“ç‰©ç†å­¦å®¶&#x27;</span>,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> listItems = people.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>&#123;person&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>&#123;listItems&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¾“å‡ºæ§åˆ¶å°é”™è¯¯ï¼š<code>Warning: Each child in a list should have a unique â€œkeyâ€ prop.</code></p><p>è§£å†³æ–¹æ³•ï¼šå› ä¸ºä½ å¿…é¡»ç»™æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½æŒ‡å®šä¸€ä¸ª <code>key</code>â€”â€”å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—çš„å½¢å¼ï¼Œåªè¦èƒ½å”¯ä¸€æ ‡è¯†å‡ºå„ä¸ªæ•°ç»„é¡¹å°±è¡Œï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v98s4nlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v98s4nlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;person.id&#125;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p><mark>ç›´æ¥æ”¾åœ¨ <code>map()</code> æ–¹æ³•é‡Œçš„ JSX å…ƒç´ ä¸€èˆ¬éƒ½éœ€è¦æŒ‡å®š <code>key</code> å€¼ï¼</mark></p><p>ä¸åŒæ¥æºçš„æ•°æ®å¾€å¾€å¯¹åº”ä¸åŒçš„ key å€¼è·å–æ–¹å¼ï¼š</p><ul><li>æ¥è‡ªæ•°æ®åº“çš„æ•°æ®ï¼š å¦‚æœä½ çš„æ•°æ®æ˜¯ä»æ•°æ®åº“ä¸­è·å–çš„ï¼Œé‚£ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨æ•°æ®è¡¨ä¸­çš„ä¸»é”®ï¼Œå› ä¸ºå®ƒä»¬å¤©ç„¶å…·æœ‰å”¯ä¸€æ€§ã€‚</li><li>æœ¬åœ°äº§ç”Ÿæ•°æ®ï¼š å¦‚æœä½ æ•°æ®çš„äº§ç”Ÿå’Œä¿å­˜éƒ½åœ¨æœ¬åœ°ï¼ˆä¾‹å¦‚ç¬”è®°è½¯ä»¶é‡Œçš„ç¬”è®°ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè‡ªå¢è®¡æ•°å™¨æˆ–è€…ä¸€ä¸ªç±»ä¼¼ <a href="https://www.npmjs.com/package/uuid"><code>uuid</code></a> çš„åº“æ¥ç”Ÿæˆ keyã€‚</li></ul><p>key éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼š</p><ol><li>key å€¼åœ¨å…„å¼ŸèŠ‚ç‚¹ä¹‹é—´å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸è¿‡ä¸è¦æ±‚å…¨å±€å”¯ä¸€ï¼Œåœ¨ä¸åŒçš„æ•°ç»„ä¸­å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ keyã€‚</li><li>key å€¼ä¸èƒ½æ”¹å˜ï¼Œå¦åˆ™å°±å¤±å»äº†ä½¿ç”¨ key çš„æ„ä¹‰ï¼æ‰€ä»¥åƒä¸‡ä¸è¦åœ¨æ¸²æŸ“æ—¶åŠ¨æ€åœ°ç”Ÿæˆ keyã€‚</li></ol><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">ä½ å¯èƒ½ä¼šæƒ³ç›´æ¥æŠŠæ•°ç»„é¡¹çš„ç´¢å¼•å½“ä½œ key å€¼æ¥ç”¨ï¼Œå®é™…ä¸Šï¼Œå¦‚æœä½ æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®š `key` å€¼ï¼ŒReact ç¡®å®é»˜è®¤ä¼šè¿™ä¹ˆåšã€‚ä½†æ˜¯æ•°ç»„é¡¹çš„é¡ºåºåœ¨æ’å…¥ã€åˆ é™¤æˆ–è€…é‡æ–°æ’åºç­‰æ“ä½œä¸­ä¼šå‘ç”Ÿæ”¹å˜ï¼Œæ­¤æ—¶æŠŠç´¢å¼•é¡ºåºç”¨ä½œ key å€¼ä¼šäº§ç”Ÿä¸€äº›å¾®å¦™ä¸”ä»¤äººå›°æƒ‘çš„ bugã€‚<br />ä¸ä¹‹ç±»ä¼¼ï¼Œè¯·ä¸è¦åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åœ°äº§ç”Ÿ keyï¼Œåƒæ˜¯ `key={Math.random()}` è¿™ç§æ–¹å¼ã€‚è¿™ä¼šå¯¼è‡´æ¯æ¬¡é‡æ–°æ¸²æŸ“åçš„ key å€¼éƒ½ä¸ä¸€æ ·ï¼Œä»è€Œä½¿å¾—æ‰€æœ‰çš„ç»„ä»¶å’Œ DOM å…ƒç´ æ¯æ¬¡éƒ½è¦é‡æ–°åˆ›å»ºã€‚è¿™ä¸ä»…ä¼šé€ æˆè¿è¡Œå˜æ…¢çš„é—®é¢˜ï¼Œæ›´æœ‰å¯èƒ½å¯¼è‡´ç”¨æˆ·è¾“å…¥çš„ä¸¢å¤±ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨èƒ½ä»ç»™å®šæ•°æ®ä¸­ç¨³å®šå–å¾—çš„å€¼æ‰æ˜¯æ˜æ™ºçš„é€‰æ‹©ã€‚<p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œç»„ä»¶ä¸ä¼šæŠŠ <code>key</code> å½“ä½œ props çš„ä¸€éƒ¨åˆ†ã€‚Key çš„å­˜åœ¨åªå¯¹ React æœ¬èº«èµ·åˆ°æç¤ºä½œç”¨ã€‚å¦‚æœä½ çš„ç»„ä»¶éœ€è¦ä¸€ä¸ª IDï¼Œé‚£ä¹ˆè¯·æŠŠå®ƒä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ prop ä¼ ç»™ç»„ä»¶ï¼š <code>&lt;Profile key=&#123;id&#125; userId=&#123;id&#125; /&gt;</code>ã€‚</p></p><hr><p>data.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7oo6sflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7oo6sflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> people = [<br>  &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;å‡¯ç‘Ÿç³Â·çº¦ç¿°é€Š&#x27;</span>,<br>    <span class="hljs-attr">profession</span>: <span class="hljs-string">&#x27;æ•°å­¦å®¶&#x27;</span>,<br>    <span class="hljs-attr">accomplishment</span>: <span class="hljs-string">&#x27;å¤ªç©ºé£è¡Œç›¸å…³æ•°å€¼çš„æ ¸ç®—&#x27;</span>,<br>    <span class="hljs-attr">imageId</span>: <span class="hljs-string">&#x27;MK3eW3A&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;é©¬é‡Œå¥¥Â·è«åˆ©çº³&#x27;</span>,<br>    <span class="hljs-attr">profession</span>: <span class="hljs-string">&#x27;åŒ–å­¦å®¶&#x27;</span>,<br>    <span class="hljs-attr">accomplishment</span>: <span class="hljs-string">&#x27;åŒ—æè‡­æ°§ç©ºæ´çš„å‘ç°&#x27;</span>,<br>    <span class="hljs-attr">imageId</span>: <span class="hljs-string">&#x27;mynHUSa&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ç©†ç½•é»˜å¾·Â·é˜¿åœæœå‹’Â·è¨æ‹‰å§†&#x27;</span>,<br>    <span class="hljs-attr">profession</span>: <span class="hljs-string">&#x27;ç‰©ç†å­¦å®¶&#x27;</span>,<br>    <span class="hljs-attr">accomplishment</span>: <span class="hljs-string">&#x27;å…³äºåŸºæœ¬ç²’å­é—´å¼±ç›¸äº’ä½œç”¨å’Œç”µç£ç›¸äº’ä½œç”¨çš„ç»Ÿä¸€ç†è®º&#x27;</span>,<br>    <span class="hljs-attr">imageId</span>: <span class="hljs-string">&#x27;bE7W1ji&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ç€è¥¿Â·è±æ¸©Â·æœ±åˆ©äºš&#x27;</span>,<br>    <span class="hljs-attr">profession</span>: <span class="hljs-string">&#x27;åŒ–å­¦å®¶&#x27;</span>,<br>    <span class="hljs-attr">accomplishment</span>: <span class="hljs-string">&#x27;å¼€åˆ›æ€§çš„å¯çš„æ¾è¯ç‰©ã€ç±»å›ºé†‡å’Œé¿å­•è¯çš„ç ”ç©¶&#x27;</span>,<br>    <span class="hljs-attr">imageId</span>: <span class="hljs-string">&#x27;IOjWm71&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;è‹å¸ƒæ‹‰é©¬å°¼æ‰¬Â·é’±å¾·æ‹‰å¡å¡&#x27;</span>,<br>    <span class="hljs-attr">profession</span>: <span class="hljs-string">&#x27;å¤©ä½“ç‰©ç†å­¦å®¶&#x27;</span>,<br>    <span class="hljs-attr">accomplishment</span>: <span class="hljs-string">&#x27;ç™½çŸ®æ˜Ÿè´¨é‡è®¡ç®—&#x27;</span>,<br>    <span class="hljs-attr">imageId</span>: <span class="hljs-string">&#x27;lrWQx8l&#x27;</span>,<br>  &#125;,<br>];<br></code></pre></td></tr></table></div></figure><p>utils.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8tpye0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8tpye0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getImageUrl</span>(<span class="hljs-params">person</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="hljs-string">&#x27;https://i.imgur.com/&#x27;</span> +<br>    person.<span class="hljs-property">imageId</span> +<br>    <span class="hljs-string">&#x27;s.jpg&#x27;</span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nitpkclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nitpkclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; people &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./data.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; getImageUrl &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> chemists = people.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span><br>    person.<span class="hljs-property">profession</span> === <span class="hljs-string">&#x27;åŒ–å­¦å®¶&#x27;</span><br>  );<br>  <span class="hljs-keyword">const</span> listItems = chemists.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;getImageUrl(person)&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;person.name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>&#123;person.name&#125;:<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="language-xml">        &#123;&#x27; &#x27; + person.profession + &#x27; &#x27;&#125;</span><br><span class="language-xml">        å› &#123;person.accomplishment&#125;è€Œé—»åä¸–ç•Œ</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>&#123;listItems&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ§åˆ¶å°é”™è¯¯ï¼š<code>Warning: Each child in a list should have a unique &quot;key&quot; prop. Check the render method of List. See https://reactjs.org/link/warning-keys for more information.    at li    at List</code></p><p><mark>å› ä¸ºç®­å¤´å‡½æ•°ä¼šéšå¼åœ°è¿”å›ä½äº <code>=&gt;</code> ä¹‹åçš„è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœç•¥ <code>return</code> è¯­å¥ã€‚</mark></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cchia2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cchia2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> listItems = chemists.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span> <span class="hljs-comment">// éšå¼åœ°è¿”å›ï¼</span><br>);<br></code></pre></td></tr></table></div></figure><p><mark>å¦‚æœä½ çš„ <code>=&gt;</code> åé¢è·Ÿäº†ä¸€å¯¹èŠ±æ‹¬å· <code>&#123;</code> ï¼Œé‚£ä½ å¿…é¡»ä½¿ç”¨ <code>return</code> æ¥æŒ‡å®šè¿”å›å€¼ï¼</mark></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-c0ld9ilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-c0ld9ilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> listItems = chemists.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span> &#123;<br><span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>ç®­å¤´å‡½æ•° <code>=&gt; &#123;</code> åé¢çš„éƒ¨åˆ†è¢«ç§°ä¸º <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions#function_body">â€œå—å‡½æ•°ä½“â€</a>ï¼Œå—å‡½æ•°ä½“æ”¯æŒå¤šè¡Œä»£ç çš„å†™æ³•ï¼Œä½†è¦ç”¨ <code>return</code> è¯­å¥æ‰èƒ½æŒ‡å®šè¿”å›å€¼ã€‚å‡å¦‚ä½ å¿˜äº†å†™ <code>return</code>ï¼Œé‚£è¿™ä¸ªå‡½æ•°ä»€ä¹ˆéƒ½ä¸ä¼šè¿”å›ï¼</p><p>ä¸ºæ¯ä¸ªåˆ—è¡¨é¡¹æ˜¾ç¤ºå¤šä¸ª DOM èŠ‚ç‚¹ï¼šFragment è¯­æ³•çš„ç®€å†™å½¢å¼ <code>&lt;&gt; &lt;/&gt;</code> æ— æ³•æ¥å— key å€¼ï¼Œæ‰€ä»¥ä½ åªèƒ½è¦ä¹ˆæŠŠç”Ÿæˆçš„èŠ‚ç‚¹ç”¨ä¸€ä¸ª <code>&lt;div&gt;</code> æ ‡ç­¾åŒ…è£¹èµ·æ¥ï¼Œè¦ä¹ˆä½¿ç”¨é•¿ä¸€ç‚¹ä½†æ›´æ˜ç¡®çš„ <code>&lt;Fragment&gt;</code> å†™æ³•ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t4d8e0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t4d8e0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Fragment</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> listItems = people.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">person</span> =&gt;</span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;person.id&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;person.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;person.bio&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></div></figure><p>è¿™é‡Œçš„ Fragment æ ‡ç­¾æœ¬èº«å¹¶ä¸ä¼šå‡ºç°åœ¨ DOM ä¸Šï¼Œè¿™ä¸²ä»£ç æœ€ç»ˆä¼šè½¬æ¢æˆ <code>&lt;h1&gt;</code>ã€<code>&lt;p&gt;</code>ã€<code>&lt;h1&gt;</code>ã€<code>&lt;p&gt;</code>â€¦â€¦ çš„åˆ—è¡¨ã€‚</p><h2 id="8-ä¿æŒç»„ä»¶çº¯ç²¹"><a href="#8-ä¿æŒç»„ä»¶çº¯ç²¹" class="headerlink" title="8.ä¿æŒç»„ä»¶çº¯ç²¹"></a>8.ä¿æŒç»„ä»¶çº¯ç²¹</h2><p>éƒ¨åˆ† JavaScript å‡½æ•°æ˜¯ çº¯ç²¹ çš„ï¼Œè¿™ç±»å‡½æ•°é€šå¸¸è¢«ç§°ä¸ºçº¯å‡½æ•°ã€‚çº¯å‡½æ•°ä»…æ‰§è¡Œè®¡ç®—æ“ä½œï¼Œä¸åšå…¶ä»–æ“ä½œã€‚ä½ å¯ä»¥é€šè¿‡å°†ç»„ä»¶æŒ‰çº¯å‡½æ•°ä¸¥æ ¼ç¼–å†™ï¼Œä»¥é¿å…ä¸€äº›éšç€ä»£ç åº“çš„å¢é•¿è€Œå‡ºç°çš„ã€ä»¤äººå›°æ‰°çš„ bug ä»¥åŠä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚</p><p>çº¯å‡½æ•°çš„ç‰¹å¾ï¼š</p><ul><li>åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ã€‚å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡ã€‚</li><li>è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒã€‚ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œçº¯å‡½æ•°åº”æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚</li></ul><p>React å‡è®¾ä½ ç¼–å†™çš„æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯çº¯å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œä½ æ‰€ç¼–å†™çš„ React ç»„ä»¶å¿…é¡»æ€»æ˜¯è¿”å›ç›¸åŒçš„ JSXã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5gnh69lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5gnh69lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Recipe</span>(<span class="hljs-params">&#123; drinkers &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>    </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Boil &#123;drinkers&#125; cups of water.<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Add &#123;drinkers&#125; spoons of tea and &#123;0.5 * drinkers&#125; spoons of spice.<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Add &#123;0.5 * drinkers&#125; cups of milk to boil and sugar to taste.<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Spiced Chai Recipe<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>For two<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Recipe</span> <span class="hljs-attr">drinkers</span>=<span class="hljs-string">&#123;2&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>For a gathering<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Recipe</span> <span class="hljs-attr">drinkers</span>=<span class="hljs-string">&#123;4&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>React çš„æ¸²æŸ“è¿‡ç¨‹å¿…é¡»è‡ªå§‹è‡³ç»ˆæ˜¯çº¯ç²¹çš„ã€‚ç»„ä»¶åº”è¯¥åª è¿”å› å®ƒä»¬çš„ JSXï¼Œè€Œä¸ æ”¹å˜ åœ¨æ¸²æŸ“å‰ï¼Œå°±å·²å­˜åœ¨çš„ä»»ä½•å¯¹è±¡æˆ–å˜é‡ â€” è¿™å°†ä¼šä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ï¼</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x2l8t6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x2l8t6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> guest = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cup</span>(<span class="hljs-params"></span>) &#123;<br>  guest = guest + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TeaSet</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p> <a href="http://localhost:3000/learn/passing-props-to-a-component">å°† <code>guest</code> ä½œä¸º prop ä¼ å…¥</a> æ¥ä¿®å¤æ­¤ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1a15n1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1a15n1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cup</span>(<span class="hljs-params">&#123; guest &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TeaSet</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> <span class="hljs-attr">guest</span>=<span class="hljs-string">&#123;1&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> <span class="hljs-attr">guest</span>=<span class="hljs-string">&#123;2&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> <span class="hljs-attr">guest</span>=<span class="hljs-string">&#123;3&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ React ä¸­ï¼Œä½ å¯ä»¥åœ¨æ¸²æŸ“æ—¶è¯»å–ä¸‰ç§è¾“å…¥ï¼š<a href="http://localhost:3000/learn/passing-props-to-a-component">props</a>ï¼Œ<a href="http://localhost:3000/learn/state-a-components-memory">state</a> å’Œ <a href="http://localhost:3000/learn/passing-data-deeply-with-context">context</a>ã€‚ä½ åº”è¯¥å§‹ç»ˆå°†è¿™äº›è¾“å…¥è§†ä¸ºåªè¯»ã€‚</p><p>å½“ä½ æƒ³æ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ”¹æŸäº›å†…å®¹æ—¶ï¼Œä½ åº”è¯¥ <a href="http://localhost:3000/learn/state-a-components-memory">è®¾ç½®state</a>ï¼Œè€Œä¸æ˜¯ç›´æ¥å†™å…¥å˜é‡ã€‚å½“ä½ çš„ç»„ä»¶æ­£åœ¨æ¸²æŸ“æ—¶ï¼Œä½ æ°¸è¿œä¸åº”è¯¥æ”¹å˜é¢„å…ˆå­˜åœ¨çš„å˜é‡æˆ–å¯¹è±¡ã€‚</p><p>React æä¾›äº† â€œä¸¥æ ¼æ¨¡å¼â€ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘æ—¶ï¼Œå®ƒå°†ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶å‡½æ•°ä¸¤æ¬¡ã€‚é€šè¿‡é‡å¤è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼æœ‰åŠ©äºæ‰¾åˆ°è¿åè¿™äº›è§„åˆ™çš„ç»„ä»¶ã€‚</p><p>ä¸¥æ ¼æ¨¡å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ç”Ÿæ•ˆï¼Œå› æ­¤å®ƒä¸ä¼šé™ä½åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚å¦‚éœ€å¼•å…¥ä¸¥æ ¼æ¨¡å¼ï¼Œä½ å¯ä»¥ç”¨ <code>&lt;React.StrictMode&gt;</code> åŒ…è£¹æ ¹ç»„ä»¶ã€‚ä¸€äº›æ¡†æ¶ä¼šé»˜è®¤è¿™æ ·åšã€‚</p><hr><p>&#x3D;&#x3D;çªå˜&#x3D;&#x3D;mutationï¼šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œç»„ä»¶æ”¹å˜äº† é¢„å…ˆå­˜åœ¨çš„ å˜é‡çš„å€¼ ã€‚çº¯å‡½æ•°ä¸ä¼šæ”¹å˜å‡½æ•°ä½œç”¨åŸŸå¤–çš„å˜é‡ã€æˆ–åœ¨å‡½æ•°è°ƒç”¨å‰åˆ›å»ºçš„å¯¹è±¡â€”â€”è¿™ä¼šä½¿å‡½æ•°å˜å¾—ä¸çº¯ç²¹ï¼</p><p>ä½†æ˜¯ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨æ¸²æŸ“æ—¶æ›´æ”¹ä½ åˆšåˆšåˆ›å»ºçš„å˜é‡å’Œå¯¹è±¡ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t02addlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t02addlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cup</span>(<span class="hljs-params">&#123; guest &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Tea cup for guest #&#123;guest&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TeaGathering</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> cups = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">12</span>; i++) &#123;<br>    cups.<span class="hljs-title function_">push</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Cup</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;i&#125;</span> <span class="hljs-attr">guest</span>=<span class="hljs-string">&#123;i&#125;</span> /&gt;</span></span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> cups;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœ <code>cups</code> å˜é‡æˆ– <code>[]</code> æ•°ç»„æ˜¯åœ¨ <code>TeaGathering</code> å‡½æ•°ä¹‹å¤–åˆ›å»ºçš„ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼å› ä¸ºå¦‚æœé‚£æ ·çš„è¯ï¼Œå½“ä½ è°ƒç”¨æ•°ç»„çš„ push æ–¹æ³•æ—¶ï¼Œå°±ä¼šæ›´æ”¹ é¢„å…ˆå­˜åœ¨çš„ å¯¹è±¡ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™é‡Œä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºæ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œä½ éƒ½æ˜¯åœ¨ <code>TeaGathering</code> å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å®ƒä»¬ã€‚TeaGathering ä¹‹å¤–çš„ä»£ç å¹¶ä¸ä¼šçŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆå³å±€éƒ¨mutationã€‚</p><p> å‰¯ä½œç”¨ï¼šæ›´æ–°å±å¹•ã€å¯åŠ¨åŠ¨ç”»ã€æ›´æ”¹æ•°æ®ç­‰ã€‚å®ƒä»¬æ˜¯ â€œé¢å¤–â€ å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸æ¸²æŸ“è¿‡ç¨‹æ— å…³ã€‚</p><p>åœ¨ React ä¸­ï¼Œå‰¯ä½œç”¨é€šå¸¸å±äº <a href="http://localhost:3000/learn/responding-to-events">äº‹ä»¶å¤„ç†ç¨‹åº</a>ã€‚äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ React åœ¨ä½ æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚å•å‡»æŒ‰é’®ï¼‰æ—¶è¿è¡Œçš„å‡½æ•°ã€‚å³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯åœ¨ä½ çš„ç»„ä»¶ å†…éƒ¨ å®šä¹‰çš„ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´è¿è¡Œï¼ å› æ­¤äº‹ä»¶å¤„ç†ç¨‹åºæ— éœ€æ˜¯çº¯å‡½æ•°ã€‚</p><p>å¦‚æœä½ ç”¨å°½ä¸€åˆ‡åŠæ³•ï¼Œä»æ— æ³•ä¸ºå‰¯ä½œç”¨æ‰¾åˆ°åˆé€‚çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨ç»„ä»¶ä¸­çš„ <a href="http://localhost:3000/reference/react/useEffect"><code>useEffect</code></a> æ–¹æ³•å°†å…¶é™„åŠ åˆ°è¿”å›çš„ JSX ä¸­ã€‚è¿™ä¼šå‘Šè¯‰ React åœ¨æ¸²æŸ“ç»“æŸåæ‰§è¡Œå®ƒã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•åº”è¯¥æ˜¯ä½ æœ€åçš„æ‰‹æ®µã€‚</p><p>React ä¸ºä½•ä¾§é‡äºçº¯å‡½æ•°ï¼š</p><ol><li>ä½ çš„ç»„ä»¶å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹è¿è¡Œ â€” ä¾‹å¦‚ï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼ç”±äºå®ƒä»¬é’ˆå¯¹ç›¸åŒçš„è¾“å…¥ï¼Œæ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœï¼Œå› æ­¤ä¸€ä¸ªç»„ä»¶å¯ä»¥æ»¡è¶³å¤šä¸ªç”¨æˆ·è¯·æ±‚ã€‚</li><li>ä½ å¯ä»¥ä¸ºé‚£äº›è¾“å…¥æœªæ›´æ”¹çš„ç»„ä»¶æ¥ <a href="http://localhost:3000/reference/react/memo">è·³è¿‡æ¸²æŸ“</a>ï¼Œä»¥æé«˜æ€§èƒ½ã€‚è¿™æ˜¯å®‰å…¨çš„åšæ³•ï¼Œå› ä¸ºçº¯å‡½æ•°æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°ç¼“å­˜å®ƒä»¬ã€‚</li><li>å¦‚æœåœ¨æ¸²æŸ“æ·±å±‚ç»„ä»¶æ ‘çš„è¿‡ç¨‹ä¸­ï¼ŒæŸäº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact å¯ä»¥é‡æ–°å¼€å§‹æ¸²æŸ“ï¼Œè€Œä¸ä¼šæµªè´¹æ—¶é—´å®Œæˆè¿‡æ—¶çš„æ¸²æŸ“ã€‚çº¯ç²¹æ€§ä½¿å¾—å®ƒéšæ—¶å¯ä»¥å®‰å…¨åœ°åœæ­¢è®¡ç®—ã€‚</li></ol><p>æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„æ¯ä¸ª React æ–°ç‰¹æ€§éƒ½åˆ©ç”¨åˆ°äº†çº¯å‡½æ•°ã€‚ä»æ•°æ®è·å–åˆ°åŠ¨ç”»å†åˆ°æ€§èƒ½ï¼Œä¿æŒç»„ä»¶çš„çº¯ç²¹å¯ä»¥å……åˆ†é‡Šæ”¾ React èŒƒå¼çš„èƒ½åŠ›ã€‚</p><h2 id="9-å°†UIè§†ä¸ºæ ‘"><a href="#9-å°†UIè§†ä¸ºæ ‘" class="headerlink" title="9.å°†UIè§†ä¸ºæ ‘"></a>9.å°†UIè§†ä¸ºæ ‘</h2><p>React åˆ›å»ºçš„ UI æ ‘æ˜¯ç”±æ¸²æŸ“è¿‡çš„ç»„ä»¶æ„æˆçš„ï¼Œè¢«ç§°ä¸ºæ¸²æŸ“æ ‘ã€‚</p><p>æ¸²æŸ“æ ‘è¡¨ç¤º React åº”ç”¨ç¨‹åºçš„å•ä¸ªæ¸²æŸ“è¿‡ç¨‹ã€‚åœ¨ <a href="http://localhost:3000/learn/conditional-rendering">æ¡ä»¶æ¸²æŸ“</a> ä¸­ï¼Œçˆ¶ç»„ä»¶å¯ä»¥æ ¹æ®ä¼ é€’çš„æ•°æ®æ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶ã€‚æ¯æ¬¡æ¸²æŸ“è¿‡ç¨‹çš„æ¸²æŸ“æ ‘å¯èƒ½éƒ½ä¸åŒã€‚</p><p>åœ¨ React åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ ‘æ¥å»ºæ¨¡çš„å¦ä¸€ä¸ªå…³ç³»æ˜¯åº”ç”¨ç¨‹åºçš„æ¨¡å—ä¾èµ–å…³ç³»ã€‚å½“ <a href="http://localhost:3000/learn/importing-and-exporting-components#exporting-and-importing-a-component">æ‹†åˆ†ç»„ä»¶</a> å’Œé€»è¾‘åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­æ—¶ï¼Œå°±åˆ›å»ºäº† <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript æ¨¡å—</a>ï¼Œåœ¨è¿™äº›æ¨¡å—ä¸­å¯ä»¥å¯¼å‡ºç»„ä»¶ã€å‡½æ•°æˆ–å¸¸é‡ã€‚</p><p>æ¨¡å—ä¾èµ–æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨è¯¥æ¨¡å—ä¸­çš„ <code>import</code> è¯­å¥ã€‚</p><p>æ¸²æŸ“æ ‘ï¼š</p><img src="image-20231103171110755.png" alt="image-20231103171110755" style="zoom:50%;" /><p>æ¨¡å—ä¾èµ–æ ‘ï¼š</p><img src="image-20231103171127909.png" alt="image-20231103171127909" style="zoom:50%;" /><p>ä¾èµ–æ ‘å¯¹äºç¡®å®šè¿è¡Œ React åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¨¡å—éå¸¸æœ‰ç”¨ã€‚åœ¨ä¸ºç”Ÿäº§ç¯å¢ƒæ„å»º React åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ„å»ºæ­¥éª¤ï¼Œè¯¥æ­¥éª¤å°†æ†ç»‘æ‰€æœ‰å¿…è¦çš„ JavaScript ä»¥ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚è´Ÿè´£æ­¤æ“ä½œçš„å·¥å…·ç§°ä¸º <a href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Understanding_client-side_tools/Overview#the_modern_tooling_ecosystem">bundlerï¼ˆæ†ç»‘å™¨ï¼‰</a>ï¼Œå¹¶ä¸” bundler å°†ä½¿ç”¨ä¾èµ–æ ‘æ¥ç¡®å®šåº”åŒ…å«å“ªäº›æ¨¡å—ã€‚</p><p>éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œæ†ç»‘åŒ…å¤§å°é€šå¸¸ä¹Ÿä¼šå¢åŠ ã€‚å¤§å‹æ†ç»‘åŒ…å¤§å°å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä¸‹è½½å’Œè¿è¡Œæˆæœ¬é«˜æ˜‚ï¼Œå¹¶å»¶è¿Ÿ UI ç»˜åˆ¶çš„æ—¶é—´ã€‚äº†è§£åº”ç”¨ç¨‹åºçš„ä¾èµ–æ ‘å¯èƒ½æœ‰åŠ©äºè°ƒè¯•è¿™äº›é—®é¢˜ã€‚</p><h1 id="å››-æ·»åŠ äº¤äº’"><a href="#å››-æ·»åŠ äº¤äº’" class="headerlink" title="å››.æ·»åŠ äº¤äº’"></a>å››.æ·»åŠ äº¤äº’</h1><p>åœ¨ React ä¸­ï¼Œéšæ—¶é—´å˜åŒ–çš„æ•°æ®è¢«ç§°ä¸ºçŠ¶æ€stateã€‚ä½ å¯ä»¥å‘ä»»ä½•ç»„ä»¶æ·»åŠ çŠ¶æ€ï¼Œå¹¶æŒ‰éœ€è¿›è¡Œæ›´æ–°ã€‚</p><h2 id="1-å“åº”äº‹ä»¶"><a href="#1-å“åº”äº‹ä»¶" class="headerlink" title="1.å“åº”äº‹ä»¶"></a>1.å“åº”äº‹ä»¶</h2><p>React å…è®¸ä½ å‘ JSX ä¸­æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p><p><code>&lt;button&gt;</code> ç­‰å†…ç½®ç»„ä»¶åªæ”¯æŒå†…ç½®æµè§ˆå™¨äº‹ä»¶ï¼Œå¦‚ <code>onClick</code>ã€‚å¯ä»¥å®šä¹‰ <code>handleClick</code> å‡½æ•°ç„¶å <a href="http://localhost:3000/learn/passing-props-to-a-component">å°†å…¶ä½œä¸º prop ä¼ å…¥</a> <code>&lt;button&gt;</code>ã€‚å…¶ä¸­ <code>handleClick</code> æ˜¯ä¸€ä¸ª äº‹ä»¶å¤„ç†å‡½æ•° ã€‚<mark>äº‹ä»¶å¤„ç†å‡½æ•°</mark>æœ‰å¦‚ä¸‹ç‰¹ç‚¹:</p><ul><li>é€šå¸¸åœ¨ä½ çš„ç»„ä»¶ å†…éƒ¨ å®šä¹‰ã€‚</li><li>åç§°ä»¥ <code>handle</code> å¼€å¤´ï¼Œåè·Ÿäº‹ä»¶åç§°ã€‚</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y2f7jdlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y2f7jdlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ä½ ç‚¹å‡»äº†æˆ‘ï¼&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      ç‚¹æˆ‘</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ JSX ä¸­å®šä¹‰ä¸€ä¸ªå†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xpvzqolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xpvzqolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;button onClick=&#123;<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ä½ ç‚¹å‡»äº†æˆ‘ï¼&#x27;</span>);<br>&#125;&#125;&gt;<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…ï¼Œç›´æ¥ä½¿ç”¨æ›´ä¸ºç®€æ´ç®­å¤´å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7u8w79lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7u8w79lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;button onClick=&#123;<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ä½ ç‚¹å‡»äº†æˆ‘ï¼&#x27;</span>);<br>&#125;&#125;&gt;<br></code></pre></td></tr></table></div></figure><p>ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°çš„å‡½æ•°åº”ç›´æ¥ä¼ é€’ï¼Œè€Œéè°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p><table><thead><tr><th>ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼ˆæ­£ç¡®ï¼‰</th><th>è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆé”™è¯¯ï¼‰</th></tr></thead><tbody><tr><td><code>&lt;button onClick=&#123;handleClick&#125;&gt;</code></td><td><code>&lt;button onClick=&#123;handleClick()&#125;&gt;</code></td></tr></tbody></table><p>åŒºåˆ«å¾ˆå¾®å¦™ã€‚åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>handleClick</code> å‡½æ•°ä½œä¸º <code>onClick</code> äº‹ä»¶å¤„ç†å‡½æ•°ä¼ é€’ã€‚è¿™ä¼šè®© React è®°ä½å®ƒï¼Œå¹¶ä¸”åªåœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶è°ƒç”¨ä½ çš„å‡½æ•°ã€‚</p><p>åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>handleClick()</code> ä¸­æœ€åçš„ <code>()</code> ä¼šåœ¨ <a href="http://localhost:3000/learn/render-and-commit">æ¸²æŸ“</a> è¿‡ç¨‹ä¸­ ç«‹å³ è§¦å‘å‡½æ•°ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•ç‚¹å‡»ã€‚è¿™æ˜¯å› ä¸ºåœ¨ <a href="http://localhost:3000/learn/javascript-in-jsx-with-curly-braces">JSX <code>&#123;</code> å’Œ <code>&#125;</code></a> ä¹‹é—´çš„ JavaScript ä¼šç«‹å³æ‰§è¡Œã€‚</p><p>å½“ä½ ç¼–å†™å†…è”ä»£ç æ—¶ï¼ŒåŒæ ·çš„é™·é˜±å¯èƒ½ä¼šä»¥ä¸åŒçš„æ–¹å¼å‡ºç°ï¼š</p><table><thead><tr><th>ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼ˆæ­£ç¡®ï¼‰</th><th>è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆé”™è¯¯ï¼‰</th></tr></thead><tbody><tr><td><code>&lt;button onClick=&#123;() =&gt; alert(&#39;...&#39;)&#125;&gt;</code></td><td><code>&lt;button onClick=&#123;alert(&#39;...&#39;)&#125;&gt;</code></td></tr></tbody></table><p>å¦‚æœæŒ‰å¦‚ä¸‹æ–¹å¼ä¼ é€’å†…è”ä»£ç ï¼Œå¹¶ä¸ä¼šåœ¨ç‚¹å‡»æ—¶è§¦å‘ï¼Œè€Œæ˜¯ä¼šåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶è§¦å‘ï¼šè¿™ä¸ª alert åœ¨ç»„ä»¶æ¸²æŸ“æ—¶è§¦å‘ï¼Œè€Œä¸æ˜¯ç‚¹å‡»æ—¶è§¦å‘ï¼</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nwirjclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nwirjclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;alert(</span>&#x27;<span class="hljs-attr">ä½ ç‚¹å‡»äº†æˆ‘</span>ï¼&#x27;)&#125;&gt;</span><br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ æƒ³è¦å®šä¹‰å†…è”äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯·å°†å…¶åŒ…è£…åœ¨åŒ¿åå‡½æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f8vhallqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f8vhallqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;ä½ ç‚¹å‡»äº†æˆ‘ï¼&#x27;)&#125;&gt;<br></code></pre></td></tr></table></div></figure><p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç¨åè°ƒç”¨çš„å‡½æ•°ï¼Œè€Œä¸ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œå…¶å†…éƒ¨ä»£ç ã€‚</p><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½åº”è¯¥ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼š</p><ul><li><code>&lt;button onClick=&#123;handleClick&#125;&gt;</code> ä¼ é€’äº† <code>handleClick</code> å‡½æ•°ã€‚</li><li><code>&lt;button onClick=&#123;() =&gt; alert(&#39;...&#39;)&#125;&gt;</code> ä¼ é€’äº† <code>() =&gt; alert(&#39;...&#39;)</code> å‡½æ•°ã€‚</li></ul><p>ç”±äºäº‹ä»¶å¤„ç†å‡½æ•°å£°æ˜äºç»„ä»¶å†…éƒ¨ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç›´æ¥è®¿é—®ç»„ä»¶çš„ propsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ufkmnjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ufkmnjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">AlertButton</span>(<span class="hljs-params">&#123; message, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(message)&#125;&gt;</span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toolbar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AlertButton</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;æ­£åœ¨æ’­æ”¾ï¼&quot;</span>&gt;</span></span><br><span class="language-xml">        æ’­æ”¾ç”µå½±</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">AlertButton</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AlertButton</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;æ­£åœ¨ä¸Šä¼ ï¼&quot;</span>&gt;</span></span><br><span class="language-xml">        ä¸Šä¼ å›¾ç‰‡</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">AlertButton</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰å­ç»„ä»¶çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚æ¯”å¦‚ï¼šç½®äºä¸åŒä½ç½®çš„ <code>Button</code> ç»„ä»¶ï¼Œå¯èƒ½æœ€ç»ˆæ‰§è¡Œçš„åŠŸèƒ½ä¹Ÿä¸åŒã€‚</p><p>ä¸ºæ­¤ï¼Œå°†ç»„ä»¶ä»çˆ¶ç»„ä»¶æ¥æ”¶çš„ prop ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°ä¼ é€’ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tghq14lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tghq14lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; onClick, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PlayButton</span>(<span class="hljs-params">&#123; movieName &#125;</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlayClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">`æ­£åœ¨æ’­æ”¾ <span class="hljs-subst">$&#123;movieName&#125;</span>ï¼`</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handlePlayClick&#125;</span>&gt;</span></span><br><span class="language-xml">      æ’­æ”¾ &quot;&#123;movieName&#125;&quot;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UploadButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨ä¸Šä¼ ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">      ä¸Šä¼ å›¾ç‰‡</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toolbar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">PlayButton</span> <span class="hljs-attr">movieName</span>=<span class="hljs-string">&quot;é­”å¥³å®…æ€¥ä¾¿&quot;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">UploadButton</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>Toolbar</code> ç»„ä»¶æ¸²æŸ“äº†ä¸€ä¸ª <code>PlayButton</code> ç»„ä»¶å’Œ <code>UploadButton</code> ç»„ä»¶ï¼š</p><ul><li><code>PlayButton</code> å°† <code>handlePlayClick</code> ä½œä¸º <code>onClick</code> prop ä¼ å…¥ <code>Button</code> ç»„ä»¶å†…éƒ¨ã€‚</li><li><code>UploadButton</code> å°† <code>() =&gt; alert(&#39;æ­£åœ¨ä¸Šä¼ ï¼&#39;)</code> ä½œä¸º <code>onClick</code> prop ä¼ å…¥ <code>Button</code> ç»„ä»¶å†…éƒ¨ã€‚</li></ul><p>å†…ç½®ç»„ä»¶ï¼ˆ<code>&lt;button&gt;</code> å’Œ <code>&lt;div&gt;</code>ï¼‰ä»…æ”¯æŒ <a href="http://localhost:3000/reference/react-dom/components/common#common-props">æµè§ˆå™¨äº‹ä»¶åç§°</a>ï¼Œä¾‹å¦‚ <code>onClick</code>ã€‚ä½†æ˜¯ï¼Œå½“ä½ æ„å»ºè‡ªå·±çš„ç»„ä»¶æ—¶ï¼Œä½ å¯ä»¥æŒ‰ä½ ä¸ªäººå–œå¥½å‘½åäº‹ä»¶å¤„ç†å‡½æ•°çš„ propã€‚</p><p><mark>æŒ‰ç…§æƒ¯ä¾‹ï¼Œäº‹ä»¶å¤„ç†å‡½æ•° props åº”è¯¥ä»¥ <code>on</code> å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªå¤§å†™å­—æ¯ã€‚</mark></p><p>ä¾‹å¦‚ï¼Œ<code>Button</code> ç»„ä»¶çš„ <code>onClick</code> prop æœ¬æ¥ä¹Ÿå¯ä»¥è¢«å‘½åä¸º <code>onSmash</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6hmgq4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6hmgq4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; onSmash, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onSmash&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onSmash</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨æ’­æ”¾ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        æ’­æ”¾ç”µå½±</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onSmash</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨ä¸Šä¼ ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        ä¸Šä¼ å›¾ç‰‡</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>&lt;button onClick=&#123;onSmash&#125;&gt;</code> ä»£è¡¨æµè§ˆå™¨å†…ç½®çš„ <code>&lt;button&gt;</code>ï¼ˆå°å†™ï¼‰ä»ç„¶éœ€è¦ä½¿ç”¨ <code>onClick</code> propï¼Œè€Œè‡ªå®šä¹‰çš„ <code>Button</code> ç»„ä»¶æ¥æ”¶åˆ°çš„ prop åç§°å¯ç”±ä½ å†³å®šï¼</p><p><mark>ç¡®ä¿ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºä½¿ç”¨é€‚å½“çš„ HTML æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œè¦å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¯·ä½¿ç”¨ <code>&lt;div onClick=&#123;handleClick&#125;&gt;</code>ã€‚ä½¿ç”¨çœŸæ­£çš„æµè§ˆå™¨ <code>&lt;button&gt;</code> å¯ç”¨å†…ç½®çš„æµè§ˆå™¨è¡Œä¸ºï¼Œå¦‚é”®ç›˜å¯¼èˆªã€‚</mark></p><p>äº‹ä»¶å¤„ç†å‡½æ•°è¿˜å°†æ•è·ä»»ä½•æ¥è‡ªå­ç»„ä»¶çš„äº‹ä»¶ã€‚</p><p><mark>äº‹ä»¶ä¼ æ’­</mark>ï¼šäº‹ä»¶ä¼šæ²¿ç€æ ‘å‘ä¸Šâ€œå†’æ³¡â€æˆ–â€œä¼ æ’­â€ï¼šå®ƒä»äº‹ä»¶å‘ç”Ÿçš„åœ°æ–¹å¼€å§‹ï¼Œç„¶åæ²¿ç€æ ‘å‘ä¸Šä¼ æ’­ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xdiehwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xdiehwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toolbar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Toolbar&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      alert(&#x27;ä½ ç‚¹å‡»äº† toolbar ï¼&#x27;);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨æ’­æ”¾ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        æ’­æ”¾ç”µå½±</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨ä¸Šä¼ ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        ä¸Šä¼ å›¾ç‰‡</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="äº‹ä»¶ä¼ æ’­.gif" alt="äº‹ä»¶ä¼ æ’­" style="zoom:50%;" /><p>å¦‚æœä½ ç‚¹å‡»ä»»ä¸€æŒ‰é’®ï¼Œå®ƒè‡ªèº«çš„ <code>onClick</code> å°†é¦–å…ˆæ‰§è¡Œï¼Œç„¶åçˆ¶çº§ <code>&lt;div&gt;</code> çš„ <code>onClick</code> ä¼šæ¥ç€æ‰§è¡Œã€‚å› æ­¤ä¼šå‡ºç°ä¸¤æ¡æ¶ˆæ¯ã€‚å¦‚æœä½ ç‚¹å‡» toolbar æœ¬èº«ï¼Œå°†åªæœ‰çˆ¶çº§ <code>&lt;div&gt;</code> çš„ <code>onClick</code> ä¼šæ‰§è¡Œã€‚</p><p>åœ¨ React ä¸­æ‰€æœ‰äº‹ä»¶éƒ½ä¼šä¼ æ’­ï¼Œé™¤äº† <code>onScroll</code>ï¼Œå®ƒä»…é€‚ç”¨äºä½ é™„åŠ åˆ°çš„ JSX æ ‡ç­¾ã€‚</p><p><mark>é˜»æ­¢ä¼ æ’­</mark>ï¼šäº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸€ä¸ª äº‹ä»¶å¯¹è±¡ ä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå®ƒé€šå¸¸è¢«ç§°ä¸º <code>e</code> ï¼Œä»£è¡¨ â€œeventâ€ï¼ˆäº‹ä»¶ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡æ¥è¯»å–æœ‰å…³äº‹ä»¶çš„ä¿¡æ¯ã€‚</p><p>è¿™ä¸ªäº‹ä»¶å¯¹è±¡è¿˜å…è®¸ä½ é˜»æ­¢ä¼ æ’­ã€‚å¦‚æœä½ æƒ³é˜»æ­¢ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾çˆ¶ç»„ä»¶ï¼Œä½ éœ€è¦åƒä¸‹é¢ <code>Button</code> ç»„ä»¶é‚£æ ·è°ƒç”¨ <code>e.stopPropagation()</code> ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yio9aklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yio9aklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; onClick, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">      e.stopPropagation();</span><br><span class="language-xml">      onClick();</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toolbar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Toolbar&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      alert(&#x27;ä½ ç‚¹å‡»äº† toolbar ï¼&#x27;);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨æ’­æ”¾ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        æ’­æ”¾ç”µå½±</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ­£åœ¨ä¸Šä¼ ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">        ä¸Šä¼ å›¾ç‰‡</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶ï¼š</p><ol><li><p>React è°ƒç”¨äº†ä¼ é€’ç»™ <code>&lt;button&gt;</code> çš„ <code>onClick</code> å¤„ç†å‡½æ•°ã€‚</p></li><li><p>å®šä¹‰åœ¨Buttonä¸­çš„å¤„ç†å‡½æ•°æ‰§è¡Œäº†å¦‚ä¸‹æ“ä½œï¼š</p><ul><li>è°ƒç”¨ <code>e.stopPropagation()</code>ï¼Œé˜»æ­¢äº‹ä»¶è¿›ä¸€æ­¥å†’æ³¡ã€‚</li><li>è°ƒç”¨ <code>onClick</code> å‡½æ•°ï¼Œå®ƒæ˜¯ä» <code>Toolbar</code> ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ propã€‚</li></ul></li><li><p>åœ¨ <code>Toolbar</code> ç»„ä»¶ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œæ˜¾ç¤ºæŒ‰é’®å¯¹åº”çš„ alertã€‚</p></li><li><p>ç”±äºä¼ æ’­è¢«é˜»æ­¢ï¼Œçˆ¶çº§ <code>&lt;div&gt;</code> çš„ <code>onClick</code> å¤„ç†å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚</p></li></ol><p>ç”±äºè°ƒç”¨äº† <code>e.stopPropagation()</code>ï¼Œç‚¹å‡»æŒ‰é’®ç°åœ¨å°†åªæ˜¾ç¤ºä¸€ä¸ª alertï¼ˆæ¥è‡ª <code>&lt;button&gt;</code>ï¼‰ï¼Œè€Œå¹¶éä¸¤ä¸ªï¼ˆåˆ†åˆ«æ¥è‡ª <code>&lt;button&gt;</code> å’Œçˆ¶çº§ toolbar <code>&lt;div&gt;</code>ï¼‰ã€‚</p><hr><p><mark>æ•è·é˜¶æ®µäº‹ä»¶</mark>ï¼šæå°‘æ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ•è·å­å…ƒç´ ä¸Šçš„æ‰€æœ‰äº‹ä»¶ï¼Œå³ä¾¿å®ƒä»¬é˜»æ­¢äº†ä¼ æ’­ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³å¯¹æ¯æ¬¡ç‚¹å‡»è¿›è¡ŒåŸ‹ç‚¹è®°å½•ï¼Œä¼ æ’­é€»è¾‘æš‚ä¸”ä¸è®ºã€‚é‚£ä¹ˆä½ å¯ä»¥é€šè¿‡åœ¨äº‹ä»¶åç§°æœ«å°¾æ·»åŠ  <code>Capture</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fauga0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fauga0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClickCapture</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123; /* è¿™ä¼šé¦–å…ˆæ‰§è¡Œ */ &#125;&#125;&gt;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> e.stopPropagation()&#125; /&gt;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> e.stopPropagation()&#125; /&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>æ¯ä¸ªäº‹ä»¶åˆ†ä¸‰ä¸ªé˜¶æ®µä¼ æ’­ï¼š</p><ol><li>å®ƒå‘ä¸‹ä¼ æ’­ï¼Œè°ƒç”¨æ‰€æœ‰çš„ <code>onClickCapture</code> å¤„ç†å‡½æ•°ã€‚</li><li>å®ƒæ‰§è¡Œè¢«ç‚¹å‡»å…ƒç´ çš„ <code>onClick</code> å¤„ç†å‡½æ•°ã€‚</li><li>å®ƒå‘ä¸Šä¼ æ’­ï¼Œè°ƒç”¨æ‰€æœ‰çš„ <code>onClick</code> å¤„ç†å‡½æ•°ã€‚</li></ol><p>æ•è·äº‹ä»¶å¯¹äºè·¯ç”±æˆ–æ•°æ®åˆ†æä¹‹ç±»çš„ä»£ç å¾ˆæœ‰ç”¨ï¼Œä½†ä½ å¯èƒ½ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><hr><p><mark>ä¼ é€’å¤„ç†å‡½æ•°ä½œä¸ºäº‹ä»¶ä¼ æ’­çš„æ›¿ä»£æ–¹æ¡ˆ</mark>ï¼šæ³¨æ„ï¼Œæ­¤å¤„çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°å…ˆæ‰§è¡Œäº†ä¸€è¡Œä»£ç ï¼Œç„¶åè°ƒç”¨äº†çˆ¶ç»„ä»¶ä¼ é€’çš„ <code>onClick</code> propï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jv7v9slqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jv7v9slqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">&#123; onClick, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">      e.stopPropagation();</span><br><span class="language-xml">      onClick();</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨çˆ¶å…ƒç´  <code>onClick</code> å‡½æ•°ä¹‹å‰ï¼Œå‘è¿™ä¸ªå¤„ç†å‡½æ•°æ·»åŠ æ›´å¤šä»£ç ã€‚æ­¤æ¨¡å¼æ˜¯äº‹ä»¶ä¼ æ’­çš„å¦ä¸€ç§ æ›¿ä»£æ–¹æ¡ˆ ã€‚å®ƒè®©å­ç»„ä»¶å¤„ç†äº‹ä»¶ï¼ŒåŒæ—¶ä¹Ÿè®©çˆ¶ç»„ä»¶æŒ‡å®šä¸€äº›é¢å¤–çš„è¡Œä¸ºã€‚ä¸äº‹ä»¶ä¼ æ’­ä¸åŒï¼Œå®ƒå¹¶éè‡ªåŠ¨ã€‚ä½†ä½¿ç”¨è¿™ç§æ¨¡å¼çš„å¥½å¤„æ˜¯ä½ å¯ä»¥æ¸…æ¥šåœ°è¿½è¸ªå› æŸä¸ªäº‹ä»¶çš„è§¦å‘è€Œæ‰§è¡Œçš„æ•´æ¡ä»£ç é“¾ã€‚</p><p>å¦‚æœä½ ä¾èµ–äºäº‹ä»¶ä¼ æ’­ï¼Œè€Œä¸”å¾ˆéš¾è¿½è¸ªå“ªäº›å¤„ç†ç¨‹åºåœ¨æ‰§è¡Œï¼ŒåŠå…¶æ‰§è¡Œçš„åŸå› ï¼Œå¯ä»¥å°è¯•è¿™ç§æ–¹æ³•ã€‚</p><hr><p>æŸäº›æµè§ˆå™¨äº‹ä»¶å…·æœ‰ä¸äº‹ä»¶ç›¸å…³è”çš„é»˜è®¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œç‚¹å‡» <code>&lt;form&gt;</code> è¡¨å•å†…éƒ¨çš„æŒ‰é’®ä¼šè§¦å‘è¡¨å•æäº¤äº‹ä»¶ï¼Œ<mark>é»˜è®¤æƒ…å†µä¸‹å°†é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-setjbilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-setjbilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Signup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æäº¤è¡¨å•ï¼&#x27;)&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>å‘é€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="é»˜è®¤è¡Œä¸º.gif" alt="é»˜è®¤è¡Œä¸º" style="zoom:50%;" /><p>å¯ä»¥è°ƒç”¨äº‹ä»¶å¯¹è±¡ä¸­çš„ <code>e.preventDefault()</code> æ¥é˜»æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼šé¡µé¢ä¸ä¼šé‡æ–°åŠ è½½ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yx2puolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yx2puolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Signup</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">      e.preventDefault();</span><br><span class="language-xml">      alert(&#x27;æäº¤è¡¨å•ï¼&#x27;);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>å‘é€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åŒºåˆ«ï¼š</p><ul><li><a href="https://developer.mozilla.org/docs/Web/API/Event/stopPropagation"><code>e.stopPropagation()</code></a> é˜»æ­¢è§¦å‘ç»‘å®šåœ¨å¤–å±‚æ ‡ç­¾ä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</li><li><a href="https://developer.mozilla.org/docs/Web/API/Event/preventDefault"><code>e.preventDefault()</code></a> é˜»æ­¢å°‘æ•°äº‹ä»¶çš„é»˜è®¤æµè§ˆå™¨è¡Œä¸ºã€‚</li></ul><p>äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„æœ€ä½³ä½ç½®ã€‚</p><p>ä¸æ¸²æŸ“å‡½æ•°ä¸åŒï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦æ˜¯ <a href="http://localhost:3000/learn/keeping-components-pure">çº¯å‡½æ•°</a>ï¼Œå› æ­¤å®ƒæ˜¯ç”¨æ¥ <em>æ›´æ”¹</em> æŸäº›å€¼çš„ç»ä½³ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹è¾“å…¥æ¡†çš„å€¼ä»¥å“åº”é”®å…¥ï¼Œæˆ–è€…æ›´æ”¹åˆ—è¡¨ä»¥å“åº”æŒ‰é’®çš„è§¦å‘ã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ›´æ”¹æŸäº›ä¿¡æ¯ï¼Œä½ é¦–å…ˆéœ€è¦æŸç§æ–¹å¼å­˜å‚¨å®ƒã€‚åœ¨ React ä¸­ï¼Œè¿™æ˜¯é€šè¿‡ <a href="http://localhost:3000/learn/state-a-components-memory">stateï¼ˆç»„ä»¶çš„è®°å¿†ï¼‰</a> æ¥å®Œæˆçš„ã€‚</p><h2 id="2-Stateï¼šç»„ä»¶çš„è®°å¿†"><a href="#2-Stateï¼šç»„ä»¶çš„è®°å¿†" class="headerlink" title="2.Stateï¼šç»„ä»¶çš„è®°å¿†"></a>2.Stateï¼šç»„ä»¶çš„è®°å¿†</h2><p>å¯ä»¥ç”¨ <a href="http://localhost:3000/reference/react/useState"><code>useState</code></a> Hook ä¸ºç»„ä»¶æ·»åŠ çŠ¶æ€ã€‚<em>Hook</em> æ˜¯èƒ½è®©ä½ çš„ç»„ä»¶ä½¿ç”¨ React åŠŸèƒ½çš„ç‰¹æ®Šå‡½æ•°ï¼ˆçŠ¶æ€æ˜¯è¿™äº›åŠŸèƒ½ä¹‹ä¸€ï¼‰ï¼Œåªåœ¨ React <a href="http://localhost:3000/learn/render-and-commit#step-1-trigger-a-render">æ¸²æŸ“</a>æ—¶æœ‰æ•ˆã€‚å®ƒä»¬èƒ½è®©ä½  â€œhookâ€ åˆ°ä¸åŒçš„ React ç‰¹æ€§ä¸­å»ã€‚<code>useState</code> Hook è®©ä½ å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡ã€‚å®ƒæ¥æ”¶åˆå§‹çŠ¶æ€å¹¶è¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªè®©ä½ æ›´æ–°çŠ¶æ€çš„è®¾ç½®å‡½æ•°ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ey8x1glqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ey8x1glqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">const</span> [showMore, setShowMore] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></div></figure><p>Hooks â€”â€”ä»¥ <code>use</code> å¼€å¤´çš„å‡½æ•°â€”â€”åªèƒ½åœ¨ç»„ä»¶æˆ–<a href="http://localhost:3000/learn/reusing-logic-with-custom-hooks">è‡ªå®šä¹‰ Hook</a> çš„æœ€é¡¶å±‚è°ƒç”¨ã€‚ ä½ ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥æˆ–å…¶ä»–åµŒå¥—å‡½æ•°å†…è°ƒç”¨ Hookã€‚Hook æ˜¯å‡½æ•°ï¼Œä½†å°†å®ƒä»¬è§†ä¸ºå…³äºç»„ä»¶éœ€æ±‚çš„æ— æ¡ä»¶å£°æ˜ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚åœ¨ç»„ä»¶é¡¶éƒ¨ â€œuseâ€ React ç‰¹æ€§ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶é¡¶éƒ¨â€œå¯¼å…¥â€æ¨¡å—ã€‚</p><p>ç‚¹å‡» â€œNextâ€ æŒ‰é’®åº”è¯¥æ˜¾ç¤ºä¸‹ä¸€ä¸ªé›•å¡‘å¹¶å°† <code>index</code> æ›´æ”¹ä¸º <code>1</code>ï¼Œå†æ¬¡ç‚¹å‡»åˆæ›´æ”¹ä¸º <code>2</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½†è¿™ä¸ªç»„ä»¶ç°åœ¨ä¸èµ·ä½œç”¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-c1puj7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-c1puj7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; sculptureList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./data.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    index = index + <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> sculpture = sculptureList[index];<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        Next</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> </span><br><span class="language-xml">        by &#123;sculpture.artist&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>  </span><br><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;sculpture.url&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;sculpture.alt&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        &#123;sculpture.description&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>handleClick()</code> äº‹ä»¶å¤„ç†å‡½æ•°æ­£åœ¨æ›´æ–°å±€éƒ¨å˜é‡ <code>index</code>ã€‚ä½†å­˜åœ¨ä¸¤ä¸ªåŸå› ä½¿å¾—å˜åŒ–ä¸å¯è§ï¼š</p><ol><li>å±€éƒ¨å˜é‡æ— æ³•åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æŒä¹…ä¿å­˜ã€‚ å½“ React å†æ¬¡æ¸²æŸ“è¿™ä¸ªç»„ä»¶æ—¶ï¼Œå®ƒä¼šä»å¤´å¼€å§‹æ¸²æŸ“â€”â€”ä¸ä¼šè€ƒè™‘ä¹‹å‰å¯¹å±€éƒ¨å˜é‡çš„ä»»ä½•æ›´æ”¹ã€‚</li><li>æ›´æ”¹å±€éƒ¨å˜é‡ä¸ä¼šè§¦å‘æ¸²æŸ“ã€‚ React æ²¡æœ‰æ„è¯†åˆ°å®ƒéœ€è¦ä½¿ç”¨æ–°æ•°æ®å†æ¬¡æ¸²æŸ“ç»„ä»¶ã€‚</li></ol><p>è¦ä½¿ç”¨æ–°æ•°æ®æ›´æ–°ç»„ä»¶ï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ol><li>ä¿ç•™ æ¸²æŸ“ä¹‹é—´çš„æ•°æ®ã€‚</li><li>è§¦å‘ React ä½¿ç”¨æ–°æ•°æ®æ¸²æŸ“ç»„ä»¶ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰ã€‚</li></ol><p><a href="http://localhost:3000/reference/react/useState"><code>useState</code></a> Hook æä¾›äº†è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ol><li>State å˜é‡ ç”¨äºä¿å­˜æ¸²æŸ“é—´çš„æ•°æ®ã€‚</li><li>State setter å‡½æ•° æ›´æ–°å˜é‡å¹¶è§¦å‘ React å†æ¬¡æ¸²æŸ“ç»„ä»¶ã€‚</li></ol><p>è¦æ·»åŠ  state å˜é‡ï¼Œå…ˆä»æ–‡ä»¶é¡¶éƒ¨çš„ React ä¸­å¯¼å…¥ <code>useState</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9ggw65lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9ggw65lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼Œæ›¿æ¢è¿™ä¸€è¡Œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q9aaaalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q9aaaalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></div></figure><p>å°†å…¶ä¿®æ”¹ä¸º</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-br3ylslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-br3ylslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p><code>index</code> æ˜¯ä¸€ä¸ª state å˜é‡ï¼Œ<code>setIndex</code> æ˜¯å¯¹åº”çš„ setter å‡½æ•°ã€‚</p><p>è¿™é‡Œçš„ <code>[</code> å’Œ <code>]</code> è¯­æ³•ç§°ä¸º<a href="http://localhost:3000/learn/a-javascript-refresher#array-destructuring">æ•°ç»„è§£æ„</a>ï¼Œå®ƒå…è®¸ä½ ä»æ•°ç»„ä¸­è¯»å–å€¼ã€‚ <code>useState</code> è¿”å›çš„æ•°ç»„æ€»æ˜¯æ­£å¥½æœ‰ä¸¤é¡¹ã€‚</p><p>ä»¥ä¸‹å±•ç¤ºäº†å®ƒä»¬åœ¨ <code>handleClick()</code> ä¸­æ˜¯å¦‚ä½•å…±åŒèµ·ä½œç”¨çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7cm9dflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7cm9dflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">setIndex</span>(index + <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ç‚¹å‡» â€œNextâ€ æŒ‰é’®åˆ‡æ¢å½“å‰é›•å¡‘ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hxxmedlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hxxmedlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; sculptureList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./data.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIndex</span>(index + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> sculpture = sculptureList[index];<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        Next</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> </span><br><span class="language-xml">        by &#123;sculpture.artist&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>  </span><br><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;sculpture.url&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;sculpture.alt&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        &#123;sculpture.description&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>useState</code> çš„å”¯ä¸€å‚æ•°æ˜¯ state å˜é‡çš„åˆå§‹å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>index</code> çš„åˆå§‹å€¼è¢«<code>useState(0)</code>è®¾ç½®ä¸º <code>0</code>ã€‚</p><p>æ¯æ¬¡ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œ<code>useState</code> éƒ½ä¼šç»™ä½ ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼š</p><ol><li>state å˜é‡ (<code>index</code>) ä¼šä¿å­˜ä¸Šæ¬¡æ¸²æŸ“çš„å€¼ã€‚</li><li>state setter å‡½æ•° (<code>setIndex</code>) å¯ä»¥æ›´æ–° state å˜é‡å¹¶è§¦å‘ React é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯å®é™…å‘ç”Ÿçš„æƒ…å†µï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-k6cvholqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-k6cvholqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><ol><li>ç»„ä»¶è¿›è¡Œç¬¬ä¸€æ¬¡æ¸²æŸ“ã€‚ å› ä¸ºä½ å°† <code>0</code> ä½œä¸º <code>index</code> çš„åˆå§‹å€¼ä¼ é€’ç»™ <code>useState</code>ï¼Œå®ƒå°†è¿”å› <code>[0, setIndex]</code>ã€‚ React è®°ä½ <code>0</code> æ˜¯æœ€æ–°çš„ state å€¼ã€‚</li><li>ä½ æ›´æ–°äº† stateã€‚å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ <code>setIndex(index + 1)</code>ã€‚ <code>index</code> æ˜¯ <code>0</code>ï¼Œæ‰€ä»¥å®ƒæ˜¯ <code>setIndex(1)</code>ã€‚è¿™å‘Šè¯‰ React ç°åœ¨è®°ä½ <code>index</code> æ˜¯ <code>1</code> å¹¶è§¦å‘ä¸‹ä¸€æ¬¡æ¸²æŸ“ã€‚</li><li>ç»„ä»¶è¿›è¡Œç¬¬äºŒæ¬¡æ¸²æŸ“ã€‚React ä»ç„¶çœ‹åˆ° <code>useState(0)</code>ï¼Œä½†æ˜¯å› ä¸º React <em>è®°ä½</em> äº†ä½ å°† <code>index</code> è®¾ç½®ä¸ºäº† <code>1</code>ï¼Œå®ƒå°†è¿”å› <code>[1, setIndex]</code>ã€‚</li><li>ä»¥æ­¤ç±»æ¨ï¼</li></ol><p><mark>èµ‹äºˆä¸€ä¸ªç»„ä»¶å¤šä¸ª state å˜é‡</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vmunpclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vmunpclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; sculptureList &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./data.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [showMore, setShowMore] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNextClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIndex</span>(index + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMoreClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setShowMore</span>(!showMore);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> sculpture = sculptureList[index];<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleNextClick&#125;</span>&gt;</span></span><br><span class="language-xml">        Next</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;sculpture.name&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> </span><br><span class="language-xml">        by &#123;sculpture.artist&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>  </span><br><span class="language-xml">        (&#123;index + 1&#125; of &#123;sculptureList.length&#125;)</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleMoreClick&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;showMore ? &#x27;Hide&#x27; : &#x27;Show&#x27;&#125; details</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;showMore &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;sculpture.description&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;sculpture.url&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;sculpture.alt&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœå®ƒä»¬ä¸ç›¸å…³ï¼Œé‚£ä¹ˆå­˜åœ¨å¤šä¸ª state å˜é‡æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ <code>index</code> å’Œ <code>showMore</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å‘ç°ç»å¸¸åŒæ—¶æ›´æ”¹ä¸¤ä¸ª state å˜é‡ï¼Œé‚£ä¹ˆæœ€å¥½å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåŒ…å«å¤šä¸ªå­—æ®µçš„è¡¨å•ï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªå€¼ä¸ºå¯¹è±¡çš„ state å˜é‡æ¯”æ¯ä¸ªå­—æ®µå¯¹åº”ä¸€ä¸ª state å˜é‡æ›´æ–¹ä¾¿ã€‚ <a href="http://localhost:3000/learn/choosing-the-state-structure">é€‰æ‹© state ç»“æ„</a>åœ¨è¿™æ–¹é¢æœ‰æ›´å¤šæç¤ºã€‚</p><p><code>useState</code> åœ¨è°ƒç”¨æ—¶æ²¡æœ‰ä»»ä½•å…³äºå®ƒå¼•ç”¨çš„æ˜¯<em>å“ªä¸ª</em> state å˜é‡çš„ä¿¡æ¯ã€‚æ²¡æœ‰ä¼ é€’ç»™ <code>useState</code> çš„â€œæ ‡è¯†ç¬¦â€ï¼Œå®ƒæ˜¯å¦‚ä½•çŸ¥é“è¦è¿”å›å“ªä¸ª state å˜é‡å‘¢ï¼Ÿå®ƒæ˜¯å¦ä¾èµ–äºè§£æå‡½æ•°ä¹‹ç±»çš„é­”æ³•ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p><p>ç›¸åï¼Œä¸ºäº†ä½¿è¯­æ³•æ›´ç®€æ´ï¼Œåœ¨åŒä¸€ç»„ä»¶çš„æ¯æ¬¡æ¸²æŸ“ä¸­ï¼ŒHooks éƒ½ä¾æ‰˜äºä¸€ä¸ªç¨³å®šçš„è°ƒç”¨é¡ºåºã€‚è¿™åœ¨å®è·µä¸­å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºå¦‚æœä½ éµå¾ªä¸Šé¢çš„è§„åˆ™ï¼ˆâ€œåªåœ¨é¡¶å±‚è°ƒç”¨ Hooksâ€ï¼‰ï¼ŒHooks å°†å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºè¢«è°ƒç”¨ã€‚æ­¤å¤–ï¼Œ<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter æ’ä»¶</a>ä¹Ÿå¯ä»¥æ•è·å¤§å¤šæ•°é”™è¯¯ã€‚</p><p>åœ¨ React å†…éƒ¨ï¼Œä¸ºæ¯ä¸ªç»„ä»¶ä¿å­˜äº†ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª state å¯¹ã€‚å®ƒç»´æŠ¤å½“å‰ state å¯¹çš„ç´¢å¼•å€¼ï¼Œåœ¨æ¸²æŸ“ä¹‹å‰å°†å…¶è®¾ç½®ä¸º â€œ0â€ã€‚æ¯æ¬¡è°ƒç”¨ useState æ—¶ï¼ŒReact éƒ½ä¼šä¸ºä½ æä¾›ä¸€ä¸ª state å¯¹å¹¶å¢åŠ ç´¢å¼•å€¼ã€‚</p><hr><p><mark>State æ˜¯éš”ç¦»ä¸”ç§æœ‰çš„</mark>ï¼šState æ˜¯å±å¹•ä¸Šç»„ä»¶å®ä¾‹å†…éƒ¨çš„çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶ä¸¤æ¬¡ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½ä¼šæœ‰å®Œå…¨éš”ç¦»çš„ stateï¼æ”¹å˜å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚</p><p>state ä¸å£°æ˜åœ¨æ¨¡å—é¡¶éƒ¨çš„æ™®é€šå˜é‡çš„åŒºåˆ«ï¼š State ä¸ä¾èµ–äºç‰¹å®šçš„å‡½æ•°è°ƒç”¨æˆ–åœ¨ä»£ç ä¸­çš„ä½ç½®ï¼Œå®ƒçš„ä½œç”¨åŸŸâ€œåªé™äºâ€å±å¹•ä¸Šçš„æŸå—ç‰¹å®šåŒºåŸŸã€‚</p><p><code>Page</code> ç»„ä»¶â€œä¸çŸ¥é“â€å…³äº <code>Gallery</code> state çš„ä»»ä½•ä¿¡æ¯ï¼Œç”šè‡³ä¸çŸ¥é“å®ƒæ˜¯å¦æœ‰ä»»ä½• stateã€‚ä¸ props ä¸åŒï¼Œ&#x3D;&#x3D;state å®Œå…¨ç§æœ‰äºå£°æ˜å®ƒçš„ç»„ä»¶&#x3D;&#x3D;ã€‚çˆ¶ç»„ä»¶æ— æ³•æ›´æ”¹å®ƒã€‚è¿™ä½¿ä½ å¯ä»¥å‘ä»»ä½•ç»„ä»¶æ·»åŠ æˆ–åˆ é™¤ stateï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶ã€‚</p><p>å¦‚æœä½ å¸Œæœ›ä¸¤ä¸ªç”»å»Šä¿æŒå…¶ states åŒæ­¥æ€ä¹ˆåŠï¼Ÿåœ¨ React ä¸­æ‰§è¡Œæ­¤æ“ä½œçš„æ­£ç¡®æ–¹æ³•æ˜¯ä»å­ç»„ä»¶ä¸­<em>åˆ é™¤</em> state å¹¶å°†å…¶æ·»åŠ åˆ°ç¦»å®ƒä»¬æœ€è¿‘çš„å…±äº«çˆ¶ç»„ä»¶ä¸­ã€‚</p><h2 id="3-æ¸²æŸ“å’Œæäº¤"><a href="#3-æ¸²æŸ“å’Œæäº¤" class="headerlink" title="3.æ¸²æŸ“å’Œæäº¤"></a>3.æ¸²æŸ“å’Œæäº¤</h2><p>ç»„ä»¶æ˜¾ç¤ºåˆ°å±å¹•ä¹‹å‰ï¼Œå…¶å¿…é¡»è¢« React æ¸²æŸ“ã€‚</p><p>åœ¨ä¸€ä¸ª React åº”ç”¨ä¸­ä¸€æ¬¡å±å¹•æ›´æ–°éƒ½ä¼šå‘ç”Ÿä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼šè§¦å‘+æ¸²æŸ“+æäº¤</p><ol><li><p><mark>è§¦å‘ä¸€æ¬¡æ¸²æŸ“</mark></p><ul><li><p>æœ‰ä¸¤ç§åŸå› ä¼šå¯¼è‡´ç»„ä»¶çš„æ¸²æŸ“:</p><ol><li><p>ç»„ä»¶çš„ åˆæ¬¡æ¸²æŸ“ï¼šå½“åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šè§¦å‘åˆæ¬¡æ¸²æŸ“ã€‚æ¡†æ¶å’Œæ²™ç®±æœ‰æ—¶ä¼šéšè—è¿™éƒ¨åˆ†ä»£ç ï¼Œä½†å®ƒæ˜¯é€šè¿‡è°ƒç”¨ç›®æ ‡ DOM èŠ‚ç‚¹çš„ <a href="http://localhost:3000/reference/react-dom/client/createRoot"><code>createRoot</code></a>ï¼Œç„¶åç”¨ä½ çš„ç»„ä»¶è°ƒç”¨ <code>render</code> å‡½æ•°å®Œæˆçš„ï¼š</p><p>index.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vrp12zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vrp12zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;.image.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRoot &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/client&#x27;</span>;<br><br><span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>))<br>root.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Image</span> /&gt;</span></span>);<br></code></pre></td></tr></table></div></figure><p>Image.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-prb80qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-prb80qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Image</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/ZF6s192.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&#x27;Floralis GenÃ©rica&#x27; by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åˆ é™¤<code>root.render()</code>åï¼Œä½ å°†ä¼šçœ‹åˆ°ç»„ä»¶æ¶ˆå¤±ã€‚</p></li><li><p>ç»„ä»¶ï¼ˆæˆ–è€…å…¶ç¥–å…ˆä¹‹ä¸€ï¼‰çš„ çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼šä¸€æ—¦ç»„ä»¶è¢«åˆæ¬¡æ¸²æŸ“ï¼Œä½ å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ <a href="http://localhost:3000/reference/react/useState#setstate"><code>set</code> å‡½æ•°</a> æ›´æ–°å…¶çŠ¶æ€æ¥è§¦å‘ä¹‹åçš„æ¸²æŸ“ã€‚æ›´æ–°ç»„ä»¶çš„çŠ¶æ€ä¼šè‡ªåŠ¨å°†ä¸€æ¬¡æ¸²æŸ“é€å…¥é˜Ÿåˆ—ã€‚</p></li></ol></li></ul></li><li><p><mark>React æ¸²æŸ“ä½ çš„ç»„ä»¶</mark>ï¼šåœ¨ä½ è§¦å‘æ¸²æŸ“åï¼ŒReact ä¼šè°ƒç”¨ä½ çš„ç»„ä»¶æ¥ç¡®å®šè¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å†…å®¹ã€‚â€œæ¸²æŸ“ä¸­â€ å³ React åœ¨è°ƒç”¨ä½ çš„ç»„ä»¶ã€‚</p><ul><li>åœ¨è¿›è¡Œåˆæ¬¡æ¸²æŸ“æ—¶, React ä¼šè°ƒç”¨æ ¹ç»„ä»¶ã€‚</li><li>å¯¹äºåç»­çš„æ¸²æŸ“, React ä¼šè°ƒç”¨å†…éƒ¨çŠ¶æ€æ›´æ–°è§¦å‘äº†æ¸²æŸ“çš„å‡½æ•°ç»„ä»¶ã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯é€’å½’çš„ï¼šå¦‚æœæ›´æ–°åçš„ç»„ä»¶ä¼šè¿”å›æŸä¸ªå¦å¤–çš„ç»„ä»¶ï¼Œé‚£ä¹ˆ React æ¥ä¸‹æ¥å°±ä¼šæ¸²æŸ“ <em>é‚£ä¸ª</em> ç»„ä»¶ï¼Œè€Œå¦‚æœé‚£ä¸ªç»„ä»¶åˆè¿”å›äº†æŸä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆ React æ¥ä¸‹æ¥å°±ä¼šæ¸²æŸ“ é‚£ä¸ª ç»„ä»¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæŒç»­ä¸‹å»ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„åµŒå¥—ç»„ä»¶å¹¶ä¸” React ç¡®åˆ‡çŸ¥é“å“ªäº›ä¸œè¥¿åº”è¯¥æ˜¾ç¤ºåˆ°å±å¹•ä¸Šä¸ºæ­¢ã€‚</p><p>index.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-i46j2ulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-i46j2ulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Gallery</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Gallery.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createRoot &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/client&#x27;</span>;<br><br><span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>))<br>root.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Gallery</span> /&gt;</span></span>);<br></code></pre></td></tr></table></div></figure><p>Gallery.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dvrnlblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dvrnlblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Gallery</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>é¼“èˆäººå¿ƒçš„é›•å¡‘<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Image</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://i.imgur.com/ZF6s192.jpg&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&#x27;Floralis GenÃ©rica&#x27; by Eduardo Catalano: a gigantic metallic flower sculpture with reflective petals&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><ul><li>åœ¨åˆæ¬¡æ¸²æŸ“ä¸­ï¼Œ React å°†ä¼šä¸º<code>&lt;section&gt;</code>ã€<code>&lt;h1&gt;</code> å’Œä¸‰ä¸ª <code>&lt;img&gt;</code> æ ‡ç­¾ <a href="https://developer.mozilla.org/docs/Web/API/Document/createElement">åˆ›å»º DOM èŠ‚ç‚¹</a>ã€‚</li><li>åœ¨ä¸€æ¬¡é‡æ¸²æŸ“è¿‡ç¨‹ä¸­, React å°†è®¡ç®—å®ƒä»¬çš„å“ªäº›å±æ€§ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰è‡ªä¸Šæ¬¡æ¸²æŸ“ä»¥æ¥å·²æ›´æ”¹ã€‚åœ¨ä¸‹ä¸€æ­¥ï¼ˆæäº¤é˜¶æ®µï¼‰ä¹‹å‰ï¼Œå®ƒä¸ä¼šå¯¹è¿™äº›ä¿¡æ¯æ‰§è¡Œä»»ä½•æ“ä½œã€‚</li></ul><p>æ¸²æŸ“å¿…é¡»å§‹ç»ˆæ˜¯ä¸€æ¬¡ <a href="http://localhost:3000/learn/keeping-components-pure">çº¯è®¡ç®—</a>:</p><ul><li>è¾“å…¥ç›¸åŒï¼Œè¾“å‡ºç›¸åŒã€‚ ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œç»„ä»¶åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„ JSXã€‚ï¼ˆå½“æœ‰äººç‚¹äº†è¥¿çº¢æŸ¿æ²™æ‹‰æ—¶ï¼Œä»–ä»¬ä¸åº”è¯¥æ”¶åˆ°æ´‹è‘±æ²™æ‹‰ï¼ï¼‰</li><li>åªåšå®ƒè‡ªå·±çš„äº‹æƒ…ã€‚ å®ƒä¸åº”æ›´æ”¹ä»»ä½•å­˜åœ¨äºæ¸²æŸ“ä¹‹å‰çš„å¯¹è±¡æˆ–å˜é‡ã€‚ï¼ˆä¸€ä¸ªè®¢å•ä¸åº”æ›´æ”¹å…¶ä»–ä»»ä½•äººçš„è®¢å•ã€‚ï¼‰</li></ul><p>å¦åˆ™ï¼Œéšç€ä»£ç åº“å¤æ‚æ€§çš„å¢åŠ ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä»¤äººå›°æƒ‘çš„é”™è¯¯å’Œä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚<mark>åœ¨ â€œä¸¥æ ¼æ¨¡å¼â€ ä¸‹å¼€å‘æ—¶ï¼ŒReact ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶çš„å‡½æ•°ä¸¤æ¬¡ï¼Œè¿™å¯ä»¥å¸®åŠ©å‘ç°ç”±ä¸çº¯å‡½æ•°å¼•èµ·çš„é”™è¯¯ã€‚</mark></p></li><li><p><mark>React æŠŠæ›´æ”¹æäº¤åˆ° DOM ä¸Š</mark>ï¼šåœ¨æ¸²æŸ“ï¼ˆè°ƒç”¨ï¼‰ä½ çš„ç»„ä»¶ä¹‹åï¼ŒReact å°†ä¼šä¿®æ”¹ DOMã€‚</p><ul><li>å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼Œ React ä¼šä½¿ç”¨ <a href="https://developer.mozilla.org/docs/Web/API/Node/appendChild"><code>appendChild()</code></a> DOM API å°†å…¶åˆ›å»ºçš„æ‰€æœ‰ DOM èŠ‚ç‚¹æ”¾åœ¨å±å¹•ä¸Šã€‚</li><li>å¯¹äºé‡æ¸²æŸ“ï¼Œ React å°†åº”ç”¨æœ€å°‘çš„å¿…è¦æ“ä½œï¼ˆåœ¨æ¸²æŸ“æ—¶è®¡ç®—ï¼ï¼‰ï¼Œä»¥ä½¿å¾— DOM ä¸æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºç›¸äº’åŒ¹é…ã€‚</li></ul><p>React ä»…åœ¨æ¸²æŸ“ä¹‹é—´å­˜åœ¨å·®å¼‚æ—¶æ‰ä¼šæ›´æ”¹ DOM èŠ‚ç‚¹ã€‚ </p><p>ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæ¯ç§’ä½¿ç”¨ä»çˆ¶ç»„ä»¶ä¼ é€’ä¸‹æ¥çš„ä¸åŒå±æ€§é‡æ–°æ¸²æŸ“ä¸€æ¬¡ã€‚æ³¨æ„ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€äº›æ–‡æœ¬åˆ° <code>&lt;input&gt;</code> æ ‡ç­¾ï¼Œæ›´æ–°å®ƒçš„ <code>value</code>ï¼Œä½†æ˜¯æ–‡æœ¬ä¸ä¼šåœ¨ç»„ä»¶é‡æ¸²æŸ“æ—¶æ¶ˆå¤±ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qhqiz7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qhqiz7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Clock</span>(<span class="hljs-params">&#123; time &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;time&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="Clock.gif" alt="Clock" style="zoom:50%;" /><p>ä¹‹æ‰€ä»¥ä¼šæ­£å¸¸è¿è¡Œï¼Œæ˜¯å› ä¸ºåœ¨æœ€åä¸€æ­¥ä¸­ï¼ŒReact åªä¼šä½¿ç”¨æœ€æ–°çš„ <code>time</code> æ›´æ–° <code>&lt;h1&gt;</code> æ ‡ç­¾çš„å†…å®¹ã€‚å®ƒçœ‹åˆ° <code>&lt;input&gt;</code> æ ‡ç­¾å‡ºç°åœ¨ JSX ä¸­ä¸ä¸Šæ¬¡ç›¸åŒçš„ä½ç½®ï¼Œå› æ­¤ React ä¸ä¼šä¿®æ”¹ <code>&lt;input&gt;</code> æ ‡ç­¾æˆ–å®ƒçš„ <code>value</code>ï¼</p></li></ol><p>åœ¨æ¸²æŸ“å®Œæˆå¹¶ä¸” React æ›´æ–° DOM ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°ç»˜åˆ¶å±å¹•ã€‚å°½ç®¡è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œæµè§ˆå™¨æ¸²æŸ“â€ï¼ˆbrowser renderingï¼‰ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å°†å®ƒç§°ä¸ºâ€œç»˜åˆ¶â€ï¼ˆpaintingï¼‰ï¼Œä»¥é¿å…åœ¨è¿™äº›æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ä¸­å‡ºç°æ··æ·†ã€‚</p><h2 id="4-stateå¦‚åŒä¸€å¼ å¿«ç…§"><a href="#4-stateå¦‚åŒä¸€å¼ å¿«ç…§" class="headerlink" title="4.stateå¦‚åŒä¸€å¼ å¿«ç…§"></a>4.stateå¦‚åŒä¸€å¼ å¿«ç…§</h2><p><mark>è®¾ç½® state ä¼šè§¦å‘æ¸²æŸ“</mark>ï¼šè¦ä½¿ç•Œé¢å¯¹è¾“å…¥åšå‡ºååº”ï¼Œä½ éœ€è¦è®¾ç½®å…¶ stateã€‚</p><p>å½“ React é‡æ–°æ¸²æŸ“ä¸€ä¸ªç»„ä»¶æ—¶ï¼š</p><ol><li>React ä¼šå†æ¬¡è°ƒç”¨ä½ çš„å‡½æ•°</li><li>å‡½æ•°ä¼šè¿”å›æ–°çš„ JSX å¿«ç…§</li><li>React ä¼šæ›´æ–°ç•Œé¢ä»¥åŒ¹é…è¿”å›çš„å¿«ç…§</li></ol><p>å½“ React è°ƒç”¨ä½ çš„ç»„ä»¶æ—¶ï¼Œå®ƒä¼šä¸ºç‰¹å®šçš„é‚£ä¸€æ¬¡æ¸²æŸ“æä¾›ä¸€å¼  state å¿«ç…§ã€‚ä½ çš„ç»„ä»¶ä¼šåœ¨å…¶ JSX ä¸­è¿”å›ä¸€å¼ åŒ…å«ä¸€æ•´å¥—æ–°çš„ props å’Œäº‹ä»¶å¤„ç†å‡½æ•°çš„ UI å¿«ç…§ ï¼Œå…¶ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯ æ ¹æ®é‚£ä¸€æ¬¡æ¸²æŸ“ä¸­ state çš„å€¼ è¢«è®¡ç®—å‡ºæ¥çš„ï¼</p><p>ä½ å¯èƒ½ä¼šä»¥ä¸ºç‚¹å‡»â€œ+3â€æŒ‰é’®ä¼šè°ƒç”¨ <code>setNumber(number + 1)</code> ä¸‰æ¬¡ä»è€Œä½¿è®¡æ•°å™¨é€’å¢ä¸‰æ¬¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-lz461qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-lz461qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [number, setNumber] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;number&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setNumber(number + 1);</span><br><span class="language-xml">        setNumber(number + 1);</span><br><span class="language-xml">        setNumber(number + 1);</span><br><span class="language-xml">      &#125;&#125;&gt;+3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><p><mark>æ¯æ¬¡ç‚¹å‡»åªä¼šè®© <code>number</code> é€’å¢ä¸€æ¬¡ï¼</mark></p><p>è®¾ç½® state åªä¼šä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“å˜æ›´ state çš„å€¼ã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼Œ<code>number</code> ä¸º <code>0</code>ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ é‚£æ¬¡æ¸²æŸ“ä¸­çš„ <code>onClick</code> å¤„ç†å‡½æ•°ä¸­ï¼Œå³ä¾¿åœ¨è°ƒç”¨äº† <code>setNumber(number + 1)</code> ä¹‹åï¼Œ<code>number</code> çš„å€¼ä¹Ÿä»ç„¶æ˜¯ <code>0</code>ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d5t19vlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d5t19vlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;<br>  setNumber(number + 1);<br>  setNumber(number + 1);<br>  setNumber(number + 1);<br>&#125;&#125;&gt;+3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>ä»¥ä¸‹æ˜¯è¿™ä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°é€šçŸ¥ React è¦åšçš„äº‹æƒ…ï¼š</p><ol><li><p><code>setNumber(number + 1)</code>ï¼š</p><p><code>number</code>æ˜¯0æ‰€ä»¥<code>setNumber(0 + 1)</code>ã€‚</p><ul><li>React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† <code>number</code> æ›´æ”¹ä¸º <code>1</code>ã€‚</li></ul></li><li><p><code>setNumber(number + 1)</code>ï¼š</p><p><code>number</code>æ˜¯0æ‰€ä»¥<code>setNumber(0 + 1)</code>ã€‚</p><ul><li>React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† <code>number</code> æ›´æ”¹ä¸º <code>1</code>ã€‚</li></ul></li><li><p><code>setNumber(number + 1)</code>ï¼š</p><p><code>number</code>æ˜¯0æ‰€ä»¥<code>setNumber(0 + 1)</code>ã€‚</p><ul><li>React å‡†å¤‡åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶å°† <code>number</code> æ›´æ”¹ä¸º <code>1</code>ã€‚</li></ul></li></ol><p>å°½ç®¡ä½ è°ƒç”¨äº†ä¸‰æ¬¡ <code>setNumber(number + 1)</code>ï¼Œä½†åœ¨ è¿™æ¬¡æ¸²æŸ“çš„ äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ <code>number</code> ä¼šä¸€ç›´æ˜¯ <code>0</code>ï¼Œæ‰€ä»¥ä½ ä¼šä¸‰æ¬¡å°† state è®¾ç½®æˆ <code>1</code>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œä»¥åï¼ŒReact é‡æ–°æ¸²æŸ“çš„ç»„ä»¶ä¸­çš„ <code>number</code> ç­‰äº <code>1</code> è€Œä¸æ˜¯ <code>3</code>ã€‚</p><p>ä½ è¿˜å¯ä»¥é€šè¿‡åœ¨å¿ƒé‡ŒæŠŠ state å˜é‡æ›¿æ¢æˆå®ƒä»¬åœ¨ä½ ä»£ç ä¸­çš„å€¼æ¥æƒ³è±¡è¿™ä¸ªè¿‡ç¨‹ã€‚ç”±äº è¿™æ¬¡æ¸²æŸ“ ä¸­çš„ state å˜é‡ <code>number</code> æ˜¯ <code>0</code>ï¼Œå…¶äº‹ä»¶å¤„ç†å‡½æ•°çœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hemrb7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hemrb7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;<br>  setNumber(0 + 1);<br>  setNumber(0 + 1);<br>  setNumber(0 + 1);<br>&#125;&#125;&gt;+3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>å¯¹äºä¸‹ä¸€æ¬¡æ¸²æŸ“æ¥è¯´ï¼Œ<code>number</code> æ˜¯ <code>1</code>ï¼Œå› æ­¤ é‚£æ¬¡æ¸²æŸ“ä¸­çš„ ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°çœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cta3kblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cta3kblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;<br>  setNumber(1 + 1);<br>  setNumber(1 + 1);<br>  setNumber(1 + 1);<br>&#125;&#125;&gt;+3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå†æ¬¡ç‚¹å‡»æŒ‰é’®ä¼šå°†è®¡æ•°å™¨è®¾ç½®ä¸º <code>2</code>ï¼Œä¸‹æ¬¡ç‚¹å‡»æ—¶ä¼šè®¾ä¸º <code>3</code>ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><hr><p>ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä¼šå‘å‡ºä»€ä¹ˆè­¦å‘Šï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ew1ceclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ew1ceclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [number, setNumber] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;number&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setNumber(number + 5);</span><br><span class="language-xml">        alert(number);</span><br><span class="language-xml">      &#125;&#125;&gt;+5<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="button.gif" alt="button" style="zoom:50%;" /><p>å¦‚æœä½ ä½¿ç”¨ä¹‹å‰æ›¿æ¢çš„æ–¹æ³•ï¼Œä½ å°±èƒ½çŒœåˆ°è¿™ä¸ªæç¤ºæ¡†å°†ä¼šæ˜¾ç¤º â€œ0â€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-138tlulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-138tlulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setNumber</span>(<span class="hljs-number">0</span> + <span class="hljs-number">5</span>);<br><span class="hljs-title function_">alert</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p>ä½†å¦‚æœä½ åœ¨è¿™ä¸ªæç¤ºæ¡†ä¸ŠåŠ ä¸Šä¸€ä¸ªå®šæ—¶å™¨ï¼Œ ä½¿å¾—å®ƒåœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“ ä¹‹å æ‰è§¦å‘ï¼Œåˆä¼šæ€æ ·å‘¢ï¼Ÿæ˜¯ä¼šæ˜¾ç¤º â€œ0â€ è¿˜æ˜¯ â€œ5â€ ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-68hxenlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-68hxenlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [number, setNumber] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;number&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setNumber(number + 5);</span><br><span class="language-xml">        setTimeout(() =&gt; &#123;</span><br><span class="language-xml">          alert(number);</span><br><span class="language-xml">        &#125;, 3000);</span><br><span class="language-xml">      &#125;&#125;&gt;+5<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="timeout.gif" alt="timeout" style="zoom:50%;" /><p>å¦‚æœä½¿ç”¨æ›¿ä»£æ³•ï¼Œå°±èƒ½çœ‹åˆ°è¢«ä¼ å…¥æç¤ºæ¡†çš„ state â€œå¿«ç…§â€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t20jrolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t20jrolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setNumber</span>(<span class="hljs-number">0</span> + <span class="hljs-number">5</span>);<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">alert</span>(<span class="hljs-number">0</span>);<br>&#125;, <span class="hljs-number">3000</span>);<br></code></pre></td></tr></table></div></figure><p>åˆ°æç¤ºæ¡†è¿è¡Œæ—¶ï¼ŒReact ä¸­å­˜å‚¨çš„ state å¯èƒ½å·²ç»å‘ç”Ÿäº†æ›´æ”¹ï¼Œä½†å®ƒæ˜¯ä½¿ç”¨ç”¨æˆ·ä¸ä¹‹äº¤äº’æ—¶çŠ¶æ€çš„å¿«ç…§è¿›è¡Œè°ƒåº¦çš„ï¼</p><p><mark>ä¸€ä¸ª state å˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–</mark>ï¼Œ å³ä½¿å…¶äº‹ä»¶å¤„ç†å‡½æ•°çš„ä»£ç æ˜¯å¼‚æ­¥çš„ã€‚åœ¨ é‚£æ¬¡æ¸²æŸ“çš„ <code>onClick</code> å†…éƒ¨ï¼Œ<code>number</code> çš„å€¼å³ä½¿åœ¨è°ƒç”¨ <code>setNumber(number + 5)</code> ä¹‹åä¹Ÿè¿˜æ˜¯ <code>0</code>ã€‚å®ƒçš„å€¼åœ¨ React é€šè¿‡è°ƒç”¨ä½ çš„ç»„ä»¶â€œè·å– UI çš„å¿«ç…§â€æ—¶å°±è¢«â€œå›ºå®šâ€äº†ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¼šåœ¨äº”ç§’å»¶è¿Ÿä¹‹åå‘é€ä¸€æ¡æ¶ˆæ¯çš„è¡¨å•ã€‚æƒ³è±¡ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>ä½ æŒ‰ä¸‹â€œå‘é€â€æŒ‰é’®ï¼Œå‘ Alice å‘é€â€œä½ å¥½â€ã€‚</li><li>åœ¨äº”ç§’å»¶è¿Ÿç»“æŸä¹‹å‰ï¼Œå°†â€œToâ€å­—æ®µçš„å€¼æ›´æ”¹ä¸ºâ€œBobâ€ã€‚</li></ol><p>ä½ è§‰å¾— <code>alert</code> ä¼šæ˜¾ç¤ºä»€ä¹ˆï¼Ÿå®ƒæ˜¯ä¼šæ˜¾ç¤ºâ€œä½ å‘ Alice è¯´äº†ä½ å¥½â€œè¿˜æ˜¯ä¼šæ˜¾ç¤ºâ€œä½ å‘ Bob è¯´äº†ä½ å¥½â€ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bbu2omlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bbu2omlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [to, setTo] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">`You said <span class="hljs-subst">$&#123;message&#125;</span> to <span class="hljs-subst">$&#123;to&#125;</span>`</span>);<br>    &#125;, <span class="hljs-number">5000</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        To:&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;to&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setTo(e.target.value)&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Alice&quot;</span>&gt;</span>Alice<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Bob&quot;</span>&gt;</span>Bob<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Message&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;message&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setMessage(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="hello.gif" alt="hello" style="zoom:50%;" /><p>React ä¼šä½¿ state çš„å€¼å§‹ç»ˆâ€å›ºå®šâ€œåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å„ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨ã€‚ ä½ æ— éœ€æ‹…å¿ƒä»£ç è¿è¡Œæ—¶ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>ä½†æ˜¯ï¼Œä¸‡ä¸€ä½ æƒ³åœ¨é‡æ–°æ¸²æŸ“ä¹‹å‰è¯»å–æœ€æ–°çš„ state æ€ä¹ˆåŠï¼Ÿä½ åº”è¯¥ä½¿ç”¨ <a href="http://localhost:3000/learn/queueing-a-series-of-state-updates">çŠ¶æ€æ›´æ–°å‡½æ•°</a>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ttsc8rlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ttsc8rlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TrafficLight</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [walk, setWalk] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setWalk</span>(!walk);<br>    <span class="hljs-title function_">alert</span>(walk ? <span class="hljs-string">&#x27;Stop is next&#x27;</span> : <span class="hljs-string">&#x27;Walk is next&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        Change to &#123;walk ? &#x27;Stop&#x27; : &#x27;Walk&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">color:</span> <span class="hljs-attr">walk</span> ? &#x27;<span class="hljs-attr">darkgreen</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">darkred</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&#125;&gt;</span></span><br><span class="language-xml">        &#123;walk ? &#x27;Walk&#x27; : &#x27;Stop&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å®ç°çº¢ç»¿ç¯ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7g4b20lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7g4b20lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TrafficLight</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [walk, setWalk] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setWalk</span>(!walk);<br>    <span class="hljs-title function_">alert</span>(walk ? <span class="hljs-string">&#x27;Stop is next&#x27;</span> : <span class="hljs-string">&#x27;Walk is next&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        Change to &#123;walk ? &#x27;Stop&#x27; : &#x27;Walk&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">color:</span> <span class="hljs-attr">walk</span> ? &#x27;<span class="hljs-attr">darkgreen</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">darkred</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&#125;&gt;</span></span><br><span class="language-xml">        &#123;walk ? &#x27;Walk&#x27; : &#x27;Stop&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŠŠ <code>alert</code> æ–¹æ³•æ”¾åœ¨ <code>setWalk</code> æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åæ²¡æœ‰åŒºåˆ«ã€‚é‚£æ¬¡æ¸²æŸ“çš„ <code>walk</code> çš„å€¼æ˜¯å›ºå®šçš„ã€‚<mark>è°ƒç”¨<code>setWalk</code> åªä¼šä¸º ä¸‹æ¬¡ æ¸²æŸ“å¯¹å®ƒè¿›è¡Œå˜æ›´ï¼Œè€Œä¸ä¼šå½±å“æ¥è‡ªä¸Šæ¬¡æ¸²æŸ“çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</mark></p><h2 id="5-æŠŠä¸€ç³»åˆ—-state-æ›´æ–°åŠ å…¥é˜Ÿåˆ—"><a href="#5-æŠŠä¸€ç³»åˆ—-state-æ›´æ–°åŠ å…¥é˜Ÿåˆ—" class="headerlink" title="5.æŠŠä¸€ç³»åˆ— state æ›´æ–°åŠ å…¥é˜Ÿåˆ—"></a>5.æŠŠä¸€ç³»åˆ— state æ›´æ–°åŠ å…¥é˜Ÿåˆ—</h2><p>è®¾ç½®ç»„ä»¶ state ä¼šæŠŠä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ã€‚ä½†æœ‰æ—¶ä½ å¯èƒ½ä¼šå¸Œæœ›åœ¨ä¸‹æ¬¡æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ä¹‹å‰å¯¹ state çš„å€¼æ‰§è¡Œå¤šæ¬¡æ“ä½œã€‚</p><p><mark>React ä¼šç­‰åˆ°äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ æ‰€æœ‰ ä»£ç éƒ½è¿è¡Œå®Œæ¯•å†å¤„ç†ä½ çš„ state æ›´æ–°ã€‚</mark></p><p>è¿™è®©ä½ å¯ä»¥æ›´æ–°å¤šä¸ª state å˜é‡â€”â€”ç”šè‡³æ¥è‡ªå¤šä¸ªç»„ä»¶çš„ state å˜é‡â€”â€”è€Œä¸ä¼šè§¦å‘å¤ªå¤šçš„ <a href="http://localhost:3000/learn/render-and-commit#re-renders-when-state-updates">é‡æ–°æ¸²æŸ“</a>ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€åªæœ‰åœ¨ä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°åŠå…¶ä¸­ä»»ä½•ä»£ç æ‰§è¡Œå®Œæˆ ä¹‹åï¼ŒUI æ‰ä¼šæ›´æ–°ã€‚è¿™ç§ç‰¹æ€§ä¹Ÿå°±æ˜¯ æ‰¹å¤„ç†ï¼Œå®ƒä¼šä½¿ä½ çš„ React åº”ç”¨è¿è¡Œå¾—æ›´å¿«ã€‚å®ƒè¿˜ä¼šå¸®ä½ é¿å…å¤„ç†åªæ›´æ–°äº†ä¸€éƒ¨åˆ† state å˜é‡çš„ä»¤äººå›°æƒ‘çš„â€œåŠæˆå“â€æ¸²æŸ“ã€‚</p><p>React ä¸ä¼šè·¨å¤šä¸ªéœ€è¦åˆ»æ„è§¦å‘çš„äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ï¼‰è¿›è¡Œæ‰¹å¤„ç†â€”â€”æ¯æ¬¡ç‚¹å‡»éƒ½æ˜¯å•ç‹¬å¤„ç†çš„ã€‚è¯·æ”¾å¿ƒï¼ŒReact åªä¼šåœ¨ä¸€èˆ¬æ¥è¯´å®‰å…¨çš„æƒ…å†µä¸‹æ‰è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™å¯ä»¥ç¡®ä¿ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç¬¬ä¸€æ¬¡ç‚¹å‡»æŒ‰é’®ä¼šç¦ç”¨è¡¨å•ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ç‚¹å‡»å°±ä¸ä¼šå†æ¬¡æäº¤å®ƒã€‚</p><p><mark>åœ¨ä¸‹æ¬¡æ¸²æŸ“å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª state </mark>ï¼šè¿™æ˜¯ä¸€ä¸ªä¸å¸¸è§çš„ç”¨ä¾‹ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª stateï¼Œä½ å¯ä»¥åƒ <code>setNumber(n =&gt; n + 1)</code> è¿™æ ·ä¼ å…¥ä¸€ä¸ªæ ¹æ®é˜Ÿåˆ—ä¸­çš„å‰ä¸€ä¸ª state è®¡ç®—ä¸‹ä¸€ä¸ª state çš„ å‡½æ•°ï¼Œè€Œä¸æ˜¯åƒ <code>setNumber(number + 1)</code> è¿™æ ·ä¼ å…¥ ä¸‹ä¸€ä¸ª state å€¼ã€‚è¿™æ˜¯ä¸€ç§å‘Šè¯‰ React â€œç”¨ state å€¼åšæŸäº‹â€è€Œä¸æ˜¯ä»…ä»…æ›¿æ¢å®ƒçš„æ–¹æ³•ã€‚</p><p>ç°åœ¨å°è¯•é€’å¢è®¡æ•°å™¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v8a91qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v8a91qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [number, setNumber] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;number&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setNumber(n =&gt; n + 1);</span><br><span class="language-xml">        setNumber(n =&gt; n + 1);</span><br><span class="language-xml">        setNumber(n =&gt; n + 1);</span><br><span class="language-xml">      &#125;&#125;&gt;+3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>n =&gt; n + 1</code> è¢«ç§°ä¸º æ›´æ–°å‡½æ•°ã€‚å½“ä½ å°†å®ƒä¼ é€’ç»™ä¸€ä¸ª state è®¾ç½®å‡½æ•°æ—¶ï¼š</p><ol><li>React ä¼šå°†æ­¤å‡½æ•°åŠ å…¥é˜Ÿåˆ—ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„æ‰€æœ‰å…¶ä»–ä»£ç è¿è¡Œåè¿›è¡Œå¤„ç†ã€‚</li><li>åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå†é˜Ÿåˆ—å¹¶ç»™ä½ æ›´æ–°ä¹‹åçš„æœ€ç»ˆ stateã€‚</li></ol><p>React åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°æ—¶å¤„ç†è¿™å‡ è¡Œä»£ç çš„è¿‡ç¨‹ï¼š</p><ol><li><code>setNumber(n =&gt; n + 1)</code>ï¼š<code>n =&gt; n + 1</code> æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚</li><li><code>setNumber(n =&gt; n + 1)</code>ï¼š<code>n =&gt; n + 1</code> æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚</li><li><code>setNumber(n =&gt; n + 1)</code>ï¼š<code>n =&gt; n + 1</code> æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚React å°†å®ƒåŠ å…¥é˜Ÿåˆ—ã€‚</li></ol><p>å½“ä½ åœ¨ä¸‹æ¬¡æ¸²æŸ“æœŸé—´è°ƒç”¨ <code>useState</code> æ—¶ï¼ŒReact ä¼šéå†é˜Ÿåˆ—ã€‚ä¹‹å‰çš„ <code>number</code> state çš„å€¼æ˜¯ <code>0</code>ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ React ä½œä¸ºå‚æ•° <code>n</code> ä¼ é€’ç»™ç¬¬ä¸€ä¸ªæ›´æ–°å‡½æ•°çš„å€¼ã€‚ç„¶å React ä¼šè·å–ä½ ä¸Šä¸€ä¸ªæ›´æ–°å‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶å°†å…¶ä½œä¸º <code>n</code> ä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼š</p><table><thead><tr><th>æ›´æ–°é˜Ÿåˆ—</th><th><code>n</code></th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>n =&gt; n + 1</code></td><td><code>0</code></td><td><code>0 + 1 = 1</code></td></tr><tr><td><code>n =&gt; n + 1</code></td><td><code>1</code></td><td><code>1 + 1 = 2</code></td></tr><tr><td><code>n =&gt; n + 1</code></td><td><code>2</code></td><td><code>2 + 1 = 3</code></td></tr></tbody></table><p>React ä¼šä¿å­˜ <code>3</code> ä¸ºæœ€ç»ˆç»“æœå¹¶ä» <code>useState</code> ä¸­è¿”å›ã€‚</p><p><mark>å¦‚æœä½ åœ¨æ›¿æ¢ state åæ›´æ–° state ä¼šå‘ç”Ÿä»€ä¹ˆ</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ps3spllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ps3spllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [number, setNumber] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;number&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setNumber(number + 5);</span><br><span class="language-xml">        setNumber(n =&gt; n + 1);</span><br><span class="language-xml">      &#125;&#125;&gt;å¢åŠ æ•°å­—<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><p>0â†’6â†’12â†’...</p><p>è¿™æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°å‘Šè¯‰ React è¦åšçš„äº‹æƒ…ï¼š</p><ol><li><code>setNumber(number + 5)</code>ï¼š<code>number</code> ä¸º <code>0</code>ï¼Œæ‰€ä»¥ <code>setNumber(0 + 5)</code>ã€‚React å°† <em>â€œæ›¿æ¢ä¸º <code>5</code>â€</em> æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚</li><li><code>setNumber(n =&gt; n + 1)</code>ï¼š<code>n =&gt; n + 1</code> æ˜¯ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚ React å°† è¯¥å‡½æ•° æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚</li></ol><p>åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå† state é˜Ÿåˆ—ï¼š</p><table><thead><tr><th>æ›´æ–°é˜Ÿåˆ—</th><th><code>n</code></th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td>â€œæ›¿æ¢ä¸º <code>5</code>â€</td><td><code>0</code>ï¼ˆæœªä½¿ç”¨ï¼‰</td><td><code>5</code></td></tr><tr><td><code>n =&gt; n + 1</code></td><td><code>5</code></td><td><code>5 + 1 = 6</code></td></tr></tbody></table><p>React ä¼šä¿å­˜ <code>6</code> ä¸ºæœ€ç»ˆç»“æœå¹¶ä» <code>useState</code> ä¸­è¿”å›ã€‚</p><p><code>setState(x)</code> å®é™…ä¸Šä¼šåƒ <code>setState(n =&gt; x)</code> ä¸€æ ·è¿è¡Œï¼Œåªæ˜¯æ²¡æœ‰ä½¿ç”¨ <code>n</code>ï¼</p><p><mark>å¦‚æœä½ åœ¨æ›´æ–° state åæ›¿æ¢ state ä¼šå‘ç”Ÿä»€ä¹ˆ</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5ydo0mlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5ydo0mlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;button onClick=&#123;<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setNumber</span>(number + <span class="hljs-number">5</span>);<br>  <span class="hljs-title function_">setNumber</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> n + <span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">42</span>);<br>&#125;&#125;&gt;<br></code></pre></td></tr></table></div></figure><p>0â†’42</p><p>React åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°æ—¶å¤„ç†è¿™å‡ è¡Œä»£ç çš„è¿‡ç¨‹ï¼š</p><ol><li><code>setNumber(number + 5)</code>ï¼š<code>number</code> ä¸º <code>0</code>ï¼Œæ‰€ä»¥ <code>setNumber(0 + 5)</code>ã€‚React å°† <em>â€œæ›¿æ¢ä¸º <code>5</code>â€</em> æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚</li><li><code>setNumber(n =&gt; n + 1)</code>ï¼š<code>n =&gt; n + 1</code> æ˜¯ä¸€ä¸ªæ›´æ–°å‡½æ•°ã€‚React å°†è¯¥å‡½æ•°æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚</li><li><code>setNumber(42)</code>ï¼šReact å°† â€œæ›¿æ¢ä¸º <code>42</code>â€ æ·»åŠ åˆ°å…¶é˜Ÿåˆ—ä¸­ã€‚</li></ol><p>åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒReact ä¼šéå† state é˜Ÿåˆ—ï¼š</p><table><thead><tr><th>æ›´æ–°é˜Ÿåˆ—</th><th><code>n</code></th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td>â€œæ›¿æ¢ä¸º <code>5</code>â€</td><td><code>0</code>ï¼ˆæœªä½¿ç”¨ï¼‰</td><td><code>5</code></td></tr><tr><td><code>n =&gt; n + 1</code></td><td><code>5</code></td><td><code>5 + 1 = 6</code></td></tr><tr><td>â€œæ›¿æ¢ä¸º <code>42</code>â€</td><td><code>6</code>ï¼ˆæœªä½¿ç”¨ï¼‰</td><td><code>42</code></td></tr></tbody></table><p>ç„¶å React ä¼šä¿å­˜ <code>42</code> ä¸ºæœ€ç»ˆç»“æœå¹¶ä» <code>useState</code> ä¸­è¿”å›ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œä»¥ä¸‹æ˜¯ä½ å¯ä»¥è€ƒè™‘ä¼ é€’ç»™ <code>setNumber</code> state è®¾ç½®å‡½æ•°çš„å†…å®¹ï¼š</p><ul><li>ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼ˆä¾‹å¦‚ï¼š<code>n =&gt; n + 1</code>ï¼‰ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚</li><li>ä»»ä½•å…¶ä»–çš„å€¼ï¼ˆä¾‹å¦‚ï¼šæ•°å­— <code>5</code>ï¼‰ä¼šå¯¼è‡´â€œæ›¿æ¢ä¸º <code>5</code>â€è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„å†…å®¹ä¼šè¢«å¿½ç•¥ã€‚</li></ul><p>äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåï¼ŒReact å°†è§¦å‘é‡æ–°æ¸²æŸ“ã€‚<mark>åœ¨é‡æ–°æ¸²æŸ“æœŸé—´ï¼ŒReact å°†å¤„ç†é˜Ÿåˆ—ã€‚æ›´æ–°å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œå› æ­¤ æ›´æ–°å‡½æ•°å¿…é¡»æ˜¯ <a href="http://localhost:3000/learn/keeping-components-pure">çº¯å‡½æ•°</a> å¹¶ä¸”åª è¿”å› ç»“æœã€‚ä¸è¦å°è¯•ä»å®ƒä»¬å†…éƒ¨è®¾ç½® state æˆ–è€…æ‰§è¡Œå…¶ä»–å‰¯ä½œç”¨</mark>ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact ä¼šæ‰§è¡Œæ¯ä¸ªæ›´æ–°å‡½æ•°ä¸¤æ¬¡ï¼ˆä½†æ˜¯ä¸¢å¼ƒç¬¬äºŒä¸ªç»“æœï¼‰ä»¥ä¾¿å¸®åŠ©ä½ å‘ç°é”™è¯¯ã€‚</p><p>å‘½åæƒ¯ä¾‹ï¼šé€šå¸¸å¯ä»¥é€šè¿‡ç›¸åº” state å˜é‡çš„ç¬¬ä¸€ä¸ªå­—æ¯æ¥å‘½åæ›´æ–°å‡½æ•°çš„å‚æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a8eh9rlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a8eh9rlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setEnabled</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> !e);<br><br><span class="hljs-title function_">setLastName</span>(<span class="hljs-function"><span class="hljs-params">ln</span> =&gt;</span> ln.<span class="hljs-title function_">reverse</span>());<br><br><span class="hljs-title function_">setFriendCount</span>(<span class="hljs-function"><span class="hljs-params">fc</span> =&gt;</span> fc * <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ å–œæ¬¢æ›´å†—é•¿çš„ä»£ç ï¼Œå¦ä¸€ä¸ªå¸¸è§çš„æƒ¯ä¾‹æ˜¯é‡å¤ä½¿ç”¨å®Œæ•´çš„ state å˜é‡åç§°ï¼Œå¦‚ <code>setEnabled(enabled =&gt; !enabled)</code>ï¼Œæˆ–ä½¿ç”¨å‰ç¼€ï¼Œå¦‚ <code>setEnabled(prevEnabled =&gt; !prevEnabled)</code>ã€‚</p><h2 id="6-æ›´æ–°-state-ä¸­çš„å¯¹è±¡"><a href="#6-æ›´æ–°-state-ä¸­çš„å¯¹è±¡" class="headerlink" title="6.æ›´æ–° state ä¸­çš„å¯¹è±¡"></a>6.æ›´æ–° state ä¸­çš„å¯¹è±¡</h2><p>state ä¸­å¯ä»¥ä¿å­˜ä»»æ„ç±»å‹çš„ JavaScript å€¼ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä½ ä¸åº”è¯¥ç›´æ¥ä¿®æ”¹å­˜æ”¾åœ¨ React state ä¸­çš„å¯¹è±¡ã€‚ç›¸åï¼Œå½“ä½ æƒ³è¦æ›´æ–°ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆæˆ–è€…å°†å…¶æ‹·è´ä¸€ä»½ï¼‰ï¼Œç„¶åå°† state æ›´æ–°ä¸ºæ­¤å¯¹è±¡ã€‚</p><p>æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œè¿™äº›ç±»å‹çš„å€¼åœ¨ JavaScript ä¸­æ˜¯ä¸å¯å˜ï¼ˆimmutableï¼‰çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸èƒ½è¢«æ”¹å˜æˆ–æ˜¯åªè¯»çš„ã€‚ä½ å¯ä»¥é€šè¿‡æ›¿æ¢å®ƒä»¬çš„å€¼ä»¥è§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n6mv5xlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n6mv5xlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setX</span>(<span class="hljs-number">5</span>);<br></code></pre></td></tr></table></div></figure><p>state <code>x</code> ä» <code>0</code> å˜ä¸º <code>5</code>ï¼Œä½†æ˜¯æ•°å­— <code>0</code> æœ¬èº«å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚åœ¨ JavaScript ä¸­ï¼Œæ— æ³•å¯¹å†…ç½®çš„åŸå§‹å€¼ï¼Œå¦‚æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚</p><p>ç°åœ¨è€ƒè™‘ state ä¸­å­˜æ”¾å¯¹è±¡çš„æƒ…å†µï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-62serklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-62serklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [position, setPosition] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;);<br></code></pre></td></tr></table></div></figure><p>ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œå¯ä»¥æ”¹å˜å¯¹è±¡è‡ªèº«çš„å†…å®¹ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œå°±åˆ¶é€ äº†ä¸€ä¸ª mutationï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-pu9puglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-pu9puglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">position.<span class="hljs-property">x</span> = <span class="hljs-number">5</span>;<br></code></pre></td></tr></table></div></figure><p>ç„¶è€Œï¼Œè™½ç„¶ä¸¥æ ¼æ¥è¯´ React state ä¸­å­˜æ”¾çš„å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œä½†ä½ åº”è¯¥åƒå¤„ç†æ•°å­—ã€å¸ƒå°”å€¼ã€å­—ç¬¦ä¸²ä¸€æ ·å°†å®ƒä»¬è§†ä¸ºä¸å¯å˜çš„ã€‚å› æ­¤ä½ åº”è¯¥æ›¿æ¢å®ƒä»¬çš„å€¼ï¼Œè€Œä¸æ˜¯å¯¹å®ƒä»¬è¿›è¡Œä¿®æ”¹ã€‚ </p><p>åº”è¯¥ <mark>æŠŠæ‰€æœ‰å­˜æ”¾åœ¨ state ä¸­çš„ JavaScript å¯¹è±¡éƒ½è§†ä¸ºåªè¯»çš„</mark>ã€‚</p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå­˜æ”¾åœ¨ state ä¸­çš„å¯¹è±¡æ¥è¡¨ç¤ºæŒ‡é’ˆå½“å‰çš„ä½ç½®ã€‚å½“ä½ åœ¨é¢„è§ˆåŒºè§¦æ‘¸æˆ–ç§»åŠ¨å…‰æ ‡æ—¶ï¼Œçº¢è‰²çš„ç‚¹æœ¬åº”ç§»åŠ¨ã€‚ä½†æ˜¯å®é™…ä¸Šçº¢ç‚¹ä»åœç•™åœ¨åŸå¤„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kqjuo1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kqjuo1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MovingDot</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [position, setPosition] = <span class="hljs-title function_">useState</span>(&#123;<br>    <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span><br>  &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerMove</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">        position.x = e.clientX;</span><br><span class="language-xml">        position.y = e.clientY;</span><br><span class="language-xml">      &#125;&#125;</span><br><span class="language-xml">      style=&#123;&#123;</span><br><span class="language-xml">        position: &#x27;relative&#x27;,</span><br><span class="language-xml">        width: &#x27;100vw&#x27;,</span><br><span class="language-xml">        height: &#x27;100vh&#x27;,</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">absolute</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">backgroundColor:</span> &#x27;<span class="hljs-attr">red</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">borderRadius:</span> &#x27;<span class="hljs-attr">50</span>%&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translate</span>($&#123;<span class="hljs-attr">position.x</span>&#125;<span class="hljs-attr">px</span>, $&#123;<span class="hljs-attr">position.y</span>&#125;<span class="hljs-attr">px</span>)`,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">left:</span> <span class="hljs-attr">-10</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">top:</span> <span class="hljs-attr">-10</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">width:</span> <span class="hljs-attr">20</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">height:</span> <span class="hljs-attr">20</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&#125; /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç ç›´æ¥ä¿®æ”¹äº† <a href="http://localhost:3000/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time">ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­</a> åˆ†é…ç»™ <code>position</code> çš„å¯¹è±¡ã€‚ä½†æ˜¯å› ä¸ºå¹¶æ²¡æœ‰ä½¿ç”¨ state çš„è®¾ç½®å‡½æ•°ï¼ŒReact å¹¶ä¸çŸ¥é“å¯¹è±¡å·²æ›´æ”¹ã€‚æ‰€ä»¥ React æ²¡æœ‰åšå‡ºä»»ä½•å“åº”ã€‚è¿™å°±åƒåœ¨åƒå®Œé¥­ä¹‹åæ‰å°è¯•å»æ”¹å˜è¦ç‚¹çš„èœä¸€æ ·ã€‚è™½ç„¶åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç›´æ¥ä¿®æ”¹ state å¯èƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æˆ‘ä»¬å¹¶ä¸æ¨èè¿™ä¹ˆåšã€‚ä½ åº”è¯¥æŠŠåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥è®¿é—®åˆ°çš„ state è§†ä¸ºåªè¯»çš„ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†çœŸæ­£åœ° <a href="http://localhost:3000/learn/state-as-a-snapshot#setting-state-triggers-renders">è§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“</a>ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒä¼ é€’ç»™ state çš„è®¾ç½®å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ikyvz5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ikyvz5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx">onPointerMove=&#123;<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;<br>  <span class="hljs-title function_">setPosition</span>(&#123;<br>    <span class="hljs-attr">x</span>: e.<span class="hljs-property">clientX</span>,<br>    <span class="hljs-attr">y</span>: e.<span class="hljs-property">clientY</span><br>  &#125;);<br>&#125;&#125;<br></code></pre></td></tr></table></div></figure><p>é€šè¿‡ä½¿ç”¨ <code>setPosition</code>ï¼Œä½ åœ¨å‘Šè¯‰ Reactï¼š</p><ul><li>ä½¿ç”¨è¿™ä¸ªæ–°çš„å¯¹è±¡æ›¿æ¢ <code>position</code> çš„å€¼</li><li>ç„¶åå†æ¬¡æ¸²æŸ“è¿™ä¸ªç»„ä»¶</li></ul><p>ç°åœ¨ä½ å¯ä»¥çœ‹åˆ°ï¼Œå½“ä½ åœ¨é¢„è§ˆåŒºè§¦æ‘¸æˆ–ç§»åŠ¨å…‰æ ‡æ—¶ï¼Œçº¢ç‚¹ä¼šè·Ÿéšç€ä½ çš„æŒ‡é’ˆç§»åŠ¨ã€‚</p><p>åƒè¿™æ ·çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒæ”¹å˜äº† state ä¸­ç°æœ‰çš„å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0fi7a3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0fi7a3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">position.<span class="hljs-property">x</span> = e.<span class="hljs-property">clientX</span>;<br><br>position.<span class="hljs-property">y</span> = e.<span class="hljs-property">clientY</span>;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯åƒè¿™æ ·çš„ä»£ç å°± æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºä½ æ”¹å˜çš„æ˜¯ä½ åˆšåˆšåˆ›å»ºçš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5kcddglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5kcddglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> nextPosition = &#123;&#125;;<br><br>nextPosition.<span class="hljs-property">x</span> = e.<span class="hljs-property">clientX</span>;<br><br>nextPosition.<span class="hljs-property">y</span> = e.<span class="hljs-property">clientY</span>;<br><br><span class="hljs-title function_">setPosition</span>(nextPosition);<br></code></pre></td></tr></table></div></figure><p>äº‹å®ä¸Šï¼Œå®ƒå®Œå…¨ç­‰åŒäºä¸‹é¢è¿™ç§å†™æ³•ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-faksunlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-faksunlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setPosition</span>(&#123;<br>    <span class="hljs-attr">x</span>: e.<span class="hljs-property">clientX</span>,<br>    <span class="hljs-attr">y</span>: e.<span class="hljs-property">client</span><br>&#125;);<br></code></pre></td></tr></table></div></figure><p>åªæœ‰å½“ä½ æ”¹å˜å·²ç»å¤„äº state ä¸­çš„ ç°æœ‰ å¯¹è±¡æ—¶ï¼Œmutation æ‰ä¼šæˆä¸ºé—®é¢˜ã€‚è€Œä¿®æ”¹ä¸€ä¸ªä½ åˆšåˆšåˆ›å»ºçš„å¯¹è±¡å°±ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼Œå› ä¸º è¿˜æ²¡æœ‰å…¶ä»–çš„ä»£ç å¼•ç”¨å®ƒã€‚æ”¹å˜å®ƒå¹¶ä¸ä¼šæ„å¤–åœ°å½±å“åˆ°ä¾èµ–å®ƒçš„ä¸œè¥¿ã€‚è¿™å«åšâ€œå±€éƒ¨ mutationâ€ã€‚ä½ ç”šè‡³å¯ä»¥ <a href="http://localhost:3000/learn/keeping-components-pure#local-mutation-your-components-little-secret">åœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­</a> è¿›è¡Œâ€œå±€éƒ¨ mutationâ€çš„æ“ä½œã€‚</p><p><mark>ä½¿ç”¨å±•å¼€è¯­æ³•å¤åˆ¶å¯¹è±¡</mark>ï¼šåœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå§‹ç»ˆä¼šæ ¹æ®å½“å‰æŒ‡é’ˆçš„ä½ç½®åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„ <code>position</code> å¯¹è±¡ã€‚ä½†æ˜¯é€šå¸¸ï¼Œä½ ä¼šå¸Œæœ›æŠŠ ç°æœ‰ æ•°æ®ä½œä¸ºä½ æ‰€åˆ›å»ºçš„æ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åªæƒ³è¦æ›´æ–°è¡¨å•ä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå…¶ä»–çš„å­—æ®µä»ç„¶ä½¿ç”¨ä¹‹å‰çš„å€¼ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œè¾“å…¥æ¡†å¹¶ä¸ä¼šæ­£å¸¸è¿è¡Œã€æ— æ³•ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼ã€‘ï¼Œå› ä¸º <code>onChange</code> ç›´æ¥ä¿®æ”¹äº† state ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3kjrrnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3kjrrnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [person, setPerson] = <span class="hljs-title function_">useState</span>(&#123;<br>    <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Barbara&#x27;</span>,<br>    <span class="hljs-attr">lastName</span>: <span class="hljs-string">&#x27;Hepworth&#x27;</span>,<br>    <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;bhepworth@sculpture.com&#x27;</span><br>  &#125;);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleFirstNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    person.<span class="hljs-property">firstName</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLastNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    person.<span class="hljs-property">lastName</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleEmailChange</span>(<span class="hljs-params">e</span>) &#123;<br>    person.<span class="hljs-property">email</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        First name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.firstName&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleFirstNameChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Last name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.lastName&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleLastNameChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Email:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.email&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleEmailChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        &#123;person.firstName&#125;&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        &#123;person.lastName&#125;&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        (&#123;person.email&#125;)</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231107160248607.png" alt="image-20231107160248607" style="zoom:50%;" /><p>ä¸‹é¢è¿™è¡Œä»£ç ä¿®æ”¹äº†ä¸Šä¸€æ¬¡æ¸²æŸ“ä¸­çš„ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vebxkklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vebxkklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">person.<span class="hljs-property">firstName</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br></code></pre></td></tr></table></div></figure><p>æƒ³è¦å®ç°ä½ çš„éœ€æ±‚ï¼Œæœ€å¯é çš„åŠæ³•å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å¹¶å°†å®ƒä¼ é€’ç»™ <code>setPerson</code>ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œä½ è¿˜éœ€è¦ æŠŠå½“å‰çš„æ•°æ®å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­ï¼Œå› ä¸ºä½ åªæ”¹å˜äº†å…¶ä¸­ä¸€ä¸ªå­—æ®µï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5mxi0klqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5mxi0klqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setPerson</span>(&#123;<br>  <span class="hljs-attr">firstName</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>, <span class="hljs-comment">/* ä» input ä¸­è·å–æ–°çš„ first name */</span><br>  <span class="hljs-attr">lastName</span>: person.<span class="hljs-property">lastName</span>,<br>  <span class="hljs-attr">email</span>: person.<span class="hljs-property">email</span><br>&#125;);<br></code></pre></td></tr></table></div></figure><p>ä½ å¯ä»¥ä½¿ç”¨ <code>...</code> <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Spread_syntax#spread_in_object_literals">å¯¹è±¡å±•å¼€</a> è¯­æ³•ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦å•ç‹¬å¤åˆ¶æ¯ä¸ªå±æ€§ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5tt1njlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5tt1njlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setPerson</span>(&#123;<br>  ...person, <span class="hljs-comment">// å¤åˆ¶ä¸Šä¸€ä¸ª person ä¸­çš„æ‰€æœ‰å­—æ®µ</span><br>  <span class="hljs-attr">firstName</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> <span class="hljs-comment">// ä½†æ˜¯è¦†ç›– firstName å­—æ®µ </span><br>&#125;);<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨è¡¨å•å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä½ å¹¶æ²¡æœ‰ä¸ºæ¯ä¸ªè¾“å…¥æ¡†å•ç‹¬å£°æ˜ä¸€ä¸ª stateã€‚å¯¹äºå¤§å‹è¡¨å•ï¼Œå°†æ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸­æ˜¯éå¸¸æ–¹ä¾¿çš„â€”â€”å‰ææ˜¯ä½ èƒ½å¤Ÿæ­£ç¡®åœ°æ›´æ–°å®ƒï¼</p><p><code>...</code> å±•å¼€è¯­æ³•æœ¬è´¨æ˜¯æ˜¯â€œæµ…æ‹·è´â€â€”â€”å®ƒåªä¼šå¤åˆ¶ä¸€å±‚ã€‚è¿™ä½¿å¾—å®ƒçš„æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯ä¹Ÿæ„å‘³ç€å½“ä½ æƒ³è¦æ›´æ–°ä¸€ä¸ªåµŒå¥—å±æ€§æ—¶ï¼Œä½ å¿…é¡»å¾—å¤šæ¬¡ä½¿ç”¨å±•å¼€è¯­æ³•ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°æ¥æ›´æ–°å¤šä¸ªå­—æ®µï¼šä½ ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡çš„å®šä¹‰ä¸­ä½¿ç”¨ <code>[</code> å’Œ <code>]</code> æ‹¬å·æ¥å®ç°å±æ€§çš„åŠ¨æ€å‘½åã€‚ä¸‹é¢æ˜¯åŒä¸€ä¸ªä¾‹å­ï¼Œä½†å®ƒä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°è€Œä¸æ˜¯ä¸‰ä¸ªï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hmrc54lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hmrc54lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) &#123;<br><span class="hljs-title function_">setPerson</span>(&#123;<br>  ...person,<br>  [e.<span class="hljs-property">target</span>.<span class="hljs-property">name</span>]: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>&#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>e.target.name</code> å¼•ç”¨äº† <code>&lt;input&gt;</code> è¿™ä¸ª DOM å…ƒç´ çš„ <code>name</code> å±æ€§ã€‚</p><p><mark>æ›´æ–°ä¸€ä¸ªåµŒå¥—å¯¹è±¡</mark>ï¼šè€ƒè™‘ä¸‹é¢è¿™ç§ç»“æ„çš„åµŒå¥—å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ulorh8lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ulorh8lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [person, setPerson] = <span class="hljs-title function_">useState</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br>  <span class="hljs-attr">artwork</span>: &#123;<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br>    <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br>    <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ æƒ³è¦æ›´æ–° <code>person.artwork.city</code> çš„å€¼ï¼Œç”¨ mutation æ¥å®ç°çš„æ–¹æ³•éå¸¸å®¹æ˜“ç†è§£ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-lger3mlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-lger3mlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">person.<span class="hljs-property">artwork</span>.<span class="hljs-property">city</span> = <span class="hljs-string">&#x27;New Delhi&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯åœ¨ React ä¸­ï¼Œä½ éœ€è¦å°† state è§†ä¸ºä¸å¯å˜çš„ï¼ä¸ºäº†ä¿®æ”¹ <code>city</code> çš„å€¼ï¼Œä½ é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>artwork</code> å¯¹è±¡ï¼ˆå…¶ä¸­é¢„å…ˆå¡«å……äº†ä¸Šä¸€ä¸ª <code>artwork</code> å¯¹è±¡ä¸­çš„æ•°æ®ï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ <code>person</code> å¯¹è±¡ï¼Œå¹¶ä½¿å¾—å…¶ä¸­çš„ <code>artwork</code> å±æ€§æŒ‡å‘æ–°åˆ›å»ºçš„ <code>artwork</code> å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9yhdt6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9yhdt6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> nextArtwork = &#123; ...person.<span class="hljs-property">artwork</span>, <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;New Delhi&#x27;</span> &#125;;<br><span class="hljs-keyword">const</span> nextPerson = &#123; ...person, <span class="hljs-attr">artwork</span>: nextArtwork &#125;;<br><span class="hljs-title function_">setPerson</span>(nextPerson);<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…ï¼Œå†™æˆä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s0us3alqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s0us3alqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setPerson</span>(&#123;<br>  ...person, <span class="hljs-comment">/*  å¤åˆ¶å…¶å®ƒå­—æ®µçš„æ•°æ®   */</span> <br>  <span class="hljs-attr">artwork</span>: &#123; <span class="hljs-comment">/*  æ›¿æ¢ artwork å­—æ®µ   */</span> <br>    ...person.<span class="hljs-property">artwork</span>, <span class="hljs-comment">/* å¤åˆ¶ä¹‹å‰ person.artwork ä¸­çš„æ•°æ®   */</span> <br>    <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;New Delhi&#x27;</span> <span class="hljs-comment">/*  ä½†æ˜¯å°† city çš„å€¼æ›¿æ¢ä¸º New Delhiï¼  */</span> <br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>è¿™è™½ç„¶çœ‹èµ·æ¥æœ‰ç‚¹å†—é•¿ï¼Œä½†å¯¹äºå¾ˆå¤šæƒ…å†µéƒ½èƒ½æœ‰æ•ˆåœ°è§£å†³é—®</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yox73hlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yox73hlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [person, setPerson] = <span class="hljs-title function_">useState</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br>    <span class="hljs-attr">artwork</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br>      <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br>      <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setPerson</span>(&#123;<br>      ...person,<br>      <span class="hljs-attr">name</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTitleChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setPerson</span>(&#123;<br>      ...person,<br>      <span class="hljs-attr">artwork</span>: &#123;<br>        ...person.<span class="hljs-property">artwork</span>,<br>        <span class="hljs-attr">title</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCityChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setPerson</span>(&#123;<br>      ...person,<br>      <span class="hljs-attr">artwork</span>: &#123;<br>        ...person.<span class="hljs-property">artwork</span>,<br>        <span class="hljs-attr">city</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleImageChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setPerson</span>(&#123;<br>      ...person,<br>      <span class="hljs-attr">artwork</span>: &#123;<br>        ...person.<span class="hljs-property">artwork</span>,<br>        <span class="hljs-attr">image</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span><br>      &#125;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleNameChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Title:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.artwork.title&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleTitleChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        City:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.artwork.city&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleCityChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Image:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person.artwork.image&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleImageChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;person.artwork.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">        &#123;&#x27; by &#x27;&#125;</span><br><span class="language-xml">        &#123;person.name&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">        (located in &#123;person.artwork.city&#125;)</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;person.artwork.image&#125;</span> </span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;person.artwork.title&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¯¹è±¡å¹¶éæ˜¯çœŸæ­£åµŒå¥—çš„ï¼šä¸‹é¢è¿™ä¸ªå¯¹è±¡ä»ä»£ç ä¸Šæ¥çœ‹æ˜¯â€œåµŒå¥—â€çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8lgz2ilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8lgz2ilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj = &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br><span class="hljs-attr">artwork</span>: &#123;<br><span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br><span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br><span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>&#125;<br>&#125;;<br></code></pre></td></tr></table></div></figure><p>ç„¶è€Œï¼Œå½“æˆ‘ä»¬æ€è€ƒå¯¹è±¡çš„ç‰¹æ€§æ—¶ï¼Œâ€œåµŒå¥—â€å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸å‡†ç¡®çš„æ–¹å¼ã€‚å½“è¿™æ®µä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œä¸å­˜åœ¨â€œåµŒå¥—â€çš„å¯¹è±¡ã€‚ä½ å®é™…ä¸Šçœ‹åˆ°çš„æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t2suqrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t2suqrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj1 = &#123;<br><span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br><span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br><span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>&#125;;<br><br><span class="hljs-keyword">let</span> obj2 = &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br><span class="hljs-attr">artwork</span>: obj1<br>&#125;;<br></code></pre></td></tr></table></div></figure><p>å¯¹è±¡ <code>obj1</code> å¹¶ä¸å¤„äº <code>obj2</code> çš„â€œå†…éƒ¨â€ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ä¸­ï¼Œ<code>obj3</code> ä¸­çš„å±æ€§ä¹Ÿå¯ä»¥æŒ‡å‘ <code>obj1</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rl07jqlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rl07jqlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> obj1 = &#123;<br><span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br><span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br><span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>&#125;;<br><br><span class="hljs-keyword">let</span> obj2 = &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br><span class="hljs-attr">artwork</span>: obj1<br>&#125;;<br><br><span class="hljs-keyword">let</span> obj3 = &#123;<br><span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Copycat&#x27;</span>,<br><span class="hljs-attr">artwork</span>: obj1<br>&#125;;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ ç›´æ¥ä¿®æ”¹ <code>obj3.artwork.city</code>ï¼Œå°±ä¼šåŒæ—¶å½±å“ <code>obj2.artwork.city</code> å’Œ <code>obj1.city</code>ã€‚è¿™æ˜¯å› ä¸º <code>obj3.artwork</code>ã€<code>obj2.artwork</code> å’Œ <code>obj1</code> éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚å½“ä½ ç”¨â€œåµŒå¥—â€çš„æ–¹å¼çœ‹å¾…å¯¹è±¡æ—¶ï¼Œå¾ˆéš¾çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚ç›¸åï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„å¯¹è±¡ï¼Œåªä¸è¿‡æ˜¯ç”¨å±æ€§â€œæŒ‡å‘â€å½¼æ­¤è€Œå·²ã€‚</p><p><mark>ä½¿ç”¨ Immer ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘</mark>ï¼šå¦‚æœä½ çš„ state æœ‰å¤šå±‚çš„åµŒå¥—ï¼Œä½ æˆ–è®¸åº”è¯¥è€ƒè™‘ <a href="http://localhost:3000/learn/choosing-the-state-structure#avoid-deeply-nested-state">å°†å…¶æ‰å¹³åŒ–</a>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æƒ³æ”¹å˜ state çš„æ•°æ®ç»“æ„ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ç”¨ä¸€ç§æ›´ä¾¿æ·çš„æ–¹å¼æ¥å®ç°åµŒå¥—å±•å¼€çš„æ•ˆæœã€‚<a href="https://github.com/immerjs/use-immer">Immer</a> æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„åº“ï¼Œå®ƒå¯ä»¥è®©ä½ ä½¿ç”¨ç®€ä¾¿ä½†å¯ä»¥ç›´æ¥ä¿®æ”¹çš„è¯­æ³•ç¼–å†™ä»£ç ï¼Œå¹¶ä¼šå¸®ä½ å¤„ç†å¥½å¤åˆ¶çš„è¿‡ç¨‹ã€‚é€šè¿‡ä½¿ç”¨ Immerï¼Œä½ å†™å‡ºçš„ä»£ç çœ‹èµ·æ¥å°±åƒæ˜¯ä½ â€œæ‰“ç ´äº†è§„åˆ™â€è€Œç›´æ¥ä¿®æ”¹äº†å¯¹è±¡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-60k6s0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-60k6s0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">updatePerson</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>  draft.<span class="hljs-property">artwork</span>.<span class="hljs-property">city</span> = <span class="hljs-string">&#x27;Lagos&#x27;</span>;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯ä¸åŒäºä¸€èˆ¬çš„ mutationï¼Œå®ƒå¹¶ä¸ä¼šè¦†ç›–ä¹‹å‰çš„ stateï¼</p><p>ç”± Immer æä¾›çš„ <code>draft</code> æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¯¹è±¡ï¼Œè¢«ç§°ä¸º <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>ï¼Œå®ƒä¼šè®°å½•ä½ ç”¨å®ƒæ‰€è¿›è¡Œçš„æ“ä½œã€‚è¿™å°±æ˜¯ä½ èƒ½å¤Ÿéšå¿ƒæ‰€æ¬²åœ°ç›´æ¥ä¿®æ”¹å¯¹è±¡çš„åŸå› æ‰€åœ¨ï¼ä»åŸç†ä¸Šè¯´ï¼ŒImmer ä¼šå¼„æ¸…æ¥š <code>draft</code> å¯¹è±¡çš„å“ªäº›éƒ¨åˆ†è¢«æ”¹å˜äº†ï¼Œå¹¶ä¼šä¾ç…§ä½ çš„ä¿®æ”¹åˆ›å»ºå‡ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚</p><p>ä½¿ç”¨ Immer:</p><ol><li>è¿è¡Œ <code>npm install use-immer</code> æ·»åŠ  Immer ä¾èµ–</li><li>ç”¨ <code>import &#123; useImmer &#125; from &#39;use-immer&#39;</code> æ›¿æ¢æ‰ <code>import &#123; useState &#125; from &#39;react&#39;</code></li></ol><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g7e22xlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g7e22xlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useImmer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;use-immer&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [person, updatePerson] = <span class="hljs-title function_">useImmer</span>(&#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Niki de Saint Phalle&#x27;</span>,<br>    <span class="hljs-attr">artwork</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Blue Nana&#x27;</span>,<br>      <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Hamburg&#x27;</span>,<br>      <span class="hljs-attr">image</span>: <span class="hljs-string">&#x27;https://i.imgur.com/Sd1AgUOm.jpg&#x27;</span>,<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">updatePerson</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      draft.<span class="hljs-property">name</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTitleChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">updatePerson</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      draft.<span class="hljs-property">artwork</span>.<span class="hljs-property">title</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCityChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">updatePerson</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      draft.<span class="hljs-property">artwork</span>.<span class="hljs-property">city</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleImageChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">updatePerson</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      draft.<span class="hljs-property">artwork</span>.<span class="hljs-property">image</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>    &#125;);<br>  &#125;<br>  ...<br>&#125; <br></code></pre></td></tr></table></div></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°å˜å¾—æ›´ç®€æ´äº†ã€‚ä½ å¯ä»¥éšæ„åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶ä½¿ç”¨ <code>useState</code> å’Œ <code>useImmer</code>ã€‚å¦‚æœä½ æƒ³è¦å†™å‡ºæ›´ç®€æ´çš„æ›´æ–°å¤„ç†å‡½æ•°ï¼ŒImmer ä¼šæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå°¤å…¶æ˜¯å½“ä½ çš„ state ä¸­æœ‰åµŒå¥—ï¼Œå¹¶ä¸”å¤åˆ¶å¯¹è±¡ä¼šå¸¦æ¥é‡å¤çš„ä»£ç æ—¶ã€‚</p><hr><p><mark>ä¸ºä»€ä¹ˆåœ¨ React ä¸­ä¸æ¨èç›´æ¥ä¿®æ”¹ stateï¼Ÿ</mark></p><ol><li>è°ƒè¯•ï¼šå¦‚æœä½ ä½¿ç”¨ <code>console.log</code> å¹¶ä¸”ä¸ç›´æ¥ä¿®æ”¹ stateï¼Œä½ ä¹‹å‰æ—¥å¿—ä¸­çš„ state çš„å€¼å°±ä¸ä¼šè¢«æ–°çš„ state å˜åŒ–æ‰€å½±å“ã€‚è¿™æ ·ä½ å°±å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´ state çš„å€¼å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–</li><li>ä¼˜åŒ–ï¼šReact å¸¸è§çš„ <a href="http://localhost:3000/reference/react/memo">ä¼˜åŒ–ç­–ç•¥</a> ä¾èµ–äºå¦‚æœä¹‹å‰çš„ props æˆ–è€… state çš„å€¼å’Œä¸‹ä¸€æ¬¡ç›¸åŒå°±è·³è¿‡æ¸²æŸ“ã€‚å¦‚æœä½ ä»æœªç›´æ¥ä¿®æ”¹ state ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å¾ˆå¿«çœ‹åˆ° state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœ <code>prevObj === obj</code>ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥è‚¯å®šè¿™ä¸ªå¯¹è±¡å†…éƒ¨å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</li><li>æ–°åŠŸèƒ½ï¼šæˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ React çš„æ–°åŠŸèƒ½ä¾èµ–äº state è¢« <a href="http://localhost:3000/learn/state-as-a-snapshot">åƒå¿«ç…§ä¸€æ ·çœ‹å¾…</a> çš„ç†å¿µã€‚å¦‚æœä½ ç›´æ¥ä¿®æ”¹ state çš„å†å²ç‰ˆæœ¬ï¼Œå¯èƒ½ä¼šå½±å“ä½ ä½¿ç”¨è¿™äº›æ–°åŠŸèƒ½ã€‚</li><li>éœ€æ±‚å˜æ›´ï¼šæœ‰äº›åº”ç”¨åŠŸèƒ½åœ¨ä¸å‡ºç°ä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹ä¼šæ›´å®¹æ˜“å®ç°ï¼Œæ¯”å¦‚å®ç°æ’¤é”€&#x2F;æ¢å¤ã€å±•ç¤ºä¿®æ”¹å†å²ï¼Œæˆ–æ˜¯å…è®¸ç”¨æˆ·æŠŠè¡¨å•é‡ç½®æˆæŸä¸ªä¹‹å‰çš„å€¼ã€‚è¿™æ˜¯å› ä¸ºä½ å¯ä»¥æŠŠ state ä¹‹å‰çš„æ‹·è´ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€‚æ—¶å¯¹å…¶è¿›è¡Œå†æ¬¡ä½¿ç”¨ã€‚å¦‚æœä¸€å¼€å§‹å°±ç”¨äº†ç›´æ¥ä¿®æ”¹ state çš„æ–¹å¼ï¼Œé‚£ä¹ˆåé¢è¦å®ç°è¿™æ ·çš„åŠŸèƒ½å°±ä¼šå˜å¾—éå¸¸å›°éš¾ã€‚</li><li>æ›´ç®€å•çš„å®ç°ï¼šReact å¹¶ä¸ä¾èµ–äº mutation ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œã€‚å®ƒä¸éœ€è¦åƒå¾ˆå¤šâ€œå“åº”å¼â€çš„è§£å†³æ–¹æ¡ˆä¸€æ ·å»åŠ«æŒå¯¹è±¡çš„å±æ€§ã€æ€»æ˜¯ç”¨ä»£ç†æŠŠå¯¹è±¡åŒ…è£¹èµ·æ¥ï¼Œæˆ–è€…åœ¨åˆå§‹åŒ–æ—¶åšå…¶ä»–å·¥ä½œã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ React å…è®¸ä½ æŠŠä»»ä½•å¯¹è±¡å­˜æ”¾åœ¨ state ä¸­â€”â€”ä¸ç®¡å¯¹è±¡æœ‰å¤šå¤§â€”â€”è€Œä¸ä¼šé€ æˆæœ‰ä»»ä½•é¢å¤–çš„æ€§èƒ½æˆ–æ­£ç¡®æ€§é—®é¢˜çš„åŸå› ã€‚</li></ol><p>åœ¨å®è·µä¸­ï¼Œä½ ç»å¸¸å¯ä»¥â€œä¾¥å¹¸â€ç›´æ¥ä¿®æ”¹ state è€Œä¸å‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä¸è¦è¿™æ ·åšï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ç§‰æ‰¿ç€è¿™ç§ç†å¿µå¼€å‘çš„ React æ–°åŠŸèƒ½ã€‚</p><h2 id="7-æ›´æ–°-state-ä¸­çš„æ•°ç»„"><a href="#7-æ›´æ–°-state-ä¸­çš„æ•°ç»„" class="headerlink" title="7.æ›´æ–° state ä¸­çš„æ•°ç»„"></a>7.æ›´æ–° state ä¸­çš„æ•°ç»„</h2><p>æ•°ç»„æ˜¯å¦å¤–ä¸€ç§å¯ä»¥å­˜å‚¨åœ¨ state ä¸­çš„ JavaScript å¯¹è±¡ï¼Œå®ƒè™½ç„¶æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å´åº”è¯¥è¢«è§†ä¸ºä¸å¯å˜ã€‚åŒå¯¹è±¡ä¸€æ ·ï¼Œå½“ä½ æƒ³è¦æ›´æ–°å­˜å‚¨äº state ä¸­çš„æ•°ç»„æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ˆæˆ–è€…åˆ›å»ºä¸€ä»½å·²æœ‰æ•°ç»„çš„æ‹·è´å€¼ï¼‰ï¼Œå¹¶ä½¿ç”¨æ–°æ•°ç»„è®¾ç½® stateã€‚</p><p><mark>åœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹æ›´æ–°æ•°ç»„</mark>ï¼šåœ¨ JavaScript ä¸­ï¼Œæ•°ç»„åªæ˜¯å¦ä¸€ç§å¯¹è±¡ã€‚<a href="http://localhost:3000/learn/updating-objects-in-state">åŒå¯¹è±¡ä¸€æ ·</a>ï¼Œä½ éœ€è¦å°† React state ä¸­çš„æ•°ç»„è§†ä¸ºåªè¯»çš„ã€‚è¿™æ„å‘³ç€ä½ ä¸åº”è¯¥ä½¿ç”¨ç±»ä¼¼äº <code>arr[0] = &#39;bird&#39;</code> è¿™æ ·çš„æ–¹å¼æ¥é‡æ–°åˆ†é…æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä¹Ÿä¸åº”è¯¥ä½¿ç”¨ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>push()</code> å’Œ <code>pop()</code>ã€‚</p><p>ç›¸åï¼Œæ¯æ¬¡è¦æ›´æ–°ä¸€ä¸ªæ•°ç»„æ—¶ï¼Œä½ éœ€è¦æŠŠä¸€ä¸ªæ–°çš„æ•°ç»„ä¼ å…¥ state çš„ setting æ–¹æ³•ä¸­ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨åƒ <code>filter()</code> å’Œ <code>map()</code> è¿™æ ·ä¸ä¼šç›´æ¥ä¿®æ”¹åŸå§‹å€¼çš„æ–¹æ³•ï¼Œä»åŸå§‹æ•°ç»„ç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚ç„¶åä½ å°±å¯ä»¥å°† state è®¾ç½®ä¸ºè¿™ä¸ªæ–°ç”Ÿæˆçš„æ•°ç»„ã€‚</p><p>å½“ä½ æ“ä½œ React state ä¸­çš„æ•°ç»„æ—¶ï¼Œä½ éœ€è¦é¿å…ä½¿ç”¨å·¦åˆ—çš„æ–¹æ³•ï¼Œè€Œé¦–é€‰å³åˆ—çš„æ–¹æ³•ï¼š</p><table><thead><tr><th></th><th>é¿å…ä½¿ç”¨ (ä¼šæ”¹å˜åŸå§‹æ•°ç»„)</th><th>æ¨èä½¿ç”¨ (ä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼‰</th></tr></thead><tbody><tr><td>æ·»åŠ å…ƒç´ </td><td><code>push</code>ï¼Œ<code>unshift</code></td><td><code>concat</code>ï¼Œ<code>[...arr]</code> å±•å¼€è¯­æ³•ï¼ˆ<a href="http://localhost:3000/learn/updating-arrays-in-state#adding-to-an-array">ä¾‹å­</a>ï¼‰</td></tr><tr><td>åˆ é™¤å…ƒç´ </td><td><code>pop</code>ï¼Œ<code>shift</code>ï¼Œ<code>splice</code></td><td><code>filter</code>ï¼Œ<code>slice</code>ï¼ˆ<a href="http://localhost:3000/learn/updating-arrays-in-state#removing-from-an-array">ä¾‹å­</a>ï¼‰</td></tr><tr><td>æ›¿æ¢å…ƒç´ </td><td><code>splice</code>ï¼Œ<code>arr[i] = ...</code> èµ‹å€¼</td><td><code>map</code>ï¼ˆ<a href="http://localhost:3000/learn/updating-arrays-in-state#replacing-items-in-an-array">ä¾‹å­</a>ï¼‰</td></tr><tr><td>æ’åº</td><td><code>reverse</code>ï¼Œ<code>sort</code></td><td>å…ˆå°†æ•°ç»„å¤åˆ¶ä¸€ä»½ï¼ˆ<a href="http://localhost:3000/learn/updating-arrays-in-state#making-other-changes-to-an-array">ä¾‹å­</a>ï¼‰</td></tr></tbody></table><p>æˆ–è€…ï¼Œä½ å¯ä»¥<a href="http://localhost:3000/learn/updating-arrays-in-state#write-concise-update-logic-with-immer">ä½¿ç”¨ Immer</a> ï¼Œè¿™æ ·ä½ ä¾¿å¯ä»¥ä½¿ç”¨è¡¨æ ¼ä¸­çš„æ‰€æœ‰æ–¹æ³•äº†ã€‚</p><ul><li><code>slice</code> è®©ä½ å¯ä»¥æ‹·è´æ•°ç»„æˆ–æ˜¯æ•°ç»„çš„ä¸€éƒ¨åˆ†ã€‚</li><li><code>splice</code> ä¼šç›´æ¥ä¿®æ”¹ åŸå§‹æ•°ç»„ï¼ˆæ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ ï¼‰ã€‚</li></ul><p>åœ¨ React ä¸­ï¼Œæ›´å¤šæƒ…å†µä¸‹ä½ ä¼šä½¿ç”¨ <code>slice</code>ï¼ˆæ²¡æœ‰ <code>p</code> ï¼ï¼‰ï¼Œå› ä¸ºä½ ä¸æƒ³æ”¹å˜ state ä¸­çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚</p><p><mark>å‘æ•°ç»„ä¸­æ·»åŠ å…ƒç´ </mark>ï¼š<code>push()</code> ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ï¼Œè€Œä½ ä¸å¸Œæœ›è¿™æ ·ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3qq16ilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3qq16ilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [artists, setArtists] = <span class="hljs-title function_">useState</span>([]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        artists.push(&#123;</span><br><span class="language-xml">          id: nextId++,</span><br><span class="language-xml">          name: name,</span><br><span class="language-xml">        &#125;);</span><br><span class="language-xml">      &#125;&#125;&gt;æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;artists.map(artist =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artist.id&#125;</span>&gt;</span>&#123;artist.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç›¸åï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ª æ–° æ•°ç»„ï¼Œå…¶åŒ…å«äº†åŸå§‹æ•°ç»„çš„æ‰€æœ‰å…ƒç´  ä»¥åŠ ä¸€ä¸ªåœ¨æœ«å°¾çš„æ–°å…ƒç´ ã€‚è¿™å¯ä»¥é€šè¿‡å¾ˆå¤šç§æ–¹æ³•å®ç°ï¼Œæœ€ç®€å•çš„ä¸€ç§å°±æ˜¯ä½¿ç”¨ <code>...</code> <a href="http://localhost:3000/a-javascript-refresher#array-spread">æ•°ç»„å±•å¼€</a> è¯­æ³•ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-pao1bhlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-pao1bhlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;<br>        setArtists( /* æ›¿æ¢ state   */ <br>  [ /*  æ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ªæ–°æ•°ç»„å®ç°çš„  */ <br>    ...artists, /* æ–°æ•°ç»„åŒ…å«åŸæ•°ç»„çš„æ‰€æœ‰å…ƒç´    */ <br>    &#123; id: nextId++, name: name &#125; /*  å¹¶åœ¨æœ«å°¾æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å…ƒç´   */ <br>  ]<br>);<br>    &#125;&#125;&gt;æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>æ•°ç»„å±•å¼€è¿ç®—ç¬¦è¿˜å…è®¸ä½ æŠŠæ–°æ·»åŠ çš„å…ƒç´ æ”¾åœ¨åŸå§‹çš„ <code>...artists</code> ä¹‹å‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g18nxulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g18nxulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setArtists</span>([<br>  &#123; <span class="hljs-attr">id</span>: nextId++, <span class="hljs-attr">name</span>: name &#125;,<br>  ...artists <span class="hljs-comment">/*  å°†åŸæ•°ç»„ä¸­çš„å…ƒç´ æ”¾åœ¨æœ«å°¾  */</span> <br>]);<br></code></pre></td></tr></table></div></figure><p>è¿™æ ·ä¸€æ¥ï¼Œå±•å¼€æ“ä½œå°±å¯ä»¥å®Œæˆ <code>push()</code> å’Œ <code>unshift()</code> çš„å·¥ä½œï¼Œå°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾å’Œå¼€å¤´ã€‚</p><hr><p> <mark>ä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ </mark>ï¼šä»æ•°ç»„ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†å®ƒè¿‡æ»¤å‡ºå»ã€‚æ¢å¥è¯è¯´ï¼Œä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªä¸åŒ…å«è¯¥å…ƒç´ çš„æ–°æ•°ç»„ã€‚è¿™å¯ä»¥é€šè¿‡ <code>filter</code> æ–¹æ³•å®ç°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w7bhu7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w7bhu7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> initialArtists = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Marta Colvin Andrade&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Lamidi Olonade Fakeye&#x27;</span>&#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Louise Nevelson&#x27;</span>&#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [artists, setArtists] = <span class="hljs-title function_">useState</span>(<br>    initialArtists<br>  );<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;artists.map(artist =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artist.id&#125;</span>&gt;</span></span><br><span class="language-xml">            &#123;artist.name&#125;&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">              setArtists(</span><br><span class="language-xml">                artists.filter(a =&gt;</span><br><span class="language-xml">                  a.id !== artist.id</span><br><span class="language-xml">                )</span><br><span class="language-xml">              );</span><br><span class="language-xml">            &#125;&#125;&gt;</span><br><span class="language-xml">              åˆ é™¤</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>artists.filter(s =&gt; s.id !== artist.id)</code> è¡¨ç¤ºâ€œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„ç”±é‚£äº› ID ä¸ <code>artists.id</code> ä¸åŒçš„ <code>artists</code> ç»„æˆâ€ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ª artist çš„â€œåˆ é™¤â€æŒ‰é’®ä¼šæŠŠ <em>é‚£ä¸€ä¸ª</em> artist ä»åŸå§‹æ•°ç»„ä¸­è¿‡æ»¤æ‰ï¼Œå¹¶ä½¿ç”¨è¿‡æ»¤åçš„æ•°ç»„å†æ¬¡è¿›è¡Œæ¸²æŸ“ã€‚æ³¨æ„ï¼Œ<code>filter</code> å¹¶ä¸ä¼šæ”¹å˜åŸå§‹æ•°ç»„ã€‚</p><hr><p><mark>è½¬æ¢æ•°ç»„</mark>ï¼šå¦‚æœä½ æƒ³æ”¹å˜æ•°ç»„ä¸­çš„æŸäº›æˆ–å…¨éƒ¨å…ƒç´ ï¼Œä½ å¯ä»¥ç”¨ <code>map()</code> åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚ä½ ä¼ å…¥ <code>map</code> çš„å‡½æ•°å†³å®šäº†è¦æ ¹æ®æ¯ä¸ªå…ƒç´ çš„å€¼æˆ–ç´¢å¼•ï¼ˆæˆ–äºŒè€…éƒ½è¦ï¼‰å¯¹å…ƒç´ åšä½•å¤„ç†ã€‚</p><p>ä¸€ä¸ªæ•°ç»„è®°å½•äº†ä¸¤ä¸ªåœ†å½¢å’Œä¸€ä¸ªæ­£æ–¹å½¢çš„åæ ‡ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä»…æœ‰ä¸¤ä¸ªåœ†å½¢ä¼šå‘ä¸‹ç§»åŠ¨ 100 åƒç´ ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨ <code>map()</code> ç”Ÿæˆä¸€ä¸ªæ–°æ•°ç»„å®ç°çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ze45hulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ze45hulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> initialShapes = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;circle&#x27;</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;square&#x27;</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;circle&#x27;</span>, <span class="hljs-attr">x</span>: <span class="hljs-number">250</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ShapeEditor</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [shapes, setShapes] = <span class="hljs-title function_">useState</span>(<br>    initialShapes<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> nextShapes = shapes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">shape</span> =&gt;</span> &#123;<br>      <span class="hljs-comment">/*  ä¸ä½œæ”¹å˜  */</span><br>      <span class="hljs-keyword">if</span> (shape.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;square&#x27;</span>) &#123;<br>        <span class="hljs-keyword">return</span> shape;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">/*  è¿”å›ä¸€ä¸ªæ–°çš„åœ†å½¢ï¼Œä½ç½®åœ¨ä¸‹æ–¹ 50px å¤„  */</span> <br>        <span class="hljs-keyword">return</span> &#123;<br>          ...shape,<br>          <span class="hljs-attr">y</span>: shape.<span class="hljs-property">y</span> + <span class="hljs-number">50</span>,<br>        &#125;;<br>      &#125;<br>    &#125;);<br>    <span class="hljs-comment">/*  ä½¿ç”¨æ–°çš„æ•°ç»„è¿›è¡Œé‡æ¸²æŸ“  */</span> <br>    <span class="hljs-title function_">setShapes</span>(nextShapes);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        æ‰€æœ‰åœ†å½¢å‘ä¸‹ç§»åŠ¨ï¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;shapes.map(shape =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;shape.id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">background:</span> &#x27;<span class="hljs-attr">purple</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">position:</span> &#x27;<span class="hljs-attr">absolute</span>&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">left:</span> <span class="hljs-attr">shape.x</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">top:</span> <span class="hljs-attr">shape.y</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">borderRadius:</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">shape.type</span> === <span class="hljs-string">&#x27;circle&#x27;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              ? &#x27;<span class="hljs-attr">50</span>%&#x27; <span class="hljs-attr">:</span> &#x27;&#x27;,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">width:</span> <span class="hljs-attr">20</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">height:</span> <span class="hljs-attr">20</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&#125; /&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>&#x3D;&#x3D;æ›¿æ¢æ•°ç»„ä¸­çš„å…ƒç´ &#x3D;&#x3D;ï¼šæƒ³è¦æ›¿æ¢æ•°ç»„ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ˜¯éå¸¸å¸¸è§çš„ã€‚ç±»ä¼¼ <code>arr[0] = &#39;bird&#39;</code> è¿™æ ·çš„èµ‹å€¼è¯­å¥ä¼šç›´æ¥ä¿®æ”¹åŸå§‹æ•°ç»„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿåº”è¯¥ä½¿ç”¨ <code>map</code>ã€‚</p><p>è¦æ›¿æ¢ä¸€ä¸ªå…ƒç´ ï¼Œè¯·ä½¿ç”¨ <code>map</code> åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ã€‚åœ¨ä½ çš„ <code>map</code> å›è°ƒé‡Œï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…ƒç´ çš„ç´¢å¼•ã€‚ä½¿ç”¨ç´¢å¼•æ¥åˆ¤æ–­æœ€ç»ˆæ˜¯è¿”å›åŸå§‹çš„å…ƒç´ ï¼ˆå³å›è°ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰è¿˜æ˜¯æ›¿æ¢æˆå…¶ä»–å€¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jwb8dalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jwb8dalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> initialCounters = [<br>  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CounterList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [counters, setCounters] = <span class="hljs-title function_">useState</span>(<br>    initialCounters<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleIncrementClick</span>(<span class="hljs-params">index</span>) &#123;<br>    <span class="hljs-keyword">const</span> nextCounters = counters.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">c, i</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (i === index) &#123;<br>        <span class="hljs-comment">/*  é€’å¢è¢«ç‚¹å‡»çš„è®¡æ•°å™¨æ•°å€¼  */</span> <br>        <span class="hljs-keyword">return</span> c + <span class="hljs-number">1</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">/*  å…¶ä½™éƒ¨åˆ†ä¸å‘ç”Ÿå˜åŒ–  */</span> <br>        <span class="hljs-keyword">return</span> c;<br>      &#125;<br>    &#125;);<br>    <span class="hljs-title function_">setCounters</span>(nextCounters);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;counters.map((counter, i) =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;i&#125;</span>&gt;</span></span><br><span class="language-xml">          &#123;counter&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">            handleIncrementClick(i);</span><br><span class="language-xml">          &#125;&#125;&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>&#x3D;&#x3D;å‘æ•°ç»„ä¸­æ’å…¥å…ƒç´ &#x3D;&#x3D;ï¼šæœ‰æ—¶ï¼Œä½ ä¹Ÿè®¸æƒ³å‘æ•°ç»„ç‰¹å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªä½ç½®æ—¢ä¸åœ¨æ•°ç»„å¼€å¤´ï¼Œä¹Ÿä¸åœ¨æœ«å°¾ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥å°†æ•°ç»„å±•å¼€è¿ç®—ç¬¦ <code>...</code> å’Œ <code>slice()</code> æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚<code>slice()</code> æ–¹æ³•è®©ä½ ä»æ•°ç»„ä¸­åˆ‡å‡ºâ€œä¸€ç‰‡â€ã€‚ä¸ºäº†å°†å…ƒç´ æ’å…¥æ•°ç»„ï¼Œä½ éœ€è¦å…ˆå±•å¼€åŸæ•°ç»„åœ¨æ’å…¥ç‚¹ä¹‹å‰çš„åˆ‡ç‰‡ï¼Œç„¶åæ’å…¥æ–°å…ƒç´ ï¼Œæœ€åå±•å¼€åŸæ•°ç»„ä¸­å‰©ä¸‹çš„éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ’å…¥æŒ‰é’®æ€»æ˜¯ä¼šå°†å…ƒç´ æ’å…¥åˆ°æ•°ç»„ä¸­ç´¢å¼•ä¸º <code>1</code> çš„ä½ç½®ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-upywrflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-upywrflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialArtists = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Marta Colvin Andrade&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Lamidi Olonade Fakeye&#x27;</span>&#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Louise Nevelson&#x27;</span>&#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [artists, setArtists] = <span class="hljs-title function_">useState</span>(<br>    initialArtists<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> insertAt = <span class="hljs-number">1</span>; <span class="hljs-comment">/*  å¯èƒ½æ˜¯ä»»ä½•ç´¢å¼•  */</span> <br>    <span class="hljs-keyword">const</span> nextArtists = [<br>      <span class="hljs-comment">/* æ’å…¥ç‚¹ä¹‹å‰çš„å…ƒç´ ï¼š   */</span> <br>      ...artists.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, insertAt),<br>      <span class="hljs-comment">/* æ–°çš„å…ƒç´ ï¼š  */</span> <br>      &#123; <span class="hljs-attr">id</span>: nextId++, <span class="hljs-attr">name</span>: name &#125;,<br>      <span class="hljs-comment">/* æ’å…¥ç‚¹ä¹‹åçš„å…ƒç´ ï¼š  */</span> <br>      ...artists.<span class="hljs-title function_">slice</span>(insertAt)<br>    ];<br>    <span class="hljs-title function_">setArtists</span>(nextArtists);<br>    <span class="hljs-title function_">setName</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æŒ¯å¥‹äººå¿ƒçš„é›•å¡‘å®¶ä»¬ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;name&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setName(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        æ’å…¥</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;artists.map(artist =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artist.id&#125;</span>&gt;</span>&#123;artist.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¯èƒ½æƒ³ç¿»è½¬æ•°ç»„ï¼Œæˆ–æ˜¯å¯¹æ•°ç»„æ’åºã€‚è€Œ JavaScript ä¸­çš„ <code>reverse()</code> å’Œ <code>sort()</code> æ–¹æ³•ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œæ‰€ä»¥ä½ æ— æ³•ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚</p><p>ç„¶è€Œï¼Œä½ å¯ä»¥å…ˆæ‹·è´è¿™ä¸ªæ•°ç»„ï¼Œå†æ”¹å˜è¿™ä¸ªæ‹·è´åçš„å€¼ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qsde15lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qsde15lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialList = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Big Bellies&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Lunar Landscape&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Terracotta Army&#x27;</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [list, setList] = <span class="hljs-title function_">useState</span>(initialList);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> nextList = [...list];<br>    nextList.<span class="hljs-title function_">reverse</span>();<br>    <span class="hljs-title function_">setList</span>(nextList);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        ç¿»è½¬</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;list.map(artwork =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artwork.id&#125;</span>&gt;</span>&#123;artwork.title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å³ä½¿ä½ æ‹·è´äº†æ•°ç»„ï¼Œä½ è¿˜æ˜¯ä¸èƒ½ç›´æ¥ä¿®æ”¹å…¶å†…éƒ¨çš„å…ƒç´ ã€‚è¿™æ˜¯å› ä¸º<mark>æ•°ç»„çš„æ‹·è´æ˜¯æµ…æ‹·è´â€”â€”æ–°çš„æ•°ç»„ä¸­ä¾ç„¶ä¿ç•™äº†ä¸åŸå§‹æ•°ç»„ç›¸åŒçš„å…ƒç´ </mark>ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä¿®æ”¹äº†æ‹·è´æ•°ç»„å†…éƒ¨çš„æŸä¸ªå¯¹è±¡ï¼Œå…¶å®ä½ æ­£åœ¨ç›´æ¥ä¿®æ”¹å½“å‰çš„ stateã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåƒä¸‹é¢çš„ä»£ç å°±ä¼šå¸¦æ¥é—®é¢˜ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-z5c0hwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-z5c0hwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> nextList = [...list];<br>nextList[<span class="hljs-number">0</span>].<span class="hljs-property">seen</span> = <span class="hljs-literal">true</span>;  <span class="hljs-comment">/* é—®é¢˜ï¼šç›´æ¥ä¿®æ”¹äº† list[0] çš„å€¼   */</span><br><span class="hljs-title function_">setList</span>(nextList);<br></code></pre></td></tr></table></div></figure><p>è™½ç„¶ <code>nextList</code> å’Œ <code>list</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ï¼Œ<code>nextList[0]</code> å’Œ <code>list[0]</code> <mark>å´æŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡</mark>ã€‚å› æ­¤ï¼Œé€šè¿‡æ”¹å˜ <code>nextList[0].seen</code>ï¼Œ<code>list[0].seen</code> çš„å€¼ä¹Ÿè¢«æ”¹å˜äº†ã€‚è¿™æ˜¯ä¸€ç§ state çš„ mutation æ“ä½œï¼Œä½ åº”è¯¥é¿å…è¿™ä¹ˆåšï¼ä½ å¯ä»¥ç”¨ç±»ä¼¼äº <a href="http://localhost:3000/learn/updating-objects-in-state#updating-a-nested-object">æ›´æ–°åµŒå¥—çš„ JavaScript å¯¹è±¡</a> çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”<mark>æ‹·è´æƒ³è¦ä¿®æ”¹çš„ç‰¹å®šå…ƒç´ ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å®ƒ</mark>ã€‚ä¸‹é¢æ˜¯å…·ä½“çš„æ“ä½œã€‚</p><hr><p><mark>æ›´æ–°æ•°ç»„å†…éƒ¨çš„å¯¹è±¡</mark>ï¼šå¯¹è±¡å¹¶ä¸æ˜¯ çœŸçš„ ä½äºæ•°ç»„â€œå†…éƒ¨â€ã€‚å¯èƒ½ä»–ä»¬åœ¨ä»£ç ä¸­çœ‹èµ·æ¥åƒæ˜¯åœ¨æ•°ç»„â€œå†…éƒ¨â€ï¼Œä½†å…¶å®<mark>æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯è¿™ä¸ªæ•°ç»„â€œæŒ‡å‘â€çš„ä¸€ä¸ªå­˜å‚¨äºå…¶å®ƒä½ç½®çš„å€¼</mark>ã€‚è¿™å°±æ˜¯å½“ä½ åœ¨å¤„ç†ç±»ä¼¼ <code>list[0]</code> è¿™æ ·çš„åµŒå¥—å­—æ®µæ—¶éœ€è¦æ ¼å¤–å°å¿ƒçš„åŸå› ã€‚å…¶ä»–äººçš„è‰ºæœ¯å“æ¸…å•å¯èƒ½æŒ‡å‘äº†æ•°ç»„çš„åŒä¸€ä¸ªå…ƒç´ ï¼</p><p><mark>å½“ä½ æ›´æ–°ä¸€ä¸ªåµŒå¥—çš„ state æ—¶ï¼Œä½ éœ€è¦ä»æƒ³è¦æ›´æ–°çš„åœ°æ–¹åˆ›å»ºæ‹·è´å€¼ï¼Œä¸€ç›´è¿™æ ·ï¼Œç›´åˆ°é¡¶å±‚ã€‚</mark> </p><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªä¸åŒçš„è‰ºæœ¯å“æ¸…å•æœ‰ç€ç›¸åŒçš„åˆå§‹ stateã€‚ä»–ä»¬æœ¬åº”è¯¥äº’ä¸å½±å“ï¼Œä½†æ˜¯å› ä¸ºä¸€æ¬¡ mutationï¼Œä»–ä»¬çš„ state è¢«æ„å¤–åœ°å…±äº«äº†ï¼Œå‹¾é€‰ä¸€ä¸ªæ¸…å•ä¸­çš„äº‹é¡¹ä¼šå½±å“å¦å¤–ä¸€ä¸ªæ¸…å•ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-94xeeplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-94xeeplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialList = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Big Bellies&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Lunar Landscape&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Terracotta Army&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">true</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BucketList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [myList, setMyList] = <span class="hljs-title function_">useState</span>(initialList);<br>  <span class="hljs-keyword">const</span> [yourList, setYourList] = <span class="hljs-title function_">useState</span>(<br>    initialList<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleToggleMyList</span>(<span class="hljs-params">artworkId, nextSeen</span>) &#123;<br>    <span class="hljs-keyword">const</span> myNextList = [...myList];<br>    <span class="hljs-keyword">const</span> artwork = myNextList.<span class="hljs-title function_">find</span>(<br>      <span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">id</span> === artworkId<br>    );<br>    artwork.<span class="hljs-property">seen</span> = nextSeen;<br>    <span class="hljs-title function_">setMyList</span>(myNextList);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleToggleYourList</span>(<span class="hljs-params">artworkId, nextSeen</span>) &#123;<br>    <span class="hljs-keyword">const</span> yourNextList = [...yourList];<br>    <span class="hljs-keyword">const</span> artwork = yourNextList.<span class="hljs-title function_">find</span>(<br>      <span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">id</span> === artworkId<br>    );<br>    artwork.<span class="hljs-property">seen</span> = nextSeen;<br>    <span class="hljs-title function_">setYourList</span>(yourNextList);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è‰ºæœ¯æ„¿æœ›æ¸…å•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æˆ‘æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ItemList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">artworks</span>=<span class="hljs-string">&#123;myList&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onToggle</span>=<span class="hljs-string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä½ æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ItemList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">artworks</span>=<span class="hljs-string">&#123;yourList&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onToggle</span>=<span class="hljs-string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ItemList</span>(<span class="hljs-params">&#123; artworks, onToggle &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;artworks.map(artwork =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artwork.id&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;artwork.seen&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">                onToggle(</span><br><span class="language-xml">                  artwork.id,</span><br><span class="language-xml">                  e.target.checked</span><br><span class="language-xml">                );</span><br><span class="language-xml">              &#125;&#125;</span><br><span class="language-xml">            /&gt;</span><br><span class="language-xml">            &#123;artwork.title&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è™½ç„¶ <code>myNextList</code> è¿™ä¸ªæ•°ç»„æ˜¯æ–°çš„ï¼Œä½†æ˜¯å…¶å†…éƒ¨çš„å…ƒç´ æœ¬èº«ä¸åŸæ•°ç»„ <code>myList</code> æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œä¿®æ”¹ <code>artwork.seen</code>ï¼Œå…¶å®æ˜¯åœ¨ä¿®æ”¹åŸå§‹çš„ artwork å¯¹è±¡ã€‚è€Œè¿™ä¸ª artwork å¯¹è±¡ä¹Ÿè¢« <code>yourList</code> ä½¿ç”¨ï¼Œè¿™æ ·å°±å¸¦æ¥äº† bugã€‚è¿™æ ·çš„ bug å¯èƒ½éš¾ä»¥æƒ³åˆ°ï¼Œä½†å¥½åœ¨å¦‚æœä½ é¿å…ç›´æ¥ä¿®æ”¹ stateï¼Œå®ƒä»¬å°±ä¼šæ¶ˆå¤±ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1u527xlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1u527xlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> myNextList = [...myList];<br><span class="hljs-keyword">const</span> artwork = myNextList.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">id</span> === artworkId);<br>artwork.<span class="hljs-property">seen</span> = nextSeen; <span class="hljs-comment">/*  é—®é¢˜ï¼šç›´æ¥ä¿®æ”¹äº†å·²æœ‰çš„å…ƒç´   */</span> <br><span class="hljs-title function_">setMyList</span>(myNextList);<br></code></pre></td></tr></table></div></figure><p>å¯ä»¥ä½¿ç”¨ <code>map</code> åœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹å°†ä¸€ä¸ªæ—§çš„å…ƒç´ æ›¿æ¢æˆæ›´æ–°çš„ç‰ˆæœ¬ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-78ntiklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-78ntiklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setMyList</span>(myList.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">artwork</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (artwork.<span class="hljs-property">id</span> === artworkId) &#123;<br>    <span class="hljs-comment">/*  åˆ›å»ºåŒ…å«å˜æ›´çš„æ–°å¯¹è±¡  */</span> <br>    <span class="hljs-keyword">return</span> &#123; ...artwork, <span class="hljs-attr">seen</span>: nextSeen &#125;;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">/*  æ²¡æœ‰å˜æ›´  */</span> <br>    <span class="hljs-keyword">return</span> artwork;<br>  &#125;<br>&#125;));<br></code></pre></td></tr></table></div></figure><p>æ­¤å¤„çš„ <code>...</code> æ˜¯ä¸€ä¸ªå¯¹è±¡å±•å¼€è¯­æ³•ï¼Œè¢«ç”¨æ¥<a href="http://localhost:3000/learn/updating-objects-in-state#copying-objects-with-the-spread-syntax">åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ‹·è´</a>.</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ²¡æœ‰ä»»ä½•ç°æœ‰çš„ state ä¸­çš„å…ƒç´ ä¼šè¢«æ”¹å˜ï¼Œbug ä¹Ÿå°±è¢«ä¿®å¤äº†ã€‚</p><p>é€šå¸¸æ¥è®²ï¼Œä½ åº”è¯¥åªç›´æ¥ä¿®æ”¹ä½ åˆšåˆšåˆ›å»ºçš„å¯¹è±¡ã€‚å¦‚æœä½ æ­£åœ¨æ’å…¥ä¸€ä¸ªæ–°çš„ artworkï¼Œä½ å¯ä»¥ä¿®æ”¹å®ƒï¼Œä½†æ˜¯å¦‚æœä½ æƒ³è¦æ”¹å˜çš„æ˜¯ state ä¸­å·²ç»å­˜åœ¨çš„ä¸œè¥¿ï¼Œä½ å°±éœ€è¦å…ˆæ‹·è´ä¸€ä»½äº†ã€‚</p><p><mark>ä½¿ç”¨ Immer ç¼–å†™ç®€æ´çš„æ›´æ–°é€»è¾‘</mark>ï¼šåœ¨æ²¡æœ‰ mutation çš„å‰æä¸‹æ›´æ–°åµŒå¥—æ•°ç»„å¯èƒ½ä¼šå˜å¾—æœ‰ç‚¹é‡å¤ã€‚<a href="http://localhost:3000/learn/updating-objects-in-state#write-concise-update-logic-with-immer">å°±åƒå¯¹å¯¹è±¡ä¸€æ ·</a>:</p><ul><li>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ä¸éœ€è¦æ›´æ–°å¤„äºéå¸¸æ·±å±‚çº§çš„ state ã€‚å¦‚æœä½ æœ‰æ­¤ç±»éœ€æ±‚ï¼Œä½ æˆ–è®¸éœ€è¦<a href="http://localhost:3000/learn/choosing-the-state-structure#avoid-deeply-nested-state">è°ƒæ•´ä¸€ä¸‹æ•°æ®çš„ç»“æ„</a>ï¼Œè®©æ•°æ®å˜å¾—æ‰å¹³ä¸€äº›ã€‚</li><li>å¦‚æœä½ ä¸æƒ³æ”¹å˜ state çš„æ•°æ®ç»“æ„ï¼Œä½ ä¹Ÿè®¸ä¼šæ›´å–œæ¬¢ä½¿ç”¨ <a href="https://github.com/immerjs/use-immer">Immer</a> ï¼Œå®ƒè®©ä½ å¯ä»¥ç»§ç»­ä½¿ç”¨æ–¹ä¾¿çš„ï¼Œä½†ä¼šç›´æ¥ä¿®æ”¹åŸå€¼çš„è¯­æ³•ï¼Œå¹¶è´Ÿè´£ä¸ºä½ ç”Ÿæˆæ‹·è´å€¼ã€‚</li></ul><p>ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨ Immer æ¥é‡å†™çš„è‰ºæœ¯æ„¿æœ›æ¸…å•çš„ä¾‹å­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kz4sj7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kz4sj7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; useImmer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;use-immer&#x27;</span>;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialList = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Big Bellies&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Lunar Landscape&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Terracotta Army&#x27;</span>, <span class="hljs-attr">seen</span>: <span class="hljs-literal">true</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BucketList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [myList, updateMyList] = <span class="hljs-title function_">useImmer</span>(<br>    initialList<br>  );<br>  <span class="hljs-keyword">const</span> [yourList, updateYourList] = <span class="hljs-title function_">useImmer</span>(<br>    initialList<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleToggleMyList</span>(<span class="hljs-params">id, nextSeen</span>) &#123;<br>    <span class="hljs-title function_">updateMyList</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> artwork = draft.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span><br>        a.<span class="hljs-property">id</span> === id<br>      );<br>      artwork.<span class="hljs-property">seen</span> = nextSeen;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleToggleYourList</span>(<span class="hljs-params">artworkId, nextSeen</span>) &#123;<br>    <span class="hljs-title function_">updateYourList</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> artwork = draft.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span><br>        a.<span class="hljs-property">id</span> === artworkId<br>      );<br>      artwork.<span class="hljs-property">seen</span> = nextSeen;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è‰ºæœ¯æ„¿æœ›æ¸…å•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æˆ‘æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ItemList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">artworks</span>=<span class="hljs-string">&#123;myList&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onToggle</span>=<span class="hljs-string">&#123;handleToggleMyList&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>ä½ æƒ³çœ‹çš„è‰ºæœ¯æ¸…å•ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ItemList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">artworks</span>=<span class="hljs-string">&#123;yourList&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onToggle</span>=<span class="hljs-string">&#123;handleToggleYourList&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ItemList</span>(<span class="hljs-params">&#123; artworks, onToggle &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;artworks.map(artwork =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;artwork.id&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;artwork.seen&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">                onToggle(</span><br><span class="language-xml">                  artwork.id,</span><br><span class="language-xml">                  e.target.checked</span><br><span class="language-xml">                );</span><br><span class="language-xml">              &#125;&#125;</span><br><span class="language-xml">            /&gt;</span><br><span class="language-xml">            &#123;artwork.title&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¯·æ³¨æ„å½“ä½¿ç”¨ Immer æ—¶ï¼Œç±»ä¼¼ <code>artwork.seen = nextSeen</code> è¿™ç§ä¼šäº§ç”Ÿ mutation çš„è¯­æ³•ä¸ä¼šå†æœ‰ä»»ä½•é—®é¢˜äº†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-u2te2nlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-u2te2nlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">updateMyTodos</span>(<span class="hljs-function"><span class="hljs-params">draft</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> artwork = draft.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> a.<span class="hljs-property">id</span> === artworkId);<br>  artwork.<span class="hljs-property">seen</span> = nextSeen;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å› ä¸ºä½ å¹¶ä¸æ˜¯åœ¨ç›´æ¥ä¿®æ”¹åŸå§‹çš„ stateï¼Œè€Œæ˜¯åœ¨ä¿®æ”¹ Immer æä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ <code>draft</code> å¯¹è±¡ã€‚åŒç†ï¼Œä½ ä¹Ÿå¯ä»¥ä¸º <code>draft</code> çš„å†…å®¹ä½¿ç”¨ <code>push()</code> å’Œ <code>pop()</code> è¿™äº›ä¼šç›´æ¥ä¿®æ”¹åŸå€¼çš„æ–¹æ³•ã€‚</p><p>åœ¨å¹•åï¼ŒImmer æ€»æ˜¯ä¼šæ ¹æ®ä½ å¯¹ <code>draft</code> çš„ä¿®æ”¹æ¥ä»å¤´å¼€å§‹æ„å»ºä¸‹ä¸€ä¸ª stateã€‚è¿™ä½¿å¾—ä½ çš„äº‹ä»¶å¤„ç†ç¨‹åºéå¸¸çš„ç®€æ´ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šç›´æ¥ä¿®æ”¹ stateã€‚</p><h1 id="äº”-çŠ¶æ€ç®¡ç†"><a href="#äº”-çŠ¶æ€ç®¡ç†" class="headerlink" title="äº”.çŠ¶æ€ç®¡ç†"></a>äº”.çŠ¶æ€ç®¡ç†</h1><h2 id="1-ç”¨çŠ¶æ€å“åº”è¾“å…¥"><a href="#1-ç”¨çŠ¶æ€å“åº”è¾“å…¥" class="headerlink" title="1.ç”¨çŠ¶æ€å“åº”è¾“å…¥"></a>1.ç”¨çŠ¶æ€å“åº”è¾“å…¥</h2><p>React æ§åˆ¶ UI çš„æ–¹å¼æ˜¯å£°æ˜å¼çš„ã€‚ä½ ä¸å¿…ç›´æ¥æ§åˆ¶ UI çš„å„ä¸ªéƒ¨åˆ†ï¼Œåªéœ€è¦å£°æ˜ç»„ä»¶å¯ä»¥å¤„äºçš„ä¸åŒçŠ¶æ€ï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„è¾“å…¥åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚ä½¿ç”¨ Reactï¼Œä½ ä¸ç”¨ç›´æ¥ä»ä»£ç å±‚é¢ä¿®æ”¹ UIã€‚ä¾‹å¦‚ï¼Œä¸ç”¨ç¼–å†™è¯¸å¦‚â€œç¦ç”¨æŒ‰é’®â€ã€â€œå¯ç”¨æŒ‰é’®â€ã€â€œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯â€ç­‰å‘½ä»¤ã€‚ç›¸åï¼Œä½ åªéœ€è¦æè¿°ç»„ä»¶åœ¨ä¸åŒçŠ¶æ€ï¼ˆâ€œåˆå§‹çŠ¶æ€â€ã€â€œè¾“å…¥çŠ¶æ€â€ã€â€œæˆåŠŸçŠ¶æ€â€ï¼‰ä¸‹å¸Œæœ›å±•ç°çš„ UIï¼Œç„¶åæ ¹æ®ç”¨æˆ·è¾“å…¥è§¦å‘çŠ¶æ€æ›´æ”¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ React ç¼–å†™çš„åé¦ˆè¡¨å•ã€‚è¯·æ³¨æ„çœ‹å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨ <code>status</code> è¿™ä¸ªçŠ¶æ€å˜é‡æ¥å†³å®šå¯ç”¨æˆ–ç¦ç”¨æäº¤æŒ‰é’®ï¼Œä»¥åŠæ˜¯å¦æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯çš„ã€‚</p><p>æƒ³è±¡ä¸€ä¸ªå…è®¸ç”¨æˆ·æäº¤ä¸€ä¸ªç­”æ¡ˆçš„è¡¨å•ï¼š</p><ul><li>å½“ä½ å‘è¡¨å•è¾“å…¥æ•°æ®æ—¶ï¼Œâ€œæäº¤â€æŒ‰é’®ä¼šéšä¹‹å˜æˆå¯ç”¨çŠ¶æ€</li><li>å½“ä½ ç‚¹å‡»â€œæäº¤â€åï¼Œè¡¨å•å’Œæäº¤æŒ‰é’®éƒ½ä¼šéšä¹‹å˜æˆä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šåŠ è½½åŠ¨ç”»ä¼šéšä¹‹å‡ºç°</li><li>å¦‚æœç½‘ç»œè¯·æ±‚æˆåŠŸï¼Œè¡¨å•ä¼šéšä¹‹éšè—ï¼ŒåŒæ—¶â€œæäº¤æˆåŠŸâ€çš„ä¿¡æ¯ä¼šéšä¹‹å‡ºç°</li><li>å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ä¼šéšä¹‹å‡ºç°ï¼ŒåŒæ—¶è¡¨å•åˆå˜ä¸ºå¯ç”¨çŠ¶æ€</li></ul><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cl2hvulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cl2hvulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [answer, setAnswer] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;typing&#x27;</span>);<br><br>  <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&#x27;success&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç­”å¯¹äº†ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;submitting&#x27;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">await</span> <span class="hljs-title function_">submitForm</span>(answer);<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;success&#x27;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;typing&#x27;</span>);<br>      <span class="hljs-title function_">setError</span>(err);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTextareaChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setAnswer</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>åŸå¸‚æµ‹éªŒ<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        å“ªä¸ªåŸå¸‚æœ‰æŠŠç©ºæ°”å˜æˆé¥®ç”¨æ°´çš„å¹¿å‘Šç‰Œï¼Ÿ</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;answer&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleTextareaChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">answer.length</span> === <span class="hljs-string">0</span> ||</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&gt;</span></span><br><span class="language-xml">          æäº¤</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        &#123;error !== null &amp;&amp;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Error&quot;</span>&gt;</span></span><br><span class="language-xml">            &#123;error.message&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        &#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">submitForm</span>(<span class="hljs-params">answer</span>) &#123;<br>  <span class="hljs-comment">// æ¨¡æ‹Ÿæ¥å£è¯·æ±‚</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">let</span> shouldError = answer.<span class="hljs-title function_">toLowerCase</span>() !== <span class="hljs-string">&#x27;lima&#x27;</span><br>      <span class="hljs-keyword">if</span> (shouldError) &#123;<br>        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;çŒœçš„ä¸é”™ï¼Œä½†ç­”æ¡ˆä¸å¯¹ã€‚å†è¯•è¯•çœ‹å§ï¼&#x27;</span>));<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">resolve</span>();<br>      &#125;<br>    &#125;, <span class="hljs-number">1500</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p><mark>å£°æ˜å¼åœ°è€ƒè™‘ UI çš„è¿‡ç¨‹</mark>ï¼š</p><ol><li><p><mark>å®šä½ç»„ä»¶ä¸­ä¸åŒçš„è§†å›¾çŠ¶æ€</mark>ï¼šéœ€è¦å»å¯è§†åŒ– UI ç•Œé¢ä¸­ç”¨æˆ·å¯èƒ½çœ‹åˆ°çš„æ‰€æœ‰ä¸åŒçš„â€œçŠ¶æ€â€ï¼š</p><ul><li>æ— æ•°æ®ï¼šè¡¨å•æœ‰ä¸€ä¸ªä¸å¯ç”¨çŠ¶æ€çš„â€œæäº¤â€æŒ‰é’®ã€‚</li><li>è¾“å…¥ä¸­ï¼šè¡¨å•æœ‰ä¸€ä¸ªå¯ç”¨çŠ¶æ€çš„â€œæäº¤â€æŒ‰é’®ã€‚</li><li>æäº¤ä¸­ï¼šè¡¨å•å®Œå…¨å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼ŒåŠ è½½åŠ¨ç”»å‡ºç°ã€‚</li><li>æˆåŠŸæ—¶ï¼šæ˜¾ç¤ºâ€œæˆåŠŸâ€çš„æ¶ˆæ¯è€Œéè¡¨å•ã€‚</li><li>é”™è¯¯æ—¶ï¼šä¸è¾“å…¥çŠ¶æ€ç±»ä¼¼ï¼Œä½†ä¼šå¤šé”™è¯¯çš„æ¶ˆæ¯ã€‚</li></ul><p>å¦‚æœä¸€ä¸ªç»„ä»¶æœ‰å¤šä¸ªè§†å›¾çŠ¶æ€ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†å®ƒä»¬å±•ç¤ºåœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-va46c9lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-va46c9lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Form</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Form.js&#x27;</span>;<br><br><span class="hljs-keyword">let</span> statuses = [<br>  <span class="hljs-string">&#x27;empty&#x27;</span>,<br>  <span class="hljs-string">&#x27;typing&#x27;</span>,<br>  <span class="hljs-string">&#x27;submitting&#x27;</span>,<br>  <span class="hljs-string">&#x27;success&#x27;</span>,<br>  <span class="hljs-string">&#x27;error&#x27;</span>,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      &#123;statuses.map(status =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;status&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>Form (&#123;status&#125;):<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">status</span>=<span class="hljs-string">&#123;status&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Form.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3ts94jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3ts94jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params">&#123; status &#125;</span>) &#123;<br>  <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&#x27;success&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>That&#x27;s right!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &#125; /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;empty&#x27;</span> ||</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &#125;&gt;</span></span><br><span class="language-xml">        Submit</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;status === &#x27;error&#x27; &amp;&amp;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Error&quot;</span>&gt;</span></span><br><span class="language-xml">          Good guess but a wrong answer. Try again!</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>ç¡®å®šæ˜¯ä»€ä¹ˆè§¦å‘äº†è¿™äº›çŠ¶æ€çš„æ”¹å˜</mark>ï¼šå¯ä»¥è§¦å‘ state çš„æ›´æ–°æ¥å“åº”ä¸¤ç§è¾“å…¥ï¼š</p><ul><li>äººä¸ºè¾“å…¥ã€‚æ¯”å¦‚ç‚¹å‡»æŒ‰é’®ã€åœ¨è¡¨å•ä¸­è¾“å…¥å†…å®¹ï¼Œæˆ–å¯¼èˆªåˆ°é“¾æ¥ã€‚ã€äººä¸ºè¾“å…¥é€šå¸¸éœ€è¦ <a href="http://localhost:3000/learn/responding-to-events">äº‹ä»¶å¤„ç†å‡½æ•°</a>ï¼ã€‘</li><li>è®¡ç®—æœºè¾“å…¥ã€‚æ¯”å¦‚ç½‘ç»œè¯·æ±‚å¾—åˆ°åé¦ˆã€å®šæ—¶å™¨è¢«è§¦å‘ï¼Œæˆ–åŠ è½½ä¸€å¼ å›¾ç‰‡ã€‚</li></ul><p>ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸­ï¼Œä½ å¿…é¡»è®¾ç½® <a href="http://localhost:3000/learn/state-a-components-memory#anatomy-of-usestate">state å˜é‡</a> å»æ›´æ–° UIã€‚å¯¹äºæ­£åœ¨å¼€å‘ä¸­çš„è¡¨å•æ¥è¯´ï¼Œä½ éœ€è¦æ”¹å˜ state ä»¥å“åº”å‡ ä¸ªä¸åŒçš„è¾“å…¥ï¼š</p><ul><li>æ”¹å˜è¾“å…¥æ¡†ä¸­çš„æ–‡æœ¬æ—¶ï¼ˆäººä¸ºï¼‰åº”è¯¥æ ¹æ®è¾“å…¥æ¡†çš„å†…å®¹æ˜¯å¦æ˜¯ç©ºå€¼ï¼Œä»è€Œå†³å®šå°†è¡¨å•çš„çŠ¶æ€ä»ç©ºå€¼çŠ¶æ€åˆ‡æ¢åˆ°è¾“å…¥ä¸­æˆ–åˆ‡æ¢å›åŸçŠ¶æ€ã€‚</li><li>ç‚¹å‡»æäº¤æŒ‰é’®æ—¶ï¼ˆäººä¸ºï¼‰åº”è¯¥å°†è¡¨å•çš„çŠ¶æ€åˆ‡æ¢åˆ°æäº¤ä¸­çš„çŠ¶æ€ã€‚</li><li>ç½‘ç»œè¯·æ±‚æˆåŠŸåï¼ˆè®¡ç®—æœºï¼‰åº”è¯¥å°†è¡¨å•çš„çŠ¶æ€åˆ‡æ¢åˆ°æˆåŠŸçš„çŠ¶æ€ã€‚</li><li>ç½‘ç»œè¯·æ±‚å¤±è´¥åï¼ˆè®¡ç®—æœºï¼‰åº”è¯¥å°†è¡¨å•çš„çŠ¶æ€åˆ‡æ¢åˆ°å¤±è´¥çš„çŠ¶æ€ï¼Œä¸æ­¤åŒæ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚</li></ul></li><li><p><mark>é€šè¿‡ <code>useState</code> è¡¨ç¤ºå†…å­˜ä¸­çš„ state</mark>ï¼šstate çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯â€œå¤„äºå˜åŒ–ä¸­çš„â€ï¼Œå¹¶ä¸”ä½ éœ€è¦è®©â€œå˜åŒ–çš„éƒ¨åˆ†â€å°½å¯èƒ½çš„å°‘ã€‚</p><p>å…ˆä»ç»å¯¹å¿…é¡»å­˜åœ¨çš„çŠ¶æ€å¼€å§‹ã€‚ä¾‹å¦‚ï¼Œä½ éœ€è¦å­˜å‚¨è¾“å…¥çš„ <code>answer</code> ä»¥åŠç”¨äºå­˜å‚¨æœ€åä¸€ä¸ªé”™è¯¯çš„ <code>error</code> ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-lkq315lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-lkq315lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [answer, setAnswer] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></div></figure><p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦ä¸€ä¸ªçŠ¶æ€å˜é‡æ¥ä»£è¡¨ä½ æƒ³è¦æ˜¾ç¤ºçš„é‚£ä¸ªå¯è§†çŠ¶æ€ã€‚é€šå¸¸æœ‰å¤šç§æ–¹å¼åœ¨å†…å­˜ä¸­è¡¨ç¤ºå®ƒï¼Œå› æ­¤ä½ éœ€è¦è¿›è¡Œå®éªŒã€‚</p><p>å¦‚æœä½ å¾ˆéš¾ç«‹å³æƒ³å‡ºæœ€å¥½çš„åŠæ³•ï¼Œé‚£å°±å…ˆä»æ·»åŠ è¶³å¤Ÿå¤šçš„ state å¼€å§‹ï¼Œç¡®ä¿æ‰€æœ‰å¯èƒ½çš„è§†å›¾çŠ¶æ€éƒ½å›Šæ‹¬å…¶ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5xcplglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5xcplglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [isEmpty, setIsEmpty] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br><span class="hljs-keyword">const</span> [isTyping, setIsTyping] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-keyword">const</span> [isSubmitting, setIsSubmitting] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-keyword">const</span> [isSuccess, setIsSuccess] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-keyword">const</span> [isError, setIsError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></div></figure><p>ä½ æœ€åˆçš„æƒ³æ³•æˆ–è®¸ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œé‡æ„ state ä¹Ÿæ˜¯æ­¥éª¤ä¸­çš„ä¸€éƒ¨åˆ†ï¼</p></li><li><p><mark>åˆ é™¤ä»»ä½•ä¸å¿…è¦çš„ state å˜é‡</mark>ï¼šé˜²æ­¢å‡ºç°åœ¨å†…å­˜ä¸­çš„ state ä¸ä»£è¡¨ä»»ä½•ä½ å¸Œæœ›ç”¨æˆ·çœ‹åˆ°çš„æœ‰æ•ˆ UI çš„æƒ…å†µã€‚</p><p>å…³äº state å˜é‡çš„é—®é¢˜ï¼š</p><ul><li>è¿™ä¸ª state æ˜¯å¦ä¼šå¯¼è‡´çŸ›ç›¾ï¼Ÿä¾‹å¦‚ï¼Œ<code>isTyping</code> ä¸ <code>isSubmitting</code> çš„çŠ¶æ€ä¸èƒ½åŒæ—¶ä¸º <code>true</code>ã€‚çŸ›ç›¾çš„äº§ç”Ÿé€šå¸¸è¯´æ˜äº†è¿™ä¸ª state æ²¡æœ‰è¶³å¤Ÿçš„çº¦æŸæ¡ä»¶ã€‚ä¸¤ä¸ªå¸ƒå°”å€¼æœ‰å››ç§å¯èƒ½çš„ç»„åˆï¼Œä½†æ˜¯åªæœ‰ä¸‰ç§å¯¹åº”æœ‰æ•ˆçš„çŠ¶æ€ã€‚ä¸ºäº†å°†â€œä¸å¯èƒ½â€çš„çŠ¶æ€ç§»é™¤ï¼Œä½ å¯ä»¥å°† <code>&#39;typing&#39;</code>ã€<code>&#39;submitting&#39;</code> ä»¥åŠ <code>&#39;success&#39;</code> è¿™ä¸‰ä¸ªä¸­çš„å…¶ä¸­ä¸€ä¸ªä¸ <code>status</code> ç»“åˆã€‚</li><li>ç›¸åŒçš„ä¿¡æ¯æ˜¯å¦å·²ç»åœ¨å¦ä¸€ä¸ª state å˜é‡ä¸­å­˜åœ¨ï¼Ÿå¦ä¸€ä¸ªçŸ›ç›¾ï¼š<code>isEmpty</code> å’Œ <code>isTyping</code> ä¸èƒ½åŒæ—¶ä¸º <code>true</code>ã€‚é€šè¿‡ä½¿å®ƒä»¬æˆä¸ºç‹¬ç«‹çš„ state å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®ƒä»¬ä¸åŒæ­¥å¹¶å¯¼è‡´ bugã€‚å¹¸è¿çš„æ˜¯ï¼Œä½ å¯ä»¥ç§»é™¤ <code>isEmpty</code> è½¬è€Œç”¨ <code>message.length === 0</code>ã€‚</li><li>ä½ æ˜¯å¦å¯ä»¥é€šè¿‡å¦ä¸€ä¸ª state å˜é‡çš„ç›¸åå€¼å¾—åˆ°ç›¸åŒçš„ä¿¡æ¯ï¼Ÿ<code>isError</code> æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºä½ å¯ä»¥æ£€æŸ¥ <code>error !== null</code>ã€‚</li></ul><p>åœ¨æ¸…ç†ä¹‹åï¼Œä½ åªå‰©ä¸‹ 3 ä¸ªï¼ˆä»åŸæœ¬çš„ 7 ä¸ªï¼ï¼‰<em>å¿…è¦</em>çš„ state å˜é‡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fyhfowlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fyhfowlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [answer, setAnswer] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;typing&#x27;</span>); <span class="hljs-comment">// &#x27;typing&#x27;, &#x27;submitting&#x27;, or &#x27;success&#x27;</span><br></code></pre></td></tr></table></div></figure><p>æ­£æ˜¯å› ä¸ºä½ ä¸èƒ½åœ¨ä¸ç ´ååŠŸèƒ½çš„æƒ…å†µä¸‹åˆ é™¤å…¶ä¸­ä»»ä½•ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå› æ­¤ä½ å¯ä»¥ç¡®å®šè¿™äº›éƒ½æ˜¯å¿…è¦çš„ã€‚</p><p><mark>é€šè¿‡ reducer æ¥å‡å°‘â€œä¸å¯èƒ½â€ state</mark>ï¼šå°½ç®¡è¿™ä¸‰ä¸ªå˜é‡å¯¹äºè¡¨ç¤ºè¿™ä¸ªè¡¨å•çš„çŠ¶æ€æ¥è¯´å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œä»ç„¶æ˜¯æœ‰ä¸€äº›ä¸­é—´çŠ¶æ€å¹¶ä¸æ˜¯å®Œå…¨æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ä¸€ä¸ªéç©ºçš„ <code>error</code> å½“ <code>status</code> çš„å€¼ä¸º <code>success</code> æ—¶æ²¡æœ‰æ„ä¹‰ã€‚ä¸ºäº†æ›´ç²¾ç¡®åœ°æ¨¡å—åŒ–çŠ¶æ€ï¼Œä½ å¯ä»¥ <a href="http://localhost:3000/learn/extracting-state-logic-into-a-reducer">å°†çŠ¶æ€æå–åˆ°ä¸€ä¸ª reducer ä¸­</a>ã€‚Reducer å¯ä»¥è®©æ‚¨åˆå¹¶å¤šä¸ªçŠ¶æ€å˜é‡åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­å¹¶å·©å›ºæ‰€æœ‰ç›¸å…³çš„é€»è¾‘ï¼</p></li><li><p><mark>è¿æ¥äº‹ä»¶å¤„ç†å‡½æ•°ä»¥è®¾ç½® state</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f931nllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f931nllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [answer, setAnswer] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;typing&#x27;</span>);<br><br>  <span class="hljs-keyword">if</span> (status === <span class="hljs-string">&#x27;success&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>That&#x27;s right!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;submitting&#x27;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">await</span> <span class="hljs-title function_">submitForm</span>(answer);<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;success&#x27;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (err) &#123;<br>      <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;typing&#x27;</span>);<br>      <span class="hljs-title function_">setError</span>(err);<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleTextareaChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setAnswer</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>City quiz<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        In which city is there a billboard that turns air into drinkable water?</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;answer&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleTextareaChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">answer.length</span> === <span class="hljs-string">0</span> ||</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">status</span> === <span class="hljs-string">&#x27;submitting&#x27;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        &#125;&gt;</span></span><br><span class="language-xml">          Submit</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        &#123;error !== null &amp;&amp;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;Error&quot;</span>&gt;</span></span><br><span class="language-xml">            &#123;error.message&#125;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">        &#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">submitForm</span>(<span class="hljs-params">answer</span>) &#123;<br>  <span class="hljs-comment">// Pretend it&#x27;s hitting the network.</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">let</span> shouldError = answer.<span class="hljs-title function_">toLowerCase</span>() !== <span class="hljs-string">&#x27;lima&#x27;</span><br>      <span class="hljs-keyword">if</span> (shouldError) &#123;<br>        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Good guess but a wrong answer. Try again!&#x27;</span>));<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-title function_">resolve</span>();<br>      &#125;<br>    &#125;, <span class="hljs-number">1500</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å°†æ‰€æœ‰çš„äº¤äº’å˜ä¸º state çš„æ”¹å˜ï¼Œå¯ä»¥è®©ä½ é¿å…ä¹‹åå¼•å…¥æ–°çš„è§†å›¾çŠ¶æ€åå¯¼è‡´ç°æœ‰ state è¢«ç ´åã€‚åŒæ—¶ä¹Ÿä½¿ä½ åœ¨ä¸å¿…æ”¹å˜äº¤äº’é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œæ›´æ”¹æ¯ä¸ªçŠ¶æ€å¯¹åº”çš„ UIã€‚</p></li></ol><h2 id="2-é€‰æ‹©stateç»“æ„"><a href="#2-é€‰æ‹©stateç»“æ„" class="headerlink" title="2.é€‰æ‹©stateç»“æ„"></a>2.é€‰æ‹©stateç»“æ„</h2><p><mark>æ„å»º state çš„åŸåˆ™</mark>ï¼š</p><ol><li><p><mark>åˆå¹¶å…³è”çš„ state</mark>ã€‚å¦‚æœä½ æ€»æ˜¯åŒæ—¶æ›´æ–°ä¸¤ä¸ªæˆ–æ›´å¤šçš„ state å˜é‡ï¼Œè¯·è€ƒè™‘å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå•ç‹¬çš„ state å˜é‡ã€‚</p><p>æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šä¸ç¡®å®šæ˜¯ä½¿ç”¨å•ä¸ª state å˜é‡è¿˜æ˜¯å¤šä¸ª state å˜é‡ã€‚</p><p>ä½ ä¼šåƒä¸‹é¢è¿™æ ·åšå—ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s3k0shlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s3k0shlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [x, setX] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">const</span> [y, setY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p>æˆ–è¿™æ ·ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-64bdxxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-64bdxxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [position, setPosition] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> &#125;);<br></code></pre></td></tr></table></div></figure><p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¶ä¸­ä»»ä½•ä¸€ç§æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸä¸¤ä¸ª state å˜é‡æ€»æ˜¯ä¸€èµ·å˜åŒ–ï¼Œåˆ™å°†å®ƒä»¬ç»Ÿä¸€æˆä¸€ä¸ª state å˜é‡å¯èƒ½æ›´å¥½ã€‚</p><p><mark>å¦‚æœä½ çš„ state å˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¯·è®°ä½ï¼Œ<a href="http://localhost:3000/learn/updating-objects-in-state">ä½ ä¸èƒ½åªæ›´æ–°å…¶ä¸­çš„ä¸€ä¸ªå­—æ®µ</a> è€Œä¸æ˜¾å¼å¤åˆ¶å…¶ä»–å­—æ®µ</mark>ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½ ä¸èƒ½å†™æˆ <code>setPosition(&#123; x: 100 &#125;)</code>ï¼Œå› ä¸ºå®ƒæ ¹æœ¬å°±æ²¡æœ‰ <code>y</code> å±æ€§! ç›¸åï¼Œå¦‚æœä½ æƒ³è¦ä»…è®¾ç½® <code>x</code>ï¼Œåˆ™å¯æ‰§è¡Œ <code>setPosition(&#123; ...position, x: 100 &#125;)</code>ï¼Œæˆ–å°†å®ƒä»¬åˆ†æˆä¸¤ä¸ª state å˜é‡ï¼Œå¹¶æ‰§è¡Œ <code>setX(100)</code>ã€‚</p></li><li><p><mark>é¿å…äº’ç›¸çŸ›ç›¾çš„ state</mark>ã€‚å½“ state ç»“æ„ä¸­å­˜åœ¨å¤šä¸ªç›¸äº’çŸ›ç›¾æˆ–â€œä¸ä¸€è‡´â€çš„ state æ—¶ï¼Œä½ å°±å¯èƒ½ä¸ºæ­¤ä¼šç•™ä¸‹éšæ‚£ã€‚åº”å°½é‡é¿å…è¿™ç§æƒ…å†µã€‚</p><p>ä¸‹é¢æ˜¯å¸¦æœ‰ <code>isSending</code> å’Œ <code>isSent</code> ä¸¤ä¸ª state å˜é‡çš„é…’åº—åé¦ˆè¡¨å•ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0qr5hmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0qr5hmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">FeedbackForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [isSending, setIsSending] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [isSent, setIsSent] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMessage</span>(text);<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">false</span>);<br>    <span class="hljs-title function_">setIsSent</span>(<span class="hljs-literal">true</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (isSent) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Thanks for feedback!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>How was your stay at The Prancing Pony?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        Send</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;isSending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Sending...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">// å‡è£…å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">text</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">2000</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å°½ç®¡è¿™æ®µä»£ç æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ä¹Ÿä¼šè®©ä¸€äº› state â€œæéš¾å¤„ç†â€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¿˜è®°åŒæ—¶è°ƒç”¨ <code>setIsSent</code> å’Œ <code>setIsSending</code>ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç° <code>isSending</code> å’Œ <code>isSent</code> åŒæ—¶ä¸º <code>true</code> çš„æƒ…å†µã€‚ä½ çš„ç»„ä»¶è¶Šå¤æ‚ï¼Œä½ å°±è¶Šéš¾ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>å› ä¸º <code>isSending</code> å’Œ <code>isSent</code> ä¸åº”åŒæ—¶ä¸º <code>true</code>ï¼Œæ‰€ä»¥æœ€å¥½ç”¨ä¸€ä¸ª <code>status</code> å˜é‡æ¥ä»£æ›¿å®ƒä»¬ï¼Œè¿™ä¸ª state å˜é‡å¯ä»¥é‡‡å–ä¸‰ç§æœ‰æ•ˆçŠ¶æ€å…¶ä¸­ä¹‹ä¸€ï¼š<code>&#39;typing&#39;</code> (åˆå§‹), <code>&#39;sending&#39;</code>, å’Œ <code>&#39;sent&#39;</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2lnjqslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2lnjqslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">FeedbackForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;typing&#x27;</span>);<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;sending&#x27;</span>);<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMessage</span>(text);<br>    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">&#x27;sent&#x27;</span>);<br>  &#125;<br><span class="hljs-comment">/* å¸¸é‡   */</span><br>  <span class="hljs-keyword">const</span> isSending = status === <span class="hljs-string">&#x27;sending&#x27;</span>;<br>  <span class="hljs-keyword">const</span> isSent = status === <span class="hljs-string">&#x27;sent&#x27;</span>;<br><br>  <span class="hljs-keyword">if</span> (isSent) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Thanks for feedback!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>How was your stay at The Prancing Pony?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &gt;</span></span><br><span class="language-xml">        Send</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;isSending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Sending...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-comment">/*  å‡è£…å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚  */</span> <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">text</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">2000</span>);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>é¿å…å†—ä½™çš„ state</mark>ã€‚å¦‚æœä½ èƒ½åœ¨æ¸²æŸ“æœŸé—´ä»ç»„ä»¶çš„ props æˆ–å…¶ç°æœ‰çš„ state å˜é‡ä¸­è®¡ç®—å‡ºä¸€äº›ä¿¡æ¯ï¼Œåˆ™ä¸åº”å°†è¿™äº›ä¿¡æ¯æ”¾å…¥è¯¥ç»„ä»¶çš„ state ä¸­ã€‚</p><p><mark>ä¸è¦åœ¨ state ä¸­é•œåƒ props</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-j25sozlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-j25sozlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; messageColor &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [color, setColor] = <span class="hljs-title function_">useState</span>(messageColor);   <br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™é‡Œï¼Œä¸€ä¸ª <code>color</code> state å˜é‡è¢«åˆå§‹åŒ–ä¸º <code>messageColor</code> çš„ prop å€¼ã€‚è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœçˆ¶ç»„ä»¶ç¨åä¼ é€’ä¸åŒçš„ <code>messageColor</code> å€¼ï¼ˆä¾‹å¦‚ï¼Œå°†å…¶ä» <code>&#39;blue&#39;</code> æ›´æ”¹ä¸º <code>&#39;red&#39;</code>ï¼‰ï¼Œåˆ™ <code>color</code> state å˜é‡å°†ä¸ä¼šæ›´æ–°ï¼ state ä»…åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´åˆå§‹åŒ–ã€‚</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ state å˜é‡ä¸­ï¼Œâ€œé•œåƒâ€ä¸€äº› prop å±æ€§ä¼šå¯¼è‡´æ··æ·†çš„åŸå› ã€‚ç›¸åï¼Œä½ è¦åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ <code>messageColor</code> å±æ€§ã€‚å¦‚æœä½ æƒ³ç»™å®ƒèµ·ä¸€ä¸ªæ›´çŸ­çš„åç§°ï¼Œè¯·ä½¿ç”¨å¸¸é‡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ycirqglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ycirqglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; messageColor &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> color = messageColor;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ç§å†™æ³•å°±ä¸ä¼šä¸ä»çˆ¶ç»„ä»¶ä¼ é€’çš„å±æ€§å¤±å»åŒæ­¥ã€‚</p><p>åªæœ‰å½“ä½  æƒ³è¦ å¿½ç•¥ç‰¹å®š props å±æ€§çš„æ‰€æœ‰æ›´æ–°æ—¶ï¼Œå°† props â€œé•œåƒâ€åˆ° state æ‰æœ‰æ„ä¹‰ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œprop åç§°ä»¥ <code>initial</code> æˆ– <code>default</code> å¼€å¤´ï¼Œä»¥é˜æ˜è¯¥ prop çš„æ–°å€¼å°†è¢«å¿½ç•¥ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kx55vdlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kx55vdlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">&#123; initialColor &#125;</span>) &#123;<br>  <span class="hljs-comment">// è¿™ä¸ª `color` state å˜é‡ç”¨äºä¿å­˜ `initialColor` çš„ åˆå§‹å€¼ã€‚</span><br>  <span class="hljs-comment">// å¯¹äº `initialColor` å±æ€§çš„è¿›ä¸€æ­¥æ›´æ”¹å°†è¢«å¿½ç•¥ã€‚</span><br>  <span class="hljs-keyword">const</span> [color, setColor] = <span class="hljs-title function_">useState</span>(initialColor)<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>é¿å…é‡å¤çš„ state</mark>ã€‚å½“åŒä¸€æ•°æ®åœ¨å¤šä¸ª state å˜é‡ä¹‹é—´æˆ–åœ¨å¤šä¸ªåµŒå¥—å¯¹è±¡ä¸­é‡å¤æ—¶ï¼Œè¿™ä¼šå¾ˆéš¾ä¿æŒå®ƒä»¬åŒæ­¥ã€‚åº”å°½å¯èƒ½å‡å°‘é‡å¤ã€‚</p><p>ä¸‹é¢è¿™ä¸ªèœå•åˆ—è¡¨ç»„ä»¶å¯ä»¥è®©ä½ åœ¨å¤šç§æ—…è¡Œå°åƒä¸­é€‰æ‹©ä¸€ä¸ªï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tjowrnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tjowrnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> initialItems = [<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;pretzels&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">0</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;crispy seaweed&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;granola bar&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Menu</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>(initialItems);<br>  <span class="hljs-keyword">const</span> [selectedItem, setSelectedItem] = <span class="hljs-title function_">useState</span>(<br>    items[<span class="hljs-number">0</span>]<br>  );<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>What&#x27;s your travel snack?<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;items.map(item =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span></span><br><span class="language-xml">            &#123;item.title&#125;</span><br><span class="language-xml">            &#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">              setSelectedItem(item);</span><br><span class="language-xml">            &#125;&#125;&gt;Choose<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You picked &#123;selectedItem.title&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231108141335706.png" alt="image-20231108141335706" style="zoom:50%;" /><p>å½“å‰ï¼Œå®ƒå°†æ‰€é€‰å…ƒç´ ä½œä¸ºå¯¹è±¡å­˜å‚¨åœ¨ <code>selectedItem</code> state å˜é‡ä¸­ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸å¥½ï¼š<code>selectedItem</code> çš„å†…å®¹ä¸ <code>items</code> åˆ—è¡¨ä¸­çš„æŸä¸ªé¡¹æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚ è¿™æ„å‘³ç€å…³äºè¯¥é¡¹æœ¬èº«çš„ä¿¡æ¯åœ¨ä¸¤ä¸ªåœ°æ–¹äº§ç”Ÿäº†é‡å¤ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªé—®é¢˜ï¼Ÿè®©æˆ‘ä»¬ä½¿æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç¼–è¾‘ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-izxsvulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-izxsvulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> initialItems = [<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;pretzels&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">0</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;crispy seaweed&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;granola bar&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Menu</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>(initialItems);<br>  <span class="hljs-keyword">const</span> [selectedItem, setSelectedItem] = <span class="hljs-title function_">useState</span>(<br>    items[<span class="hljs-number">0</span>]<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleItemChange</span>(<span class="hljs-params">id, e</span>) &#123;<br>    <span class="hljs-title function_">setItems</span>(items.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">id</span> === id) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          ...item,<br>          <span class="hljs-attr">title</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> item;<br>      &#125;<br>    &#125;));<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>What&#x27;s your travel snack?<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span> </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;items.map((item, index) =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;item.title&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">                handleItemChange(item.id, e)</span><br><span class="language-xml">              &#125;&#125;</span><br><span class="language-xml">            /&gt;</span><br><span class="language-xml">            &#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">              setSelectedItem(item);</span><br><span class="language-xml">            &#125;&#125;&gt;Choose<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You picked &#123;selectedItem.title&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231108141408780.png" alt="image-20231108141408780" style="zoom:50%;" /><p>å¦‚æœä½ é¦–å…ˆå•å‡»èœå•ä¸Šçš„â€œChooseâ€ ç„¶å ç¼–è¾‘å®ƒï¼Œè¾“å…¥ä¼šæ›´æ–°ï¼Œä½†åº•éƒ¨çš„æ ‡ç­¾ä¸ä¼šåæ˜ ç¼–è¾‘å†…å®¹ã€‚ è¿™æ˜¯å› ä¸ºä½ æœ‰é‡å¤çš„ stateï¼Œå¹¶ä¸”ä½ å¿˜è®°æ›´æ–°äº† <code>selectedItem</code>ã€‚</p><p>å°½ç®¡ä½ ä¹Ÿå¯ä»¥æ›´æ–° <code>selectedItem</code>ï¼Œä½†æ›´ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯æ¶ˆé™¤é‡å¤é¡¹ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å°† <code>selectedId</code> ä¿å­˜åœ¨ state ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ <code>selectedItem</code> å¯¹è±¡ä¸­ï¼ˆå®ƒåˆ›å»ºäº†ä¸€ä¸ªä¸ <code>items</code> å†…é‡å¤çš„å¯¹è±¡ï¼‰ï¼Œç„¶å é€šè¿‡æœç´¢ <code>items</code> æ•°ç»„ä¸­å…·æœ‰è¯¥ ID çš„é¡¹ï¼Œä»¥æ­¤è·å– <code>selectedItem</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9grfx3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9grfx3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> initialItems = [<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;pretzels&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">0</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;crispy seaweed&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> &#125;,<br>  &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;granola bar&#x27;</span>, <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> &#125;,<br>];<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Menu</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>(initialItems);<br>  <span class="hljs-keyword">const</span> [selectedId, setSelectedId] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">const</span> selectedItem = items.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span><br>    item.<span class="hljs-property">id</span> === selectedId<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleItemChange</span>(<span class="hljs-params">id, e</span>) &#123;<br>    <span class="hljs-title function_">setItems</span>(items.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">id</span> === id) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>          ...item,<br>          <span class="hljs-attr">title</span>: e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>,<br>        &#125;;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> item;<br>      &#125;<br>    &#125;));<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>What&#x27;s your travel snack?<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;items.map((item, index) =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;item.title&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">                handleItemChange(item.id, e)</span><br><span class="language-xml">              &#125;&#125;</span><br><span class="language-xml">            /&gt;</span><br><span class="language-xml">            &#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">              setSelectedId(item.id);</span><br><span class="language-xml">            &#125;&#125;&gt;Choose<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You picked &#123;selectedItem.title&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231108141513225.png" alt="image-20231108141513225" style="zoom:50%;" /><p>å¦‚æœä½ ç¼–è¾‘ selected å…ƒç´ ï¼Œä¸‹é¢çš„æ¶ˆæ¯å°†ç«‹å³æ›´æ–°ã€‚è¿™æ˜¯å› ä¸º <code>setItems</code> ä¼š<mark>è§¦å‘é‡æ–°æ¸²æŸ“</mark>ï¼Œè€Œ <code>items.find(...)</code> ä¼šæ‰¾åˆ°å¸¦æœ‰æ›´æ–°æ–‡æœ¬çš„å…ƒç´ ã€‚ä½ ä¸éœ€è¦åœ¨ state ä¸­ä¿å­˜ é€‰å®šçš„å…ƒç´ ï¼Œå› ä¸ºåªæœ‰ é€‰å®šçš„ ID æ˜¯å¿…è¦çš„ã€‚å…¶ä½™çš„å¯ä»¥åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—ã€‚</p></li><li><p><mark>é¿å…æ·±åº¦åµŒå¥—çš„ state</mark>ã€‚æ·±åº¦åˆ†å±‚çš„ state æ›´æ–°èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæœ€å¥½ä»¥æ‰å¹³åŒ–æ–¹å¼æ„å»º stateã€‚</p><p>ä¸€ä¸ªç”±è¡Œæ˜Ÿã€å¤§é™†å’Œå›½å®¶ç»„æˆçš„æ—…è¡Œè®¡åˆ’ã€‚ä½ å¯èƒ½ä¼šå°è¯•ä½¿ç”¨åµŒå¥—å¯¹è±¡å’Œæ•°ç»„æ¥æ„å»ºå®ƒçš„ stateï¼š</p><p>place.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oxg9islqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oxg9islqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> initialTravelPlan = &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;(Root)&#x27;</span>,<br>  <span class="hljs-attr">childPlaces</span>: [&#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Earth&#x27;</span>,<br>    <span class="hljs-attr">childPlaces</span>: [&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Africa&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Botswana&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Egypt&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Kenya&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Madagascar&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Morocco&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Nigeria&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;South Africa&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;]<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">10</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Americas&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">11</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Argentina&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">12</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Brazil&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">13</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Barbados&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">14</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Canada&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">15</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Jamaica&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">16</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Mexico&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">17</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Trinidad and Tobago&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">18</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Venezuela&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;]<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">19</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Asia&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">20</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;China&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">21</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;India&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">22</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Singapore&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">23</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;South Korea&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">24</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Thailand&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">25</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Vietnam&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: []<br>      &#125;]<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">26</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Europe&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">27</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Croatia&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">28</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;France&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">29</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Germany&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">30</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Italy&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">31</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Portugal&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">32</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Spain&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">33</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Turkey&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;]<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">34</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Oceania&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: [&#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">35</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Australia&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">36</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Bora Bora (French Polynesia)&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">37</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Easter Island (Chile)&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">38</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Fiji&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">39</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Hawaii (the USA)&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">40</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;New Zealand&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;, &#123;<br>        <span class="hljs-attr">id</span>: <span class="hljs-number">41</span>,<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Vanuatu&#x27;</span>,<br>        <span class="hljs-attr">childPlaces</span>: [],<br>      &#125;]<br>    &#125;]<br>  &#125;, &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">42</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Moon&#x27;</span>,<br>    <span class="hljs-attr">childPlaces</span>: [&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">43</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Rheita&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: []<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">44</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Piccolomini&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: []<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">45</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Tycho&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: []<br>    &#125;]<br>  &#125;, &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">46</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Mars&#x27;</span>,<br>    <span class="hljs-attr">childPlaces</span>: [&#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">47</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Corn Town&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: []<br>    &#125;, &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-number">48</span>,<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Green Hill&#x27;</span>,<br>      <span class="hljs-attr">childPlaces</span>: []      <br>    &#125;]<br>  &#125;]<br>&#125;;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9qrfgmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9qrfgmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; initialTravelPlan &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./places.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PlaceTree</span>(<span class="hljs-params">&#123; place &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> childPlaces = place.<span class="hljs-property">childPlaces</span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      &#123;place.title&#125;</span><br><span class="language-xml">      &#123;childPlaces.length &gt; 0 &amp;&amp; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">          &#123;childPlaces.map(place =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PlaceTree</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;place.id&#125;</span> <span class="hljs-attr">place</span>=<span class="hljs-string">&#123;place&#125;</span> /&gt;</span></span><br><span class="language-xml">          ))&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TravelPlan</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [plan, setPlan] = <span class="hljs-title function_">useState</span>(initialTravelPlan);<br>  <span class="hljs-keyword">const</span> planets = plan.<span class="hljs-property">childPlaces</span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Places to visit<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">        &#123;planets.map(place =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">PlaceTree</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;place.id&#125;</span> <span class="hljs-attr">place</span>&#123;<span class="hljs-attr">place</span>&#125; /&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å‡è®¾ä½ æƒ³æ·»åŠ ä¸€ä¸ªæŒ‰é’®æ¥åˆ é™¤ä¸€ä¸ªä½ å·²ç»å»è¿‡çš„åœ°æ–¹ã€‚ä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ<a href="http://localhost:3000/learn/updating-objects-in-state#updating-a-nested-object">æ›´æ–°åµŒå¥—çš„ state</a> éœ€è¦ä»æ›´æ”¹éƒ¨åˆ†ä¸€ç›´å‘ä¸Šå¤åˆ¶å¯¹è±¡ã€‚åˆ é™¤ä¸€ä¸ªæ·±åº¦åµŒå¥—çš„åœ°ç‚¹å°†æ¶‰åŠå¤åˆ¶å…¶æ•´ä¸ªçˆ¶çº§åœ°ç‚¹é“¾ã€‚è¿™æ ·çš„ä»£ç å¯èƒ½éå¸¸å†—é•¿ã€‚</p><p>å¦‚æœ state åµŒå¥—å¤ªæ·±ï¼Œéš¾ä»¥è½»æ¾æ›´æ–°ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶â€œæ‰å¹³åŒ–â€ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥é‡æ„ä¸Šé¢è¿™ä¸ªæ•°æ®ã€‚ä¸åŒäºæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ <code>place</code> éƒ½æ˜¯ä¸€ä¸ªåŒ…å« å…¶å­èŠ‚ç‚¹ çš„æ•°ç»„ï¼Œä½ å¯ä»¥è®©æ¯ä¸ªèŠ‚ç‚¹çš„ <code>place</code> ä½œä¸ºæ•°ç»„ä¿å­˜ å…¶å­èŠ‚ç‚¹çš„ IDã€‚ç„¶åå­˜å‚¨ä¸€ä¸ªèŠ‚ç‚¹ ID ä¸ç›¸åº”èŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ã€‚</p><p>è¿™ä¸ªæ•°æ®é‡ç»„å¯èƒ½ä¼šè®©ä½ æƒ³èµ·çœ‹åˆ°ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼š</p><p>place.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8nq8f4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8nq8f4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> initialTravelPlan = &#123;<br>  <span class="hljs-number">0</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;(Root)&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">42</span>, <span class="hljs-number">46</span>],<br>  &#125;,<br>  <span class="hljs-number">1</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Earth&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">19</span>, <span class="hljs-number">26</span>, <span class="hljs-number">34</span>]<br>  &#125;,<br>  <span class="hljs-number">2</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Africa&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span> , <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]<br>  &#125;, <br>  <span class="hljs-number">3</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Botswana&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">4</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Egypt&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">5</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Kenya&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">6</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">6</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Madagascar&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;, <br>  <span class="hljs-number">7</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">7</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Morocco&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">8</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">8</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Nigeria&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">9</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">9</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;South Africa&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">10</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">10</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Americas&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>, <span class="hljs-number">16</span>, <span class="hljs-number">17</span>, <span class="hljs-number">18</span>],   <br>  &#125;,<br>  <span class="hljs-number">11</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">11</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Argentina&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">12</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">12</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Brazil&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">13</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">13</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Barbados&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;, <br>  <span class="hljs-number">14</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">14</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Canada&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">15</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">15</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Jamaica&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">16</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">16</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Mexico&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">17</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">17</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Trinidad and Tobago&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">18</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">18</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Venezuela&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">19</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">19</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Asia&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">21</span>, <span class="hljs-number">22</span>, <span class="hljs-number">23</span>, <span class="hljs-number">24</span>, <span class="hljs-number">25</span>],   <br>  &#125;,<br>  <span class="hljs-number">20</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">20</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;China&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">21</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">21</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;India&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">22</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">22</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Singapore&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">23</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">23</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;South Korea&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">24</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">24</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Thailand&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">25</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">25</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Vietnam&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">26</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">26</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Europe&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">27</span>, <span class="hljs-number">28</span>, <span class="hljs-number">29</span>, <span class="hljs-number">30</span>, <span class="hljs-number">31</span>, <span class="hljs-number">32</span>, <span class="hljs-number">33</span>],   <br>  &#125;,<br>  <span class="hljs-number">27</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">27</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Croatia&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">28</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">28</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;France&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">29</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">29</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Germany&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">30</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">30</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Italy&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">31</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">31</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Portugal&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">32</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">32</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Spain&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">33</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">33</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Turkey&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">34</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">34</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Oceania&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">35</span>, <span class="hljs-number">36</span>, <span class="hljs-number">37</span>, <span class="hljs-number">38</span>, <span class="hljs-number">39</span>, <span class="hljs-number">40</span>, <span class="hljs-number">41</span>],   <br>  &#125;,<br>  <span class="hljs-number">35</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">35</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Australia&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">36</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">36</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Bora Bora (French Polynesia)&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">37</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">37</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Easter Island (Chile)&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">38</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">38</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Fiji&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">39</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">40</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Hawaii (the USA)&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">40</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">40</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;New Zealand&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">41</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">41</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Vanuatu&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">42</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">42</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Moon&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">43</span>, <span class="hljs-number">44</span>, <span class="hljs-number">45</span>]<br>  &#125;,<br>  <span class="hljs-number">43</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">43</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Rheita&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">44</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">44</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Piccolomini&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">45</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">45</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Tycho&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">46</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">46</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Mars&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: [<span class="hljs-number">47</span>, <span class="hljs-number">48</span>]<br>  &#125;,<br>  <span class="hljs-number">47</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">47</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Corn Town&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;,<br>  <span class="hljs-number">48</span>: &#123;<br>    <span class="hljs-attr">id</span>: <span class="hljs-number">48</span>,<br>    <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Green Hill&#x27;</span>,<br>    <span class="hljs-attr">childIds</span>: []<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></div></figure><p>App.jsxï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yhuorflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yhuorflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; initialTravelPlan &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./places.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">PlaceTree</span>(<span class="hljs-params">&#123; id, placesById &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> place = placesById[id];<br>  <span class="hljs-keyword">const</span> childIds = place.<span class="hljs-property">childIds</span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      &#123;place.title&#125;</span><br><span class="language-xml">      &#123;childIds.length &gt; 0 &amp;&amp; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">          &#123;childIds.map(childId =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">PlaceTree</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;childId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">id</span>=<span class="hljs-string">&#123;childId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">placesById</span>=<span class="hljs-string">&#123;placesById&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            /&gt;</span></span><br><span class="language-xml">          ))&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TravelPlan</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [plan, setPlan] = <span class="hljs-title function_">useState</span>(initialTravelPlan);<br>  <span class="hljs-keyword">const</span> root = plan[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">const</span> planetIds = root.<span class="hljs-property">childIds</span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Places to visit<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">        &#123;planetIds.map(id =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">PlaceTree</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">id</span>=<span class="hljs-string">&#123;id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">placesById</span>=<span class="hljs-string">&#123;plan&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          /&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><mark>ç°åœ¨ state å·²ç»â€œæ‰å¹³åŒ–â€ï¼ˆä¹Ÿç§°ä¸ºâ€œè§„èŒƒåŒ–â€ï¼‰ï¼Œæ›´æ–°åµŒå¥—é¡¹ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå¹¶ä¸”æœ‰åŠ©äºç¡®ä¿åœ¨åµŒå¥—å¯¹è±¡çš„ä¸åŒéƒ¨åˆ†ä¸­æ²¡æœ‰é‡å¤ã€‚</mark></p><p>ç°åœ¨è¦åˆ é™¤ä¸€ä¸ªåœ°ç‚¹ï¼Œæ‚¨åªéœ€è¦æ›´æ–°ä¸¤ä¸ª state çº§åˆ«ï¼š</p><ul><li>å…¶ <strong>çˆ¶çº§</strong> åœ°ç‚¹çš„æ›´æ–°ç‰ˆæœ¬åº”è¯¥ä»å…¶ <code>childIds</code> æ•°ç»„ä¸­æ’é™¤å·²åˆ é™¤çš„ IDã€‚</li><li>å…¶æ ¹çº§â€œè¡¨â€å¯¹è±¡çš„æ›´æ–°ç‰ˆæœ¬åº”åŒ…æ‹¬çˆ¶çº§åœ°ç‚¹çš„æ›´æ–°ç‰ˆæœ¬ã€‚</li></ul><p>æœ‰æ—¶å€™ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å°†ä¸€äº›åµŒå¥— state ç§»åŠ¨åˆ°å­ç»„ä»¶ä¸­æ¥å‡å°‘ state çš„åµŒå¥—ã€‚è¿™å¯¹äºä¸éœ€è¦ä¿å­˜çš„çŸ­æš‚ UI çŠ¶æ€éå¸¸æœ‰æ•ˆï¼Œæ¯”å¦‚ä¸€ä¸ªé€‰é¡¹æ˜¯å¦è¢«æ‚¬åœã€‚</p></li></ol><p>è¿™äº›åŸåˆ™èƒŒåçš„ç›®æ ‡æ˜¯ ä½¿ state æ˜“äºæ›´æ–°è€Œä¸å¼•å…¥é”™è¯¯ã€‚</p><h2 id="3-åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€"><a href="#3-åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€" class="headerlink" title="3.åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€"></a>3.åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€</h2><p>æœ‰æ—¶å€™ï¼Œä½ å¸Œæœ›ä¸¤ä¸ªç»„ä»¶çš„çŠ¶æ€å§‹ç»ˆåŒæ­¥æ›´æ”¹ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å°†ç›¸å…³ state ä»è¿™ä¸¤ä¸ªç»„ä»¶ä¸Šç§»é™¤ï¼Œå¹¶æŠŠ state æ”¾åˆ°å®ƒä»¬çš„å…¬å…±çˆ¶çº§ï¼Œå†é€šè¿‡ props å°† state ä¼ é€’ç»™è¿™ä¸¤ä¸ªç»„ä»¶ã€‚è¿™è¢«ç§°ä¸ºâ€œ<mark>çŠ¶æ€æå‡</mark>â€ã€‚</p><p>çˆ¶ç»„ä»¶ <code>Accordion</code> æ¸²æŸ“äº† 2 ä¸ªç‹¬ç«‹çš„ <code>Panel</code> ç»„ä»¶ã€‚</p><p><code>Accordion</code></p><ul><li><code>Panel</code></li><li><code>Panel</code></li></ul><p>æ¯ä¸ª <code>Panel</code> ç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå¸ƒå°”å€¼ <code>isActive</code>ï¼Œç”¨äºæ§åˆ¶å…¶å†…å®¹æ˜¯å¦å¯è§ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tnpwqilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tnpwqilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Panel</span>(<span class="hljs-params">&#123; title, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isActive, setIsActive] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;panel&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      &#123;isActive ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsActive(true)&#125;&gt;</span><br><span class="language-xml">          æ˜¾ç¤º</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Accordion</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å“ˆè¨å…‹æ–¯å¦ï¼Œé˜¿æ‹‰æœ¨å›¾<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;å…³äº&quot;</span>&gt;</span></span><br><span class="language-xml">        é˜¿æ‹‰æœ¨å›¾äººå£çº¦200ä¸‡ï¼Œæ˜¯å“ˆè¨å…‹æ–¯å¦æœ€å¤§çš„åŸå¸‚ã€‚å®ƒåœ¨ 1929 å¹´åˆ° 1997 å¹´é—´éƒ½æ˜¯é¦–éƒ½ã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;è¯æº&quot;</span>&gt;</span></span><br><span class="language-xml">        è¿™ä¸ªåå­—æ¥è‡ªäº <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;kk-KZ&quot;</span>&gt;</span>Ğ°Ğ»Ğ¼Ğ°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>ï¼Œå“ˆè¨å…‹è¯­ä¸­â€œè‹¹æœâ€çš„æ„æ€ï¼Œç»å¸¸è¢«ç¿»è¯‘æˆâ€œè‹¹æœä¹‹ä¹¡â€ã€‚äº‹å®ä¸Šï¼Œé˜¿æ‹‰æœ¨å›¾çš„å‘¨è¾¹åœ°åŒºè¢«è®¤ä¸ºæ˜¯è‹¹æœçš„å‘æºåœ°ï¼Œ<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;la&quot;</span>&gt;</span>Malus sieversii<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> è¢«è®¤ä¸ºæ˜¯ç°ä»Šè‹¹æœçš„ç¥–å…ˆã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç‚¹å‡»å…¶ä¸­ä¸€ä¸ªé¢æ¿ä¸­çš„æŒ‰é’®å¹¶ä¸ä¼šå½±å“å¦å¤–ä¸€ä¸ªï¼Œä»–ä»¬æ˜¯ç‹¬ç«‹çš„ã€‚</p><img src="image-20231109094105013.png" alt="image-20231109094105013" style="zoom:50%;" /><img src="image-20231109094146988.png" alt="image-20231109094146988" style="zoom:50%;" /><p>**<mark>å‡è®¾ç°åœ¨æ‚¨æƒ³æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œä»¥ä¾¿åœ¨ä»»ä½•æ—¶å€™åªå±•å¼€ä¸€ä¸ªé¢æ¿</mark>**ã€‚åœ¨è¿™ç§è®¾è®¡ä¸‹ï¼Œå±•å¼€ç¬¬ 2 ä¸ªé¢æ¿åº”ä¼šæŠ˜å ç¬¬ 1 ä¸ªé¢æ¿ã€‚æ‚¨è¯¥å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿâ€</p><p>è¦åè°ƒå¥½è¿™ä¸¤ä¸ªé¢æ¿ï¼Œæˆ‘ä»¬éœ€è¦åˆ† 3 æ­¥å°†çŠ¶æ€â€œæå‡â€åˆ°ä»–ä»¬çš„çˆ¶ç»„ä»¶ä¸­ã€‚</p><ol><li><p>ä»å­ç»„ä»¶ä¸­ <strong>ç§»é™¤</strong> stateï¼šå…ˆä» <code>Panel</code> ç»„ä»¶ä¸­ <strong>åˆ é™¤ä¸‹é¢è¿™ä¸€è¡Œ</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bqkad4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bqkad4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [isActive, setIsActive] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼ŒæŠŠ <code>isActive</code> åŠ å…¥ <code>Panel</code> ç»„ä»¶çš„ <code>props</code> ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nwurkilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nwurkilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Panel</span>(<span class="hljs-params">&#123; title, children, isActive &#125;</span>) &#123;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ <code>Panel</code> çš„çˆ¶ç»„ä»¶å°±å¯ä»¥é€šè¿‡ <a href="http://localhost:3000/learn/passing-props-to-a-component">å‘ä¸‹ä¼ é€’ prop</a> æ¥ <strong>æ§åˆ¶</strong> <code>isActive</code>ã€‚ä½†ç›¸ååœ°ï¼Œ<code>Panel</code> ç»„ä»¶å¯¹ <code>isActive</code> çš„å€¼ <strong>æ²¡æœ‰æ§åˆ¶æƒ</strong> â€”â€” ç°åœ¨å®Œå…¨ç”±çˆ¶ç»„ä»¶å†³å®šï¼</p></li><li><p>çˆ¶ç»„ä»¶ <strong>ä¼ é€’</strong> ç¡¬ç¼–ç æ•°æ®ï¼šä¸ºäº†å®ç°çŠ¶æ€æå‡ï¼Œå¿…é¡»å®šä½åˆ°ä½ æƒ³åè°ƒçš„ <strong>ä¸¤ä¸ª</strong> å­ç»„ä»¶æœ€è¿‘çš„å…¬å…±çˆ¶ç»„ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…¬å…±çˆ¶ç»„ä»¶æ˜¯ <code>Accordion</code>ã€‚å› ä¸ºå®ƒä½äºä¸¤ä¸ªé¢æ¿ä¹‹ä¸Šï¼Œå¯ä»¥æ§åˆ¶å®ƒä»¬çš„ propsï¼Œæ‰€ä»¥å®ƒå°†æˆä¸ºå½“å‰æ¿€æ´»é¢æ¿çš„â€œæ§åˆ¶ä¹‹æºâ€ã€‚é€šè¿‡ <code>Accordion</code> ç»„ä»¶å°†ç¡¬ç¼–ç å€¼ <code>isActive</code>ï¼ˆä¾‹å¦‚ <code>true</code> ï¼‰ä¼ é€’ç»™ä¸¤ä¸ªé¢æ¿ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-o78kkvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-o78kkvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Accordion</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å“ˆè¨å…‹æ–¯å¦ï¼Œé˜¿æ‹‰æœ¨å›¾<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;å…³äº&quot;</span> <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;true&#125;</span>&gt;</span></span><br><span class="language-xml">        é˜¿æ‹‰æœ¨å›¾äººå£çº¦200ä¸‡ï¼Œæ˜¯å“ˆè¨å…‹æ–¯å¦æœ€å¤§çš„åŸå¸‚ã€‚å®ƒåœ¨ 1929 å¹´åˆ° 1997 å¹´é—´éƒ½æ˜¯é¦–éƒ½ã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;è¯æº&quot;</span> <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;true&#125;</span>&gt;</span></span><br><span class="language-xml">        è¿™ä¸ªåå­—æ¥è‡ªäº <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;kk-KZ&quot;</span>&gt;</span>Ğ°Ğ»Ğ¼Ğ°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>ï¼Œå“ˆè¨å…‹è¯­ä¸­â€œè‹¹æœâ€çš„æ„æ€ï¼Œç»å¸¸è¢«ç¿»è¯‘æˆâ€œè‹¹æœä¹‹ä¹¡â€ã€‚äº‹å®ä¸Šï¼Œé˜¿æ‹‰æœ¨å›¾çš„å‘¨è¾¹åœ°åŒºè¢«è®¤ä¸ºæ˜¯è‹¹æœçš„å‘æºåœ°ï¼Œ<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;la&quot;</span>&gt;</span>Malus sieversii<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> è¢«è®¤ä¸ºæ˜¯ç°ä»Šè‹¹æœçš„ç¥–å…ˆã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Panel</span>(<span class="hljs-params">&#123; title, children, isActive &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;panel&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      &#123;isActive ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsActive(true)&#125;&gt;</span><br><span class="language-xml">          æ˜¾ç¤º</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure></li><li><p><mark>ä¸ºå…±åŒçš„çˆ¶ç»„ä»¶æ·»åŠ  state ï¼Œå¹¶å°†å…¶ä¸äº‹ä»¶å¤„ç†å‡½æ•°ä¸€èµ·å‘ä¸‹ä¼ é€’</mark>ï¼šçŠ¶æ€æå‡é€šå¸¸ä¼šæ”¹å˜åŸçŠ¶æ€çš„æ•°æ®å­˜å‚¨ç±»å‹ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªé¢æ¿ã€‚è¿™æ„å‘³ç€ <code>Accordion</code> è¿™ä¸ªçˆ¶ç»„ä»¶éœ€è¦è®°å½• <strong>å“ªä¸ª</strong> é¢æ¿æ˜¯è¢«æ¿€æ´»çš„é¢æ¿ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ•°å­—ä½œä¸ºå½“å‰è¢«æ¿€æ´» <code>Panel</code> çš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯ <code>boolean</code> å€¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-im9v26lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-im9v26lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [activeIndex, setActiveIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p>å½“ <code>activeIndex</code> ä¸º <code>0</code> æ—¶ï¼Œæ¿€æ´»ç¬¬ä¸€ä¸ªé¢æ¿ï¼Œä¸º <code>1</code> æ—¶ï¼Œæ¿€æ´»ç¬¬äºŒä¸ªé¢æ¿ã€‚</p><p>åœ¨ä»»æ„ä¸€ä¸ª <code>Panel</code> ä¸­ç‚¹å‡»â€œæ˜¾ç¤ºâ€æŒ‰é’®éƒ½éœ€è¦æ›´æ”¹ <code>Accordion</code> ä¸­çš„æ¿€æ´»ç´¢å¼•å€¼ã€‚ <code>Panel</code> ä¸­æ— æ³•ç›´æ¥è®¾ç½®çŠ¶æ€ <code>activeIndex</code> çš„å€¼ï¼Œå› ä¸ºè¯¥çŠ¶æ€æ˜¯åœ¨ <code>Accordion</code> ç»„ä»¶å†…éƒ¨å®šä¹‰çš„ã€‚ <code>Accordion</code> ç»„ä»¶éœ€è¦ <strong>æ˜¾å¼å…è®¸</strong> <code>Panel</code> ç»„ä»¶é€šè¿‡ <a href="http://localhost:3000/learn/responding-to-events#passing-event-handlers-as-props">å°†äº‹ä»¶å¤„ç†ç¨‹åºä½œä¸º prop å‘ä¸‹ä¼ é€’</a> æ¥æ›´æ”¹å…¶çŠ¶æ€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9o52z0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9o52z0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Panel</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;activeIndex</span> === <span class="hljs-string">0&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">onShow</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setActiveIndex(0)&#125;</span><br><span class="language-xml">  &gt;</span><br><span class="language-xml">    ...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Panel</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;activeIndex</span> === <span class="hljs-string">1&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">onShow</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setActiveIndex(1)&#125;</span><br><span class="language-xml">  &gt;</span><br><span class="language-xml">    ...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br>&lt;/&gt;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ <code>Panel</code> ç»„ä»¶ä¸­çš„ <code>&lt;button&gt;</code> å°†ä½¿ç”¨ <code>onShow</code> è¿™ä¸ªå±æ€§ä½œä¸ºå…¶ç‚¹å‡»äº‹ä»¶çš„å¤„ç†ç¨‹åºï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4leb53lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4leb53lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Accordion</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [activeIndex, setActiveIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å“ˆè¨å…‹æ–¯å¦ï¼Œé˜¿æ‹‰æœ¨å›¾<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;å…³äº&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;activeIndex</span> === <span class="hljs-string">0&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onShow</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setActiveIndex(0)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        é˜¿æ‹‰æœ¨å›¾äººå£çº¦200ä¸‡ï¼Œæ˜¯å“ˆè¨å…‹æ–¯å¦æœ€å¤§çš„åŸå¸‚ã€‚å®ƒåœ¨ 1929 å¹´åˆ° 1997 å¹´é—´éƒ½æ˜¯é¦–éƒ½ã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Panel</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;è¯æº&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isActive</span>=<span class="hljs-string">&#123;activeIndex</span> === <span class="hljs-string">1&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onShow</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setActiveIndex(1)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        è¿™ä¸ªåå­—æ¥è‡ªäº <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;kk-KZ&quot;</span>&gt;</span>Ğ°Ğ»Ğ¼Ğ°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>ï¼Œå“ˆè¨å…‹è¯­ä¸­â€œè‹¹æœâ€çš„æ„æ€ï¼Œç»å¸¸è¢«ç¿»è¯‘æˆâ€œè‹¹æœä¹‹ä¹¡â€ã€‚äº‹å®ä¸Šï¼Œé˜¿æ‹‰æœ¨å›¾çš„å‘¨è¾¹åœ°åŒºè¢«è®¤ä¸ºæ˜¯è‹¹æœçš„å‘æºåœ°ï¼Œ<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;la&quot;</span>&gt;</span>Malus sieversii<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> è¢«è®¤ä¸ºæ˜¯ç°ä»Šè‹¹æœçš„ç¥–å…ˆã€‚</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Panel</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Panel</span>(<span class="hljs-params">&#123;</span><br><span class="hljs-params">  title,</span><br><span class="hljs-params">  children,</span><br><span class="hljs-params">  isActive,</span><br><span class="hljs-params">  onShow</span><br><span class="hljs-params">&#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;panel&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;title&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="language-xml">      &#123;isActive ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onShow&#125;</span>&gt;</span></span><br><span class="language-xml">          æ˜¾ç¤º</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure></li></ol><p>è¿™æ ·ï¼Œ<code>Accordion</code> ç»„ä»¶å°±å¯ä»¥æ§åˆ¶ 2 ä¸ª <code>Panel</code> ç»„ä»¶ï¼Œä¿è¯åŒä¸€æ—¶é—´åªèƒ½å±•å¼€ä¸€ä¸ªã€‚æˆ‘ä»¬å°±å®Œæˆäº†å¯¹çŠ¶æ€çš„æå‡ï¼å°†çŠ¶æ€ç§»è‡³å…¬å…±çˆ¶ç»„ä»¶ä¸­å¯ä»¥è®©ä½ æ›´å¥½çš„ç®¡ç†è¿™ä¸¤ä¸ªé¢æ¿ã€‚ä½¿ç”¨æ¿€æ´»ç´¢å¼•å€¼ä»£æ›¿ä¹‹å‰çš„ <code>æ˜¯å¦æ˜¾ç¤º</code> æ ‡è¯†ç¡®ä¿äº†ä¸€æ¬¡åªèƒ½æ¿€æ´»ä¸€ä¸ªé¢æ¿ã€‚è€Œé€šè¿‡å‘ä¸‹ä¼ é€’äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥è®©å­ç»„ä»¶ä¿®æ”¹çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚</p><img src="image-20231109103148744.png" alt="image-20231109103148744" style="zoom:50%;" /><p><mark>å—æ§ç»„ä»¶å’Œéå—æ§ç»„ä»¶</mark>ï¼šé€šå¸¸æˆ‘ä»¬æŠŠåŒ…å«â€œä¸å—æ§åˆ¶â€çŠ¶æ€çš„ç»„ä»¶ç§°ä¸ºâ€œéå—æ§ç»„ä»¶â€ã€‚ä¾‹å¦‚ï¼Œæœ€å¼€å§‹å¸¦æœ‰ <code>isActive</code> çŠ¶æ€å˜é‡çš„ <code>Panel</code> ç»„ä»¶å°±æ˜¯ä¸å—æ§åˆ¶çš„ï¼Œå› ä¸ºå…¶çˆ¶ç»„ä»¶æ— æ³•æ§åˆ¶é¢æ¿çš„æ¿€æ´»çŠ¶æ€ã€‚</p><p>ç›¸åï¼Œå½“ç»„ä»¶ä¸­çš„é‡è¦ä¿¡æ¯æ˜¯ç”± <code>props</code> è€Œä¸æ˜¯å…¶è‡ªèº«çŠ¶æ€é©±åŠ¨æ—¶ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯¥ç»„ä»¶æ˜¯â€œå—æ§ç»„ä»¶â€ã€‚è¿™å°±å…è®¸çˆ¶ç»„ä»¶å®Œå…¨æŒ‡å®šå…¶è¡Œä¸ºã€‚æœ€åå¸¦æœ‰ <code>isActive</code> å±æ€§çš„ <code>Panel</code> ç»„ä»¶æ˜¯ç”± <code>Accordion</code> ç»„ä»¶æ§åˆ¶çš„ã€‚</p><p>éå—æ§ç»„ä»¶é€šå¸¸å¾ˆç®€å•ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦å¤ªå¤šé…ç½®ã€‚ä½†æ˜¯å½“ä½ æƒ³æŠŠå®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå°±ä¸é‚£ä¹ˆçµæ´»äº†ã€‚å—æ§ç»„ä»¶å…·æœ‰æœ€å¤§çš„çµæ´»æ€§ï¼Œä½†å®ƒä»¬éœ€è¦çˆ¶ç»„ä»¶ä½¿ç”¨ <code>props</code> å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œâ€œå—æ§â€å’Œâ€œéå—æ§â€å¹¶ä¸æ˜¯ä¸¥æ ¼çš„æŠ€æœ¯æœ¯è¯­â€”â€”é€šå¸¸æ¯ä¸ªç»„ä»¶éƒ½åŒæ—¶æ‹¥æœ‰å†…éƒ¨çŠ¶æ€å’Œ <code>props</code>ã€‚ç„¶è€Œï¼Œè¿™å¯¹äºç»„ä»¶è¯¥å¦‚ä½•è®¾è®¡å’Œæä¾›ä»€ä¹ˆæ ·åŠŸèƒ½çš„è®¨è®ºæ˜¯æœ‰å¸®åŠ©çš„ã€‚</p><p>å½“ç¼–å†™ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä½ åº”è¯¥è€ƒè™‘å“ªäº›ä¿¡æ¯åº”è¯¥å—æ§åˆ¶ï¼ˆé€šè¿‡ <code>props</code>ï¼‰ï¼Œå“ªäº›ä¿¡æ¯ä¸åº”è¯¥å—æ§åˆ¶ï¼ˆé€šè¿‡ <code>state</code>ï¼‰ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥éšæ—¶æ”¹å˜ä¸»æ„å¹¶é‡æ„ä»£ç ã€‚</p><hr><p><mark>æ¯ä¸ªçŠ¶æ€éƒ½å¯¹åº”å”¯ä¸€çš„æ•°æ®æº </mark>ï¼šåœ¨ <code>React</code> åº”ç”¨ä¸­ï¼Œå¾ˆå¤šç»„ä»¶éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ã€‚ä¸€äº›çŠ¶æ€å¯èƒ½â€œæ´»è·ƒâ€åœ¨å¶å­ç»„ä»¶ï¼ˆæ ‘å½¢ç»“æ„æœ€åº•å±‚çš„ç»„ä»¶ï¼‰é™„è¿‘ï¼Œä¾‹å¦‚è¾“å…¥æ¡†ã€‚å¦ä¸€äº›çŠ¶æ€å¯èƒ½åœ¨åº”ç”¨ç¨‹åºé¡¶éƒ¨â€œæ´»åŠ¨â€ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯è·¯ç”±åº“ä¹Ÿæ˜¯é€šè¿‡å°†å½“å‰è·¯ç”±å­˜å‚¨åœ¨ <code>React</code> çŠ¶æ€ä¸­ï¼Œåˆ©ç”¨ <code>props</code> å°†çŠ¶æ€å±‚å±‚ä¼ é€’ä¸‹å»æ¥å®ç°çš„ï¼</p><p><strong>å¯¹äºæ¯ä¸ªç‹¬ç‰¹çš„çŠ¶æ€ï¼Œéƒ½åº”è¯¥å­˜åœ¨ä¸”åªå­˜åœ¨äºä¸€ä¸ªæŒ‡å®šçš„ç»„ä»¶ä¸­ä½œä¸º state</strong>ã€‚è¿™ä¸€åŸåˆ™ä¹Ÿè¢«ç§°ä¸ºæ‹¥æœ‰ <a href="https://en.wikipedia.org/wiki/Single_source_of_truth">â€œå¯ä¿¡å•ä¸€æ•°æ®æºâ€</a>ã€‚å®ƒå¹¶ä¸æ„å‘³ç€æ‰€æœ‰çŠ¶æ€éƒ½å­˜åœ¨ä¸€ä¸ªåœ°æ–¹â€”â€”å¯¹æ¯ä¸ªçŠ¶æ€æ¥è¯´ï¼Œéƒ½éœ€è¦ä¸€ä¸ªç‰¹å®šçš„ç»„ä»¶æ¥ä¿å­˜è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚ä½ åº”è¯¥ <strong>å°†çŠ¶æ€æå‡</strong> åˆ°å…¬å…±çˆ¶çº§ï¼Œæˆ– <strong>å°†çŠ¶æ€ä¼ é€’</strong> åˆ°éœ€è¦å®ƒçš„å­çº§ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç»„ä»¶ä¹‹é—´å¤åˆ¶å…±äº«çš„çŠ¶æ€ã€‚</p><p>ä½ çš„åº”ç”¨ä¼šéšç€ä½ çš„æ“ä½œè€Œå˜åŒ–ã€‚å½“ä½ å°†çŠ¶æ€ä¸Šä¸‹ç§»åŠ¨æ—¶ï¼Œä½ ä¾ç„¶ä¼šæƒ³è¦ç¡®å®šæ¯ä¸ªçŠ¶æ€åœ¨å“ªé‡Œâ€œæ´»è·ƒâ€ã€‚è¿™éƒ½æ˜¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼</p><h2 id="4-å¯¹stateè¿›è¡Œä¿ç•™å’Œé‡ç½®"><a href="#4-å¯¹stateè¿›è¡Œä¿ç•™å’Œé‡ç½®" class="headerlink" title="4.å¯¹stateè¿›è¡Œä¿ç•™å’Œé‡ç½®"></a>4.å¯¹stateè¿›è¡Œä¿ç•™å’Œé‡ç½®</h2><p>å„ä¸ªç»„ä»¶çš„ state æ˜¯å„è‡ªç‹¬ç«‹çš„ã€‚æ ¹æ®ç»„ä»¶åœ¨ UI æ ‘ä¸­çš„ä½ç½®ï¼ŒReact å¯ä»¥è·Ÿè¸ªå“ªäº› state å±äºå“ªä¸ªç»„ä»¶ã€‚ä½ å¯ä»¥æ§åˆ¶åœ¨é‡æ–°æ¸²æŸ“è¿‡ç¨‹ä¸­ä½•æ—¶å¯¹ state è¿›è¡Œä¿ç•™å’Œé‡ç½®ã€‚</p><p><mark>çŠ¶æ€ä¸æ¸²æŸ“æ ‘ä¸­çš„ä½ç½®ç›¸å…³</mark>ï¼šReact ä¼šä¸º UI ä¸­çš„ç»„ä»¶ç»“æ„æ„å»º <a href="http://localhost:3000/learn/understanding-your-ui-as-a-tree#the-render-tree">æ¸²æŸ“æ ‘</a>ã€‚å½“å‘ä¸€ä¸ªç»„ä»¶æ·»åŠ çŠ¶æ€æ—¶ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šè®¤ä¸ºçŠ¶æ€â€œå­˜åœ¨â€åœ¨ç»„ä»¶å†…ã€‚ä½†å®é™…ä¸Šï¼ŒçŠ¶æ€æ˜¯ç”± React ä¿å­˜çš„ã€‚React é€šè¿‡ç»„ä»¶åœ¨æ¸²æŸ“æ ‘ä¸­çš„ä½ç½®å°†å®ƒä¿å­˜çš„æ¯ä¸ªçŠ¶æ€ä¸æ­£ç¡®çš„ç»„ä»¶å…³è”èµ·æ¥ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­åªæœ‰ä¸€ä¸ª <code>&lt;Counter /&gt;</code> JSX æ ‡ç­¾ï¼Œä½†å®ƒä¼šåœ¨ä¸¤ä¸ªä¸åŒçš„ä½ç½®æ¸²æŸ“ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f3ka5jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f3ka5jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> counter = <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span>;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;counter&#125;</span><br><span class="language-xml">      &#123;counter&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231109111059717.png" alt="image-20231109111059717" style="zoom:50%;" /><p>Reactæ ‘ï¼š</p><img src="image-20231109111139160.png" alt="image-20231109111139160" style="zoom:50%;" /><p><strong><mark>è¿™æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ counterï¼Œå› ä¸ºå®ƒä»¬åœ¨æ ‘ä¸­è¢«æ¸²æŸ“åœ¨äº†å„è‡ªçš„ä½ç½®ã€‚</mark></strong> ä¸€èˆ¬æƒ…å†µä¸‹ä½ ä¸ç”¨å»è€ƒè™‘è¿™äº›ä½ç½®æ¥ä½¿ç”¨ Reactï¼Œä½†çŸ¥é“å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>åœ¨ React ä¸­ï¼Œå±å¹•ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰å®Œå…¨ç‹¬ç«‹çš„ stateã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ å¹¶æ’æ¸²æŸ“ä¸¤ä¸ª <code>Counter</code> ç»„ä»¶æ—¶ï¼Œå®ƒä»¬éƒ½ä¼šæ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„ <code>score</code> å’Œ <code>hover</code> stateã€‚</p><p>å½“ä¸€ä¸ªè®¡æ•°å™¨è¢«æ›´æ–°æ—¶ï¼Œåªæœ‰è¯¥ç»„ä»¶çš„çŠ¶æ€ä¼šè¢«æ›´æ–°ï¼š</p><img src="image-20231109111343125.png" alt="image-20231109111343125" style="zoom:50%;" /><p><mark>åªæœ‰å½“åœ¨æ ‘ä¸­ç›¸åŒçš„ä½ç½®æ¸²æŸ“ç›¸åŒçš„ç»„ä»¶æ—¶ï¼ŒReact æ‰ä¼šä¸€ç›´ä¿ç•™ç€ç»„ä»¶çš„ state</mark>ã€‚æƒ³è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œå¯ä»¥å°†ä¸¤ä¸ªè®¡æ•°å™¨çš„å€¼é€’å¢ï¼Œå–æ¶ˆå‹¾é€‰ â€œæ¸²æŸ“ç¬¬äºŒä¸ªè®¡æ•°å™¨â€ å¤é€‰æ¡†ï¼Œç„¶åå†æ¬¡å‹¾é€‰å®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vj1vvelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vj1vvelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [showB, setShowB] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span><br><span class="language-xml">      &#123;showB &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span>&#125; </span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;showB&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            setShowB(e.target.checked)</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        æ¸²æŸ“ç¬¬äºŒä¸ªè®¡æ•°å™¨</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="counter.gif" alt="counter" style="zoom:50%;" /><p>å½“ä½ åœæ­¢æ¸²æŸ“ç¬¬äºŒä¸ªè®¡æ•°å™¨çš„é‚£ä¸€åˆ»ï¼Œå®ƒçš„ state å®Œå…¨æ¶ˆå¤±äº†ã€‚è¿™æ˜¯å› ä¸º <mark>React åœ¨ç§»é™¤ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä¹Ÿä¼šé”€æ¯å®ƒçš„ state</mark>ã€‚</p><p>å½“ä½ é‡æ–°å‹¾é€‰â€œæ¸²æŸ“ç¬¬äºŒä¸ªè®¡æ•°å™¨â€å¤é€‰æ¡†æ—¶ï¼Œå¦ä¸€ä¸ªè®¡æ•°å™¨åŠå…¶ state å°†ä»å¤´å¼€å§‹åˆå§‹åŒ–ï¼ˆ<code>score = 0</code>ï¼‰å¹¶è¢«æ·»åŠ åˆ° DOM ä¸­ã€‚</p><p><strong><mark>åªè¦ä¸€ä¸ªç»„ä»¶è¿˜è¢«æ¸²æŸ“åœ¨ UI æ ‘çš„ç›¸åŒä½ç½®ï¼ŒReact å°±ä¼šä¿ç•™å®ƒçš„ state</mark>ã€‚</strong> å¦‚æœå®ƒè¢«ç§»é™¤ï¼Œæˆ–è€…ä¸€ä¸ªä¸åŒçš„ç»„ä»¶è¢«æ¸²æŸ“åœ¨ç›¸åŒçš„ä½ç½®ï¼Œé‚£ä¹ˆ React å°±ä¼šä¸¢æ‰å®ƒçš„ stateã€‚</p><hr><p><mark>ç›¸åŒä½ç½®çš„ç›¸åŒç»„ä»¶ä¼šä½¿å¾— state è¢«ä¿ç•™ä¸‹æ¥ </mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-79ridelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-79ridelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isFancy, setIsFancy] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isFancy ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;true&#125;</span> /&gt;</span> </span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;false&#125;</span> /&gt;</span> </span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isFancy&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            setIsFancy(e.target.checked)</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        ä½¿ç”¨å¥½çœ‹çš„æ ·å¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; isFancy &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (isFancy) &#123;<br>    className += <span class="hljs-string">&#x27; fancy&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="fancy1.gif" alt="fancy1" style="zoom:50%;" /><p>å½“ä½ å‹¾é€‰æˆ–æ¸…ç©ºå¤é€‰æ¡†çš„æ—¶å€™ï¼Œè®¡æ•°å™¨ state å¹¶æ²¡æœ‰è¢«é‡ç½®ã€‚ä¸ç®¡ <code>isFancy</code> æ˜¯ <code>true</code> è¿˜æ˜¯ <code>false</code>ï¼Œæ ¹ç»„ä»¶ <code>App</code> è¿”å›çš„ <code>div</code> çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶éƒ½æ˜¯ <code>&lt;Counter /&gt;</code>ï¼š</p><img src="image-20231109135330938.png" alt="image-20231109135330938" style="zoom:50%;" /><p>æ›´æ–° <code>App</code> çš„çŠ¶æ€ä¸ä¼šé‡ç½® <code>Counter</code>ï¼Œå› ä¸º <code>Counter</code> å§‹ç»ˆä¿æŒåœ¨åŒä¸€ä½ç½®ã€‚<mark>å®ƒæ˜¯ä½äºç›¸åŒä½ç½®çš„ç›¸åŒç»„ä»¶ï¼Œæ‰€ä»¥å¯¹ React æ¥è¯´ï¼Œå®ƒæ˜¯åŒä¸€ä¸ªè®¡æ•°å™¨ã€‚</mark></p><p><mark>è®°ä½ å¯¹ React æ¥è¯´é‡è¦çš„æ˜¯ç»„ä»¶åœ¨ UI æ ‘ä¸­çš„ä½ç½®,è€Œä¸æ˜¯åœ¨ JSX ä¸­çš„ä½ç½®ï¼ </mark></p><p>è¿™ä¸ªç»„ä»¶åœ¨ <code>if</code> å†…å¤–æœ‰ä¸¤ä¸ª<code>return</code> è¯­å¥ï¼Œå®ƒä»¬å¸¦æœ‰ä¸åŒçš„ <code>&lt;Counter /&gt;</code> JSX æ ‡ç­¾ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v6tgo0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v6tgo0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isFancy, setIsFancy] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">if</span> (isFancy) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;true&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isFancy&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">              setIsFancy(e.target.checked)</span><br><span class="language-xml">            &#125;&#125;</span><br><span class="language-xml">          /&gt;</span><br><span class="language-xml">          ä½¿ç”¨å¥½çœ‹çš„æ ·å¼</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>    );<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;false&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isFancy&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            setIsFancy(e.target.checked)</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        ä½¿ç”¨å¥½çœ‹çš„æ ·å¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; isFancy &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (isFancy) &#123;<br>    className += <span class="hljs-string">&#x27; fancy&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="fancy1.gif" alt="fancy1" style="zoom:50%;" /><p>ä½ å¯èƒ½ä»¥ä¸ºå½“ä½ å‹¾é€‰å¤é€‰æ¡†çš„æ—¶å€™ state ä¼šè¢«é‡ç½®ï¼Œä½†å®ƒå¹¶æ²¡æœ‰ï¼è¿™æ˜¯å› ä¸º <strong>ä¸¤ä¸ª <code>&lt;Counter /&gt;</code> æ ‡ç­¾<mark>è¢«æ¸²æŸ“åœ¨äº†ç›¸åŒçš„ä½ç½®</mark>ã€‚</strong> React ä¸çŸ¥é“ä½ çš„å‡½æ•°é‡Œæ˜¯å¦‚ä½•è¿›è¡Œæ¡ä»¶åˆ¤æ–­çš„ï¼Œå®ƒåªä¼šâ€œçœ‹åˆ°â€ä½ è¿”å›çš„æ ‘ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œ<code>App</code> ç»„ä»¶éƒ½ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹ç€ <code>&lt;Counter /&gt;</code> ä½œä¸ºç¬¬ä¸€ä¸ªå­ç»„ä»¶çš„ <code>div</code>ã€‚è¿™å°±æ˜¯ React è®¤ä¸ºå®ƒä»¬æ˜¯ <strong>åŒä¸€ä¸ª</strong> <code>&lt;Counter /&gt;</code> çš„åŸå› ã€‚</p><p>ä½ å¯ä»¥è®¤ä¸ºå®ƒä»¬æœ‰ç›¸åŒçš„â€œåœ°å€â€ï¼šæ ¹ç»„ä»¶çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶ã€‚ä¸ç®¡ä½ çš„é€»è¾‘æ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Œè¿™å°±æ˜¯ React åœ¨å‰åä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´å°†å®ƒä»¬è¿›è¡ŒåŒ¹é…çš„æ–¹å¼ã€‚</p><p><mark>ç›¸åŒä½ç½®çš„ä¸åŒç»„ä»¶ä¼šä½¿ state é‡ç½® </mark>ï¼šåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‹¾é€‰å¤é€‰æ¡†ä¼šå°† <code>&lt;Counter&gt;</code> æ›¿æ¢ä¸ºä¸€ä¸ª <code>&lt;p&gt;</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gd51a6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gd51a6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPaused, setIsPaused] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isPaused ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¾…ä¼šè§ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> </span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span> </span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isPaused&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            setIsPaused(e.target.checked)</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        ä¼‘æ¯ä¸€ä¸‹</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="fancy2-1699509744853-4.gif" alt="fancy2" style="zoom:50%;" /><p>åœ¨ç›¸åŒä½ç½®å¯¹ <strong>ä¸åŒ</strong> çš„ç»„ä»¶ç±»å‹è¿›è¡Œåˆ‡æ¢ã€‚åˆšå¼€å§‹ <code>&lt;div&gt;</code> çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶æ˜¯ä¸€ä¸ª <code>Counter</code>ã€‚ä½†æ˜¯å½“ä½ åˆ‡æ¢æˆ <code>p</code> æ—¶ï¼ŒReact å°† <code>Counter</code> ä» UI æ ‘ä¸­ç§»é™¤äº†å¹¶é”€æ¯äº†å®ƒçš„çŠ¶æ€ã€‚</p><img src="image-20231109140248758.png" alt="image-20231109140248758" style="zoom:50%;" /><p>å½“åˆ‡æ¢å›æ¥æ—¶ï¼Œ<code>p</code> ä¼šè¢«åˆ é™¤ï¼Œè€Œ <code>Counter</code> ä¼šè¢«æ·»åŠ ï¼š</p><img src="image-20231109140313803.png" alt="image-20231109140313803" style="zoom:50%;" /><p><mark>å½“ä½ åœ¨ç›¸åŒä½ç½®æ¸²æŸ“ä¸åŒçš„ç»„ä»¶æ—¶ï¼Œç»„ä»¶çš„æ•´ä¸ªå­æ ‘éƒ½ä¼šè¢«é‡ç½®</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zddnzzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zddnzzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isFancy, setIsFancy] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isFancy ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;true&#125;</span> /&gt;</span> </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;false&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isFancy&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            setIsFancy(e.target.checked)</span><br><span class="language-xml">          &#125;&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        ä½¿ç”¨å¥½çœ‹çš„æ ·å¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; isFancy &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (isFancy) &#123;<br>    className += <span class="hljs-string">&#x27; fancy&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="fancy3.gif" style="zoom:50%;" /><p>å½“ä½ å‹¾é€‰å¤é€‰æ¡†åè®¡æ•°å™¨çš„ state è¢«é‡ç½®äº†ã€‚è™½ç„¶ä½ æ¸²æŸ“äº†ä¸€ä¸ª <code>Counter</code>ï¼Œä½†æ˜¯ <code>div</code> çš„ç¬¬ä¸€ä¸ªå­ç»„ä»¶ä» <code>div</code> å˜æˆäº† <code>section</code>ã€‚å½“å­ç»„ä»¶ <code>div</code> ä» DOM ä¸­è¢«ç§»é™¤çš„æ—¶å€™ï¼Œå®ƒåº•ä¸‹çš„æ•´æ£µæ ‘ï¼ˆåŒ…å« <code>Counter</code> ä»¥åŠå®ƒçš„ stateï¼‰ä¹Ÿéƒ½è¢«é”€æ¯äº†ã€‚</p><p>å½“ <code>section</code> å˜ä¸º <code>div</code> æ—¶ï¼Œ<code>section</code> ä¼šè¢«åˆ é™¤ï¼Œæ–°çš„ <code>div</code> è¢«æ·»åŠ ï¼š</p><img src="image-20231109140745131.png" alt="image-20231109140745131" style="zoom:50%;" /><p>å½“åˆ‡æ¢å›æ¥æ—¶ï¼Œ<code>div</code> ä¼šè¢«åˆ é™¤ï¼Œæ–°çš„ <code>section</code> è¢«æ·»åŠ ï¼š</p><img src="image-20231109140804072.png" alt="image-20231109140804072" style="zoom:50%;" /><p><mark><strong>å¦‚æœä½ æƒ³åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¿ç•™ stateï¼Œå‡ æ¬¡æ¸²æŸ“ä¸­çš„æ ‘å½¢ç»“æ„å°±åº”è¯¥ç›¸äº’â€œåŒ¹é…â€</strong>ã€‚ç»“æ„ä¸åŒå°±ä¼šå¯¼è‡´ state çš„é”€æ¯ï¼Œå› ä¸º React ä¼šåœ¨å°†ä¸€ä¸ªç»„ä»¶ä»æ ‘ä¸­ç§»é™¤æ—¶é”€æ¯å®ƒçš„ stateã€‚</mark></p><p><mark>ä¸åº”è¯¥æŠŠç»„ä»¶å‡½æ•°çš„å®šä¹‰åµŒå¥—èµ·æ¥</mark>ï¼šç¤ºä¾‹ä¸­ï¼Œ <code>MyTextField</code> ç»„ä»¶è¢«å®šä¹‰åœ¨ <code>MyComponent</code> <strong>å†…éƒ¨</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6i3gb7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6i3gb7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [counter, setCounter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyTextField</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyTextField</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setCounter(counter + 1)</span><br><span class="language-xml">      &#125;&#125;&gt;ç‚¹å‡»äº† &#123;counter&#125; æ¬¡<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="click.gif" alt="click" style="zoom:50%;" /><p>æ¯æ¬¡ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè¾“å…¥æ¡†çš„ state éƒ½ä¼šæ¶ˆå¤±ï¼è¿™æ˜¯å› ä¸ºæ¯æ¬¡ <code>MyComponent</code> æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ª <strong>ä¸åŒ</strong> çš„ <code>MyTextField</code> å‡½æ•°ã€‚ä½ åœ¨ç›¸åŒä½ç½®æ¸²æŸ“çš„æ˜¯ <strong>ä¸åŒ</strong> çš„ç»„ä»¶ï¼Œæ‰€ä»¥ React å°†å…¶ä¸‹æ‰€æœ‰çš„ state éƒ½é‡ç½®äº†ã€‚è¿™æ ·ä¼šå¯¼è‡´ bug ä»¥åŠæ€§èƒ½é—®é¢˜ã€‚<mark>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œ <strong>æ°¸è¿œè¦å°†ç»„ä»¶å®šä¹‰åœ¨æœ€ä¸Šå±‚å¹¶ä¸”ä¸è¦æŠŠå®ƒä»¬çš„å®šä¹‰åµŒå¥—èµ·æ¥ã€‚</strong></mark></p><p><mark>åœ¨ç›¸åŒä½ç½®é‡ç½® state</mark>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¼šåœ¨ä¸€ä¸ªç»„ä»¶ä¿æŒåœ¨åŒä¸€ä½ç½®æ—¶ä¿ç•™å®ƒçš„ stateã€‚é€šå¸¸è¿™å°±æ˜¯ä½ æƒ³è¦çš„ï¼Œæ‰€ä»¥æŠŠå®ƒä½œä¸ºé»˜è®¤ç‰¹æ€§å¾ˆåˆç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³è¦é‡ç½®ä¸€ä¸ªç»„ä»¶çš„ stateã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªåº”ç”¨ï¼Œå®ƒå¯ä»¥è®©ä¸¤ä¸ªç©å®¶åœ¨æ¯ä¸ªå›åˆä¸­è®°å½•ä»–ä»¬çš„å¾—åˆ†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-eiusm1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-eiusm1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Scoreboard</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlayerA, setIsPlayerA] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isPlayerA ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Taylor&quot;</span> /&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Sarah&quot;</span> /&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setIsPlayerA(!isPlayerA);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        ä¸‹ä¸€ä½ç©å®¶ï¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; person &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;person&#125; çš„åˆ†æ•°ï¼š&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="score.gif" alt="score" style="zoom:50%;" /><p>ç›®å‰å½“ä½ åˆ‡æ¢ç©å®¶æ—¶ï¼Œåˆ†æ•°ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚è¿™ä¸¤ä¸ª <code>Counter</code> å‡ºç°åœ¨ç›¸åŒçš„ä½ç½®ï¼Œæ‰€ä»¥ React ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ <strong>åŒä¸€ä¸ª</strong> <code>Counter</code>ï¼Œåªæ˜¯ä¼ äº†ä¸åŒçš„ <code>person</code> propã€‚</p><p>ä½†æ˜¯ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™ä¸ªåº”ç”¨ä¸­çš„ä¸¤ä¸ªè®¡æ•°å™¨åº”è¯¥æ˜¯å„è‡ªç‹¬ç«‹çš„ã€‚è™½ç„¶å®ƒä»¬åœ¨ UI ä¸­çš„ä½ç½®ç›¸åŒï¼Œä½†æ˜¯ä¸€ä¸ªæ˜¯ Taylor çš„è®¡æ•°å™¨ï¼Œä¸€ä¸ªæ˜¯ Sarah çš„è®¡æ•°å™¨ã€‚</p><p>æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åœ¨å®ƒä»¬ç›¸äº’åˆ‡æ¢æ—¶é‡ç½® stateï¼š</p><ol><li><p>å°†ç»„ä»¶æ¸²æŸ“åœ¨ä¸åŒçš„ä½ç½®ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sfiutelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sfiutelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Scoreboard</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlayerA, setIsPlayerA] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isPlayerA &amp;&amp;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Taylor&quot;</span> /&gt;</span></span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">      &#123;!isPlayerA &amp;&amp;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Sarah&quot;</span> /&gt;</span></span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setIsPlayerA(!isPlayerA);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        ä¸‹ä¸€ä½ç©å®¶ï¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; person &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;person&#125; çš„åˆ†æ•°ï¼š&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="score2.gif" alt="score2" style="zoom:50%;" /><p>èµ·åˆ <code>isPlayerA</code> çš„å€¼æ˜¯ <code>true</code>ã€‚æ‰€ä»¥ç¬¬ä¸€ä¸ªä½ç½®åŒ…å«äº† <code>Counter</code> çš„ stateï¼Œè€Œç¬¬äºŒä¸ªä½ç½®æ˜¯ç©ºçš„ã€‚</p><p>å½“ä½ ç‚¹å‡»â€œä¸‹ä¸€ä½ç©å®¶â€æŒ‰é’®æ—¶ï¼Œç¬¬ä¸€ä¸ªä½ç½®ä¼šè¢«æ¸…ç©ºï¼Œè€Œç¬¬äºŒä¸ªä½ç½®ç°åœ¨åŒ…å«äº†ä¸€ä¸ª <code>Counter</code>ã€‚</p><img src="image-20231109142132582.png" alt="image-20231109142132582" style="zoom:50%;" /></li><li><p>ä½¿ç”¨ <code>key</code> èµ‹äºˆæ¯ä¸ªç»„ä»¶ä¸€ä¸ªæ˜ç¡®çš„èº«ä»½ï¼š<mark>ä½¿ç”¨ key æ¥è®© React åŒºåˆ†ä»»ä½•ç»„ä»¶</mark>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä½¿ç”¨çˆ¶ç»„ä»¶å†…éƒ¨çš„é¡ºåºï¼ˆâ€œç¬¬ä¸€ä¸ªè®¡æ•°å™¨â€ã€â€œç¬¬äºŒä¸ªè®¡æ•°å™¨â€ï¼‰æ¥åŒºåˆ†ç»„ä»¶ã€‚ä½†æ˜¯ key å¯ä»¥è®©ä½ å‘Šè¯‰ React è¿™ä¸ä»…ä»…æ˜¯ <strong>ç¬¬ä¸€ä¸ª</strong> æˆ–è€… <strong>ç¬¬äºŒä¸ª</strong> è®¡æ•°å™¨ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªç‰¹å®šçš„è®¡æ•°å™¨â€”â€”ä¾‹å¦‚ï¼Œ<strong>Taylor çš„</strong> è®¡æ•°å™¨ã€‚è¿™æ ·æ— è®ºå®ƒå‡ºç°åœ¨æ ‘çš„ä»»ä½•ä½ç½®ï¼Œ React éƒ½ä¼šçŸ¥é“å®ƒæ˜¯ <strong>Taylor çš„</strong> è®¡æ•°å™¨ï¼</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿ä¸¤ä¸ª <code>&lt;Counter /&gt;</code> ä¼šå‡ºç°åœ¨ JSX ä¸­çš„åŒä¸€ä¸ªä½ç½®ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šå…±äº« stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l19xz5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l19xz5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Scoreboard</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlayerA, setIsPlayerA] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;isPlayerA ? (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;Taylor&quot;</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Taylor&quot;</span> /&gt;</span></span><br><span class="language-xml">      ) : (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;Sarah&quot;</span> <span class="hljs-attr">person</span>=<span class="hljs-string">&quot;Sarah&quot;</span> /&gt;</span></span><br><span class="language-xml">      )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setIsPlayerA(!isPlayerA);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        ä¸‹ä¸€ä½ç©å®¶ï¼</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">&#123; person &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [score, setScore] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [hover, setHover] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">let</span> className = <span class="hljs-string">&#x27;counter&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (hover) &#123;<br>    className += <span class="hljs-string">&#x27; hover&#x27;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;className&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onPointerEnter</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span><br><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span><br><span class="language-xml">    &gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;person&#125; çš„åˆ†æ•°ï¼š&#123;score&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;</span><br><span class="language-xml">        åŠ ä¸€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="score3.gif" alt="score3" style="zoom:50%;" /><p>æŒ‡å®šä¸€ä¸ª <code>key</code> èƒ½å¤Ÿè®© React å°† <code>key</code> æœ¬èº«è€Œéå®ƒä»¬åœ¨çˆ¶ç»„ä»¶ä¸­çš„é¡ºåºä½œä¸ºä½ç½®çš„ä¸€éƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°½ç®¡ä½ ç”¨ JSX å°†ç»„ä»¶æ¸²æŸ“åœ¨ç›¸åŒä½ç½®ï¼Œä½†åœ¨ React çœ‹æ¥å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„è®¡æ•°å™¨ã€‚å› æ­¤å®ƒä»¬æ°¸è¿œéƒ½ä¸ä¼šå…±äº« stateã€‚æ¯å½“ä¸€ä¸ªè®¡æ•°å™¨å‡ºç°åœ¨å±å¹•ä¸Šæ—¶ï¼Œå®ƒçš„ state ä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚æ¯å½“å®ƒè¢«ç§»é™¤æ—¶ï¼Œå®ƒçš„ state å°±ä¼šè¢«é”€æ¯ã€‚åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ä¼šä¸€æ¬¡åˆä¸€æ¬¡åœ°ä½¿å®ƒä»¬çš„ state é‡ç½®ã€‚</p><p><mark>è¯·è®°ä½ key ä¸æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚å®ƒä»¬åªèƒ½æŒ‡å®š <strong>çˆ¶ç»„ä»¶å†…éƒ¨</strong> çš„é¡ºåºã€‚</mark></p></li></ol><p><mark>ä½¿ç”¨ key æ¥é‡ç½® state åœ¨å¤„ç†è¡¨å•æ—¶ç‰¹åˆ«æœ‰ç”¨</mark>ï¼šåœ¨è¿™ä¸ªèŠå¤©åº”ç”¨ä¸­ï¼Œ <code>&lt;Chat&gt;</code> ç»„ä»¶åŒ…å«æ–‡æœ¬è¾“å…¥ stateï¼šåªéœ€ç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ª <code>key</code> å°±å¯ä»¥ç¡®ä¿äº†å½“ä½ é€‰æ‹©ä¸€ä¸ªä¸åŒçš„æ”¶ä»¶äººæ—¶ï¼Œ <code>Chat</code> ç»„ä»¶â€”â€”åŒ…æ‹¬å…¶ä¸‹æ–¹æ ‘ä¸­çš„ä»»ä½• stateâ€”â€”éƒ½å°†ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºã€‚ React è¿˜å°†é‡æ–°åˆ›å»º DOM å…ƒç´ ï¼Œè€Œä¸æ˜¯å¤ç”¨å®ƒä»¬ã€‚åˆ‡æ¢æ”¶ä»¶äººå°±æ€»ä¼šæ¸…é™¤æ–‡æœ¬å­—æ®µï¼š</p><p>Chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q39a4blqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q39a4blqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Chat</span>(<span class="hljs-params">&#123; contact &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;chat&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">è·Ÿ</span> &#x27; + <span class="hljs-attr">contact.name</span> + &#x27; <span class="hljs-attr">èŠä¸€èŠ</span>&#x27;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>å‘é€åˆ° &#123;contact.email&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ContatctList.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2lbag4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2lbag4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ContactList</span>(<span class="hljs-params">&#123;</span><br><span class="hljs-params">  selectedContact,</span><br><span class="hljs-params">  contacts,</span><br><span class="hljs-params">  onSelect</span><br><span class="hljs-params">&#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;contact-list&quot;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">        &#123;contacts.map(contact =&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;contact.id&#125;</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">              onSelect(contact);</span><br><span class="language-xml">            &#125;&#125;&gt;</span><br><span class="language-xml">              &#123;contact.name&#125;</span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yp9yz5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yp9yz5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Chat</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Chat.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ContactList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ContactList.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Messenger</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [to, setTo] = <span class="hljs-title function_">useState</span>(contacts[<span class="hljs-number">0</span>]);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ContactList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">contacts</span>=<span class="hljs-string">&#123;contacts&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">selectedContact</span>=<span class="hljs-string">&#123;to&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onSelect</span>=<span class="hljs-string">&#123;contact</span> =&gt;</span> setTo(contact)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Chat</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;to.id&#125;</span> <span class="hljs-attr">contact</span>=<span class="hljs-string">&#123;to&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  )<br>&#125;<br><br><span class="hljs-keyword">const</span> contacts = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Taylor&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;taylor@mail.com&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;alice@mail.com&#x27;</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">&#x27;bob@mail.com&#x27;</span> &#125;<br>];<br></code></pre></td></tr></table></div></figure><img src="chat.gif" alt="chat" style="zoom:50%;" /><p><mark>ä¸ºè¢«ç§»é™¤çš„ç»„ä»¶ä¿ç•™ state</mark>ï¼šåœ¨çœŸæ­£çš„èŠå¤©åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šæƒ³åœ¨ç”¨æˆ·å†æ¬¡é€‰æ‹©å‰ä¸€ä¸ªæ”¶ä»¶äººæ—¶æ¢å¤è¾“å…¥ stateã€‚å¯¹äºä¸€ä¸ªä¸å¯è§çš„ç»„ä»¶ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥è®©å®ƒçš„ state â€œæ´»ä¸‹å»â€ï¼š</p><ul><li>ä¸å…¶åªæ¸²æŸ“ç°åœ¨è¿™ä¸€ä¸ªèŠå¤©ï¼Œä½ å¯ä»¥æŠŠ <strong>æ‰€æœ‰</strong> èŠå¤©éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œä½†ç”¨ CSS æŠŠå…¶ä»–èŠå¤©éšè—èµ·æ¥ã€‚è¿™äº›èŠå¤©å°±ä¸ä¼šä»æ ‘ä¸­è¢«ç§»é™¤äº†ï¼Œæ‰€ä»¥å®ƒä»¬çš„å†…éƒ¨ state ä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚è¿™ç§è§£å†³æ–¹æ³•å¯¹äºç®€å• UI éå¸¸æœ‰æ•ˆã€‚ä½†å¦‚æœè¦éšè—çš„æ ‘å½¢ç»“æ„å¾ˆå¤§ä¸”åŒ…å«äº†å¤§é‡çš„ DOM èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ€§èƒ½å°±ä¼šå˜å¾—å¾ˆå·®ã€‚</li><li>ä½ å¯ä»¥è¿›è¡Œ <a href="http://localhost:3000/learn/sharing-state-between-components">çŠ¶æ€æå‡</a> å¹¶åœ¨çˆ¶ç»„ä»¶ä¸­ä¿å­˜æ¯ä¸ªæ”¶ä»¶äººçš„è‰ç¨¿æ¶ˆæ¯ã€‚è¿™æ ·å³ä½¿å­ç»„ä»¶è¢«ç§»é™¤äº†ä¹Ÿæ— æ‰€è°“ï¼Œå› ä¸ºä¿ç•™é‡è¦ä¿¡æ¯çš„æ˜¯çˆ¶ç»„ä»¶ã€‚è¿™æ˜¯æœ€å¸¸è§çš„è§£å†³æ–¹æ³•ã€‚</li><li>é™¤äº† React çš„ stateï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ•°æ®æºã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸ä½ å¸Œæœ›å³ä½¿ç”¨æˆ·ä¸å°å¿ƒå…³é—­é¡µé¢ä¹Ÿå¯ä»¥ä¿å­˜ä¸€ä»½ä¿¡æ¯è‰ç¨¿ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥è®© <code>Chat</code> ç»„ä»¶é€šè¿‡è¯»å– <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage"><code>localStorage</code></a> å¯¹å…¶ state è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶æŠŠè‰ç¨¿ä¿å­˜åœ¨é‚£é‡Œã€‚</li></ul><h2 id="5-è¿ç§»çŠ¶æ€é€»è¾‘è‡³-Reducer-ä¸­"><a href="#5-è¿ç§»çŠ¶æ€é€»è¾‘è‡³-Reducer-ä¸­" class="headerlink" title="5.è¿ç§»çŠ¶æ€é€»è¾‘è‡³ Reducer ä¸­"></a>5.è¿ç§»çŠ¶æ€é€»è¾‘è‡³ Reducer ä¸­</h2><p>å¯¹äºæ‹¥æœ‰è®¸å¤šçŠ¶æ€æ›´æ–°é€»è¾‘çš„ç»„ä»¶æ¥è¯´ï¼Œè¿‡äºåˆ†æ•£çš„äº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šä»¤äººä¸çŸ¥æ‰€æªã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥å°†ç»„ä»¶çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°é€»è¾‘æ•´åˆåˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å«ä½œ <strong>reducer</strong>ã€‚</p><p><mark>ä½¿ç”¨ reducer æ•´åˆçŠ¶æ€é€»è¾‘</mark>ï¼šéšç€ç»„ä»¶å¤æ‚åº¦çš„å¢åŠ ï¼Œä½ å°†å¾ˆéš¾ä¸€çœ¼çœ‹æ¸…æ‰€æœ‰çš„ç»„ä»¶çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ <code>TaskApp</code> ç»„ä»¶æœ‰ä¸€ä¸ªæ•°ç»„ç±»å‹çš„çŠ¶æ€ <code>tasks</code>ï¼Œå¹¶é€šè¿‡ä¸‰ä¸ªä¸åŒçš„äº‹ä»¶å¤„ç†ç¨‹åºæ¥å®ç°ä»»åŠ¡çš„æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xbpp28lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xbpp28lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, setTasks] = <span class="hljs-title function_">useState</span>(initialTasks);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title function_">setTasks</span>([<br>      ...tasks,<br>      &#123;<br>        <span class="hljs-attr">id</span>: nextId++,<br>        <span class="hljs-attr">text</span>: text,<br>        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ]);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>    <span class="hljs-title function_">setTasks</span>(<br>      tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === task.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> task;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;)<br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>    <span class="hljs-title function_">setTasks</span>(tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== taskId));<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å¸ƒæ‹‰æ ¼çš„è¡Œç¨‹å®‰æ’<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> <span class="hljs-attr">onAddTask</span>=<span class="hljs-string">&#123;handleAddTask&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">tasks</span>=<span class="hljs-string">&#123;tasks&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeTask</span>=<span class="hljs-string">&#123;handleChangeTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onDeleteTask</span>=<span class="hljs-string">&#123;handleDeleteTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å‚è§‚å¡å¤«å¡åšç‰©é¦†&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;çœ‹æœ¨å¶æˆ&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æ‰“å¡åˆ—ä¾¬å¢™&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>];<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ªç»„ä»¶çš„æ¯ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºéƒ½é€šè¿‡ <code>setTasks</code> æ¥æ›´æ–°çŠ¶æ€ã€‚éšç€è¿™ä¸ªç»„ä»¶çš„ä¸æ–­è¿­ä»£ï¼Œå…¶çŠ¶æ€é€»è¾‘ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šã€‚ä¸ºäº†é™ä½è¿™ç§å¤æ‚åº¦ï¼Œå¹¶è®©æ‰€æœ‰é€»è¾‘éƒ½å¯ä»¥å­˜æ”¾åœ¨ä¸€ä¸ªæ˜“äºç†è§£çš„åœ°æ–¹ï¼Œä½ å¯ä»¥å°†è¿™äº›çŠ¶æ€é€»è¾‘ç§»åˆ°ç»„ä»¶ä¹‹å¤–çš„ä¸€ä¸ªç§°ä¸º <strong>reducer</strong> çš„å‡½æ•°ä¸­ã€‚</p><p>Reducer æ˜¯å¤„ç†çŠ¶æ€çš„å¦ä¸€ç§æ–¹å¼ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‰ä¸ªæ­¥éª¤å°† <code>useState</code> è¿ç§»åˆ° <code>useReducer</code>ï¼š</p><ol><li><p>&#x3D;&#x3D;å°†è®¾ç½®çŠ¶æ€çš„é€»è¾‘ <strong>ä¿®æ”¹</strong> æˆ dispatch çš„ä¸€ä¸ª action&#x3D;&#x3D;ï¼šç§»é™¤æ‰€æœ‰çš„çŠ¶æ€è®¾ç½®é€»è¾‘ã€‚åªç•™ä¸‹ä¸‰ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼š</p><ul><li><code>handleAddTask(text)</code> åœ¨ç”¨æˆ·ç‚¹å‡» â€œæ·»åŠ â€ æ—¶è¢«è°ƒç”¨ã€‚</li><li><code>handleChangeTask(task)</code> åœ¨ç”¨æˆ·åˆ‡æ¢ä»»åŠ¡æˆ–ç‚¹å‡» â€œä¿å­˜â€ æ—¶è¢«è°ƒç”¨ã€‚</li><li><code>handleDeleteTask(taskId)</code> åœ¨ç”¨æˆ·ç‚¹å‡» â€œåˆ é™¤â€ æ—¶è¢«è°ƒç”¨ã€‚</li></ul><p>ä½¿ç”¨ reducers ç®¡ç†çŠ¶æ€ä¸ç›´æ¥è®¾ç½®çŠ¶æ€ç•¥æœ‰ä¸åŒã€‚å®ƒä¸æ˜¯é€šè¿‡è®¾ç½®çŠ¶æ€æ¥å‘Šè¯‰ React â€œè¦åšä»€ä¹ˆâ€ï¼Œè€Œæ˜¯é€šè¿‡äº‹ä»¶å¤„ç†ç¨‹åº dispatch ä¸€ä¸ª â€œactionâ€ æ¥æŒ‡æ˜ â€œç”¨æˆ·åˆšåˆšåšäº†ä»€ä¹ˆâ€ã€‚ï¼ˆè€ŒçŠ¶æ€æ›´æ–°é€»è¾‘åˆ™ä¿å­˜åœ¨å…¶ä»–åœ°æ–¹ï¼ï¼‰å› æ­¤ï¼Œæˆ‘ä»¬ä¸å†é€šè¿‡äº‹ä»¶å¤„ç†å™¨ç›´æ¥ â€œè®¾ç½® <code>task</code>â€ï¼Œè€Œæ˜¯ dispatch ä¸€ä¸ª â€œæ·»åŠ &#x2F;ä¿®æ”¹&#x2F;åˆ é™¤ä»»åŠ¡â€ çš„ actionã€‚è¿™æ›´åŠ ç¬¦åˆç”¨æˆ·çš„æ€ç»´ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0fhe1vlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0fhe1vlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;added&#x27;</span>,<br>    <span class="hljs-attr">id</span>: nextId++,<br>    <span class="hljs-attr">text</span>: text,<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;changed&#x27;</span>,<br>    <span class="hljs-attr">task</span>: task,<br>  &#125;);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>  <span class="hljs-title function_">dispatch</span>(&#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>    <span class="hljs-attr">id</span>: taskId,<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ ä¼ é€’ç»™ <code>dispatch</code> çš„å¯¹è±¡å«åš â€œactionâ€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q4e82ilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q4e82ilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>  <span class="hljs-title function_">dispatch</span>(<br>    <span class="hljs-comment">/* &quot;action&quot; å¯¹è±¡ï¼š */</span><br>    &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>      <span class="hljs-attr">id</span>: taskId,<br>    &#125;<br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ã€‚å®ƒçš„ç»“æ„æ˜¯ç”±ä½ å†³å®šçš„ï¼Œä½†é€šå¸¸æ¥è¯´ï¼Œå®ƒåº”è¯¥è‡³å°‘åŒ…å«å¯ä»¥è¡¨æ˜ <strong>å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…</strong> çš„ä¿¡æ¯ã€‚</p><p><code>action å¯¹è±¡</code>å¯ä»¥æœ‰å¤šç§ç»“æ„ï¼šæŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ <code>type</code> å­—æ®µæ¥æè¿°å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå¹¶é€šè¿‡å…¶å®ƒå­—æ®µä¼ é€’é¢å¤–çš„ä¿¡æ¯ã€‚<code>type</code> æ˜¯ç‰¹å®šäºç»„ä»¶çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ <code>added</code> å’Œ <code>addded_task</code> éƒ½å¯ä»¥ã€‚é€‰ä¸€ä¸ªèƒ½æè¿°æ¸…æ¥šå‘ç”Ÿçš„äº‹ä»¶çš„åå­—ï¼</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-eyd1dllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-eyd1dllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">dispatch</span>(&#123;<br>  <span class="hljs-comment">/*  é’ˆå¯¹ç‰¹å®šçš„ç»„ä»¶  */</span> <br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;what_happened&#x27;</span>,<br>  <span class="hljs-comment">/*  å…¶å®ƒå­—æ®µæ”¾è¿™é‡Œ  */</span> <br>&#125;);<br></code></pre></td></tr></table></div></figure></li><li><p>&#x3D;&#x3D;<strong>ç¼–å†™</strong> ä¸€ä¸ª reducer å‡½æ•°&#x3D;&#x3D;ï¼šreducer å‡½æ•°å°±æ˜¯ä½ æ”¾ç½®çŠ¶æ€é€»è¾‘çš„åœ°æ–¹ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºå½“å‰ state å’Œ action å¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›çš„æ˜¯æ›´æ–°åçš„ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fy45ovlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fy45ovlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">yourReducer</span>(<span class="hljs-params">state, action</span>) &#123;<br>  <span class="hljs-comment">// ç»™ React è¿”å›æ›´æ–°åçš„çŠ¶æ€</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>React ä¼šå°†çŠ¶æ€è®¾ç½®ä¸ºä½ ä» reducer è¿”å›çš„çŠ¶æ€ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¦å°†çŠ¶æ€è®¾ç½®é€»è¾‘ä»äº‹ä»¶å¤„ç†ç¨‹åºç§»åˆ° reducer å‡½æ•°ä¸­ï¼Œä½ éœ€è¦ï¼š</p><ol><li>å£°æ˜å½“å‰çŠ¶æ€ï¼ˆ<code>tasks</code>ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼›</li><li>å£°æ˜ <code>action</code> å¯¹è±¡ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼›</li><li>ä» <code>reducer</code> è¿”å› <strong>ä¸‹ä¸€ä¸ª</strong> çŠ¶æ€ï¼ˆReact ä¼šå°†æ—§çš„çŠ¶æ€è®¾ç½®ä¸ºè¿™ä¸ªæœ€æ–°çš„çŠ¶æ€ï¼‰ã€‚</li></ol><p>ä¸‹é¢æ˜¯æ‰€æœ‰è¿ç§»åˆ° <code>reducer</code> å‡½æ•°çš„çŠ¶æ€è®¾ç½®é€»è¾‘ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9qu33mlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9qu33mlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;added&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> [<br>      ...tasks,<br>      &#123;<br>        <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    ];<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;changed&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>        <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> t;<br>      &#125;<br>    &#125;);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (action.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;deleted&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥ action: &#x27;</span> + action.<span class="hljs-property">type</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç”±äº <code>reducer</code> å‡½æ•°æ¥å— <code>state</code>ï¼ˆtasksï¼‰ä½œä¸ºå‚æ•°ï¼Œå› æ­¤ä½ å¯ä»¥ <strong>åœ¨ç»„ä»¶ä¹‹å¤–å£°æ˜å®ƒ</strong>ã€‚è¿™å‡å°‘äº†ä»£ç çš„ç¼©è¿›çº§åˆ«ï¼Œæå‡äº†ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº† <code>if/else</code> è¯­å¥ï¼Œä½†æ˜¯åœ¨ reducers ä¸­ä½¿ç”¨ <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/switch">switch è¯­å¥</a> æ˜¯ä¸€ç§æƒ¯ä¾‹ã€‚ä¸¤ç§æ–¹å¼ç»“æœæ˜¯ç›¸åŒçš„ï¼Œä½† <code>switch</code> è¯­å¥è¯»èµ·æ¥ä¸€ç›®äº†ç„¶ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ccqykvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ccqykvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> [<br>        ...tasks,<br>        &#123;<br>          <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>          <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>         <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>        &#125;,<br>      ];<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥ action: &#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æˆ‘ä»¬å»ºè®®å°†æ¯ä¸ª <code>case</code> å—åŒ…è£…åˆ° <code>&#123;</code> å’Œ <code>&#125;</code> èŠ±æ‹¬å·ä¸­ï¼Œè¿™æ ·åœ¨ä¸åŒ <code>case</code> ä¸­å£°æ˜çš„å˜é‡å°±ä¸ä¼šäº’ç›¸å†²çªã€‚æ­¤å¤–ï¼Œ<code>case</code> é€šå¸¸åº”è¯¥ä»¥ <code>return</code> ç»“å°¾ã€‚å¦‚æœä½ å¿˜äº† <code>return</code>ï¼Œä»£ç å°±ä¼š <code>è¿›å…¥</code> åˆ°ä¸‹ä¸€ä¸ª <code>case</code>ï¼Œè¿™å°±ä¼šå¯¼è‡´é”™è¯¯ï¼</p><p>å°½ç®¡ <code>reducer</code> å¯ä»¥ â€œå‡å°‘â€ ç»„ä»¶å†…çš„ä»£ç é‡ï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯ä»¥æ•°ç»„ä¸Šçš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code>reduce()</code></a> æ–¹æ³•å‘½åçš„ã€‚</p><p><code>reduce()</code> å…è®¸ä½ å°†æ•°ç»„ä¸­çš„å¤šä¸ªå€¼ â€œç´¯åŠ â€ æˆä¸€ä¸ªå€¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y2tknllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y2tknllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br><span class="hljs-keyword">const</span> sum = arr.<span class="hljs-title function_">reduce</span>(<br>  <span class="hljs-function">(<span class="hljs-params">result, number</span>) =&gt;</span> result + number<br><br>); <span class="hljs-comment">// 1 + 2 + 3 + 4 + 5</span><br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">resultå‚æ•°ä»£è¡¨ç´¯ç§¯è®¡ç®—çš„ç»“æœã€‚åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å›è°ƒå‡½æ•°æ—¶ï¼Œå®ƒçš„å€¼æ˜¯ä¼ é€’ç»™reduce()æ–¹æ³•çš„åˆå§‹å€¼ï¼ˆå¦‚æœæä¾›äº†åˆå§‹å€¼ï¼‰ï¼Œæˆ–è€…æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚numberå‚æ•°ä»£è¡¨å½“å‰æ­£åœ¨å¤„ç†çš„æ•°ç»„å…ƒç´ ã€‚è¯¥å›è°ƒå‡½æ•°çš„ç›®æ ‡æ˜¯å°†æ¯ä¸ªå…ƒç´ ä¸ç´¯ç§¯çš„ç»“æœç›¸åŠ ï¼Œä»è€Œè®¡ç®—å‡ºæ€»å’Œã€‚</p><p>ä½ ä¼ é€’ç»™ <code>reduce</code> çš„å‡½æ•°è¢«ç§°ä¸º â€œreducerâ€ã€‚å®ƒæ¥å— <code>ç›®å‰çš„ç»“æœ</code> å’Œ <code>å½“å‰çš„å€¼</code>ï¼Œç„¶åè¿”å› <code>ä¸‹ä¸€ä¸ªç»“æœ</code>ã€‚React ä¸­çš„ <code>reducer</code> å’Œè¿™ä¸ªæ˜¯ä¸€æ ·çš„ï¼šå®ƒä»¬éƒ½æ¥å— <code>ç›®å‰çš„çŠ¶æ€</code> å’Œ <code>action</code> ï¼Œç„¶åè¿”å› <code>ä¸‹ä¸€ä¸ªçŠ¶æ€</code>ã€‚è¿™æ ·ï¼Œaction ä¼šéšç€æ—¶é—´æ¨ç§»ç´¯ç§¯åˆ°çŠ¶æ€ä¸­ã€‚</p></li><li><p>&#x3D;&#x3D;åœ¨ä½ çš„ç»„ä»¶ä¸­ <strong>ä½¿ç”¨</strong> reducerï¼š&#x3D;&#x3D;</p></li><li><p>å°† <code>tasksReducer</code> å¯¼å…¥åˆ°ç»„ä»¶ä¸­ã€‚è®°å¾—å…ˆä» React ä¸­å¯¼å…¥ <code>useReducer</code> Hookï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d8twldlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d8twldlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç„¶åæŠŠ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mfpgaelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mfpgaelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [tasks, setTasks] = <span class="hljs-title function_">useState</span>(initialTasks);<br></code></pre></td></tr></table></div></figure><p>æ›¿æ¢ä¸ºï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nev4x5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nev4x5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br></code></pre></td></tr></table></div></figure></li></ol><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9xye4slqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9xye4slqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;added&#x27;</span>,<br>      <span class="hljs-attr">id</span>: nextId++,<br>      <span class="hljs-attr">text</span>: text,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;changed&#x27;</span>,<br>      <span class="hljs-attr">task</span>: task,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>      <span class="hljs-attr">id</span>: taskId,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å¸ƒæ‹‰æ ¼çš„è¡Œç¨‹å®‰æ’<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> <span class="hljs-attr">onAddTask</span>=<span class="hljs-string">&#123;handleAddTask&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">tasks</span>=<span class="hljs-string">&#123;tasks&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeTask</span>=<span class="hljs-string">&#123;handleChangeTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onDeleteTask</span>=<span class="hljs-string">&#123;handleDeleteTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> [<br>        ...tasks,<br>        &#123;<br>          <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>          <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>          <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>        &#125;,<br>      ];<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥ action: &#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å‚è§‚å¡å¤«å¡åšç‰©é¦†&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;çœ‹æœ¨å¶æˆ&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æ‰“å¡åˆ—ä¾¬å¢™&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;<br>];<br></code></pre></td></tr></table></div></figure><img src="image-20231109170735742.png" alt="image-20231109170735742" style="zoom:50%;" /><p>ä¹Ÿå¯ä»¥æŠŠ reducer ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼š</p><p>tasksReducer.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-01e7m4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-01e7m4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> [<br>        ...tasks,<br>        &#123;<br>          <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>          <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>          <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>        &#125;,<br>      ];<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥ actionï¼š&#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bnoa2dlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bnoa2dlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><span class="hljs-keyword">import</span> tasksReducer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./tasksReducer.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;added&#x27;</span>,<br>      <span class="hljs-attr">id</span>: nextId++,<br>      <span class="hljs-attr">text</span>: text,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;changed&#x27;</span>,<br>      <span class="hljs-attr">task</span>: task,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>      <span class="hljs-attr">id</span>: taskId,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å¸ƒæ‹‰æ ¼çš„è¡Œç¨‹å®‰æ’<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> <span class="hljs-attr">onAddTask</span>=<span class="hljs-string">&#123;handleAddTask&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">tasks</span>=<span class="hljs-string">&#123;tasks&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeTask</span>=<span class="hljs-string">&#123;handleChangeTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onDeleteTask</span>=<span class="hljs-string">&#123;handleDeleteTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å‚è§‚å¡å¤«å¡åšç‰©é¦†&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;çœ‹æœ¨å¶æˆ&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æ‰“å¡åˆ—ä¾¬å¢™&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>];<br></code></pre></td></tr></table></div></figure><p><code>useReducer</code> å’Œ <code>useState</code> çš„åŒºåˆ«ï¼š</p><ol><li><p>ç›¸åŒï¼šå¿…é¡»ç»™å®ƒä¼ é€’ä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæœ‰çŠ¶æ€çš„å€¼å’Œä¸€ä¸ªè®¾ç½®è¯¥çŠ¶æ€çš„å‡½æ•°ã€‚</p></li><li><p>ä¸åŒï¼š<code>useReducer</code> é’©å­æ¥å— 2 ä¸ªå‚æ•°ï¼š</p><ol><li>ä¸€ä¸ª reducer å‡½æ•°</li><li>ä¸€ä¸ªåˆå§‹çš„ state</li></ol><p>å®ƒè¿”å›å¦‚ä¸‹å†…å®¹ï¼š</p><ol><li>ä¸€ä¸ªæœ‰çŠ¶æ€çš„å€¼</li><li>ä¸€ä¸ª dispatch å‡½æ•°ï¼ˆç”¨æ¥ â€œæ´¾å‘â€ ç”¨æˆ·æ“ä½œç»™ reducerï¼‰</li></ol></li></ol><p>å¯¹æ¯”ï¼š</p><ul><li><strong>ä»£ç ä½“ç§¯ï¼š</strong> é€šå¸¸ï¼Œåœ¨ä½¿ç”¨ <code>useState</code> æ—¶ï¼Œä¸€å¼€å§‹åªéœ€è¦ç¼–å†™å°‘é‡ä»£ç ã€‚è€Œ <code>useReducer</code> å¿…é¡»æå‰ç¼–å†™ reducer å‡½æ•°å’Œéœ€è¦è°ƒåº¦çš„ actionsã€‚ä½†æ˜¯ï¼Œå½“å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºä»¥ç›¸ä¼¼çš„æ–¹å¼ä¿®æ”¹ state æ—¶ï¼Œ<code>useReducer</code> å¯ä»¥å‡å°‘ä»£ç é‡ã€‚</li><li><strong>å¯è¯»æ€§ï¼š</strong> å½“çŠ¶æ€æ›´æ–°é€»è¾‘è¶³å¤Ÿç®€å•æ—¶ï¼Œ<code>useState</code> çš„å¯è¯»æ€§è¿˜è¡Œã€‚ä½†æ˜¯ï¼Œä¸€æ—¦é€»è¾‘å˜å¾—å¤æ‚èµ·æ¥ï¼Œå®ƒä»¬ä¼šä½¿ç»„ä»¶å˜å¾—è‡ƒè‚¿ä¸”éš¾ä»¥é˜…è¯»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>useReducer</code> å…è®¸ä½ å°†çŠ¶æ€æ›´æ–°é€»è¾‘ä¸äº‹ä»¶å¤„ç†ç¨‹åºåˆ†ç¦»å¼€æ¥ã€‚</li><li><strong>å¯è°ƒè¯•æ€§ï¼š</strong> å½“ä½¿ç”¨ <code>useState</code> å‡ºç°é—®é¢˜æ—¶, ä½ å¾ˆéš¾å‘ç°å…·ä½“åŸå› ä»¥åŠä¸ºä»€ä¹ˆã€‚ è€Œä½¿ç”¨ <code>useReducer</code> æ—¶ï¼Œ ä½ å¯ä»¥åœ¨ reducer å‡½æ•°ä¸­é€šè¿‡æ‰“å°æ—¥å¿—çš„æ–¹å¼æ¥è§‚å¯Ÿæ¯ä¸ªçŠ¶æ€çš„æ›´æ–°ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦æ›´æ–°ï¼ˆæ¥è‡ªå“ªä¸ª <code>action</code>ï¼‰ã€‚ å¦‚æœæ‰€æœ‰ <code>action</code> éƒ½æ²¡é—®é¢˜ï¼Œä½ å°±çŸ¥é“é—®é¢˜å‡ºåœ¨äº† reducer æœ¬èº«çš„é€»è¾‘ä¸­ã€‚ ç„¶è€Œï¼Œä¸ä½¿ç”¨ <code>useState</code> ç›¸æ¯”ï¼Œä½ å¿…é¡»å•æ­¥æ‰§è¡Œæ›´å¤šçš„ä»£ç ã€‚</li><li><strong>å¯æµ‹è¯•æ€§ï¼š</strong> reducer æ˜¯ä¸€ä¸ªä¸ä¾èµ–äºç»„ä»¶çš„çº¯å‡½æ•°ã€‚è¿™å°±æ„å‘³ç€ä½ å¯ä»¥å•ç‹¬å¯¹å®ƒè¿›è¡Œæµ‹è¯•ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¥½æ˜¯åœ¨çœŸå®ç¯å¢ƒä¸­æµ‹è¯•ç»„ä»¶ï¼Œä½†å¯¹äºå¤æ‚çš„çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œé’ˆå¯¹ç‰¹å®šçš„åˆå§‹çŠ¶æ€å’Œ <code>action</code>ï¼Œæ–­è¨€ reducer è¿”å›çš„ç‰¹å®šçŠ¶æ€ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</li></ul><p>å¦‚æœä½ åœ¨ä¿®æ”¹æŸäº›ç»„ä»¶çŠ¶æ€æ—¶ç»å¸¸å‡ºç°é—®é¢˜æˆ–è€…æƒ³ç»™ç»„ä»¶æ·»åŠ æ›´å¤šé€»è¾‘æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½ è¿˜æ˜¯ä½¿ç”¨ reducerã€‚å½“ç„¶ï¼Œä½ ä¹Ÿä¸å¿…æ•´ä¸ªé¡¹ç›®éƒ½ç”¨ reducerï¼Œè¿™æ˜¯å¯ä»¥è‡ªç”±æ­é…çš„ã€‚ä½ ç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒæ—¶ä½¿ç”¨ <code>useState</code> å’Œ <code>useReducer</code>ã€‚</p><p>ç¼–å†™ <code>reducers</code> æ—¶æœ€å¥½ç‰¢è®°ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li><strong>reducers å¿…é¡»æ˜¯çº¯ç²¹çš„ã€‚</strong> è¿™ä¸€ç‚¹å’Œ <a href="http://localhost:3000/learn/queueing-a-series-of-state-updates">çŠ¶æ€æ›´æ–°å‡½æ•°</a> æ˜¯ç›¸ä¼¼çš„ï¼Œ<code>reducers</code> åœ¨æ˜¯åœ¨æ¸²æŸ“æ—¶è¿è¡Œçš„ï¼ï¼ˆactions ä¼šæ’é˜Ÿç›´åˆ°ä¸‹ä¸€æ¬¡æ¸²æŸ“)ã€‚ è¿™å°±æ„å‘³ç€ <code>reducers</code> <a href="http://localhost:3000/learn/keeping-components-pure">å¿…é¡»çº¯å‡€</a>ï¼Œå³å½“è¾“å…¥ç›¸åŒæ—¶ï¼Œè¾“å‡ºä¹Ÿæ˜¯ç›¸åŒçš„ã€‚å®ƒä»¬ä¸åº”è¯¥åŒ…å«å¼‚æ­¥è¯·æ±‚ã€å®šæ—¶å™¨æˆ–è€…ä»»ä½•å‰¯ä½œç”¨ï¼ˆå¯¹ç»„ä»¶å¤–éƒ¨æœ‰å½±å“çš„æ“ä½œï¼‰ã€‚å®ƒä»¬åº”è¯¥ä»¥ä¸å¯å˜å€¼çš„æ–¹å¼å»æ›´æ–° <a href="http://localhost:3000/learn/updating-objects-in-state">å¯¹è±¡</a> å’Œ <a href="http://localhost:3000/learn/updating-arrays-in-state">æ•°ç»„</a>ã€‚</li><li><strong>æ¯ä¸ª action éƒ½æè¿°äº†ä¸€ä¸ªå•ä¸€çš„ç”¨æˆ·äº¤äº’ï¼Œå³ä½¿å®ƒä¼šå¼•å‘æ•°æ®çš„å¤šä¸ªå˜åŒ–ã€‚</strong> ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç”¨æˆ·åœ¨ä¸€ä¸ªç”± <code>reducer</code> ç®¡ç†çš„è¡¨å•ï¼ˆåŒ…å«äº”ä¸ªè¡¨å•é¡¹ï¼‰ä¸­ç‚¹å‡»äº† <code>é‡ç½®æŒ‰é’®</code>ï¼Œé‚£ä¹ˆ dispatch ä¸€ä¸ª <code>reset_form</code> çš„ action æ¯” dispatch äº”ä¸ªå•ç‹¬çš„ <code>set_field</code> çš„ action æ›´åŠ åˆç†ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ª <code>reducer</code> ä¸­æ‰“å°äº†æ‰€æœ‰çš„ <code>action</code> æ—¥å¿—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¥å¿—åº”è¯¥æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œå®ƒèƒ½è®©ä½ ä»¥æŸç§æ­¥éª¤å¤ç°å·²å‘ç”Ÿçš„äº¤äº’æˆ–å“åº”ã€‚è¿™å¯¹ä»£ç è°ƒè¯•å¾ˆæœ‰å¸®åŠ©ï¼</li></ul><p><mark>ä½¿ç”¨ Immer ç®€åŒ– reducers</mark>ï¼šä¸åœ¨å¹³å¸¸çš„ state ä¸­ <a href="http://localhost:3000/learn/updating-objects-in-state#write-concise-update-logic-with-immer">ä¿®æ”¹å¯¹è±¡</a> å’Œ <a href="http://localhost:3000/learn/updating-arrays-in-state#write-concise-update-logic-with-immer">æ•°ç»„</a> ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Immer</code> è¿™ä¸ªåº“æ¥ç®€åŒ– <code>reducer</code>ã€‚åœ¨è¿™é‡Œï¼Œ<a href="https://github.com/immerjs/use-immer#useimmerreducer"><code>useImmerReducer</code></a> è®©ä½ å¯ä»¥é€šè¿‡ <code>push</code> æˆ– <code>arr[i] =</code> æ¥ä¿®æ”¹ state ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nqxagolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nqxagolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useImmerReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;use-immer&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">draft, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      draft.<span class="hljs-title function_">push</span>(&#123;<br>        <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>,<br>      &#125;);<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">const</span> index = draft.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>);<br>      draft[index] = action.<span class="hljs-property">task</span>;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> draft.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">t</span>) =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥ actionï¼š&#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useImmerReducer</span>(tasksReducer, initialTasks);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;added&#x27;</span>,<br>      <span class="hljs-attr">id</span>: nextId++,<br>      <span class="hljs-attr">text</span>: text,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;changed&#x27;</span>,<br>      <span class="hljs-attr">task</span>: task,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>      <span class="hljs-attr">id</span>: taskId,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å¸ƒæ‹‰æ ¼çš„è¡Œç¨‹å®‰æ’<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> <span class="hljs-attr">onAddTask</span>=<span class="hljs-string">&#123;handleAddTask&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">tasks</span>=<span class="hljs-string">&#123;tasks&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeTask</span>=<span class="hljs-string">&#123;handleChangeTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onDeleteTask</span>=<span class="hljs-string">&#123;handleDeleteTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å‚è§‚å¡å¤«å¡åšç‰©é¦†&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;çœ‹æœ¨å¶æˆ&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>  &#123;<span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;æ‰“å¡åˆ—ä¾¬å¢™&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>&#125;,<br>];<br></code></pre></td></tr></table></div></figure><p>Reducers åº”è¯¥æ˜¯çº¯å‡€çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸åº”è¯¥å»ä¿®æ”¹ stateã€‚è€Œ Immer ä¸ºä½ æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ <code>draft</code> å¯¹è±¡ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå®‰å…¨çš„ä¿®æ”¹ stateã€‚åœ¨åº•å±‚ï¼ŒImmer ä¼šåŸºäºå½“å‰ state åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šè¿‡ <code>useImmerReducer</code> æ¥ç®¡ç† reducers æ—¶ï¼Œå¯ä»¥ä¿®æ”¹ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸”ä¸éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„ state çš„åŸå› ã€‚</p><h2 id="6-ä½¿ç”¨-Context-æ·±å±‚ä¼ é€’å‚æ•°"><a href="#6-ä½¿ç”¨-Context-æ·±å±‚ä¼ é€’å‚æ•°" class="headerlink" title="6.ä½¿ç”¨ Context æ·±å±‚ä¼ é€’å‚æ•°"></a>6.ä½¿ç”¨ Context æ·±å±‚ä¼ é€’å‚æ•°</h2><p>é€šå¸¸æ¥è¯´ï¼Œä½ ä¼šé€šè¿‡ props å°†ä¿¡æ¯ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¿…é¡»é€šè¿‡è®¸å¤šä¸­é—´ç»„ä»¶å‘ä¸‹ä¼ é€’ propsï¼Œæˆ–æ˜¯åœ¨ä½ åº”ç”¨ä¸­çš„è®¸å¤šç»„ä»¶éœ€è¦ç›¸åŒçš„ä¿¡æ¯ï¼Œä¼ é€’ props ä¼šå˜çš„ååˆ†å†—é•¿å’Œä¸ä¾¿ã€‚<mark><strong>Context</strong> å…è®¸çˆ¶ç»„ä»¶å‘å…¶ä¸‹å±‚æ— è®ºå¤šæ·±çš„ä»»ä½•ç»„ä»¶æä¾›ä¿¡æ¯ï¼Œè€Œæ— éœ€é€šè¿‡ props æ˜¾å¼ä¼ é€’ã€‚</mark></p><p><mark>ä¼ é€’ props å¸¦æ¥çš„é—®é¢˜</mark>ï¼š<a href="http://localhost:3000/learn/passing-props-to-a-component">ä¼ é€’ props</a> æ˜¯å°†æ•°æ®é€šè¿‡ UI æ ‘æ˜¾å¼ä¼ é€’åˆ°ä½¿ç”¨å®ƒçš„ç»„ä»¶çš„å¥½æ–¹æ³•ã€‚</p><p>ä½†æ˜¯å½“ä½ éœ€è¦åœ¨ç»„ä»¶æ ‘ä¸­æ·±å±‚ä¼ é€’å‚æ•°ä»¥åŠéœ€è¦åœ¨ç»„ä»¶é—´å¤ç”¨ç›¸åŒçš„å‚æ•°æ—¶ï¼Œä¼ é€’ props å°±ä¼šå˜å¾—å¾ˆéº»çƒ¦ã€‚æœ€è¿‘çš„æ ¹èŠ‚ç‚¹çˆ¶ç»„ä»¶å¯èƒ½ç¦»éœ€è¦æ•°æ®çš„ç»„ä»¶å¾ˆè¿œï¼Œ<a href="http://localhost:3000/learn/sharing-state-between-components">çŠ¶æ€æå‡</a> åˆ°å¤ªé«˜çš„å±‚çº§ä¼šå¯¼è‡´ â€œé€å±‚ä¼ é€’ propsâ€ çš„æƒ…å†µã€‚</p><img src="image-20231110160115640.png" alt="image-20231110160115640" style="zoom:50%;" /><p>React çš„ context åŠŸèƒ½å¯ä»¥åœ¨ç»„ä»¶æ ‘ä¸­ä¸éœ€è¦ props å°†æ•°æ®â€œç›´è¾¾â€åˆ°æ‰€éœ€çš„ç»„ä»¶ä¸­ã€‚</p><p> <mark>Contextï¼šä¼ é€’ props çš„å¦ä¸€ç§æ–¹æ³•</mark>ï¼šContext è®©çˆ¶ç»„ä»¶å¯ä»¥ä¸ºå®ƒä¸‹é¢çš„æ•´ä¸ªç»„ä»¶æ ‘æä¾›æ•°æ®ã€‚</p><p>æ€è€ƒä¸€ä¸‹è¿™ä¸ª <code>Heading</code> ç»„ä»¶æ¥æ”¶ä¸€ä¸ª <code>level</code> å‚æ•°æ¥å†³å®šå®ƒæ ‡é¢˜å°ºå¯¸çš„åœºæ™¯ï¼š</p><p>Heading.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-o31o90lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-o31o90lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Heading</span>(<span class="hljs-params">&#123; level, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (level) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span></span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span></span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>      <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h6</span>&gt;</span>&#123;children&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h6</span>&gt;</span></span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æœªçŸ¥çš„ levelï¼š&#x27;</span> + level);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Section.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g6wsqulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g6wsqulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Section</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;section&quot;</span>&gt;</span></span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dicrnulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dicrnulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Heading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Heading.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Section</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Section.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;1&#125;</span>&gt;</span>ä¸»æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;2&#125;</span>&gt;</span>å‰¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;3&#125;</span>&gt;</span>å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;4&#125;</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;5&#125;</span>&gt;</span>å­å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;6&#125;</span>&gt;</span>å­å­å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å‡è®¾ä½ æƒ³è®©ç›¸åŒ <code>Section</code> ä¸­çš„å¤šä¸ª Heading å…·æœ‰ç›¸åŒçš„å°ºå¯¸ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6jabkmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6jabkmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Section</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;3&#125;</span>&gt;</span>å…³äº<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;3&#125;</span>&gt;</span>ç…§ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;3&#125;</span>&gt;</span>è§†é¢‘<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Section</span>&gt;<br></code></pre></td></tr></table></div></figure><p>å°† <code>level</code> å‚æ•°ä¼ é€’ç»™ <code>&lt;Section&gt;</code> ç»„ä»¶è€Œä¸æ˜¯ä¼ ç»™ <code>&lt;Heading&gt;</code> ç»„ä»¶çœ‹èµ·æ¥æ›´å¥½ä¸€äº›ã€‚è¿™æ ·çš„è¯ä½ å¯ä»¥å¼ºåˆ¶ä½¿åŒä¸€ä¸ª section ä¸­çš„æ‰€æœ‰æ ‡é¢˜éƒ½æœ‰ç›¸åŒçš„å°ºå¯¸ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3adg3klqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3adg3klqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Section</span> level=&#123;<span class="hljs-number">3</span>&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å…³äº<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>ç…§ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>è§†é¢‘<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Section</span>&gt;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯ <code>&lt;Heading&gt;</code> ç»„ä»¶æ˜¯å¦‚ä½•çŸ¥é“ç¦»å®ƒæœ€è¿‘çš„ <code>&lt;Section&gt;</code> çš„ level çš„å‘¢ï¼Ÿ**<mark>è¿™éœ€è¦å­ç»„ä»¶å¯ä»¥é€šè¿‡æŸç§æ–¹å¼â€œè®¿é—®â€åˆ°ç»„ä»¶æ ‘ä¸­æŸå¤„åœ¨å…¶ä¸Šå±‚çš„æ•°æ®ã€‚</mark>**</p><p>ä½ ä¸èƒ½åªé€šè¿‡ props æ¥å®ç°å®ƒã€‚è¿™å°±æ˜¯ context å¤§æ˜¾èº«æ‰‹çš„åœ°æ–¹ã€‚</p><p><mark>Context å¯ä»¥è®©çˆ¶èŠ‚ç‚¹ï¼Œç”šè‡³æ˜¯å¾ˆè¿œçš„çˆ¶èŠ‚ç‚¹éƒ½å¯ä»¥ä¸ºå…¶å†…éƒ¨çš„æ•´ä¸ªç»„ä»¶æ ‘æä¾›æ•°æ®ã€‚</mark></p><img src="image-20231110160909884.png" alt="image-20231110160909884" style="zoom:50%;" /><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤æ¥å®ç°å®ƒï¼š</p><ol><li><p><strong>åˆ›å»º</strong> ä¸€ä¸ª contextã€‚ï¼ˆä½ å¯ä»¥å°†å…¶å‘½åä¸º <code>LevelContext</code>, å› ä¸ºå®ƒè¡¨ç¤ºçš„æ˜¯æ ‡é¢˜çº§åˆ«ã€‚)</p><p>LevelContext.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6m2wfclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6m2wfclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LevelContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></div></figure><p><code>createContext</code> åªéœ€<strong>é»˜è®¤å€¼</strong>ä¸€ä¸ªå‚æ•°ã€‚åœ¨è¿™é‡Œ, <code>1</code> è¡¨ç¤ºæœ€å¤§çš„æ ‡é¢˜çº§åˆ«ï¼Œä½†æ˜¯ä½ å¯ä»¥ä¼ é€’ä»»ä½•ç±»å‹çš„å€¼ï¼ˆç”šè‡³å¯ä»¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼‰ã€‚</p></li><li><p>åœ¨éœ€è¦æ•°æ®çš„ç»„ä»¶å†… <strong>ä½¿ç”¨</strong> åˆšåˆšåˆ›å»ºçš„ contextã€‚ï¼ˆ<code>Heading</code> å°†ä¼šä½¿ç”¨ <code>LevelContext</code>ã€‚ï¼‰</p><p>ä» React ä¸­å¼•å…¥ <code>useContext</code> Hook ä»¥åŠä½ åˆšåˆšåˆ›å»ºçš„ context:</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1va0s8lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1va0s8lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">LevelContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./LevelContext.js&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç›®å‰ï¼Œ<code>Heading</code> ç»„ä»¶ä» props ä¸­è¯»å– <code>level</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p9b2h2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p9b2h2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Heading</span>(<span class="hljs-params">&#123; level, children &#125;</span>) &#123;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åˆ æ‰ <code>level</code> å‚æ•°å¹¶ä»ä½ åˆšåˆšå¼•å…¥çš„ <code>LevelContext</code> ä¸­è¯»å–å€¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gjph4dlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gjph4dlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Heading</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> level = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">LevelContext</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>useContext</code> æ˜¯ä¸€ä¸ª Hookã€‚å’Œ <code>useState</code> ä»¥åŠ <code>useReducer</code>ä¸€æ ·ï¼Œä½ åªèƒ½åœ¨ React ç»„ä»¶ä¸­ï¼ˆä¸æ˜¯å¾ªç¯æˆ–è€…æ¡ä»¶é‡Œï¼‰ç«‹å³è°ƒç”¨ Hookã€‚**<code>useContext</code> å‘Šè¯‰ React <code>Heading</code> ç»„ä»¶æƒ³è¦è¯»å– <code>LevelContext</code>ã€‚**</p><p>ç°åœ¨ <code>Heading</code> ç»„ä»¶æ²¡æœ‰ <code>level</code> å‚æ•°ï¼Œä½ ä¸éœ€è¦å†åƒè¿™æ ·åœ¨ä½ çš„ JSX ä¸­å°† level å‚æ•°ä¼ é€’ç»™ <code>Heading</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f7iz9olqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f7iz9olqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Section</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;4&#125;</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;4&#125;</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&#123;4&#125;</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Section</span>&gt;<br></code></pre></td></tr></table></div></figure><p>ä¿®æ”¹ä¸€ä¸‹ JSXï¼Œè®© <code>Section</code> ç»„ä»¶ä»£æ›¿ <code>Heading</code> ç»„ä»¶æ¥æ”¶ level å‚æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-j4l91nlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-j4l91nlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Section</span> level=&#123;<span class="hljs-number">4</span>&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Section</span>&gt;<br></code></pre></td></tr></table></div></figure></li><li><p>åœ¨æŒ‡å®šæ•°æ®çš„ç»„ä»¶ä¸­ <strong>æä¾›</strong> è¿™ä¸ª contextã€‚ ï¼ˆ<code>Section</code> å°†ä¼šæä¾› <code>LevelContext</code>ã€‚ï¼‰</p><p><strong>æŠŠå®ƒä»¬ç”¨ context provider åŒ…è£¹èµ·æ¥</strong>  ä»¥æä¾› <code>LevelContext</code> ç»™å®ƒä»¬ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n8jmnilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n8jmnilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">LevelContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./LevelContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Section</span>(<span class="hljs-params">&#123; level, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;section&quot;</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">LevelContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;level&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;   <span class="hljs-tag">&lt;/<span class="hljs-name">LevelContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™å‘Šè¯‰ Reactï¼šâ€œå¦‚æœåœ¨ <code>&lt;Section&gt;</code> ç»„ä»¶ä¸­çš„ä»»ä½•å­ç»„ä»¶è¯·æ±‚ <code>LevelContext</code>ï¼Œç»™ä»–ä»¬è¿™ä¸ª <code>level</code>ã€‚â€ç»„ä»¶ä¼šä½¿ç”¨ UI æ ‘ä¸­åœ¨å®ƒä¸Šå±‚æœ€è¿‘çš„é‚£ä¸ª <code>&lt;LevelContext.Provider&gt;</code> ä¼ é€’è¿‡æ¥çš„å€¼ã€‚</p><p>ä¸éœ€è¦å‘æ¯ä¸ª <code>Heading</code> ç»„ä»¶ä¼ é€’ <code>level</code> å‚æ•°äº†ï¼å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒé€šè¿‡è®¿é—®ä¸Šå±‚æœ€è¿‘çš„ <code>Section</code> æ¥â€œæ–­å®šâ€å®ƒçš„æ ‡é¢˜çº§åˆ«ï¼š</p><ol><li>ä½ å°†ä¸€ä¸ª <code>level</code> å‚æ•°ä¼ é€’ç»™ <code>&lt;Section&gt;</code>ã€‚</li><li><code>Section</code> æŠŠå®ƒçš„å­å…ƒç´ åŒ…åœ¨ <code>&lt;LevelContext.Provider value=&#123;level&#125;&gt;</code> é‡Œé¢ã€‚</li><li><code>Heading</code> ä½¿ç”¨ <code>useContext(LevelContext)</code> è®¿é—®ä¸Šå±‚æœ€è¿‘çš„ <code>LevelContext</code> æä¾›çš„å€¼ã€‚</li></ol></li></ol><p><mark>åœ¨ç›¸åŒçš„ç»„ä»¶ä¸­ä½¿ç”¨å¹¶æä¾› context </mark>ï¼šç›®å‰ï¼Œä½ ä»éœ€è¦æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ª section çš„ <code>level</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-koztxglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-koztxglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    &lt;Section level=&#123;1&#125;&gt;<br>      ...<br>      &lt;Section level=&#123;2&#125;&gt;<br>        ...<br>        &lt;Section level=&#123;3&#125;&gt;<br>          ...<br></code></pre></td></tr></table></div></figure><p>ç”±äº context è®©ä½ å¯ä»¥ä»ä¸Šå±‚çš„ç»„ä»¶è¯»å–ä¿¡æ¯ï¼Œæ¯ä¸ª <code>Section</code> éƒ½ä¼šä»ä¸Šå±‚çš„ <code>Section</code> è¯»å– <code>level</code>ï¼Œå¹¶è‡ªåŠ¨å‘ä¸‹å±‚ä¼ é€’ <code>level + 1</code>ã€‚ ä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·åšï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oc9nl5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oc9nl5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">LevelContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./LevelContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Section</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br><br>  <span class="hljs-keyword">const</span> level = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">LevelContext</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;section&quot;</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">LevelContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;level</span> + <span class="hljs-attr">1</span>&#125;&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml"> <span class="hljs-tag">&lt;/<span class="hljs-name">LevelContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ ·ä¿®æ”¹ä¹‹åï¼Œä½ ä¸ç”¨å°† <code>level</code> å‚æ•°ä¼ ç»™ <code>&lt;Section&gt;</code> <strong>æˆ–è€…æ˜¯</strong> <code>&lt;Heading&gt;</code> äº†ï¼š</p><p>LevelContext.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5bdtrulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5bdtrulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LevelContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l3nz8zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l3nz8zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Heading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Heading.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Section</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Section.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>ä¸»æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å‰¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å‰¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å‰¯æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å­å­æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>Heading</code> å’Œ <code>Section</code> éƒ½é€šè¿‡è¯»å– <code>LevelContext</code> æ¥åˆ¤æ–­å®ƒä»¬çš„æ·±åº¦ã€‚è€Œä¸” <code>Section</code> æŠŠå®ƒçš„å­ç»„ä»¶éƒ½åŒ…åœ¨ <code>LevelContext</code> ä¸­æ¥æŒ‡å®šå…¶ä¸­çš„ä»»ä½•å†…å®¹éƒ½å¤„äºä¸€ä¸ªâ€œæ›´æ·±â€çš„çº§åˆ«ã€‚</p><p><mark>Context ä¼šç©¿è¿‡ä¸­é—´å±‚çº§çš„ç»„ä»¶</mark>ï¼š ä½ å¯ä»¥åœ¨æä¾› context çš„ç»„ä»¶å’Œä½¿ç”¨å®ƒçš„ç»„ä»¶ä¹‹é—´çš„å±‚çº§æ’å…¥ä»»æ„æ•°é‡çš„ç»„ä»¶ã€‚è¿™åŒ…æ‹¬åƒ <code>&lt;div&gt;</code> è¿™æ ·çš„å†…ç½®ç»„ä»¶å’Œä½ è‡ªå·±åˆ›å»ºçš„ç»„ä»¶ã€‚</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç›¸åŒçš„ <code>Post</code> ç»„ä»¶ï¼ˆå¸¦æœ‰è™šçº¿è¾¹æ¡†ï¼‰åœ¨ä¸¤ä¸ªä¸åŒçš„åµŒå¥—å±‚çº§ä¸Šæ¸²æŸ“ã€‚æ³¨æ„ï¼Œå®ƒå†…éƒ¨çš„ <code>&lt;Heading&gt;</code> ä¼šè‡ªåŠ¨ä»æœ€è¿‘çš„ <code>&lt;Section&gt;</code> è·å–å®ƒçš„çº§åˆ«ï¼š</p><p>Section.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-33xoqzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-33xoqzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">LevelContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./LevelContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Section</span>(<span class="hljs-params">&#123; children, isFancy &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> level = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">LevelContext</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      &#x27;<span class="hljs-attr">section</span> &#x27; +</span></span><br><span class="hljs-tag"><span class="language-xml">      (<span class="hljs-attr">isFancy</span> ? &#x27;<span class="hljs-attr">fancy</span>&#x27; <span class="hljs-attr">:</span> &#x27;&#x27;)</span></span><br><span class="hljs-tag"><span class="language-xml">    &#125;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">LevelContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;level</span> + <span class="hljs-attr">1</span>&#125;&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">LevelContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8uzimclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8uzimclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Heading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Heading.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Section</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Section.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>My Profile<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Post</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;æ—…è¡Œè€…ï¼Œä½ å¥½ï¼&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">body</span>=<span class="hljs-string">&quot;æ¥çœ‹çœ‹æˆ‘çš„å†’é™©ã€‚&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AllPosts</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">AllPosts</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>å¸–å­<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">RecentPosts</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">RecentPosts</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span>æœ€è¿‘çš„å¸–å­<span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Post</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;é‡Œæ–¯æœ¬çš„å‘³é“&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">body</span>=<span class="hljs-string">&quot;...é‚£äº›è›‹æŒï¼&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Post</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;æ¢æˆˆèŠ‚å¥ä¸­çš„å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">body</span>=<span class="hljs-string">&quot;æˆ‘çˆ±å®ƒï¼&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Post</span>(<span class="hljs-params">&#123; title, body &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Section</span> <span class="hljs-attr">isFancy</span>=<span class="hljs-string">&#123;true&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">        &#123;title&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Heading</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;body&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Section</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231110171520033.png" alt="image-20231110171520033" style="zoom:50%;" /><p><strong><mark>Context è®©ä½ å¯ä»¥ç¼–å†™â€œé€‚åº”å‘¨å›´ç¯å¢ƒâ€çš„ç»„ä»¶ï¼Œå¹¶ä¸”æ ¹æ® åœ¨å“ª ï¼ˆæˆ–è€…è¯´ åœ¨å“ªä¸ª context ä¸­ï¼‰æ¥æ¸²æŸ“å®ƒä»¬ä¸åŒçš„æ ·å­ã€‚</mark></strong></p><p>Context çš„å·¥ä½œæ–¹å¼å¯èƒ½ä¼šè®©ä½ æƒ³èµ· <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/inheritance">CSS å±æ€§ç»§æ‰¿</a>ã€‚åœ¨ CSS ä¸­ï¼Œä½ å¯ä»¥ä¸ºä¸€ä¸ª <code>&lt;div&gt;</code> æ‰‹åŠ¨æŒ‡å®š <code>color: blue</code>ï¼Œå¹¶ä¸”å…¶ä¸­çš„ä»»ä½• DOM èŠ‚ç‚¹ï¼Œæ— è®ºå¤šæ·±ï¼Œéƒ½ä¼šç»§æ‰¿é‚£ä¸ªé¢œè‰²ï¼Œé™¤éä¸­é—´çš„å…¶ä»– DOM èŠ‚ç‚¹ç”¨ <code>color: green</code> æ¥è¦†ç›–å®ƒã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ React ä¸­ï¼Œè¦†ç›–æ¥è‡ªä¸Šå±‚çš„æŸäº› context çš„å”¯ä¸€æ–¹æ³•æ˜¯å°†å­ç»„ä»¶åŒ…è£¹åˆ°ä¸€ä¸ªæä¾›ä¸åŒå€¼çš„ context provider ä¸­ã€‚</p><p>åœ¨ CSS ä¸­ï¼Œè¯¸å¦‚ <code>color</code> å’Œ <code>background-color</code> ä¹‹ç±»çš„ä¸åŒå±æ€§ä¸ä¼šè¦†ç›–å½¼æ­¤ã€‚ä½ å¯ä»¥è®¾ç½®æ‰€æœ‰ <code>&lt;div&gt;</code> çš„ <code>color</code> ä¸ºçº¢è‰²ï¼Œè€Œä¸ä¼šå½±å“ <code>background-color</code>ã€‚ç±»ä¼¼åœ°ï¼Œ<strong>ä¸åŒçš„ React context ä¸ä¼šè¦†ç›–å½¼æ­¤</strong>ã€‚ä½ é€šè¿‡ <code>createContext()</code> åˆ›å»ºçš„æ¯ä¸ª context éƒ½å’Œå…¶ä»– context å®Œå…¨åˆ†ç¦»ï¼Œåªæœ‰ä½¿ç”¨å’Œæä¾› <strong>é‚£ä¸ªç‰¹å®šçš„</strong> context çš„ç»„ä»¶æ‰ä¼šè”ç³»åœ¨ä¸€èµ·ã€‚ä¸€ä¸ªç»„ä»¶å¯ä»¥è½»æ¾åœ°ä½¿ç”¨æˆ–è€…æä¾›è®¸å¤šä¸åŒçš„ contextã€‚</p><p><strong>å¦‚æœä½ åªæƒ³æŠŠä¸€äº› props ä¼ é€’åˆ°å¤šä¸ªå±‚çº§ä¸­ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ éœ€è¦æŠŠè¿™äº›ä¿¡æ¯æ”¾åˆ° context é‡Œã€‚</strong></p><p>åœ¨ä½¿ç”¨ context ä¹‹å‰ï¼Œä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ç§æ›¿ä»£æ–¹æ¡ˆï¼š</p><ol><li>**<mark>ä» <a href="https://zh-hans.react.dev/learn/passing-props-to-a-component">ä¼ é€’ props</a> å¼€å§‹</mark>**ï¼š å¦‚æœä½ çš„ç»„ä»¶çœ‹èµ·æ¥ä¸èµ·çœ¼ï¼Œé‚£ä¹ˆé€šè¿‡åå‡ ä¸ªç»„ä»¶å‘ä¸‹ä¼ é€’ä¸€å † props å¹¶ä¸ç½•è§ã€‚è¿™æœ‰ç‚¹åƒæ˜¯åœ¨åŸ‹å¤´è‹¦å¹²ï¼Œä½†æ˜¯è¿™æ ·åšå¯ä»¥è®©å“ªäº›ç»„ä»¶ç”¨äº†å“ªäº›æ•°æ®å˜å¾—ååˆ†æ¸…æ™°ï¼ç»´æŠ¤ä½ ä»£ç çš„äººä¼šå¾ˆé«˜å…´ä½ ç”¨ props è®©æ•°æ®æµå˜å¾—æ›´åŠ æ¸…æ™°ã€‚</li><li>**<mark>æŠ½è±¡ç»„ä»¶å¹¶ <a href="https://zh-hans.react.dev/learn/passing-props-to-a-component#passing-jsx-as-children">å°† JSX ä½œä¸º <code>children</code> ä¼ é€’</a> ç»™å®ƒä»¬</mark>**ï¼š å¦‚æœä½ é€šè¿‡å¾ˆå¤šå±‚ä¸ä½¿ç”¨è¯¥æ•°æ®çš„ä¸­é—´ç»„ä»¶ï¼ˆå¹¶ä¸”åªä¼šå‘ä¸‹ä¼ é€’ï¼‰æ¥ä¼ é€’æ•°æ®ï¼Œè¿™é€šå¸¸æ„å‘³ç€ä½ åœ¨æ­¤è¿‡ç¨‹ä¸­å¿˜è®°äº†æŠ½è±¡ç»„ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½æƒ³ä¼ é€’ä¸€äº›åƒ <code>posts</code> çš„æ•°æ® props åˆ°ä¸ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„ç»„ä»¶ï¼Œç±»ä¼¼ <code>&lt;Layout posts=&#123;posts&#125; /&gt;</code>ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè®© <code>Layout</code> æŠŠ <code>children</code> å½“åšä¸€ä¸ªå‚æ•°ï¼Œç„¶åæ¸²æŸ“ <code>&lt;Layout&gt;&lt;Posts posts=&#123;posts&#125; /&gt;&lt;/Layout&gt;</code>ã€‚è¿™æ ·å°±å‡å°‘äº†å®šä¹‰æ•°æ®çš„ç»„ä»¶å’Œä½¿ç”¨æ•°æ®çš„ç»„ä»¶ä¹‹é—´çš„å±‚çº§ã€‚</li></ol><p>å¦‚æœè¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸é€‚åˆä½ ï¼Œå†è€ƒè™‘ä½¿ç”¨ contextã€‚</p><p><mark>Context çš„ä½¿ç”¨åœºæ™¯ </mark>ï¼š</p><ul><li><strong>ä¸»é¢˜ï¼š</strong> å¦‚æœä½ çš„åº”ç”¨å…è®¸ç”¨æˆ·æ›´æ”¹å…¶å¤–è§‚ï¼ˆä¾‹å¦‚æš—å¤œæ¨¡å¼ï¼‰ï¼Œä½ å¯ä»¥åœ¨åº”ç”¨é¡¶å±‚æ”¾ä¸€ä¸ª context providerï¼Œå¹¶åœ¨éœ€è¦è°ƒæ•´å…¶å¤–è§‚çš„ç»„ä»¶ä¸­ä½¿ç”¨è¯¥ contextã€‚</li><li><strong>å½“å‰è´¦æˆ·ï¼š</strong> è®¸å¤šç»„ä»¶å¯èƒ½éœ€è¦çŸ¥é“å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ã€‚å°†å®ƒæ”¾åˆ° context ä¸­å¯ä»¥æ–¹ä¾¿åœ°åœ¨æ ‘ä¸­çš„ä»»ä½•ä½ç½®è¯»å–å®ƒã€‚æŸäº›åº”ç”¨è¿˜å…è®¸ä½ åŒæ—¶æ“ä½œå¤šä¸ªè´¦æˆ·ï¼ˆä¾‹å¦‚ï¼Œä»¥ä¸åŒç”¨æˆ·çš„èº«ä»½å‘è¡¨è¯„è®ºï¼‰ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°† UI çš„ä¸€éƒ¨åˆ†åŒ…è£¹åˆ°å…·æœ‰ä¸åŒè´¦æˆ·æ•°æ®çš„ provider ä¸­ä¼šå¾ˆæ–¹ä¾¿ã€‚</li><li><strong>è·¯ç”±ï¼š</strong> å¤§å¤šæ•°è·¯ç”±è§£å†³æ–¹æ¡ˆåœ¨å…¶å†…éƒ¨ä½¿ç”¨ context æ¥ä¿å­˜å½“å‰è·¯ç”±ã€‚è¿™å°±æ˜¯æ¯ä¸ªé“¾æ¥â€œçŸ¥é“â€å®ƒæ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€çš„æ–¹å¼ã€‚å¦‚æœä½ åˆ›å»ºè‡ªå·±çš„è·¯ç”±åº“ï¼Œä½ å¯èƒ½ä¹Ÿä¼šè¿™ä¹ˆåšã€‚</li><li><strong>çŠ¶æ€ç®¡ç†ï¼š</strong> éšç€ä½ çš„åº”ç”¨çš„å¢é•¿ï¼Œæœ€ç»ˆåœ¨é è¿‘åº”ç”¨é¡¶éƒ¨çš„ä½ç½®å¯èƒ½ä¼šæœ‰å¾ˆå¤š stateã€‚è®¸å¤šé¥è¿œçš„ä¸‹å±‚ç»„ä»¶å¯èƒ½æƒ³è¦ä¿®æ”¹å®ƒä»¬ã€‚é€šå¸¸ <a href="https://zh-hans.react.dev/learn/scaling-up-with-reducer-and-context">å°† reducer ä¸ context æ­é…ä½¿ç”¨</a>æ¥ç®¡ç†å¤æ‚çš„çŠ¶æ€å¹¶å°†å…¶ä¼ é€’ç»™æ·±å±‚çš„ç»„ä»¶æ¥é¿å…è¿‡å¤šçš„éº»çƒ¦ã€‚</li></ul><p>Context ä¸å±€é™äºé™æ€å€¼ã€‚å¦‚æœä½ åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ä¼ é€’ä¸åŒçš„å€¼ï¼ŒReact å°†ä¼šæ›´æ–°è¯»å–å®ƒçš„æ‰€æœ‰ä¸‹å±‚ç»„ä»¶ï¼è¿™å°±æ˜¯ context ç»å¸¸å’Œ state ç»“åˆä½¿ç”¨çš„åŸå› ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœæ ‘ä¸­ä¸åŒéƒ¨åˆ†çš„è¿œè·ç¦»ç»„ä»¶éœ€è¦æŸäº›ä¿¡æ¯ï¼Œcontext å°†ä¼šå¯¹ä½ å¤§æœ‰å¸®åŠ©ã€‚</p><h2 id="7-ä½¿ç”¨-Reducer-å’Œ-Context-æ‹“å±•ä½ çš„åº”ç”¨"><a href="#7-ä½¿ç”¨-Reducer-å’Œ-Context-æ‹“å±•ä½ çš„åº”ç”¨" class="headerlink" title="7.ä½¿ç”¨ Reducer å’Œ Context æ‹“å±•ä½ çš„åº”ç”¨"></a>7.ä½¿ç”¨ Reducer å’Œ Context æ‹“å±•ä½ çš„åº”ç”¨</h2><p>Reducer å¯ä»¥æ•´åˆç»„ä»¶çš„çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚Context å¯ä»¥å°†ä¿¡æ¯æ·±å…¥ä¼ é€’ç»™å…¶ä»–ç»„ä»¶ã€‚ä½ å¯ä»¥ç»„åˆä½¿ç”¨å®ƒä»¬æ¥å…±åŒç®¡ç†ä¸€ä¸ªå¤æ‚é¡µé¢çš„çŠ¶æ€ã€‚</p><p>Reducer æœ‰åŠ©äºä¿æŒäº‹ä»¶å¤„ç†ç¨‹åºçš„ç®€çŸ­æ˜äº†ã€‚ä½†éšç€åº”ç”¨è§„æ¨¡è¶Šæ¥è¶Šåºå¤§ï¼Œä½ å°±å¯èƒ½ä¼šé‡åˆ°åˆ«çš„å›°éš¾ã€‚<strong>ç›®å‰ï¼Œ<code>tasks</code> çŠ¶æ€å’Œ <code>dispatch</code> å‡½æ•°ä»…åœ¨é¡¶çº§ <code>TaskApp</code> ç»„ä»¶ä¸­å¯ç”¨</strong>ã€‚è¦è®©å…¶ä»–ç»„ä»¶è¯»å–ä»»åŠ¡åˆ—è¡¨æˆ–æ›´æ”¹å®ƒï¼Œä½ å¿…é¡»æ˜¾å¼ <a href="https://zh-hans.react.dev/learn/passing-props-to-a-component">ä¼ é€’</a> å½“å‰çŠ¶æ€å’Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°†å…¶ä½œä¸º propsã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>TaskApp</code> å°† ä¸€ç³»åˆ— task å’Œäº‹ä»¶å¤„ç†ç¨‹åºä¼ é€’ç»™ <code>TaskList</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-68xw09lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-68xw09lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">TaskList</span><br>  tasks=&#123;tasks&#125;<br>  onChangeTask=&#123;handleChangeTask&#125;<br>  onDeleteTask=&#123;handleDeleteTask&#125;<br>/&gt;<br></code></pre></td></tr></table></div></figure><p><code>TaskList</code> å°†äº‹ä»¶å¤„ç†ç¨‹åºä¼ é€’ç»™ <code>Task</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3xfrcmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3xfrcmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Task</span><br>  task=&#123;task&#125;<br>  onChange=&#123;onChangeTask&#125;<br>  onDelete=&#123;onDeleteTask&#125;<br>/&gt;<br></code></pre></td></tr></table></div></figure><p>åœ¨åƒè¿™æ ·çš„å°ç¤ºä¾‹é‡Œè¿™æ ·åšæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰æˆåƒä¸Šç™¾ä¸ªç»„ä»¶ï¼Œä¼ é€’æ‰€æœ‰çŠ¶æ€å’Œå‡½æ•°å¯èƒ½ä¼šéå¸¸éº»çƒ¦ï¼</p><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œæ¯”èµ·é€šè¿‡ props ä¼ é€’å®ƒä»¬ï¼Œä½ å¯èƒ½æƒ³æŠŠ <code>tasks</code> çŠ¶æ€å’Œ <code>dispatch</code> å‡½æ•°éƒ½ <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context">æ”¾å…¥ context</a>ã€‚<strong>è¿™æ ·ï¼Œæ‰€æœ‰çš„åœ¨ <code>TaskApp</code> ç»„ä»¶æ ‘ä¹‹ä¸‹çš„ç»„ä»¶éƒ½ä¸å¿…ä¸€ç›´å¾€ä¸‹ä¼  props è€Œå¯ä»¥ç›´æ¥è¯»å– tasks å’Œ dispatch å‡½æ•°</strong>ã€‚</p><p>ç»“åˆä½¿ç”¨ reducer å’Œ contextï¼š</p><ol><li><p><strong>åˆ›å»º</strong> contextï¼š<code>useReducer</code> è¿”å›å½“å‰çš„ <code>tasks</code> å’Œ <code>dispatch</code> å‡½æ•°æ¥è®©ä½ æ›´æ–°å®ƒä»¬ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s1k3oslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s1k3oslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br></code></pre></td></tr></table></div></figure><p>ä¸ºäº†å°†å®ƒä»¬ä»ç»„ä»¶æ ‘å¾€ä¸‹ä¼ ï¼Œä½ å°† <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context#step-2-use-the-context">åˆ›å»º</a> ä¸¤ä¸ªä¸åŒçš„ contextï¼š</p><ul><li><code>TasksContext</code> æä¾›å½“å‰çš„ tasks åˆ—è¡¨ã€‚</li><li><code>TasksDispatchContext</code> æä¾›äº†ä¸€ä¸ªå‡½æ•°å¯ä»¥è®©ç»„ä»¶åˆ†å‘åŠ¨ä½œã€‚</li></ul><p>å°†å®ƒä»¬ä»å•ç‹¬çš„æ–‡ä»¶å¯¼å‡ºï¼Œä»¥ä¾¿ä»¥åå¯ä»¥ä»å…¶ä»–æ–‡ä»¶å¯¼å…¥å®ƒä»¬ï¼š</p><p>TasksContext.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0va1hplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0va1hplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksDispatchContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></div></figure><p>æŠŠ <code>null</code> ä½œä¸ºé»˜è®¤å€¼ä¼ é€’ç»™ä¸¤ä¸ª contextã€‚å®é™…å€¼æ˜¯ç”± <code>TaskApp</code> ç»„ä»¶æä¾›çš„ã€‚</p></li><li><p>å°† state å’Œ dispatch <strong>æ”¾å…¥</strong> contextï¼šç°åœ¨ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰çš„ context å¯¼å…¥ <code>TaskApp</code> ç»„ä»¶ã€‚è·å– <code>useReducer()</code> è¿”å›çš„ <code>tasks</code> å’Œ <code>dispatch</code> å¹¶å°†å®ƒä»¬ <a href="https://zh-hans.react.dev/learn/passing-data-deeply-with-context#step-3-provide-the-context">æä¾›</a> ç»™æ•´ä¸ªç»„ä»¶æ ‘ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-626opllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-626opllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TasksContext</span>, <span class="hljs-title class_">TasksDispatchContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> ( <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;tasks&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TasksDispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">        ...</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">TasksDispatchContext.Provider</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">TasksContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥åŒæ—¶é€šè¿‡ props å’Œ context ä¼ é€’ä¿¡æ¯ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xlw5hklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xlw5hklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TasksContext</span>, <span class="hljs-title class_">TasksDispatchContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(<br>    tasksReducer,<br>    initialTasks<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAddTask</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;added&#x27;</span>,<br>      <span class="hljs-attr">id</span>: nextId++,<br>      <span class="hljs-attr">text</span>: text,<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChangeTask</span>(<span class="hljs-params">task</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;changed&#x27;</span>,<br>      <span class="hljs-attr">task</span>: task<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDeleteTask</span>(<span class="hljs-params">taskId</span>) &#123;<br>    <span class="hljs-title function_">dispatch</span>(&#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;deleted&#x27;</span>,<br>      <span class="hljs-attr">id</span>: taskId<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;tasks&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TasksDispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Day off in Kyoto<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onAddTask</span>=<span class="hljs-string">&#123;handleAddTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">tasks</span>=<span class="hljs-string">&#123;tasks&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChangeTask</span>=<span class="hljs-string">&#123;handleChangeTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onDeleteTask</span>=<span class="hljs-string">&#123;handleDeleteTask&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">TasksDispatchContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">TasksContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> [...tasks, &#123;<br>        <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span><br>      &#125;];<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Unknown action: &#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Philosopherâ€™s Path&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Visit the temple&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Drink matcha&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> &#125;<br>];<br></code></pre></td></tr></table></div></figure></li><li><p>åœ¨ç»„ä»¶æ ‘çš„ä»»ä½•åœ°æ–¹ <strong>ä½¿ç”¨</strong> contextï¼š</p></li><li><p>ç°åœ¨ä½ ä¸éœ€è¦å°† tasks å’Œäº‹ä»¶å¤„ç†ç¨‹åºåœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vpxufnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vpxufnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">TasksContext</span>.<span class="hljs-property">Provider</span> value=&#123;tasks&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksDispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Day off in Kyoto<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">TasksDispatchContext.Provider</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">TasksContext</span>.<span class="hljs-property">Provider</span>&gt;<br></code></pre></td></tr></table></div></figure><p>ç›¸åï¼Œä»»ä½•éœ€è¦ tasks çš„ç»„ä»¶éƒ½å¯ä»¥ä» <code>TaskContext</code> ä¸­è¯»å–å®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mbk0w7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mbk0w7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskList</span>(<span class="hljs-params"></span>) &#123;<br><br>  <span class="hljs-keyword">const</span> tasks = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksContext</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ä»»ä½•ç»„ä»¶éƒ½å¯ä»¥ä» context ä¸­è¯»å– <code>dispatch</code> å‡½æ•°å¹¶è°ƒç”¨å®ƒï¼Œä»è€Œæ›´æ–°ä»»åŠ¡åˆ—è¡¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-m365atlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-m365atlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AddTask</span>(<span class="hljs-params"></span>) &#123;<br><br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksDispatchContext</span>);<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="hljs-comment">// ...</span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      setText(&#x27;&#x27;);</span><br><span class="language-xml">      dispatch(&#123;</span><br><span class="language-xml">        type: &#x27;added&#x27;,</span><br><span class="language-xml">        id: nextId++,</span><br><span class="language-xml">        text: text,</span><br><span class="language-xml">      &#125;);</span><br><span class="language-xml">    &#125;&#125;&gt;Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>    <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p><mark><strong><code>TaskApp</code> ç»„ä»¶ä¸ä¼šå‘ä¸‹ä¼ é€’ä»»ä½•äº‹ä»¶å¤„ç†ç¨‹åºï¼Œ<code>TaskList</code> ä¹Ÿä¸ä¼š</strong>ã€‚æ¯ä¸ªç»„ä»¶éƒ½ä¼šè¯»å–å®ƒéœ€è¦çš„ context</mark>ï¼š</p><p>TaskList.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-z8lw5llqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-z8lw5llqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TasksContext</span>, <span class="hljs-title class_">TasksDispatchContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> tasks = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksContext</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;tasks.map(task =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;task.id&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Task</span> <span class="hljs-attr">task</span>=<span class="hljs-string">&#123;task&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Task</span>(<span class="hljs-params">&#123; task &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isEditing, setIsEditing] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksDispatchContext</span>);<br>  <span class="hljs-keyword">let</span> taskContent;<br>  <span class="hljs-keyword">if</span> (isEditing) &#123;<br>    taskContent = (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;task.text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            dispatch(&#123;</span><br><span class="language-xml">              type: &#x27;changed&#x27;,</span><br><span class="language-xml">              task: &#123;</span><br><span class="language-xml">                ...task,</span><br><span class="language-xml">                text: e.target.value</span><br><span class="language-xml">              &#125;</span><br><span class="language-xml">            &#125;);</span><br><span class="language-xml">          &#125;&#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsEditing(false)&#125;&gt;</span><br><span class="language-xml">          Save</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    taskContent = (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        &#123;task.text&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsEditing(true)&#125;&gt;</span><br><span class="language-xml">          Edit</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;task.done&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">          dispatch(&#123;</span><br><span class="language-xml">            type: &#x27;changed&#x27;,</span><br><span class="language-xml">            task: &#123;</span><br><span class="language-xml">              ...task,</span><br><span class="language-xml">              done: e.target.checked</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">          &#125;);</span><br><span class="language-xml">        &#125;&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      &#123;taskContent&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        dispatch(&#123;</span><br><span class="language-xml">          type: &#x27;deleted&#x27;,</span><br><span class="language-xml">          id: task.id</span><br><span class="language-xml">        &#125;);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        Delete</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>state ä»ç„¶ â€œå­˜åœ¨äºâ€ é¡¶å±‚ <code>Task</code> ç»„ä»¶ä¸­ï¼Œç”± <code>useReducer</code> è¿›è¡Œç®¡ç†</strong>ã€‚ä¸è¿‡ï¼Œç»„ä»¶æ ‘é‡Œçš„ç»„ä»¶åªè¦å¯¼å…¥è¿™äº› context ä¹‹åå°±å¯ä»¥è·å– <code>tasks</code> å’Œ <code>dispatch</code>ã€‚</p></li></ol><p><mark>å°†ç›¸å…³é€»è¾‘è¿ç§»åˆ°ä¸€ä¸ªæ–‡ä»¶å½“ä¸­ </mark>ï¼šè¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†ä½ å¯ä»¥é€šè¿‡å°† reducer å’Œ context ç§»åŠ¨åˆ°å•ä¸ªæ–‡ä»¶ä¸­æ¥è¿›ä¸€æ­¥æ•´ç†ç»„ä»¶ã€‚ç›®å‰ï¼Œâ€œTasksContext.jsâ€ ä»…åŒ…å«ä¸¤ä¸ª context å£°æ˜ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q5x67flqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q5x67flqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksDispatchContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></div></figure><p>æ¥ç»™è¿™ä¸ªæ–‡ä»¶æ·»åŠ æ›´å¤šä»£ç ï¼å°† reducer ç§»åŠ¨åˆ°æ­¤æ–‡ä»¶ä¸­ï¼Œç„¶åå£°æ˜ä¸€ä¸ªæ–°çš„ <code>TasksProvider</code> ç»„ä»¶ã€‚æ­¤ç»„ä»¶å°†æ‰€æœ‰éƒ¨åˆ†è¿æ¥åœ¨ä¸€èµ·ï¼š</p><ol><li>å®ƒå°†ç®¡ç† reducer çš„çŠ¶æ€ã€‚</li><li>å®ƒå°†æä¾›ç°æœ‰çš„ context ç»™ç»„ä»¶æ ‘ã€‚</li><li>å®ƒå°† <a href="https://zh-hans.react.dev/learn/passing-props-to-a-component#passing-jsx-as-children">æŠŠ <code>children</code> ä½œä¸º prop</a>ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¼ é€’ JSXã€‚</li></ol><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-px1ig5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-px1ig5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TasksProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(tasksReducer, initialTasks);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;tasks&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TasksDispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">TasksDispatchContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">TasksContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>è¿™å°†ä½¿ <code>TaskApp</code> ç»„ä»¶æ›´åŠ ç›´è§‚ï¼š</strong></p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b7yixslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b7yixslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AddTask</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./AddTask.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TaskList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TaskList.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">TasksProvider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskApp</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksProvider</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Day off in Kyoto<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AddTask</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TaskList</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">TasksProvider</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ ä¹Ÿå¯ä»¥ä» <code>TasksContext.js</code> ä¸­å¯¼å‡ºä½¿ç”¨ context çš„å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5b5psblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5b5psblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTasks</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksContext</span>);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTasksDispatch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksDispatchContext</span>);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç»„ä»¶å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°è¯»å– contextï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n9nwzzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n9nwzzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> tasks = <span class="hljs-title function_">useTasks</span>();<br><br><span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useTasksDispatch</span>();<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ä¼šæ”¹å˜ä»»ä½•è¡Œä¸ºï¼Œä½†å®ƒä¼šå…è®¸ä½ ä¹‹åè¿›ä¸€æ­¥åˆ†å‰²è¿™äº› context æˆ–å‘è¿™äº›å‡½æ•°æ·»åŠ ä¸€äº›é€»è¾‘ã€‚<strong>ç°åœ¨æ‰€æœ‰çš„ context å’Œ reducer è¿æ¥éƒ¨åˆ†éƒ½åœ¨ <code>TasksContext.js</code> ä¸­ã€‚è¿™ä¿æŒäº†ç»„ä»¶çš„å¹²å‡€å’Œæ•´æ´ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºå®ƒä»¬æ˜¾ç¤ºçš„å†…å®¹ï¼Œè€Œä¸æ˜¯å®ƒä»¬ä»å“ªé‡Œè·å¾—æ•°æ®ï¼š</strong></p><p>TaskList.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1s1diklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1s1diklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; useTasks, useTasksDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TaskList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> tasks = <span class="hljs-title function_">useTasks</span>();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      &#123;tasks.map(task =&gt; (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;task.id&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Task</span> <span class="hljs-attr">task</span>=<span class="hljs-string">&#123;task&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">      ))&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Task</span>(<span class="hljs-params">&#123; task &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isEditing, setIsEditing] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useTasksDispatch</span>();<br>  <span class="hljs-keyword">let</span> taskContent;<br>  <span class="hljs-keyword">if</span> (isEditing) &#123;<br>    taskContent = (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;task.text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">            dispatch(&#123;</span><br><span class="language-xml">              type: &#x27;changed&#x27;,</span><br><span class="language-xml">              task: &#123;</span><br><span class="language-xml">                ...task,</span><br><span class="language-xml">                text: e.target.value</span><br><span class="language-xml">              &#125;</span><br><span class="language-xml">            &#125;);</span><br><span class="language-xml">          &#125;&#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsEditing(false)&#125;&gt;</span><br><span class="language-xml">          Save</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    taskContent = (<br>      <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">        &#123;task.text&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsEditing(true)&#125;&gt;</span><br><span class="language-xml">          Edit</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;task.done&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">          dispatch(&#123;</span><br><span class="language-xml">            type: &#x27;changed&#x27;,</span><br><span class="language-xml">            task: &#123;</span><br><span class="language-xml">              ...task,</span><br><span class="language-xml">              done: e.target.checked</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">          &#125;);</span><br><span class="language-xml">        &#125;&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      &#123;taskContent&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        dispatch(&#123;</span><br><span class="language-xml">          type: &#x27;deleted&#x27;,</span><br><span class="language-xml">          id: task.id</span><br><span class="language-xml">        &#125;);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        Delete</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¯ä»¥å°† <code>TasksProvider</code> è§†ä¸ºé¡µé¢çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒçŸ¥é“å¦‚ä½•å¤„ç† tasksã€‚<code>useTasks</code> ç”¨æ¥è¯»å–å®ƒä»¬ï¼Œ<code>useTasksDispatch</code> ç”¨æ¥ä»ç»„ä»¶æ ‘ä¸‹çš„ä»»ä½•ç»„ä»¶æ›´æ–°å®ƒä»¬ã€‚</p><p>AddTask.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4rmcrplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4rmcrplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; useTasksDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./TasksContext.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AddTask</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useTasksDispatch</span>();<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Add task&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setText(&#x27;&#x27;);</span><br><span class="language-xml">        dispatch(&#123;</span><br><span class="language-xml">          type: &#x27;added&#x27;,</span><br><span class="language-xml">          id: nextId++,</span><br><span class="language-xml">          text: text,</span><br><span class="language-xml">        &#125;); </span><br><span class="language-xml">      &#125;&#125;&gt;Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></div></figure><p>TasksContext.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bebovplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bebovplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; createContext, useContext, useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">TasksDispatchContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TasksProvider</span>(<span class="hljs-params">&#123; children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [tasks, dispatch] = <span class="hljs-title function_">useReducer</span>(<br>    tasksReducer,<br>    initialTasks<br>  );<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TasksContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;tasks&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TasksDispatchContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;dispatch&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;children&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">TasksDispatchContext.Provider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">TasksContext.Provider</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTasks</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksContext</span>);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTasksDispatch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">TasksDispatchContext</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">tasksReducer</span>(<span class="hljs-params">tasks, action</span>) &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;added&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> [...tasks, &#123;<br>        <span class="hljs-attr">id</span>: action.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">text</span>: action.<span class="hljs-property">text</span>,<br>        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span><br>      &#125;];<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;changed&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (t.<span class="hljs-property">id</span> === action.<span class="hljs-property">task</span>.<span class="hljs-property">id</span>) &#123;<br>          <span class="hljs-keyword">return</span> action.<span class="hljs-property">task</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-keyword">return</span> t;<br>        &#125;<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;deleted&#x27;</span>: &#123;<br>      <span class="hljs-keyword">return</span> tasks.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> !== action.<span class="hljs-property">id</span>);<br>    &#125;<br>    <span class="hljs-attr">default</span>: &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Unknown action: &#x27;</span> + action.<span class="hljs-property">type</span>);<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> initialTasks = [<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Philosopherâ€™s Path&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Visit the temple&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> &#125;,<br>  &#123; <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Drink matcha&#x27;</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> &#125;<br>];<br></code></pre></td></tr></table></div></figure><img src="image-20231113101014842.png" alt="image-20231113101014842" style="zoom:50%;" /><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">åƒ useTasks å’Œ useTasksDispatch è¿™æ ·çš„å‡½æ•°è¢«ç§°ä¸º è‡ªå®šä¹‰ Hookã€‚ å¦‚æœä½ çš„å‡½æ•°åä»¥ use å¼€å¤´ï¼Œå®ƒå°±è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ Hookã€‚è¿™è®©ä½ å¯ä»¥ä½¿ç”¨å…¶ä»– Hookï¼Œæ¯”å¦‚ useContextã€‚</p><p>éšç€åº”ç”¨çš„å¢é•¿ï¼Œä½ å¯èƒ½ä¼šæœ‰è®¸å¤šè¿™æ ·çš„ context å’Œ reducer çš„ç»„åˆã€‚è¿™æ˜¯ä¸€ç§å¼ºå¤§çš„æ‹“å±•åº”ç”¨å¹¶ <a href="https://zh-hans.react.dev/learn/sharing-state-between-components">æå‡çŠ¶æ€</a> çš„æ–¹å¼ï¼Œè®©ä½ åœ¨ç»„ä»¶æ ‘æ·±å¤„è®¿é—®æ•°æ®æ—¶æ— éœ€è¿›è¡Œå¤ªå¤šå·¥ä½œã€‚</p><h1 id="å…­-åº”æ€¥æ–¹æ¡ˆ"><a href="#å…­-åº”æ€¥æ–¹æ¡ˆ" class="headerlink" title="å…­.åº”æ€¥æ–¹æ¡ˆ"></a>å…­.åº”æ€¥æ–¹æ¡ˆ</h1><p>æœ‰äº›ç»„ä»¶å¯èƒ½éœ€è¦æ§åˆ¶å’ŒåŒæ­¥ React ä¹‹å¤–çš„ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨æµè§ˆå™¨ API èšç„¦è¾“å…¥æ¡†ï¼Œæˆ–è€…åœ¨æ²¡æœ‰ React çš„æƒ…å†µä¸‹å®ç°è§†é¢‘æ’­æ”¾å™¨ï¼Œæˆ–è€…è¿æ¥å¹¶ç›‘å¬è¿œç¨‹æœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚</p><h2 id="1-ä½¿ç”¨-ref-å¼•ç”¨å€¼"><a href="#1-ä½¿ç”¨-ref-å¼•ç”¨å€¼" class="headerlink" title="1.ä½¿ç”¨ ref å¼•ç”¨å€¼"></a>1.ä½¿ç”¨ ref å¼•ç”¨å€¼</h2><p>å½“ä½ å¸Œæœ›ç»„ä»¶â€œè®°ä½â€æŸäº›ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³è®©è¿™äº›ä¿¡æ¯ <a href="https://zh-hans.react.dev/learn/render-and-commit">è§¦å‘æ–°çš„æ¸²æŸ“</a> æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <strong>ref</strong> ã€‚</p><p>å¯ä»¥é€šè¿‡ä» React å¯¼å…¥ <code>useRef</code> Hook æ¥ä¸ºä½ çš„ç»„ä»¶æ·»åŠ ä¸€ä¸ª refï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4jvjellqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4jvjellqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä½ çš„ç»„ä»¶å†…ï¼Œè°ƒç”¨ <code>useRef</code> Hook å¹¶ä¼ å…¥ä½ æƒ³è¦å¼•ç”¨çš„åˆå§‹å€¼ä½œä¸ºå”¯ä¸€å‚æ•°ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œçš„ ref å¼•ç”¨çš„å€¼æ˜¯â€œ0â€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cma29jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cma29jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></div></figure><p><code>useRef</code> è¿”å›ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡:</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d7pis9lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d7pis9lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123; <br>  <span class="hljs-attr">current</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// ä½ å‘ useRef ä¼ å…¥çš„å€¼</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ å¯ä»¥ç”¨ <code>ref.current</code> å±æ€§è®¿é—®è¯¥ ref çš„å½“å‰å€¼ã€‚è¿™ä¸ªå€¼æ˜¯æœ‰æ„è¢«è®¾ç½®ä¸ºå¯å˜çš„ï¼Œæ„å‘³ç€ä½ æ—¢å¯ä»¥è¯»å–å®ƒä¹Ÿå¯ä»¥å†™å…¥å®ƒã€‚å°±åƒä¸€ä¸ª React è¿½è¸ªä¸åˆ°çš„ã€ç”¨æ¥å­˜å‚¨ç»„ä»¶ä¿¡æ¯çš„ç§˜å¯†â€œå£è¢‹â€ã€‚ï¼ˆè¿™å°±æ˜¯è®©å®ƒæˆä¸º React å•å‘æ•°æ®æµçš„â€œåº”æ€¥æ–¹æ¡ˆâ€çš„åŸå› ï¼‰</p><p>æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶ä¼šä½¿ <code>ref.current</code> é€’å¢ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-um6qo6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-um6qo6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    ref.<span class="hljs-property">current</span> = ref.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;ä½ ç‚¹å‡»äº† &#x27;</span> + ref.<span class="hljs-property">current</span> + <span class="hljs-string">&#x27; æ¬¡ï¼&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      ç‚¹å‡»æˆ‘ï¼</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åƒ <a href="https://zh-hans.react.dev/learn/state-a-components-memory">state</a> ä¸€æ ·ï¼Œä½ å¯ä»¥è®©å®ƒæŒ‡å‘ä»»ä½•ä¸œè¥¿ï¼šå­—ç¬¦ä¸²ã€å¯¹è±¡ï¼Œç”šè‡³æ˜¯å‡½æ•°ã€‚ä¸ state ä¸åŒçš„æ˜¯ï¼Œref æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå…·æœ‰å¯ä»¥è¢«è¯»å–å’Œä¿®æ”¹çš„ <code>current</code> å±æ€§ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<strong>ç»„ä»¶ä¸ä¼šåœ¨æ¯æ¬¡é€’å¢æ—¶é‡æ–°æ¸²æŸ“ã€‚</strong> <mark>ä¸ state ä¸€æ ·ï¼ŒReact ä¼šåœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ä¹‹é—´ä¿ç•™ refã€‚ä½†æ˜¯ï¼Œè®¾ç½® state ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œæ›´æ”¹ ref ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶</mark>ï¼</p><hr><p>åˆ¶ä½œä¸€ä¸ªç§’è¡¨ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æŒ‰æŒ‰é’®æ¥ä½¿å…¶å¯åŠ¨æˆ–åœæ­¢ã€‚ä¸ºäº†æ˜¾ç¤ºä»ç”¨æˆ·æŒ‰ä¸‹â€œå¼€å§‹â€ä»¥æ¥ç»è¿‡çš„æ—¶é—´é•¿åº¦ï¼Œä½ éœ€è¦è¿½è¸ªæŒ‰ä¸‹â€œå¼€å§‹â€æŒ‰é’®çš„æ—¶é—´å’Œå½“å‰æ—¶é—´ã€‚<strong>æ­¤ä¿¡æ¯ç”¨äºæ¸²æŸ“ï¼Œæ‰€ä»¥ä½ ä¼šæŠŠå®ƒä¿å­˜åœ¨ state ä¸­ï¼š</strong></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kvjc5llqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kvjc5llqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [startTime, setStartTime] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">const</span> [now, setNow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></div></figure><p>å½“ç”¨æˆ·æŒ‰ä¸‹â€œå¼€å§‹â€æ—¶ï¼Œä½ å°†ç”¨ <a href="https://developer.mozilla.org/docs/Web/API/setInterval"><code>setInterval</code></a> æ¯ 10 æ¯«ç§’æ›´æ–°ä¸€æ¬¡æ—¶é—´ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-u8vxdllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-u8vxdllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Stopwatch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [startTime, setStartTime] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [now, setNow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStart</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">/*  å¼€å§‹è®¡æ—¶ã€‚  */</span> <br>    <span class="hljs-title function_">setStartTime</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br>    <span class="hljs-title function_">setNow</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br><br>    <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-comment">/*  æ¯ 10ms æ›´æ–°ä¸€æ¬¡å½“å‰æ—¶é—´ã€‚  */</span> <br>      <span class="hljs-title function_">setNow</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br>    &#125;, <span class="hljs-number">10</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> secondsPassed = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (startTime != <span class="hljs-literal">null</span> &amp;&amp; now != <span class="hljs-literal">null</span>) &#123;<br>    secondsPassed = (now - startTime) / <span class="hljs-number">1000</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ—¶é—´è¿‡å»äº†ï¼š &#123;secondsPassed.toFixed(3)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleStart&#125;</span>&gt;</span></span><br><span class="language-xml">        å¼€å§‹</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="clock-1699857496128-1.gif" alt="clock" style="zoom:50%;" /><p>å½“æŒ‰ä¸‹â€œåœæ­¢â€æŒ‰é’®æ—¶ï¼Œä½ éœ€è¦å–æ¶ˆç°æœ‰çš„ intervalï¼Œä»¥ä¾¿è®©å®ƒåœæ­¢æ›´æ–° <code>now</code> state å˜é‡ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/clearInterval"><code>clearInterval</code></a> æ¥å®Œæˆæ­¤æ“ä½œã€‚ä½†ä½ éœ€è¦ä¸ºå…¶æä¾› interval IDï¼Œæ­¤ ID æ˜¯ä¹‹å‰ç”¨æˆ·æŒ‰ä¸‹ Startã€è°ƒç”¨ <code>setInterval</code> æ—¶è¿”å›çš„ã€‚ä½ éœ€è¦å°† interval ID ä¿ç•™åœ¨æŸå¤„ã€‚ <strong>ç”±äº interval ID ä¸ç”¨äºæ¸²æŸ“ï¼Œä½ å¯ä»¥å°†å…¶ä¿å­˜åœ¨ ref ä¸­ï¼š</strong></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-42hveulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-42hveulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Stopwatch</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [startTime, setStartTime] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [now, setNow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> intervalRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStart</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setStartTime</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br>    <span class="hljs-title function_">setNow</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br><br>    <span class="hljs-built_in">clearInterval</span>(intervalRef.<span class="hljs-property">current</span>);<br>    intervalRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">setNow</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());<br>    &#125;, <span class="hljs-number">10</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleStop</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-built_in">clearInterval</span>(intervalRef.<span class="hljs-property">current</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">let</span> secondsPassed = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> (startTime != <span class="hljs-literal">null</span> &amp;&amp; now != <span class="hljs-literal">null</span>) &#123;<br>    secondsPassed = (now - startTime) / <span class="hljs-number">1000</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ—¶é—´è¿‡å»äº†ï¼š &#123;secondsPassed.toFixed(3)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleStart&#125;</span>&gt;</span></span><br><span class="language-xml">        å¼€å§‹</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleStop&#125;</span>&gt;</span></span><br><span class="language-xml">        åœæ­¢</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="clock2.gif" alt="clock2" style="zoom:50%;" /><p><mark>å½“ä¸€æ¡ä¿¡æ¯ç”¨äºæ¸²æŸ“æ—¶ï¼Œå°†å®ƒä¿å­˜åœ¨ state ä¸­ã€‚å½“ä¸€æ¡ä¿¡æ¯ä»…è¢«äº‹ä»¶å¤„ç†å™¨éœ€è¦ï¼Œå¹¶ä¸”æ›´æ”¹å®ƒä¸éœ€è¦é‡æ–°æ¸²æŸ“æ—¶ï¼Œä½¿ç”¨ ref å¯èƒ½ä¼šæ›´é«˜æ•ˆã€‚</mark></p><p>refå’Œstateçš„åŒºåˆ«ï¼š</p><table><thead><tr><th>ref</th><th>state</th></tr></thead><tbody><tr><td><code>useRef(initialValue)</code>è¿”å› <code>&#123; current: initialValue &#125;</code></td><td><code>useState(initialValue)</code> è¿”å› state å˜é‡çš„å½“å‰å€¼å’Œä¸€ä¸ª state è®¾ç½®å‡½æ•° ( <code>[value, setValue]</code>)</td></tr><tr><td>æ›´æ”¹æ—¶ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“</td><td>æ›´æ”¹æ—¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚</td></tr><tr><td>å¯å˜ â€”â€” ä½ å¯ä»¥åœ¨æ¸²æŸ“è¿‡ç¨‹ä¹‹å¤–ä¿®æ”¹å’Œæ›´æ–° <code>current</code> çš„å€¼ã€‚</td><td>â€œä¸å¯å˜â€ â€”â€” ä½ å¿…é¡»ä½¿ç”¨ state è®¾ç½®å‡½æ•°æ¥ä¿®æ”¹ state å˜é‡ï¼Œä»è€Œæ’é˜Ÿé‡æ–°æ¸²æŸ“ã€‚</td></tr><tr><td>ä½ ä¸åº”åœ¨æ¸²æŸ“æœŸé—´è¯»å–ï¼ˆæˆ–å†™å…¥ï¼‰ <code>current</code> å€¼ã€‚</td><td>ä½ å¯ä»¥éšæ—¶è¯»å– stateã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±ä¸å˜çš„ state <a href="https://zh-hans.react.dev/learn/state-as-a-snapshot">å¿«ç…§</a>ã€‚</td></tr></tbody></table><p>ä½¿ç”¨ state å®ç°çš„è®¡æ•°å™¨æŒ‰é’®ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9yibyblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9yibyblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      ä½ ç‚¹å‡»äº† &#123;count&#125; æ¬¡</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="click1.gif" alt="click1" style="zoom:50%;" /><p>å› ä¸º <code>count</code> çš„å€¼å°†ä¼šè¢«æ˜¾ç¤ºï¼Œæ‰€ä»¥ä¸ºå…¶ä½¿ç”¨ state æ˜¯åˆç†çš„ã€‚å½“ä½¿ç”¨ setCount() è®¾ç½®è®¡æ•°å™¨çš„å€¼æ—¶ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œå¹¶ä¸”å±å¹•ä¼šæ›´æ–°ä»¥å±•ç¤ºæ–°çš„è®¡æ•°ã€‚</p><p>å¦‚æœä½ è¯•å›¾ç”¨ ref æ¥å®ç°å®ƒï¼ŒReact æ°¸è¿œä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œæ‰€ä»¥ä½ æ°¸è¿œä¸ä¼šçœ‹åˆ°è®¡æ•°å˜åŒ–ï¼çœ‹çœ‹ç‚¹å‡»è¿™ä¸ªæŒ‰é’®å¦‚ä½• <strong>ä¸æ›´æ–°å®ƒçš„æ–‡æœ¬</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tg8rwalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tg8rwalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> countRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">/*  è¿™æ ·å¹¶æœªé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼  */</span> <br>    countRef.<span class="hljs-property">current</span> = countRef.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">      ä½ ç‚¹å‡»äº† &#123;countRef.current&#125; æ¬¡</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="click2.gif" alt="click2" style="zoom:50%;" /><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æ¸²æŸ“æœŸé—´è¯»å– <code>ref.current</code> ä¼šå¯¼è‡´ä»£ç ä¸å¯é çš„åŸå› ã€‚å¦‚æœéœ€è¦ï¼Œè¯·æ”¹ç”¨ stateã€‚</p><p>ä½•æ—¶ä½¿ç”¨refï¼šå½“ä½ çš„ç»„ä»¶éœ€è¦â€œè·³å‡ºâ€ React å¹¶ä¸å¤–éƒ¨ API é€šä¿¡æ—¶ï¼Œä½ ä¼šç”¨åˆ° ref â€”â€” é€šå¸¸æ˜¯ä¸ä¼šå½±å“ç»„ä»¶å¤–è§‚çš„æµè§ˆå™¨ APIã€‚ä»¥ä¸‹æ˜¯è¿™äº›ç½•è§æƒ…å†µä¸­çš„å‡ ä¸ªï¼š</p><ul><li>å­˜å‚¨ <a href="https://developer.mozilla.org/docs/Web/API/setTimeout">timeout ID</a></li><li>å­˜å‚¨å’Œæ“ä½œ <a href="https://developer.mozilla.org/docs/Web/API/Element">DOM å…ƒç´ </a></li><li>å­˜å‚¨ä¸éœ€è¦è¢«ç”¨æ¥è®¡ç®— JSX çš„å…¶ä»–å¯¹è±¡ã€‚</li></ul><p>å¦‚æœä½ çš„ç»„ä»¶éœ€è¦å­˜å‚¨ä¸€äº›å€¼ï¼Œä½†ä¸å½±å“æ¸²æŸ“é€»è¾‘ï¼Œè¯·é€‰æ‹© refã€‚</p><p>éµå¾ªè¿™äº›åŸåˆ™å°†ä½¿ä½ çš„ç»„ä»¶æ›´å…·å¯é¢„æµ‹æ€§ï¼š</p><ul><li><strong>å°† ref è§†ä¸ºåº”æ€¥æ–¹æ¡ˆã€‚</strong> å½“ä½ ä½¿ç”¨å¤–éƒ¨ç³»ç»Ÿæˆ–æµè§ˆå™¨ API æ—¶ï¼Œref å¾ˆæœ‰ç”¨ã€‚å¦‚æœä½ å¾ˆå¤§ä¸€éƒ¨åˆ†åº”ç”¨ç¨‹åºé€»è¾‘å’Œæ•°æ®æµéƒ½ä¾èµ–äº refï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°è€ƒè™‘ä½ çš„æ–¹æ³•ã€‚</li><li><strong>ä¸è¦åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¯»å–æˆ–å†™å…¥ <code>ref.current</code>ã€‚</strong> å¦‚æœæ¸²æŸ“è¿‡ç¨‹ä¸­éœ€è¦æŸäº›ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ <a href="https://zh-hans.react.dev/learn/state-a-components-memory">state</a> ä»£æ›¿ã€‚ç”±äº React ä¸çŸ¥é“ <code>ref.current</code> ä½•æ—¶å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿åœ¨æ¸²æŸ“æ—¶è¯»å–å®ƒä¹Ÿä¼šä½¿ç»„ä»¶çš„è¡Œä¸ºéš¾ä»¥é¢„æµ‹ã€‚ï¼ˆå”¯ä¸€çš„ä¾‹å¤–æ˜¯åƒ <code>if (!ref.current) ref.current = new Thing()</code> è¿™æ ·çš„ä»£ç ï¼Œå®ƒåªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´è®¾ç½®ä¸€æ¬¡ refã€‚ï¼‰</li></ul><p>React state çš„é™åˆ¶ä¸é€‚ç”¨äº refã€‚ä¾‹å¦‚ï¼Œstate å°±åƒ <a href="https://zh-hans.react.dev/learn/state-as-a-snapshot">æ¯æ¬¡æ¸²æŸ“çš„å¿«ç…§</a>ï¼Œå¹¶ä¸” <a href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">ä¸ä¼šåŒæ­¥æ›´æ–°</a>ã€‚ä½†æ˜¯å½“ä½ æ”¹å˜ ref çš„ current å€¼æ—¶ï¼Œå®ƒä¼šç«‹å³æ”¹å˜ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8dxp2zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8dxp2zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">ref.<span class="hljs-property">current</span> = <span class="hljs-number">5</span>;<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ref.<span class="hljs-property">current</span>); <span class="hljs-comment">// 5</span><br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å› ä¸º <strong>ref æœ¬èº«æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œ</strong> æ‰€ä»¥å®ƒçš„è¡Œä¸ºå°±åƒå¯¹è±¡é‚£æ ·ã€‚</p><p>å½“ä½ ä½¿ç”¨ ref æ—¶ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒ <a href="https://zh-hans.react.dev/learn/updating-objects-in-state">é¿å…å˜æ›´</a>ã€‚åªè¦ä½ æ”¹å˜çš„å¯¹è±¡ä¸ç”¨äºæ¸²æŸ“ï¼ŒReact å°±ä¸ä¼šå…³å¿ƒä½ å¯¹ ref æˆ–å…¶å†…å®¹åšäº†ä»€ä¹ˆã€‚</p><p>ref æœ€å¸¸è§çš„ç”¨æ³•æ˜¯è®¿é—® DOM å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ä»¥ç¼–ç¨‹æ–¹å¼èšç„¦ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¿™ç§ç”¨æ³•å°±ä¼šæ´¾ä¸Šç”¨åœºã€‚å½“ä½ å°† ref ä¼ é€’ç»™ JSX ä¸­çš„ <code>ref</code> å±æ€§æ—¶ï¼Œæ¯”å¦‚ <code>&lt;div ref=&#123;myRef&#125;&gt;</code>ï¼ŒReact ä¼šå°†ç›¸åº”çš„ DOM å…ƒç´ æ”¾å…¥ <code>myRef.current</code> ä¸­ã€‚å½“å…ƒç´ ä» DOM ä¸­åˆ é™¤æ—¶ï¼ŒReact ä¼šå°† <code>myRef.current</code> æ›´æ–°ä¸º <code>null</code>ã€‚</p><hr><p>ä¿®å¤åæ‰çš„èŠå¤©è¾“å…¥æ¡†ï¼šè¾“å…¥æ¶ˆæ¯å¹¶å•å‡»â€œå‘é€â€ã€‚ä½ ä¼šæ³¨æ„åˆ°ï¼Œåœ¨çœ‹åˆ°â€œå·²å‘é€ï¼â€æç¤ºæ¡†ä¹‹å‰æœ‰ 3 ç§’çš„å»¶è¿Ÿã€‚åœ¨æ­¤å»¶è¿ŸæœŸé—´ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªâ€œæ’¤æ¶ˆâ€æŒ‰é’®ã€‚ç‚¹å‡»å®ƒã€‚è¿™ä¸ªâ€œæ’¤æ¶ˆâ€æŒ‰é’®åº”è¯¥é˜»æ­¢â€œå‘é€ï¼â€æ¶ˆæ¯å¼¹å‡ºã€‚å®ƒé€šè¿‡è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/clearTimeout"><code>clearTimeout</code></a> æ¥åšåˆ°è¿™ç‚¹ï¼Œè¿™ä¸€æ­¥éª¤éœ€è¦ä½¿ç”¨åœ¨ <code>handleSend</code> æ—¶ä¿å­˜çš„ timeout IDã€‚ä½†æ˜¯ï¼Œå³ä½¿åœ¨å•å‡»â€œæ’¤æ¶ˆâ€åï¼Œâ€œå·²å‘é€ï¼â€æ¶ˆæ¯ä»ç„¶å‡ºç°ã€‚æ‰¾å‡ºå®ƒä¸èµ·ä½œç”¨çš„åŸå› ï¼Œç„¶åä¿®å¤å®ƒã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0p96whlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0p96whlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> timeoutID = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSend</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">true</span>);<br>    timeoutID = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;å·²å‘é€ï¼&#x27;</span>);<br>        <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">false</span>);<br>    &#125;, <span class="hljs-number">3000</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUndo</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">false</span>);<br>    <span class="hljs-built_in">clearTimeout</span>(timeoutID);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ¯å½“ä½ çš„ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ˆä¾‹å¦‚å½“ä½ è®¾ç½® state æ—¶ï¼‰ï¼Œæ‰€æœ‰å±€éƒ¨å˜é‡éƒ½ä¼šä»å¤´å¼€å§‹åˆå§‹åŒ–ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¸èƒ½å°† timeout ID ä¿å­˜åœ¨åƒ <code>timeoutID</code> è¿™æ ·çš„å±€éƒ¨å˜é‡ä¸­ï¼Œç„¶åæœŸæœ›æœªæ¥å¦ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨â€œçœ‹åˆ°â€å®ƒã€‚ç›¸åï¼Œå°†å®ƒå­˜å‚¨åœ¨ä¸€ä¸ª ref ä¸­ï¼ŒReact å°†åœ¨æ¸²æŸ“ä¹‹é—´ä¿ç•™å®ƒã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1wi96flqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1wi96flqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Chat</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [isSending, setIsSending] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> timeoutRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSend</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">true</span>);<br>    timeoutRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;å·²å‘é€!&#x27;</span>);<br>      <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">false</span>);<br>    &#125;, <span class="hljs-number">3000</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUndo</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIsSending</span>(<span class="hljs-literal">false</span>);<br>    <span class="hljs-built_in">clearTimeout</span>(timeoutRef.<span class="hljs-property">current</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;isSending&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSend&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;isSending ? &#x27;å‘é€ä¸­â€¦â€¦&#x27; : &#x27;å‘é€&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;isSending &amp;&amp;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleUndo&#125;</span>&gt;</span></span><br><span class="language-xml">          æ’¤é”€</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231113150628769.png" alt="image-20231113150628769" style="zoom:50%;" /><hr><p>ä¿®å¤æ— æ³•é‡æ–°æ¸²æŸ“çš„ç»„ä»¶ï¼šè¿™ä¸ªæŒ‰é’®æœ¬è¯¥åœ¨æ˜¾ç¤ºâ€œå¼€â€å’Œâ€œå…³â€ä¹‹é—´åˆ‡æ¢ã€‚ä½†æ˜¯ï¼Œå®ƒå§‹ç»ˆæ˜¾ç¤ºâ€œå…³â€ã€‚è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿä¿®å¤å®ƒã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gjg1oelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gjg1oelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      isOnRef.current = !isOnRef.current;</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;isOnRef.current ? &#x27;å¼€&#x27; : &#x27;å…³&#x27;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¿®å¤ï¼šref çš„ current å€¼è¢«ç”¨äºè®¡ç®—æ¸²æŸ“è¾“å‡ºï¼š<code>&#123;isOnRef.current ? &#39;å¼€&#39;ï¼š&#39;å…³&#39;&#125;</code>ã€‚è¿™è¡¨æ˜æ­¤ä¿¡æ¯æœ¬æ¥ä¸åº”è¯¥åœ¨ ref ä¸­ï¼Œè€Œåº”è¯¥æ”¾åœ¨ state é‡Œã€‚è¦ä¿®å¤å®ƒï¼Œè¯·åˆ é™¤ ref ï¼Œä½¿ç”¨ state ä»£æ›¿ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-60l3gdlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-60l3gdlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOn, setIsOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      setIsOn(!isOn);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;isOn ? &#x27;å¼€&#x27; : &#x27;å…³&#x27;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="on.gif" alt="on" style="zoom:50%;" /><hr><p>ä¿®å¤é˜²æŠ–ï¼šæ‰€æœ‰æŒ‰é’®ç‚¹å‡»å¤„ç†å™¨éƒ½æ˜¯ <a href="https://redd.one/blog/debounce-vs-throttle">â€œé˜²æŠ–çš„â€</a>ã€‚ è¦äº†è§£è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œè¯·æŒ‰ä¸‹å…¶ä¸­ä¸€ä¸ªæŒ‰é’®ã€‚æ³¨æ„æ¶ˆæ¯åœ¨ä¸€ç§’åæ˜¾ç¤ºã€‚å¦‚æœä½ åœ¨ç­‰å¾…æ¶ˆæ¯æ—¶æŒ‰ä¸‹æŒ‰é’®ï¼Œè®¡æ—¶å™¨å°†é‡ç½®ã€‚å› æ­¤å¦‚æœä½ å¤šæ¬¡å¿«é€Ÿå•å‡»åŒä¸€ä¸ªæŒ‰é’®ï¼Œåˆ™ç›´åˆ°ä½ åœæ­¢å•å‡» <strong>ä¹‹å</strong> 1 ç§’é’Ÿï¼Œè¯¥æ¶ˆæ¯æ‰ä¼šæ˜¾ç¤ºã€‚é˜²æŠ–å¯ä»¥è®©ä½ å°†ä¸€äº›åŠ¨ä½œæ¨è¿Ÿåˆ°ç”¨æˆ·â€œåœæ­¢åŠ¨ä½œâ€ä¹‹åã€‚</p><p>è¿™ä¸ªä¾‹å­å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†å¹¶ä¸å®Œå…¨ç¬¦åˆé¢„æœŸã€‚æŒ‰é’®ä¸æ˜¯ç‹¬ç«‹çš„ã€‚è¦æŸ¥çœ‹é—®é¢˜ï¼Œè¯·å•å‡»å…¶ä¸­ä¸€ä¸ªæŒ‰é’®ï¼Œç„¶åç«‹å³å•å‡»å¦ä¸€ä¸ªæŒ‰é’®ã€‚ä½ æœ¬æ¥æœŸæœ›åœ¨å»¶è¿Ÿä¹‹åï¼Œä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªæŒ‰é’®çš„æ¶ˆæ¯ã€‚ä½†åªæœ‰æœ€åä¸€ä¸ªæŒ‰é’®çš„æ¶ˆæ¯å‡ºç°äº†ã€‚ç¬¬ä¸€ä¸ªæŒ‰é’®çš„æ¶ˆæ¯ä¸¢å¤±äº†ã€‚</p><p>ä¸ºä»€ä¹ˆæŒ‰é’®ä¼šç›¸äº’å¹²æ‰°å‘¢ï¼ŸæŸ¥æ‰¾å¹¶ä¿®å¤é—®é¢˜ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8alxkclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8alxkclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> timeoutID;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">DebouncedButton</span>(<span class="hljs-params">&#123; onClick, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      clearTimeout(timeoutID);</span><br><span class="language-xml">      timeoutID = setTimeout(() =&gt; &#123;</span><br><span class="language-xml">        onClick();</span><br><span class="language-xml">      &#125;, 1000);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¿®å¤ï¼šåƒ <code>timeoutID</code> è¿™æ ·çš„å˜é‡æ˜¯è¢«æ‰€æœ‰ç»„ä»¶å…±äº«çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå•å‡»ç¬¬äºŒä¸ªæŒ‰é’®ä¼šé‡ç½®ç¬¬ä¸€ä¸ªæŒ‰é’®æœªå®Œæˆçš„ timeout çš„åŸå› ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œä½ å¯ä»¥æŠŠ timeout ä¿å­˜åœ¨ ref ä¸­ã€‚æ¯ä¸ªæŒ‰é’®éƒ½æœ‰è‡ªå·±çš„ refï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šç›¸äº’å†²çªã€‚è¯·æ³¨æ„å¿«é€Ÿå•å‡»ä¸¤ä¸ªæŒ‰é’®å¦‚ä½•æ˜¾ç¤ºä¸¤ä¸ªæ¶ˆæ¯ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9gfga2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9gfga2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">DebouncedButton</span>(<span class="hljs-params">&#123; onClick, children &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> timeoutRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">      clearTimeout(timeoutRef.current);</span><br><span class="language-xml">      timeoutRef.current = setTimeout(() =&gt; &#123;</span><br><span class="language-xml">        onClick();</span><br><span class="language-xml">      &#125;, 1000);</span><br><span class="language-xml">    &#125;&#125;&gt;</span><br><span class="language-xml">      &#123;children&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DebouncedButton</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;å®‡å®™é£èˆ¹å·²å‘å°„ï¼&#x27;)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        å‘å°„å®‡å®™é£èˆ¹</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DebouncedButton</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DebouncedButton</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ±¤ç…®å¥½äº†ï¼&#x27;)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        ç…®ç‚¹å„¿æ±¤</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DebouncedButton</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">DebouncedButton</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> alert(&#x27;æ‘‡ç¯®æ›²å”±å®Œäº†ï¼&#x27;)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        å”±é¦–æ‘‡ç¯®æ›²</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">DebouncedButton</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="debounce.gif" alt="debounce" style="zoom:50%;" /><hr><p>è¯»å–æœ€æ–°çš„ stateï¼šå½“ä½ æŒ‰ä¸‹â€œå‘é€â€åï¼Œåœ¨æ˜¾ç¤ºæ¶ˆæ¯ä¹‹å‰ä¼šæœ‰ä¸€å°æ®µå»¶è¿Ÿã€‚è¾“å…¥â€œä½ å¥½â€ï¼ŒæŒ‰ä¸‹å‘é€ï¼Œç„¶åå†æ¬¡å¿«é€Ÿç¼–è¾‘è¾“å…¥ã€‚å°½ç®¡ä½ è¿›è¡Œäº†ç¼–è¾‘ï¼Œæç¤ºæ¡†ä»ä¼šæ˜¾ç¤ºâ€œä½ å¥½â€ï¼ˆè¿™æ˜¯æŒ‰é’®è¢«ç‚¹å‡» <a href="https://zh-hans.react.dev/learn/state-as-a-snapshot#state-over-time">é‚£ä¸€åˆ»</a> state çš„å€¼ï¼‰ã€‚</p><p>é€šå¸¸ï¼Œè¿™ç§è¡Œä¸ºæ˜¯ä½ åœ¨åº”ç”¨ç¨‹åºä¸­æƒ³è¦çš„ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å¯èƒ½éœ€è¦ä¸€äº›å¼‚æ­¥ä»£ç æ¥è¯»å–æŸäº› state çš„ <strong>æœ€æ–°</strong> ç‰ˆæœ¬ã€‚ä½ èƒ½æƒ³å‡ºä¸€ç§æ–¹æ³•ï¼Œè®©æç¤ºæ¡†æ˜¾ç¤º <strong>å½“å‰</strong> è¾“å…¥æ–‡æœ¬è€Œä¸æ˜¯ç‚¹å‡»æ—¶çš„å†…å®¹å—ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n74t23lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n74t23lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Chat</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSend</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æ­£åœ¨å‘é€ï¼š&#x27;</span> + text);<br>    &#125;, <span class="hljs-number">3000</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSend&#125;</span>&gt;</span></span><br><span class="language-xml">        å‘é€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¿®å¤ï¼šstate è¿ä½œèµ·æ¥ <a href="https://zh-hans.react.dev/learn/state-as-a-snapshot">å°±åƒå¿«ç…§</a>ï¼Œå› æ­¤ä½ æ— æ³•ä» timeout ç­‰å¼‚æ­¥æ“ä½œä¸­è¯»å–æœ€æ–°çš„ stateã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥åœ¨ ref ä¸­ä¿å­˜æœ€æ–°çš„è¾“å…¥æ–‡æœ¬ã€‚ref æ˜¯å¯å˜çš„ï¼Œå› æ­¤ä½ å¯ä»¥éšæ—¶è¯»å– <code>current</code> å±æ€§ã€‚ç”±äºå½“å‰æ–‡æœ¬ä¹Ÿç”¨äºæ¸²æŸ“ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ éœ€è¦ <strong>åŒæ—¶</strong> ä½¿ç”¨ä¸€ä¸ª state å˜é‡ï¼ˆç”¨äºæ¸²æŸ“ï¼‰<strong>å’Œ</strong> ä¸€ä¸ª refï¼ˆåœ¨ timeout æ—¶è¯»å–å®ƒï¼‰ã€‚ä½ éœ€è¦æ‰‹åŠ¨æ›´æ–°å½“å‰çš„ ref å€¼ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0syvqwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0syvqwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Chat</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> textRef = <span class="hljs-title function_">useRef</span>(text);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setText</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>    textRef.<span class="hljs-property">current</span> = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSend</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æ­£åœ¨å‘é€ï¼š&#x27;</span> + textRef.<span class="hljs-property">current</span>);<br>    &#125;, <span class="hljs-number">3000</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSend&#125;</span>&gt;</span></span><br><span class="language-xml">        å‘é€</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="send.gif" alt="send" style="zoom:50%;" /><h2 id="2-ä½¿ç”¨-ref-æ“ä½œ-DOM"><a href="#2-ä½¿ç”¨-ref-æ“ä½œ-DOM" class="headerlink" title="2.ä½¿ç”¨ ref æ“ä½œ DOM"></a>2.ä½¿ç”¨ ref æ“ä½œ DOM</h2><p>ç”±äº React ä¼šè‡ªåŠ¨å¤„ç†æ›´æ–° <a href="https://developer.mozilla.org/docs/Web/API/Document_Object_Model/Introduction">DOM</a> ä»¥åŒ¹é…ä½ çš„æ¸²æŸ“è¾“å‡ºï¼Œå› æ­¤ä½ åœ¨ç»„ä»¶ä¸­é€šå¸¸ä¸éœ€è¦æ“ä½œ DOMã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ä½ å¯èƒ½éœ€è¦è®¿é—®ç”± React ç®¡ç†çš„ DOM å…ƒç´  â€”â€” ä¾‹å¦‚ï¼Œè®©ä¸€ä¸ªèŠ‚ç‚¹è·å¾—ç„¦ç‚¹ã€æ»šåŠ¨åˆ°å®ƒæˆ–æµ‹é‡å®ƒçš„å°ºå¯¸å’Œä½ç½®ã€‚åœ¨ React ä¸­æ²¡æœ‰å†…ç½®çš„æ–¹æ³•æ¥åšè¿™äº›äº‹æƒ…ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªæŒ‡å‘ DOM èŠ‚ç‚¹çš„ <strong>ref</strong> æ¥å®ç°ã€‚</p><p>è¦è®¿é—®ç”± React ç®¡ç†çš„ DOM èŠ‚ç‚¹ï¼Œé¦–å…ˆï¼Œå¼•å…¥ <code>useRef</code> Hookï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ioepwplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ioepwplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼Œåœ¨ä½ çš„ç»„ä»¶ä¸­ä½¿ç”¨å®ƒå£°æ˜ä¸€ä¸ª refï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qtmibxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qtmibxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> myRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></div></figure><p>æœ€åï¼Œå°† ref ä½œä¸º ref å±æ€§ä¼ é€’ç»™æ‚¨æƒ³è¦è·å– DOM èŠ‚ç‚¹çš„ JSX æ ‡ç­¾ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-spqgmrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-spqgmrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;div ref=&#123;myRef&#125;&gt;<br></code></pre></td></tr></table></div></figure><p><code>useRef</code> Hook è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰ä¸€ä¸ªåä¸º <code>current</code> çš„å±æ€§ã€‚æœ€åˆï¼Œ<code>myRef.current</code> æ˜¯ <code>null</code>ã€‚å½“ React ä¸ºè¿™ä¸ª <code>&lt;div&gt;</code> åˆ›å»ºä¸€ä¸ª DOM èŠ‚ç‚¹æ—¶ï¼ŒReact ä¼šæŠŠå¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨æ”¾å…¥ <code>myRef.current</code>ã€‚ç„¶åï¼Œä½ å¯ä»¥ä» <a href="https://zh-hans.react.dev/learn/responding-to-events">äº‹ä»¶å¤„ç†å™¨</a> è®¿é—®æ­¤ DOM èŠ‚ç‚¹ï¼Œå¹¶ä½¿ç”¨åœ¨å…¶ä¸Šå®šä¹‰çš„å†…ç½®<a href="https://developer.mozilla.org/docs/Web/API/Element">æµè§ˆå™¨ API</a>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1jo59plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1jo59plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/*  ä½ å¯ä»¥ä½¿ç”¨ä»»æ„æµè§ˆå™¨ APIï¼Œä¾‹å¦‚ï¼š  */</span> <br>myRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">scrollIntoView</span>();<br></code></pre></td></tr></table></div></figure><p>è™½ç„¶ DOM æ“ä½œæ˜¯ ref æœ€å¸¸è§çš„ç”¨ä¾‹ï¼Œä½† <code>useRef</code> Hook å¯ç”¨äºå­˜å‚¨ React ä¹‹å¤–çš„å…¶ä»–å†…å®¹ï¼Œä¾‹å¦‚è®¡æ—¶å™¨ ID ã€‚ä¸ state ç±»ä¼¼ï¼Œref èƒ½åœ¨æ¸²æŸ“ä¹‹é—´ä¿ç•™ã€‚ä½ ç”šè‡³å¯ä»¥å°† ref è§†ä¸ºè®¾ç½®å®ƒä»¬æ—¶ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“çš„ state å˜é‡ï¼</p><hr><p>æ»šåŠ¨å›¾åƒè½®æ’­ï¼šæ­¤å›¾åƒè½®æ’­æœ‰ä¸€ä¸ªâ€œä¸‹ä¸€ä¸ªâ€æŒ‰é’®ï¼Œå¯ä»¥åˆ‡æ¢æ¿€æ´»çš„å›¾åƒã€‚å•å‡»æ—¶ä½¿å›¾åº“æ°´å¹³æ»šåŠ¨åˆ°æ¿€æ´»çš„å›¾åƒã€‚ä½ éœ€è¦åœ¨æ¿€æ´»çš„å›¾åƒçš„ DOM èŠ‚ç‚¹ä¸Šè°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/scrollIntoView"><code>scrollIntoView()</code></a>ï¼šå¯ä»¥å£°æ˜ä¸€ä¸ª <code>selectedRef</code>ï¼Œç„¶åæ ¹æ®æ¡ä»¶å°†å®ƒä¼ é€’ç»™å½“å‰å›¾åƒï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sg3vrzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sg3vrzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;index</span> === <span class="hljs-string">i</span> ? <span class="hljs-attr">selectedRef</span> <span class="hljs-attr">:</span> <span class="hljs-attr">null</span>&#125;&gt;</span><br></code></pre></td></tr></table></div></figure><p>å½“<code>index === i</code>æ—¶ï¼Œè¡¨ç¤ºå›¾åƒæ˜¯è¢«é€‰ä¸­çš„å›¾åƒï¼Œç›¸åº”çš„ <code>&lt;li&gt;</code> å°†æ¥æ”¶åˆ° <code>selectedRef</code>ã€‚React å°†ç¡®ä¿ <code>selectedRef.current</code> å§‹ç»ˆæŒ‡å‘æ­£ç¡®çš„ DOM èŠ‚ç‚¹ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¸ºäº†å¼ºåˆ¶ React åœ¨æ»šåŠ¨å‰æ›´æ–° DOMï¼Œ<code>flushSync</code> è°ƒç”¨æ˜¯å¿…éœ€çš„ã€‚å¦åˆ™ï¼Œ<code>selectedRef.current</code>å°†å§‹ç»ˆæŒ‡å‘ä¹‹å‰é€‰æ‹©çš„é¡¹ç›®ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b3qttvlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b3qttvlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; flushSync &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CatFriends</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> selectedRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [index, setIndex] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">          flushSync(() =&gt; &#123;</span><br><span class="language-xml">            if (index &lt; catList.length - 1) &#123;</span><br><span class="language-xml">              setIndex(index + 1);</span><br><span class="language-xml">            &#125; else &#123;</span><br><span class="language-xml">              setIndex(0);</span><br><span class="language-xml">            &#125;</span><br><span class="language-xml">          &#125;);</span><br><span class="language-xml">          selectedRef.current.scrollIntoView(&#123;</span><br><span class="language-xml">            behavior: &#x27;smooth&#x27;,</span><br><span class="language-xml">            block: &#x27;nearest&#x27;,</span><br><span class="language-xml">            inline: &#x27;center&#x27;</span><br><span class="language-xml">          &#125;);            </span><br><span class="language-xml">        &#125;&#125;&gt;</span><br><span class="language-xml">          ä¸‹ä¸€æ­¥</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">          &#123;catList.map((cat, i) =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">li</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;cat.id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;index</span> === <span class="hljs-string">i</span> ?</span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">selectedRef</span> <span class="hljs-attr">:</span></span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">null</span></span></span><br><span class="hljs-tag"><span class="language-xml">              &#125;</span></span><br><span class="hljs-tag"><span class="language-xml">            &gt;</span></span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                  <span class="hljs-attr">index</span> === <span class="hljs-string">i</span> ?</span></span><br><span class="hljs-tag"><span class="language-xml">                    &#x27;<span class="hljs-attr">active</span>&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">                    <span class="hljs-attr">:</span> &#x27;&#x27;</span></span><br><span class="hljs-tag"><span class="language-xml">                &#125;</span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;cat.imageUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">çŒ«çŒ«</span> #&#x27; + <span class="hljs-attr">cat.id</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">              /&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">          ))&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">const</span> catList = [];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>  catList.<span class="hljs-title function_">push</span>(&#123;<br>    <span class="hljs-attr">id</span>: i,<br>    <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">&#x27;https://placekitten.com/250/200?image=&#x27;</span> + i<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="scroll.gif" alt="scroll" style="zoom:50%;" /><p>å¦‚ä½•ä½¿ç”¨ ref å›è°ƒç®¡ç† ref åˆ—è¡¨ï¼šæœ‰æ—¶ref çš„æ•°é‡æ˜¯é¢„å…ˆç¡®å®šçš„ã€‚ä½†æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½ç»‘å®š ref ï¼Œè€Œä½ åˆä¸çŸ¥é“ä¼šæœ‰å¤šå°‘é¡¹ã€‚åƒä¸‹é¢è¿™æ ·åš<strong>æ˜¯è¡Œä¸é€šçš„</strong>ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ndyx5plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ndyx5plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>  &#123;items.map((item) =&gt; &#123;<br>    /* è¡Œä¸é€šï¼   */ <br>    const ref = useRef(null);<br>    return <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> /&gt;</span>;<br>  &#125;)&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å› ä¸º <strong>Hook åªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚è¢«è°ƒç”¨</strong>ã€‚ä¸èƒ½åœ¨å¾ªç¯è¯­å¥ã€æ¡ä»¶è¯­å¥æˆ– <code>map()</code> å‡½æ•°ä¸­è°ƒç”¨ <code>useRef</code> ã€‚</p><p>å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç”¨ä¸€ä¸ª ref å¼•ç”¨å…¶çˆ¶å…ƒç´ ï¼Œç„¶åç”¨ DOM æ“ä½œæ–¹æ³•å¦‚ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/querySelectorAll"><code>querySelectorAll</code></a> æ¥å¯»æ‰¾å®ƒçš„å­èŠ‚ç‚¹ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å¾ˆè„†å¼±ï¼Œå¦‚æœ DOM ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½ä¼šå¤±æ•ˆæˆ–æŠ¥é”™ã€‚</li><li><strong>å°†å‡½æ•°ä¼ é€’ç»™ <code>ref</code> å±æ€§</strong>ã€‚è¿™ç§°ä¸º <mark><a href="https://zh-hans.react.dev/reference/react-dom/components/common#ref-callback"><code>ref</code> å›è°ƒ</a></mark>ã€‚å½“éœ€è¦è®¾ç½® ref æ—¶ï¼ŒReact å°†ä¼ å…¥ DOM èŠ‚ç‚¹æ¥è°ƒç”¨ä½ çš„ ref å›è°ƒï¼Œå¹¶åœ¨éœ€è¦æ¸…é™¤å®ƒæ—¶ä¼ å…¥ <code>null</code> ã€‚è¿™ä½¿ä½ å¯ä»¥ç»´æŠ¤è‡ªå·±çš„æ•°ç»„æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a>ï¼Œå¹¶é€šè¿‡å…¶ç´¢å¼•æˆ–æŸç§ç±»å‹çš„ ID è®¿é—®ä»»ä½• refã€‚</li></ol><p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¤æ–¹æ³•æ»šåŠ¨åˆ°é•¿åˆ—è¡¨ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rt1dvqlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rt1dvqlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CatFriends</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> itemsRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">scrollToId</span>(<span class="hljs-params">itemId</span>) &#123;<br>    <span class="hljs-keyword">const</span> map = <span class="hljs-title function_">getMap</span>();<br>    <span class="hljs-keyword">const</span> node = map.<span class="hljs-title function_">get</span>(itemId);<br>    node.<span class="hljs-title function_">scrollIntoView</span>(&#123;<br>      <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span>,<br>      <span class="hljs-attr">block</span>: <span class="hljs-string">&#x27;nearest&#x27;</span>,<br>      <span class="hljs-attr">inline</span>: <span class="hljs-string">&#x27;center&#x27;</span><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMap</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (!itemsRef.<span class="hljs-property">current</span>) &#123;<br>      <span class="hljs-comment">/*  é¦–æ¬¡è¿è¡Œæ—¶åˆå§‹åŒ– Mapã€‚  */</span> <br>      itemsRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> itemsRef.<span class="hljs-property">current</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> scrollToId(0)&#125;&gt;</span><br><span class="language-xml">          Tom</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> scrollToId(5)&#125;&gt;</span><br><span class="language-xml">          Maru</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> scrollToId(9)&#125;&gt;</span><br><span class="language-xml">          Jellylorum</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">          &#123;catList.map(cat =&gt; (</span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">li</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;cat.id&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">              <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;(node)</span> =&gt;</span> &#123;</span><br><span class="language-xml">                const map = getMap();</span><br><span class="language-xml">                if (node) &#123;</span><br><span class="language-xml">                  map.set(cat.id, node);</span><br><span class="language-xml">                &#125; else &#123;</span><br><span class="language-xml">                  map.delete(cat.id);</span><br><span class="language-xml">                &#125;</span><br><span class="language-xml">              &#125;&#125;</span><br><span class="language-xml">            &gt;</span><br><span class="language-xml">              <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;cat.imageUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">                <span class="hljs-attr">alt</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">Cat</span> #&#x27; + <span class="hljs-attr">cat.id</span>&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">              /&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">          ))&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">const</span> catList = [];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>  catList.<span class="hljs-title function_">push</span>(&#123;<br>    <span class="hljs-attr">id</span>: i,<br>    <span class="hljs-attr">imageUrl</span>: <span class="hljs-string">&#x27;https://placekitten.com/250/200?image=&#x27;</span> + i<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="scroll2.gif" alt="scroll2" style="zoom:50%;" /><p>å½“ä½ å°† ref æ”¾åœ¨åƒ <code>&lt;input /&gt;</code> è¿™æ ·è¾“å‡ºæµè§ˆå™¨å…ƒç´ çš„å†…ç½®ç»„ä»¶ä¸Šæ—¶ï¼ŒReact ä¼šå°†è¯¥ ref çš„ <code>current</code> å±æ€§è®¾ç½®ä¸ºç›¸åº”çš„ DOM èŠ‚ç‚¹ï¼ˆä¾‹å¦‚æµè§ˆå™¨ä¸­å®é™…çš„ <code>&lt;input /&gt;</code> ï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ å°è¯•å°† ref æ”¾åœ¨ <strong>ä½ è‡ªå·±çš„</strong> ç»„ä»¶ä¸Šï¼Œä¾‹å¦‚ <code>&lt;MyInput /&gt;</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½ ä¼šå¾—åˆ° <code>null</code>ã€‚è¯·æ³¨æ„å•å‡»æŒ‰é’® <strong>å¹¶ä¸ä¼š</strong> èšç„¦è¾“å…¥æ¡†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-25n9kzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-25n9kzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">props</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...props</span>&#125; /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyForm</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        èšç„¦è¾“å…¥æ¡†</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŠ¥é”™<code>Warning: Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?</code></p><p>å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¸å…è®¸ç»„ä»¶è®¿é—®å…¶ä»–ç»„ä»¶çš„ DOM èŠ‚ç‚¹ã€‚ç”šè‡³è‡ªå·±çš„å­ç»„ä»¶ä¹Ÿä¸è¡Œï¼è¿™æ˜¯æ•…æ„çš„ã€‚Refs æ˜¯ä¸€ä¸ªåº”æ€¥æ–¹æ¡ˆï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ã€‚æ‰‹åŠ¨æ“ä½œ <strong>å¦ä¸€ä¸ª</strong> ç»„ä»¶çš„ DOM èŠ‚ç‚¹ä¼šä½¿ä½ çš„ä»£ç æ›´åŠ è„†å¼±ã€‚</p><p>ç›¸åï¼Œ<strong>æƒ³è¦</strong> æš´éœ²å…¶ DOM èŠ‚ç‚¹çš„ç»„ä»¶å¿…é¡»<strong>é€‰æ‹©</strong>è¯¥è¡Œä¸ºã€‚<mark>ä¸€ä¸ªç»„ä»¶å¯ä»¥æŒ‡å®šå°†å®ƒçš„ ref â€œè½¬å‘â€ç»™ä¸€ä¸ªå­ç»„ä»¶</mark>ã€‚ä¸‹é¢æ˜¯ <code>MyInput</code> å¦‚ä½•ä½¿ç”¨ <code>forwardRef</code> APIï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7ic1cslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7ic1cslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> /&gt;</span></span>;<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„:</p><ol><li><code>&lt;MyInput ref=&#123;inputRef&#125; /&gt;</code> å‘Šè¯‰ React å°†å¯¹åº”çš„ DOM èŠ‚ç‚¹æ”¾å…¥ <code>inputRef.current</code> ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™å–å†³äº <code>MyInput</code> ç»„ä»¶æ˜¯å¦å…è®¸è¿™ç§è¡Œä¸ºï¼Œ é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å…è®¸çš„ã€‚</li><li><code>MyInput</code> ç»„ä»¶æ˜¯ä½¿ç”¨ <code>forwardRef</code> å£°æ˜çš„ã€‚ <strong>è¿™è®©ä»ä¸Šé¢æ¥æ”¶çš„ <code>inputRef</code> ä½œä¸ºç¬¬äºŒä¸ªå‚æ•° <code>ref</code> ä¼ å…¥ç»„ä»¶</strong>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>props</code> ã€‚</li><li><code>MyInput</code> ç»„ä»¶å°†è‡ªå·±æ¥æ”¶åˆ°çš„ <code>ref</code> ä¼ é€’ç»™å®ƒå†…éƒ¨çš„ <code>&lt;input&gt;</code>ã€‚</li></ol><p>ç°åœ¨ï¼Œå•å‡»æŒ‰é’®èšç„¦è¾“å…¥æ¡†èµ·ä½œç”¨äº†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3wuyxclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3wuyxclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; forwardRef, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...props</span>&#125; <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> /&gt;</span></span>;<br>&#125;);<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    inputRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">MyInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        èšç„¦è¾“å…¥æ¡†</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="focusinput.gif" alt="focusinput" style="zoom:50%;" /><p><mark>ä½¿åˆ†å¼€çš„ç»„ä»¶ä¸­çš„æœç´¢åŸŸè·å¾—ç„¦ç‚¹ </mark>ï¼šåšåˆ°å•å‡»â€œæœç´¢â€æŒ‰é’®å°†ç„¦ç‚¹æ”¾åœ¨æœç´¢åŸŸä¸Šã€‚è¯·æ³¨æ„ï¼Œæ¯ä¸ªç»„ä»¶éƒ½åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”ä¸èƒ½å°†å…¶ç§»å‡ºã€‚</p><p>è§£ç­”ï¼šéœ€è¦å‘ <code>SearchButton</code> æ·»åŠ ä¸€ä¸ª<code>onClick</code> å±æ€§ï¼Œ<code>SearchButton</code> ä¼šå°†å…¶å‘ä¸‹ä¼ é€’ç»™æµè§ˆå™¨åŸç”Ÿ <code>&lt;button&gt;</code>ã€‚ä½ è¿˜è¦å‘ä¸‹ä¼ é€’ä¸€ä¸ª ref ç»™ <code>&lt;SearchInput&gt;</code>ï¼Œ<code>&lt;SearchInput&gt;</code> å°†è½¬å‘ ref ç»™çœŸæ­£çš„ <code>&lt;input&gt;</code> å¹¶å¯¹å®ƒè¿›è¡Œèµ‹å€¼ã€‚æœ€åï¼Œåœ¨å•å‡»äº‹ä»¶å¤„ç†å™¨ä¸­ï¼Œä½ å°†èƒ½å¯¹å­˜å‚¨åœ¨è¯¥ ref ä¸­çš„ DOM èŠ‚ç‚¹è°ƒç”¨ <code>focus</code>ã€‚</p><p>SearchInput.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b9yfwalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b9yfwalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; forwardRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">forwardRef</span>(<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params">props, ref</span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æ‰¾ä»€ä¹ˆå‘¢ï¼Ÿ&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br>    );<br>  &#125;<br>);<br></code></pre></td></tr></table></div></figure><p>SearchButton.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p7k4zzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p7k4zzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchButton</span>(<span class="hljs-params">&#123; onClick &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;onClick&#125;</span>&gt;</span></span><br><span class="language-xml">      æœç´¢</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-arz9uwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-arz9uwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SearchButton.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchInput</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./SearchInput.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">SearchButton</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">          inputRef.current.focus();</span><br><span class="language-xml">        &#125;&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SearchInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">åœ¨è®¾è®¡ç³»ç»Ÿä¸­ï¼Œå°†ä½çº§ç»„ä»¶ï¼ˆå¦‚æŒ‰é’®ã€è¾“å…¥æ¡†ç­‰ï¼‰çš„ ref è½¬å‘åˆ°å®ƒä»¬çš„ DOM èŠ‚ç‚¹æ˜¯ä¸€ç§å¸¸è§æ¨¡å¼ã€‚å¦ä¸€æ–¹é¢ï¼Œåƒè¡¨å•ã€åˆ—è¡¨æˆ–é¡µé¢æ®µè½è¿™æ ·çš„é«˜çº§ç»„ä»¶é€šå¸¸ä¸ä¼šæš´éœ²å®ƒä»¬çš„ DOM èŠ‚ç‚¹ï¼Œä»¥é¿å…å¯¹ DOM ç»“æ„çš„æ„å¤–ä¾èµ–ã€‚</p><p>React ä½•æ—¶æ·»åŠ  refsï¼šåœ¨ React ä¸­ï¼Œæ¯æ¬¡æ›´æ–°éƒ½åˆ†ä¸º <a href="https://zh-hans.react.dev/learn/render-and-commit#step-3-react-commits-changes-to-the-dom">ä¸¤ä¸ªé˜¶æ®µ</a>ï¼š</p><ul><li>åœ¨ <strong>æ¸²æŸ“</strong> é˜¶æ®µï¼Œ React è°ƒç”¨ä½ çš„ç»„ä»¶æ¥ç¡®å®šå±å¹•ä¸Šåº”è¯¥æ˜¾ç¤ºä»€ä¹ˆã€‚</li><li>åœ¨ <strong>æäº¤</strong> é˜¶æ®µï¼Œ React æŠŠå˜æ›´åº”ç”¨äº DOMã€‚</li></ul><p>é€šå¸¸ï¼Œä½  <a href="https://zh-hans.react.dev/learn/referencing-values-with-refs#best-practices-for-refs">ä¸å¸Œæœ›</a> åœ¨æ¸²æŸ“æœŸé—´è®¿é—® refsã€‚è¿™ä¹Ÿé€‚ç”¨äºä¿å­˜ DOM èŠ‚ç‚¹çš„ refsã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒDOM èŠ‚ç‚¹å°šæœªåˆ›å»ºï¼Œå› æ­¤ <code>ref.current</code> å°†ä¸º <code>null</code>ã€‚åœ¨æ¸²æŸ“æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼ŒDOM èŠ‚ç‚¹è¿˜æ²¡æœ‰æ›´æ–°ã€‚æ‰€ä»¥è¯»å–å®ƒä»¬è¿˜ä¸ºæ—¶è¿‡æ—©ã€‚</p><p>React åœ¨æäº¤é˜¶æ®µè®¾ç½® <code>ref.current</code>ã€‚åœ¨æ›´æ–° DOM ä¹‹å‰ï¼ŒReact å°†å—å½±å“çš„ <code>ref.current</code> å€¼è®¾ç½®ä¸º <code>null</code>ã€‚æ›´æ–° DOM åï¼ŒReact ç«‹å³å°†å®ƒä»¬è®¾ç½®åˆ°ç›¸åº”çš„ DOM èŠ‚ç‚¹ã€‚</p><p><strong>é€šå¸¸ï¼Œä½ å°†ä»äº‹ä»¶å¤„ç†å™¨è®¿é—® refsã€‚</strong> å¦‚æœä½ æƒ³ä½¿ç”¨ ref æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä½†æ²¡æœ‰ç‰¹å®šçš„äº‹ä»¶å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ª effectã€‚</p><p><mark>ç”¨ flushSync åŒæ­¥æ›´æ–° state</mark>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„å¾…åŠäº‹é¡¹ï¼Œå¹¶å°†å±å¹•å‘ä¸‹æ»šåŠ¨åˆ°åˆ—è¡¨çš„æœ€åä¸€ä¸ªå­é¡¹ã€‚è¯·æ³¨æ„ï¼Œå‡ºäºæŸç§åŸå› ï¼Œå®ƒæ€»æ˜¯æ»šåŠ¨åˆ°æœ€åä¸€ä¸ªæ·»åŠ  <strong>ä¹‹å‰</strong> çš„å¾…åŠäº‹é¡¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0n5c8dlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0n5c8dlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> listRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>(<br>    initialTodos<br>  );<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAdd</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> newTodo = &#123; <span class="hljs-attr">id</span>: nextId++, <span class="hljs-attr">text</span>: text &#125;;<br>    <span class="hljs-title function_">setText</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>    <span class="hljs-title function_">setTodos</span>([ ...todos, newTodo]);<br>    listRef.<span class="hljs-property">current</span>.<span class="hljs-property">lastChild</span>.<span class="hljs-title function_">scrollIntoView</span>(&#123;<br>      <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span>,<br>      <span class="hljs-attr">block</span>: <span class="hljs-string">&#x27;nearest&#x27;</span><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleAdd&#125;</span>&gt;</span></span><br><span class="language-xml">        æ·»åŠ </span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">      /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;listRef&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;todos.map(todo =&gt; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="language-xml">        ))&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">let</span> initialTodos = [];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>  initialTodos.<span class="hljs-title function_">push</span>(&#123;<br>    <span class="hljs-attr">id</span>: nextId++,<br>    <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;å¾…åŠ #&#x27;</span> + (i + <span class="hljs-number">1</span>)<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>é—®é¢˜å‡ºåœ¨è¿™ä¸¤è¡Œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9cfpsblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9cfpsblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">setTodos</span>([ ...todos, newTodo]);<br><br>listRef.<span class="hljs-property">current</span>.<span class="hljs-property">lastChild</span>.<span class="hljs-title function_">scrollIntoView</span>();<br></code></pre></td></tr></table></div></figure><p><mark>åœ¨ React ä¸­ï¼Œ<a href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">state æ›´æ–°æ˜¯æ’é˜Ÿè¿›è¡Œçš„</a></mark>ã€‚é€šå¸¸ï¼Œè¿™å°±æ˜¯ä½ æƒ³è¦çš„ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä¼šå¯¼è‡´é—®é¢˜ï¼Œå› ä¸º <code>setTodos</code> ä¸ä¼šç«‹å³æ›´æ–° DOMã€‚å› æ­¤ï¼Œå½“ä½ å°†åˆ—è¡¨æ»šåŠ¨åˆ°æœ€åä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°šæœªæ·»åŠ å¾…åŠäº‹é¡¹ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ»šåŠ¨æ€»æ˜¯â€œè½åâ€ä¸€é¡¹çš„åŸå› ã€‚</p><p>è¦è§£å†³æ­¤é—®é¢˜ï¼Œä½ å¯ä»¥<mark>å¼ºåˆ¶ React åŒæ­¥æ›´æ–°ï¼ˆâ€œåˆ·æ–°â€ï¼‰DOM</mark>ã€‚ ä¸ºæ­¤ï¼Œä» <code>react-dom</code> å¯¼å…¥ <code>flushSync</code> å¹¶<strong>å°† state æ›´æ–°åŒ…è£¹</strong> åˆ° <code>flushSync</code> è°ƒç”¨ä¸­ã€‚è¿™å°†æŒ‡ç¤º React å½“å°è£…åœ¨ <code>flushSync</code> ä¸­çš„ä»£ç æ‰§è¡Œåï¼Œç«‹å³åŒæ­¥æ›´æ–° DOMã€‚å› æ­¤ï¼Œå½“ä½ å°è¯•æ»šåŠ¨åˆ°æœ€åä¸€ä¸ªå¾…åŠäº‹é¡¹æ—¶ï¼Œå®ƒå·²ç»åœ¨ DOM ä¸­äº†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g1i9eelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g1i9eelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; flushSync &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAdd</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> newTodo = &#123; <span class="hljs-attr">id</span>: nextId++, <span class="hljs-attr">text</span>: text &#125;;<br>    <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-title function_">setText</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>        <span class="hljs-title function_">setTodos</span>([ ...todos, newTodo]);      <br>    &#125;);<br>    listRef.<span class="hljs-property">current</span>.<span class="hljs-property">lastChild</span>.<span class="hljs-title function_">scrollIntoView</span>(&#123;<br>        <span class="hljs-attr">behavior</span>: <span class="hljs-string">&#x27;smooth&#x27;</span>,<br>        <span class="hljs-attr">block</span>: <span class="hljs-string">&#x27;nearest&#x27;</span><br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½¿ç”¨ refs æ“ä½œ DOM çš„æœ€ä½³å®è·µï¼šRefs æ˜¯ä¸€ä¸ªåº”æ€¥æ–¹æ¡ˆã€‚ä½ åº”è¯¥åªåœ¨ä½ å¿…é¡»â€œè·³å‡º Reactâ€æ—¶ä½¿ç”¨å®ƒä»¬ã€‚è¿™æ–¹é¢çš„å¸¸è§ç¤ºä¾‹åŒ…æ‹¬ç®¡ç†ç„¦ç‚¹ã€æ»šåŠ¨ä½ç½®æˆ–è°ƒç”¨ React æœªæš´éœ²çš„æµè§ˆå™¨ APIã€‚</p><p>å¦‚æœä½ åšæŒèšç„¦å’Œæ»šåŠ¨ç­‰éç ´åæ€§æ“ä½œï¼Œåº”è¯¥ä¸ä¼šé‡åˆ°ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°è¯•æ‰‹åŠ¨<strong>ä¿®æ”¹</strong> DOMï¼Œåˆ™å¯èƒ½ä¼šä¸ React æ‰€åšçš„æ›´æ”¹å‘ç”Ÿå†²çªã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªä¾‹å­åŒ…æ‹¬ä¸€æ¡æ¬¢è¿æ¶ˆæ¯å’Œä¸¤ä¸ªæŒ‰é’®ã€‚ç¬¬ä¸€ä¸ªæŒ‰é’®ä½¿ç”¨ <a href="https://zh-hans.react.dev/learn/conditional-rendering">æ¡ä»¶æ¸²æŸ“</a> å’Œ <a href="https://zh-hans.react.dev/learn/state-a-components-memory">state</a> åˆ‡æ¢å®ƒçš„æ˜¾ç¤ºå’Œéšè—ï¼Œå°±åƒä½ é€šå¸¸åœ¨ React ä¸­æ‰€åšçš„é‚£æ ·ã€‚ç¬¬äºŒä¸ªæŒ‰é’®ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/remove"><code>remove()</code> DOM API</a> å°†å…¶ä» React æ§åˆ¶ä¹‹å¤–çš„ DOM ä¸­å¼ºè¡Œç§»é™¤.</p><p>å°è¯•æŒ‰å‡ æ¬¡â€œé€šè¿‡ setState åˆ‡æ¢â€ã€‚è¯¥æ¶ˆæ¯ä¼šæ¶ˆå¤±å¹¶å†æ¬¡å‡ºç°ã€‚ç„¶åæŒ‰ â€œä» DOM ä¸­åˆ é™¤â€ã€‚è¿™å°†å¼ºè¡Œåˆ é™¤å®ƒã€‚æœ€åï¼ŒæŒ‰ â€œé€šè¿‡ setState åˆ‡æ¢â€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8zmj9jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8zmj9jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">          setShow(!show);</span><br><span class="language-xml">        &#125;&#125;&gt;</span><br><span class="language-xml">        é€šè¿‡ setState åˆ‡æ¢</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">          ref.current.remove();</span><br><span class="language-xml">        &#125;&#125;&gt;</span><br><span class="language-xml">        ä» DOM ä¸­åˆ é™¤</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span>&gt;</span>Hello world<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="ref.gif" alt="ref" style="zoom:50%;" /><p>åœ¨ä½ æ‰‹åŠ¨åˆ é™¤ DOM å…ƒç´ åï¼Œå°è¯•ä½¿ç”¨ <code>setState</code> å†æ¬¡æ˜¾ç¤ºå®ƒä¼šå¯¼è‡´å´©æºƒã€‚è¿™æ˜¯å› ä¸ºä½ æ›´æ”¹äº† DOMï¼Œè€Œ React ä¸çŸ¥é“å¦‚ä½•ç»§ç»­æ­£ç¡®ç®¡ç†å®ƒã€‚</p><p><mark>é¿å…æ›´æ”¹ç”± React ç®¡ç†çš„ DOM èŠ‚ç‚¹</mark>ã€‚ å¯¹ React ç®¡ç†çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ã€æ·»åŠ å­å…ƒç´ ã€ä»ä¸­åˆ é™¤å­å…ƒç´ ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„è§†è§‰ç»“æœï¼Œæˆ–ä¸ä¸Šè¿°ç±»ä¼¼çš„å´©æºƒã€‚</p><p>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ å®Œå…¨ä¸èƒ½è¿™æ ·åšã€‚å®ƒéœ€è¦è°¨æ…ã€‚ <strong>ä½ å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹ React æ²¡æœ‰ç†ç”±æ›´æ–°çš„éƒ¨åˆ† DOMã€‚</strong> ä¾‹å¦‚ï¼Œå¦‚æœæŸäº› <code>&lt;div&gt;</code> åœ¨ JSX ä¸­å§‹ç»ˆä¸ºç©ºï¼ŒReact å°†æ²¡æœ‰ç†ç”±å»å˜åŠ¨å…¶å­åˆ—è¡¨ã€‚ å› æ­¤ï¼Œåœ¨é‚£é‡Œæ‰‹åŠ¨å¢åˆ å…ƒç´ æ˜¯å®‰å…¨çš„ã€‚</p><hr><p>æ’­æ”¾å’Œæš‚åœè§†é¢‘ï¼šæŒ‰é’®åˆ‡æ¢ state å˜é‡ä»¥åœ¨æ’­æ”¾å’Œæš‚åœçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚ ç„¶è€Œï¼Œä¸ºäº†å®é™…æ’­æ”¾æˆ–æš‚åœè§†é¢‘ï¼Œåˆ‡æ¢çŠ¶æ€æ˜¯ä¸å¤Ÿçš„ã€‚ä½ è¿˜éœ€è¦åœ¨ <code>&lt;video&gt;</code> çš„ DOM å…ƒç´ ä¸Šè°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/play"><code>play()</code></a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/pause"><code>pause()</code></a>ã€‚ å‘å®ƒæ·»åŠ ä¸€ä¸ª refï¼Œå¹¶ä½¿æŒ‰é’®èµ·ä½œç”¨ã€‚å¯¹äºé¢å¤–çš„æŒ‘æˆ˜ï¼Œå³ä½¿ç”¨æˆ·å³é”®å•å‡»è§†é¢‘å¹¶ä½¿ç”¨å†…ç½®æµè§ˆå™¨åª’ä½“æ§ä»¶æ’­æ”¾ï¼Œä¹Ÿè¦ä½¿â€œæ’­æ”¾â€æŒ‰é’®ä¸è§†é¢‘æ˜¯å¦æ­£åœ¨æ’­æ”¾åŒæ­¥ã€‚ æ‚¨å¯èƒ½éœ€è¦åœ¨è§†é¢‘ä¸­ç›‘å¬ <code>onPlay</code> å’Œ <code>onPause</code> æ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>è§£ç­”ï¼šä¸ºäº†å¤„ç†å†…ç½®æµè§ˆå™¨æ§ä»¶ï¼Œæ‚¨å¯ä»¥å°† <code>onPlay</code> å’Œ <code>onPause</code> å¤„ç†ç¨‹åºæ·»åŠ åˆ° <code>&lt;video&gt;</code> å…ƒç´ ï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„ <code>setIsPlaying</code>ã€‚ è¿™æ ·ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨æ§ä»¶æ’­æ”¾è§†é¢‘ï¼ŒçŠ¶æ€å°†ç›¸åº”è°ƒæ•´ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zceiumlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zceiumlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlaying, setIsPlaying] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> nextIsPlaying = !isPlaying;<br>    <span class="hljs-title function_">setIsPlaying</span>(nextIsPlaying);<br><br>    <span class="hljs-keyword">if</span> (nextIsPlaying) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;isPlaying ? &#x27;æš‚åœ&#x27; : &#x27;æ’­æ”¾&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">video</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;250&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onPlay</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsPlaying(true)&#125;</span><br><span class="language-xml">        onPause=&#123;() =&gt; setIsPlaying(false)&#125;</span><br><span class="language-xml">      &gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">source</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;video/mp4&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  )<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="play.gif" alt="play" style="zoom:50%;" /><hr><p>ä½¿æœç´¢åŸŸè·å¾—ç„¦ç‚¹ï¼šåšåˆ°å•å‡»â€œæœç´¢â€æŒ‰é’®æ—¶ï¼Œä½¿æœç´¢åŸŸè·å¾—ç„¦ç‚¹ã€‚</p><p>è§£ç­”ï¼šå‘è¾“å…¥æ¡†æ·»åŠ ä¸€ä¸ª refï¼Œå¹¶åœ¨ DOM èŠ‚ç‚¹ä¸Šè°ƒç”¨ <code>focus()</code> ä»¥ä½¿å…¶è·å¾—ç„¦ç‚¹ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vm10illqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vm10illqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> inputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> &#123;</span><br><span class="language-xml">          inputRef.current.focus();</span><br><span class="language-xml">        &#125;&#125;&gt;</span><br><span class="language-xml">          æœç´¢</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;æ‰¾ä»€ä¹ˆå‘¢ï¼Ÿ&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="focus.gif" alt="focus" style="zoom:50%;" /><h2 id="3-ä½¿ç”¨-Effect-åŒæ­¥"><a href="#3-ä½¿ç”¨-Effect-åŒæ­¥" class="headerlink" title="3.ä½¿ç”¨ Effect åŒæ­¥"></a>3.ä½¿ç”¨ Effect åŒæ­¥</h2><p>æœ‰äº›ç»„ä»¶éœ€è¦ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ® React state æ§åˆ¶é React ç»„ä»¶ã€è®¾ç½®æœåŠ¡å™¨è¿æ¥æˆ–åœ¨ç»„ä»¶å‡ºç°åœ¨å±å¹•ä¸Šæ—¶å‘é€åˆ†ææ—¥å¿—ã€‚Effects ä¼šåœ¨æ¸²æŸ“åè¿è¡Œä¸€äº›ä»£ç ï¼Œä»¥ä¾¿å¯ä»¥å°†ç»„ä»¶ä¸ React ä¹‹å¤–çš„æŸäº›ç³»ç»ŸåŒæ­¥ã€‚</p><p>React ç»„ä»¶ä¸­çš„ä¸¤ç§é€»è¾‘ç±»å‹ï¼š</p><ul><li><strong>æ¸²æŸ“é€»è¾‘ä»£ç </strong>ï¼ˆåœ¨ <a href="https://zh-hans.react.dev/learn/describing-the-ui">æè¿° UI</a> ä¸­æœ‰ä»‹ç»ï¼‰ä½äºç»„ä»¶çš„é¡¶å±‚ã€‚ä½ å°†åœ¨è¿™é‡Œæ¥æ”¶ props å’Œ stateï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œè½¬æ¢ï¼Œæœ€ç»ˆè¿”å›ä½ æƒ³åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„ JSXã€‚<a href="https://zh-hans.react.dev/learn/keeping-components-pure">æ¸²æŸ“çš„ä»£ç å¿…é¡»æ˜¯çº¯ç²¹çš„</a>â€”â€”å°±åƒæ•°å­¦å…¬å¼ä¸€æ ·ï¼Œå®ƒåªåº”è¯¥â€œè®¡ç®—â€ç»“æœï¼Œè€Œä¸åšå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚</li><li><strong>äº‹ä»¶å¤„ç†ç¨‹åº</strong>ï¼ˆåœ¨ <a href="https://zh-hans.react.dev/learn/adding-interactivity">æ·»åŠ äº¤äº’æ€§</a> ä¸­ä»‹ç»ï¼‰æ˜¯åµŒå¥—åœ¨ç»„ä»¶å†…éƒ¨çš„å‡½æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯è®¡ç®—å‡½æ•°ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šæ›´æ–°è¾“å…¥å­—æ®µã€æäº¤ HTTP POST è¯·æ±‚ä»¥è´­ä¹°äº§å“ï¼Œæˆ–è€…å°†ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•ã€‚äº‹ä»¶å¤„ç†ç¨‹åºåŒ…å«ç”±ç‰¹å®šç”¨æˆ·æ“ä½œï¼ˆä¾‹å¦‚æŒ‰é’®ç‚¹å‡»æˆ–é”®å…¥ï¼‰å¼•èµ·çš„â€œå‰¯ä½œç”¨â€ï¼ˆå®ƒä»¬æ”¹å˜äº†ç¨‹åºçš„çŠ¶æ€ï¼‰ã€‚</li></ul><p>æœ‰æ—¶è¿™è¿˜ä¸å¤Ÿã€‚è€ƒè™‘ä¸€ä¸ª <code>ChatRoom</code> ç»„ä»¶ï¼Œå®ƒåœ¨å±å¹•ä¸Šå¯è§æ—¶å¿…é¡»è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚è¿æ¥åˆ°æœåŠ¡å™¨ä¸æ˜¯ä¸€ä¸ªçº¯è®¡ç®—ï¼ˆå®ƒåŒ…å«å‰¯ä½œç”¨ï¼‰ï¼Œå› æ­¤å®ƒä¸èƒ½åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿã€‚ç„¶è€Œï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰å¯¼è‡´ <code>ChatRoom</code> è¢«æ˜¾ç¤ºã€‚</p><p><mark>Effect å…è®¸ä½ æŒ‡å®šç”±æ¸²æŸ“æœ¬èº«ï¼Œè€Œä¸æ˜¯ç‰¹å®šäº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨</mark>ã€‚åœ¨èŠå¤©ä¸­å‘é€æ¶ˆæ¯æ˜¯ä¸€ä¸ªâ€œäº‹ä»¶â€ï¼Œå› ä¸ºå®ƒç›´æ¥ç”±ç”¨æˆ·ç‚¹å‡»ç‰¹å®šæŒ‰é’®å¼•èµ·ã€‚ç„¶è€Œï¼Œå»ºç«‹æœåŠ¡å™¨è¿æ¥æ˜¯ Effectï¼Œå› ä¸ºå®ƒåº”è¯¥å‘ç”Ÿæ— è®ºå“ªç§äº¤äº’å¯¼è‡´ç»„ä»¶å‡ºç°ã€‚Effect åœ¨å±å¹•æ›´æ–°åçš„ <a href="https://zh-hans.react.dev/learn/render-and-commit">æäº¤é˜¶æ®µ</a> è¿è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ—¶æœºï¼Œå¯ä»¥å°† React ç»„ä»¶ä¸æŸä¸ªå¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ç½‘ç»œæˆ–ç¬¬ä¸‰æ–¹åº“ï¼‰åŒæ­¥ã€‚</p><p><code>Effect</code> åœ¨ React ä¸­æ˜¯ä¸“æœ‰å®šä¹‰â€”â€”ç”±æ¸²æŸ“å¼•èµ·çš„å‰¯ä½œç”¨ï¼Œæˆ–ç§°ä¸ºå‰¯ä½œç”¨ã€‚</p><p>ç¼–å†™ Effect éœ€è¦éµå¾ªä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™ï¼š</p><ol><li><strong>å£°æ˜ Effect</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œã€‚</li><li><strong>æŒ‡å®š Effect ä¾èµ–</strong>ã€‚å¤§å¤šæ•° Effect åº”è¯¥æŒ‰éœ€æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ·¡å…¥åŠ¨ç”»åº”è¯¥åªåœ¨ç»„ä»¶å‡ºç°æ—¶è§¦å‘ã€‚è¿æ¥å’Œæ–­å¼€æœåŠ¡å™¨çš„æ“ä½œåªåº”åœ¨ç»„ä»¶å‡ºç°å’Œæ¶ˆå¤±æ—¶ï¼Œæˆ–è€…åˆ‡æ¢èŠå¤©å®¤æ—¶æ‰§è¡Œã€‚</li><li><strong>å¿…è¦æ—¶æ·»åŠ æ¸…ç†ï¼ˆcleanupï¼‰å‡½æ•°</strong>ã€‚æœ‰æ—¶ Effect éœ€è¦æŒ‡å®šå¦‚ä½•åœæ­¢ã€æ’¤é”€ï¼Œæˆ–è€…æ¸…é™¤å®ƒçš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œâ€œè¿æ¥â€æ“ä½œéœ€è¦â€œæ–­è¿â€ï¼Œâ€œè®¢é˜…â€éœ€è¦â€œé€€è®¢â€ï¼Œâ€œè·å–â€æ—¢éœ€è¦â€œå–æ¶ˆâ€ä¹Ÿéœ€è¦â€œå¿½ç•¥â€ã€‚</li></ol><p>ç¬¬ä¸€æ­¥ï¼šå£°æ˜ Effect ï¼šé¦–å…ˆåœ¨ React ä¸­å¼•å…¥ <a href="https://zh-hans.react.dev/reference/react/useEffect"><code>useEffect</code> Hook</a>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-enidrmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-enidrmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼Œåœ¨ç»„ä»¶é¡¶éƒ¨è°ƒç”¨å®ƒï¼Œå¹¶ä¼ å…¥åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sq5mpjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sq5mpjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/*  æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œæ­¤å¤„çš„ä»£ç   */</span> <br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ¯å½“ä½ çš„ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒReact å°†æ›´æ–°å±å¹•ï¼Œç„¶åè¿è¡Œ <code>useEffect</code> ä¸­çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œ**<code>useEffect</code> ä¼šæŠŠè¿™æ®µä»£ç æ”¾åˆ°å±å¹•æ›´æ–°æ¸²æŸ“ä¹‹åæ‰§è¡Œ**ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Effect ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚è€ƒè™‘ä¸€ä¸ª <code>&lt;VideoPlayer&gt;</code> React ç»„ä»¶ã€‚é€šè¿‡ä¼ é€’å¸ƒå°”ç±»å‹çš„ <code>isPlaying</code> prop ä»¥æ§åˆ¶æ˜¯æ’­æ”¾è¿˜æ˜¯æš‚åœï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ndhw8plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ndhw8plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">VideoPlayer</span> isPlaying=&#123;isPlaying&#125; /&gt;;<br></code></pre></td></tr></table></div></figure><p>è‡ªå®šä¹‰çš„ <code>VideoPlayer</code> ç»„ä»¶æ¸²æŸ“äº†å†…ç½®çš„ <code>video</code> æ ‡ç­¾ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4sscfalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4sscfalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-comment">/*  TODOï¼šä½¿ç”¨ isPlaying åšä¸€äº›äº‹æƒ…  */</span> <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯ï¼Œæµè§ˆå™¨çš„ <code>&lt;video&gt;</code> æ ‡ç­¾æ²¡æœ‰ <code>isPlaying</code> å±æ€§ã€‚æ§åˆ¶å®ƒçš„å”¯ä¸€æ–¹å¼æ˜¯åœ¨ DOM å…ƒç´ ä¸Šè°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/play"><code>play()</code></a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLMediaElement/pause"><code>pause()</code></a> æ–¹æ³•ã€‚å› æ­¤ï¼Œ<strong>ä½ éœ€è¦å°† <code>isPlaying</code> prop çš„å€¼ä¸ <code>play()</code> å’Œ <code>pause()</code> ç­‰å‡½æ•°çš„è°ƒç”¨è¿›è¡ŒåŒæ­¥ï¼Œè¯¥å±æ€§ç”¨äºå‘ŠçŸ¥å½“å‰è§†é¢‘æ˜¯å¦åº”è¯¥æ’­æ”¾</strong>ã€‚</p><p>é¦–å…ˆè¦è·å– <code>&lt;video&gt;</code>  DOM èŠ‚ç‚¹çš„ <a href="https://zh-hans.react.dev/learn/manipulating-the-dom-with-refs">å¯¹è±¡å¼•ç”¨</a>ã€‚</p><p>ä½ å¯èƒ½ä¼šå°è¯•åœ¨æ¸²æŸ“æœŸé—´è°ƒç”¨ <code>play()</code> æˆ– <code>pause()</code>ï¼Œä½†è¿™ç§åšæ³•æ˜¯é”™çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-m1qau5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-m1qau5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>    ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();  <span class="hljs-comment">/*  æ¸²æŸ“æœŸé—´ä¸èƒ½è°ƒç”¨ `play()`ã€‚   */</span> <br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>(); <span class="hljs-comment">/*  åŒæ ·ï¼Œè°ƒç”¨ `pause()` ä¹Ÿä¸è¡Œã€‚  */</span> <br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span> <span class="hljs-attr">loop</span> <span class="hljs-attr">playsInline</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlaying, setIsPlaying] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsPlaying(!isPlaying)&#125;&gt;</span><br><span class="language-xml">        &#123;isPlaying ? &#x27;æš‚åœ&#x27; : &#x27;æ’­æ”¾&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">VideoPlayer</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isPlaying</span>=<span class="hljs-string">&#123;isPlaying&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŠ¥é”™ï¼š</p><figure class="highlight pgsql"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g5sez6lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g5sez6lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Runtime Error<br>App.js: Cannot <span class="hljs-keyword">read</span> properties <span class="hljs-keyword">of</span> <span class="hljs-keyword">null</span> (reading <span class="hljs-string">&#x27;pause&#x27;</span>) (<span class="hljs-number">9</span>:<span class="hljs-number">16</span>)<br><br>   <span class="hljs-number">6</span> |   <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>   <span class="hljs-number">7</span> |     <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">current</span>.play();  // Ã¦Â¸Â²Ã¦ÂŸÂ“Ã¦ÂœÂŸÃ©Â—Â´Ã¤Â¸ÂÃ¨ÂƒÂ½Ã¨Â°ÂƒÃ§Â”Â¨ `play()`Ã£Â€Â‚ <br>   <span class="hljs-number">8</span> |   &#125; <span class="hljs-keyword">else</span> &#123;<br>&gt;  <span class="hljs-number">9</span> |     <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">current</span>.pause(); // Ã¥ÂÂŒÃ¦ Â·Ã¯Â¼ÂŒÃ¨Â°ÂƒÃ§Â”Â¨ `pause()` Ã¤Â¹ÂŸÃ¤Â¸ÂÃ¨Â¡ÂŒÃ£Â€Â‚<br>                       ^<br>  <span class="hljs-number">10</span> |   &#125;<br>  <span class="hljs-number">11</span> | <br>  <span class="hljs-number">12</span> |   <span class="hljs-keyword">return</span> &lt;video <span class="hljs-keyword">ref</span>=&#123;<span class="hljs-keyword">ref</span>&#125; src=&#123;src&#125; <span class="hljs-keyword">loop</span> playsInline /&gt;;<br></code></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç ä¹‹æ‰€ä»¥ä¸æ­£ç¡®ï¼Œæ˜¯å› ä¸ºå®ƒè¯•å›¾åœ¨æ¸²æŸ“æœŸé—´å¯¹ DOM èŠ‚ç‚¹è¿›è¡Œæ“ä½œã€‚<mark>åœ¨ React ä¸­ï¼Œ<a href="https://zh-hans.react.dev/learn/keeping-components-pure">JSX çš„æ¸²æŸ“å¿…é¡»æ˜¯çº¯ç²¹æ“ä½œ</a>ï¼Œä¸åº”è¯¥åŒ…å«ä»»ä½•åƒä¿®æ”¹ DOM çš„å‰¯ä½œç”¨ã€‚</mark></p><p>è€Œä¸”ï¼Œå½“ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>VideoPlayer</code> æ—¶ï¼Œå¯¹åº”çš„ DOM èŠ‚ç‚¹ç”šè‡³è¿˜ä¸å­˜åœ¨ï¼å¦‚æœè¿ DOM èŠ‚ç‚¹éƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆå¦‚ä½•è°ƒç”¨ <code>play()</code> æˆ– <code>pause()</code> æ–¹æ³•å‘¢ï¼åœ¨è¿”å› JSX ä¹‹å‰ï¼ŒReact ä¸çŸ¥é“è¦åˆ›å»ºä»€ä¹ˆ DOMã€‚</p><p>è§£å†³åŠæ³•æ˜¯ <strong>ä½¿ç”¨ <code>useEffect</code> åŒ…è£¹å‰¯ä½œç”¨ï¼ŒæŠŠå®ƒåˆ†ç¦»åˆ°æ¸²æŸ“é€»è¾‘çš„è®¡ç®—è¿‡ç¨‹ä¹‹å¤–</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jyphfmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jyphfmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useEffect, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span> <span class="hljs-attr">loop</span> <span class="hljs-attr">playsInline</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŠŠè°ƒç”¨ DOM æ–¹æ³•çš„æ“ä½œå°è£…åœ¨ Effect ä¸­ï¼Œä½ å¯ä»¥è®© React å…ˆæ›´æ–°å±å¹•ï¼Œç¡®å®šç›¸å…³ DOM åˆ›å»ºå¥½äº†ä»¥åç„¶åå†è¿è¡Œ Effectã€‚</p><p>å½“ <code>VideoPlayer</code> ç»„ä»¶æ¸²æŸ“æ—¶ï¼ˆæ— è®ºæ˜¯å¦ä¸ºé¦–æ¬¡æ¸²æŸ“ï¼‰ï¼Œéƒ½ä¼šå‘ç”Ÿä»¥ä¸‹äº‹æƒ…ã€‚é¦–å…ˆï¼ŒReact ä¼šåˆ·æ–°å±å¹•ï¼Œç¡®ä¿ <code>&lt;video&gt;</code> å…ƒç´ å·²ç»æ­£ç¡®åœ°å‡ºç°åœ¨ DOM ä¸­ï¼›ç„¶åï¼ŒReact å°†è¿è¡Œ Effectï¼›æœ€åï¼ŒEffect å°†æ ¹æ® <code>isPlaying</code> çš„å€¼è°ƒç”¨ <code>play()</code> æˆ– <code>pause()</code>ã€‚</p><p>è¯•è¯•æŒ‰ä¸‹å‡ æ¬¡æ’­æ”¾å’Œæš‚åœæ“ä½œï¼Œè§‚å¯Ÿè§†é¢‘æ’­æ”¾å™¨çš„æ’­æ”¾ã€æš‚åœè¡Œä¸ºæ˜¯å¦‚ä½•ä¸ <code>isPlaying</code> prop åŒæ­¥çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-33ng6plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-33ng6plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span> <span class="hljs-attr">loop</span> <span class="hljs-attr">playsInline</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlaying, setIsPlaying] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsPlaying(!isPlaying)&#125;&gt;</span><br><span class="language-xml">        &#123;isPlaying ? &#x27;æš‚åœ&#x27; : &#x27;æ’­æ”¾&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">VideoPlayer</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isPlaying</span>=<span class="hljs-string">&#123;isPlaying&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Effect ä¼šåœ¨  <strong>æ¯æ¬¡</strong> æ¸²æŸ“åæ‰§è¡Œï¼Œ<strong>è€Œä»¥ä¸‹ä»£ç ä¼šé™·å…¥æ­»å¾ªç¯ä¸­</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g6gk6hlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g6gk6hlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>æ¯æ¬¡æ¸²æŸ“ç»“æŸéƒ½ä¼šæ‰§è¡Œ Effectï¼›è€Œæ›´æ–° state ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯æ–°ä¸€è½®æ¸²æŸ“æ—¶åˆä¼šå†æ¬¡æ‰§è¡Œ Effectï¼Œç„¶å Effect å†æ¬¡æ›´æ–° stateâ€¦â€¦å¦‚æ­¤å‘¨è€Œå¤å§‹ï¼Œä»è€Œé™·å…¥æ­»å¾ªç¯ã€‚</p><p>Effect é€šå¸¸åº”è¯¥ä½¿ç»„ä»¶ä¸ <strong>å¤–éƒ¨</strong> ç³»ç»Ÿä¿æŒåŒæ­¥ã€‚å¦‚æœæ²¡æœ‰å¤–éƒ¨ç³»ç»Ÿï¼Œä½ åªæƒ³æ ¹æ®å…¶ä»–çŠ¶æ€è°ƒæ•´ä¸€äº›çŠ¶æ€ï¼Œé‚£ä¹ˆ <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect">ä½ ä¹Ÿè®¸ä¸éœ€è¦ Effect</a>ã€‚</p><hr><p>ç¬¬äºŒæ­¥ï¼šæŒ‡å®š Effect ä¾èµ–ï¼šä¸€èˆ¬æ¥è¯´ï¼ŒEffect ä¼šåœ¨ <strong>æ¯æ¬¡</strong> æ¸²æŸ“æ—¶æ‰§è¡Œã€‚<strong>ä½†æ›´å¤šæ—¶å€™ï¼Œå¹¶ä¸éœ€è¦æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½æ‰§è¡Œ Effect</strong>ã€‚</p><ol><li>æœ‰æ—¶è¿™ä¼šæ‹–æ…¢è¿è¡Œé€Ÿåº¦ã€‚å› ä¸ºä¸å¤–éƒ¨ç³»ç»Ÿçš„åŒæ­¥æ“ä½œæ€»æ˜¯æœ‰ä¸€å®šæ—¶è€—ï¼Œåœ¨éå¿…è¦æ—¶å¯èƒ½å¸Œæœ›è·³è¿‡å®ƒã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰äººä¼šå¸Œæœ›æ¯æ¬¡ç”¨é”®ç›˜æ‰“å­—æ—¶éƒ½é‡æ–°è¿æ¥èŠå¤©æœåŠ¡å™¨ã€‚</li><li>æœ‰æ—¶è¿™ä¼šå¯¼è‡´ç¨‹åºé€»è¾‘é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œç»„ä»¶çš„æ·¡å…¥åŠ¨ç”»åªéœ€è¦åœ¨ç¬¬ä¸€è½®æ¸²æŸ“å‡ºç°æ—¶æ’­æ”¾ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è§¦å‘æ–°ä¸€è½®æ¸²æŸ“åéƒ½æ’­æ”¾ã€‚</li></ol><p>å°† <strong>ä¾èµ–æ•°ç»„</strong> ä¼ å…¥ <code>useEffect</code> çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»¥å‘Šè¯‰ React <strong>è·³è¿‡ä¸å¿…è¦åœ°é‡æ–°è¿è¡Œ Effect</strong>ã€‚ä¼ å…¥ä¸€ä¸ªç©ºæ•°ç»„ <code>[]</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-pz5vbslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-pz5vbslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-comment">// ...</span><br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>æŠ¥é”™ï¼š<code>React Hook useEffect has a missing dependency: &#39;isPlaying&#39;. Either include it or remove the dependency array.</code></p><p>é—®é¢˜å‡ºç°åœ¨ Effect ä¸­ä½¿ç”¨äº† <code>isPlaying</code> prop ä»¥æ§åˆ¶é€»è¾‘ï¼Œä½†åˆæ²¡æœ‰ç›´æ¥å‘Šè¯‰ Effect éœ€è¦ä¾èµ–è¿™ä¸ªå±æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°† <code>isPlaying</code> æ·»åŠ è‡³ä¾èµ–æ•°ç»„ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fb5zdwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fb5zdwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123; <span class="hljs-comment">/*  isPlaying åœ¨æ­¤å¤„ä½¿ç”¨â€¦â€¦  */</span> <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>    &#125;<br>&#125;, [isPlaying]); <span class="hljs-comment">// â€¦â€¦æ‰€ä»¥å®ƒå¿…é¡»åœ¨æ­¤å¤„å£°æ˜ï¼</span><br></code></pre></td></tr></table></div></figure><p>ç°åœ¨æ‰€æœ‰çš„ä¾èµ–éƒ½å·²ç»å£°æ˜ï¼Œæ‰€ä»¥æ²¡æœ‰é”™è¯¯äº†ã€‚<mark>æŒ‡å®š <code>[isPlaying]</code> ä¼šå‘Šè¯‰ Reactï¼Œå¦‚æœ <code>isPlaying</code> åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶ä¸å½“å‰ç›¸åŒï¼Œå®ƒåº”è¯¥è·³è¿‡é‡æ–°è¿è¡Œ Effect</mark>ã€‚é€šè¿‡è¿™ä¸ªæ”¹å˜ï¼Œè¾“å…¥æ¡†çš„è¾“å…¥ä¸ä¼šå¯¼è‡´ Effect é‡æ–°è¿è¡Œï¼Œä½†æ˜¯æŒ‰ä¸‹æ’­æ”¾&#x2F;æš‚åœæŒ‰é’®ä¼šé‡æ–°è¿è¡Œ Effectã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wd2igdlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wd2igdlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useRef, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Calling video.play()&#x27;</span>);<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Calling video.pause()&#x27;</span>);<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;, [isPlaying]);<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#123;src&#125;</span> <span class="hljs-attr">loop</span> <span class="hljs-attr">playsInline</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isPlaying, setIsPlaying] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setIsPlaying(!isPlaying)&#125;&gt;</span><br><span class="language-xml">        &#123;isPlaying ? &#x27;Pause&#x27; : &#x27;Play&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">VideoPlayer</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">isPlaying</span>=<span class="hljs-string">&#123;isPlaying&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¾èµ–æ•°ç»„å¯ä»¥åŒ…å«å¤šä¸ªä¾èµ–é¡¹ã€‚å½“æŒ‡å®šçš„æ‰€æœ‰ä¾èµ–é¡¹åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æœŸé—´çš„å€¼ä¸å½“å‰å€¼å®Œå…¨ç›¸åŒæ—¶ï¼ŒReact ä¼šè·³è¿‡é‡æ–°è¿è¡Œè¯¥ Effectã€‚React ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> æ¯”è¾ƒä¾èµ–é¡¹çš„å€¼ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<mark>ä¸èƒ½éšæ„é€‰æ‹©ä¾èµ–é¡¹</mark>ã€‚å¦‚æœä½ æŒ‡å®šçš„ä¾èµ–é¡¹ä¸èƒ½ä¸ Effect ä»£ç æ‰€æœŸæœ›çš„ç›¸åŒ¹é…æ—¶ï¼Œlint å°†ä¼šæŠ¥é”™ï¼Œè¿™å°†å¸®åŠ©ä½ æ‰¾åˆ°ä»£ç ä¸­çš„é—®é¢˜ã€‚å¦‚æœä½ ä¸å¸Œæœ›æŸäº›ä»£ç é‡æ–°è¿è¡Œï¼Œ<a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#what-to-do-when-you-dont-want-to-re-synchronize">é‚£ä¹ˆä½ åº”å½“ <strong>é‡æ–°ç¼–è¾‘ Effect ä»£ç æœ¬èº«</strong>ï¼Œä½¿å…¶ä¸éœ€è¦è¯¥ä¾èµ–é¡¹</a>ã€‚</p><p><mark>æ²¡æœ‰ä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ä¾èµ–æ•°ç»„ä½ç©ºæ•°ç»„ <code>[]</code> çš„è¡Œä¸ºæ˜¯ä¸ä¸€è‡´çš„</mark>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-38q659lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-38q659lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  è¿™é‡Œçš„ä»£ç ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ  */</span> <br>&#125;);<br><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  è¿™é‡Œçš„ä»£ç åªä¼šåœ¨ç»„ä»¶æŒ‚è½½åæ‰§è¡Œ  */</span> <br>&#125;, []);<br><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  è¿™é‡Œçš„ä»£ç åªä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åï¼Œå¹¶ä¸” a æˆ– b çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¸ä¸€è‡´æ—¶æ‰§è¡Œ  */</span><br>&#125;, [a, b]);<br></code></pre></td></tr></table></div></figure><p>ä¸ºä»€ä¹ˆä¾èµ–æ•°ç»„ä¸­å¯ä»¥çœç•¥ ref? </p><p>ä¸‹é¢çš„ Effect åŒæ—¶ä½¿ç”¨äº† <code>ref</code> ä¸ <code>isPlaying</code> propï¼Œä½†æ˜¯åªæœ‰ <code>isPlaying</code> è¢«å£°æ˜ä¸ºäº†ä¾èµ–é¡¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cjbf18lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cjbf18lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;, [isPlaying]);<br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å› ä¸º <code>ref</code> å…·æœ‰ <strong>ç¨³å®š</strong> çš„æ ‡è¯†ï¼šReact ä¿è¯ <a href="https://zh-hans.react.dev/reference/react/useRef#returns">æ¯è½®æ¸²æŸ“ä¸­è°ƒç”¨ <code>useRef</code> æ‰€äº§ç”Ÿçš„å¼•ç”¨å¯¹è±¡æ—¶ï¼Œè·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ€»æ˜¯ç›¸åŒçš„</a>ï¼Œå³è·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå¯¼è‡´é‡æ–°è¿è¡Œ Effectã€‚å› æ­¤ï¼Œä¾èµ–æ•°ç»„ä¸­æ˜¯å¦åŒ…å«å®ƒå¹¶ä¸é‡è¦ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åŒ…æ‹¬å®ƒï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-psc2khlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-psc2khlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">VideoPlayer</span>(<span class="hljs-params">&#123; src, isPlaying &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (isPlaying) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">play</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">pause</span>();<br>    &#125;<br>  &#125;, [isPlaying, ref]);<br></code></pre></td></tr></table></div></figure><p><code>useState</code> è¿”å›çš„ <a href="https://zh-hans.react.dev/reference/react/useState#setstate"><code>set</code> å‡½æ•°</a> ä¹Ÿæœ‰ç¨³å®šçš„æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥æŠŠå®ƒä»ä¾èµ–æ•°ç»„ä¸­å¿½ç•¥æ‰ã€‚å¦‚æœåœ¨å¿½ç•¥æŸä¸ªä¾èµ–é¡¹æ—¶ linter ä¸ä¼šæŠ¥é”™ï¼Œé‚£ä¹ˆè¿™ä¹ˆåšå°±æ˜¯å®‰å…¨çš„ã€‚</p><p>ä½†æ˜¯ï¼Œä»…åœ¨ linter å¯ä»¥â€œçœ‹åˆ°â€å¯¹è±¡ç¨³å®šæ—¶ï¼Œå¿½ç•¥ç¨³å®šä¾èµ–é¡¹çš„è§„åˆ™æ‰ä¼šèµ·ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>ref</code> æ˜¯ä»çˆ¶ç»„ä»¶ä¼ é€’çš„ï¼Œåˆ™å¿…é¡»åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­æŒ‡å®šå®ƒã€‚è¿™æ ·åšæ˜¯åˆé€‚çš„ï¼Œå› ä¸ºæ— æ³•ç¡®å®šçˆ¶ç»„ä»¶æ˜¯å¦å§‹ç»ˆæ˜¯ä¼ é€’ç›¸åŒçš„ refï¼Œæˆ–è€…å¯èƒ½æ˜¯æœ‰æ¡ä»¶åœ°ä¼ é€’å‡ ä¸ª ref ä¹‹ä¸€ã€‚å› æ­¤ï¼Œä½ çš„ Effect å°†å–å†³äºä¼ é€’çš„æ˜¯å“ªä¸ª refã€‚</p><hr><p>ç¬¬ä¸‰æ­¥ï¼šæŒ‰éœ€æ·»åŠ æ¸…ç†ï¼ˆcleanupï¼‰å‡½æ•° </p><p>è€ƒè™‘ä¸€ä¸ªä¸åŒçš„ä¾‹å­ã€‚ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª <code>ChatRoom</code> ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å‡ºç°æ—¶éœ€è¦è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚ç°åœ¨ä¸ºä½ æä¾›äº† <code>createConnection()</code> APIï¼Œè¯¥ API è¿”å›ä¸€ä¸ªåŒ…å« <code>connect()</code> ä¸ <code>disconnection()</code> æ–¹æ³•çš„å¯¹è±¡ã€‚è€ƒè™‘å½“ç»„ä»¶å±•ç¤ºç»™ç”¨æˆ·æ—¶ï¼Œåº”è¯¥å¦‚ä½•ä¿æŒè¿æ¥ï¼Ÿ</p><p>ä»ç¼–å†™ Effect é€»è¾‘å¼€å§‹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7cso13lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7cso13lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>  connection.<span class="hljs-title function_">connect</span>();<br>&#125;);<br></code></pre></td></tr></table></div></figure><p>æ¯æ¬¡é‡æ–°æ¸²æŸ“åè¿æ¥åˆ°èŠå¤©å®¤ä¼šå¾ˆæ…¢ï¼Œå› æ­¤å¯ä»¥æ·»åŠ ä¾èµ–æ•°ç»„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d5ja5klqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d5ja5klqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>  connection.<span class="hljs-title function_">connect</span>();<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>Effect ä¸­çš„ä»£ç æ²¡æœ‰ä½¿ç”¨ä»»ä½• props æˆ– stateï¼Œæ­¤æ—¶æŒ‡å®šä¾èµ–æ•°ç»„ä¸ºç©ºæ•°ç»„ <code>[]</code>ã€‚è¿™å‘Šè¯‰ React ä»…åœ¨ç»„ä»¶â€œæŒ‚è½½â€æ—¶è¿è¡Œæ­¤ä»£ç ï¼Œå³é¦–æ¬¡å‡ºç°åœ¨å±å¹•ä¸Šè¿™ä¸€é˜¶æ®µã€‚</p><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oayc3jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oayc3jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// çœŸå®çš„å®ç°ä¼šå°†å…¶è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ­¤å¤„ä»£ç åªæ˜¯ç¤ºä¾‹</span><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥ä¸­â€¦â€¦&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ è¿æ¥æ–­å¼€ã€‚&#x27;</span>);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9rx0qylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9rx0qylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ°èŠå¤©å®¤ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231114171125599.png" alt="image-20231114171125599" style="zoom:50%;" /><p>è¿™é‡Œçš„ Effect ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œï¼Œæ‰€ä»¥ <code>&quot;âœ… è¿æ¥ä¸­â€¦â€¦&quot;</code> åœ¨æ§åˆ¶å°ä¸­åªä¼šæ‰“å°ä¸€æ¬¡ã€‚<strong>ç„¶è€Œæ§åˆ¶å°å®é™…æ‰“å° <code>&quot;âœ… è¿æ¥ä¸­â€¦â€¦&quot;</code> äº†ä¸¤æ¬¡ï¼ä¸ºä»€ä¹ˆä¼šè¿™æ ·</strong>ï¼Ÿ</p><p>æƒ³è±¡ <code>ChatRoom</code> ç»„ä»¶æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡çš„ App ä¸­è®¸å¤šç•Œé¢ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ç”¨æˆ·åˆ‡æ¢åˆ°å«æœ‰ <code>ChatRoom</code> ç»„ä»¶çš„é¡µé¢ä¸Šæ—¶ï¼Œè¯¥ç»„ä»¶è¢«æŒ‚è½½ï¼Œå¹¶è°ƒç”¨ <code>connection.connect()</code> æ–¹æ³•è¿æ¥æœåŠ¡å™¨ã€‚ç„¶åæƒ³è±¡ç”¨æˆ·æ­¤æ—¶çªç„¶å¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œæ¯”å¦‚åˆ‡æ¢åˆ°â€œè®¾ç½®â€é¡µé¢ã€‚è¿™æ—¶ï¼Œ<code>ChatRoom</code> ç»„ä»¶å°±è¢«å¸è½½äº†ã€‚æ¥ä¸‹æ¥ï¼Œç”¨æˆ·åœ¨â€œè®¾ç½®â€é¡µé¢å¿™å®Œåï¼Œå•å‡»â€œè¿”å›â€ï¼Œå›åˆ°ä¸Šä¸€ä¸ªé¡µé¢ï¼Œå¹¶å†æ¬¡æŒ‚è½½ <code>ChatRoom</code>ã€‚è¿™å°†å»ºç«‹ç¬¬äºŒæ¬¡è¿æ¥ï¼Œä½†æ˜¯ï¼Œç¬¬ä¸€æ¬¡æ—¶åˆ›å»ºçš„è¿æ¥ä»æœªè¢«é”€æ¯ï¼å½“ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­ä¸æ–­åˆ‡æ¢ç•Œé¢å†è¿”å›æ—¶ï¼Œä¸æœåŠ¡å™¨çš„è¿æ¥ä¼šä¸æ–­å †ç§¯ã€‚</p><p>å¦‚æœä¸è¿›è¡Œå¤§é‡çš„æ‰‹åŠ¨æµ‹è¯•ï¼Œè¿™æ ·çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«é—æ¼ã€‚<mark>ä¸ºäº†å¸®åŠ©ä½ å¿«é€Ÿå‘ç°å®ƒä»¬ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šåœ¨åˆå§‹æŒ‚è½½ç»„ä»¶åï¼Œç«‹å³å†æŒ‚è½½ä¸€æ¬¡</mark>ã€‚</p><p>è§‚å¯Ÿåˆ° <code>&quot;âœ… è¿æ¥ä¸­â€¦â€¦&quot;</code> å‡ºç°äº†ä¸¤æ¬¡ï¼Œå¯ä»¥å¸®åŠ©æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼šåœ¨ä»£ç ä¸­ï¼Œç»„ä»¶è¢«å¸è½½æ—¶æ²¡æœ‰å…³é—­è¿æ¥ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨ Effect ä¸­è¿”å›ä¸€ä¸ª <strong>æ¸…ç†ï¼ˆcleanupï¼‰</strong> å‡½æ•°ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t6ag9olqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t6ag9olqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>        connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>æ¯æ¬¡é‡æ–°æ‰§è¡Œ Effect ä¹‹å‰ï¼ŒReact éƒ½ä¼šè°ƒç”¨æ¸…ç†å‡½æ•°ï¼›ç»„ä»¶è¢«å¸è½½æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨æ¸…ç†å‡½æ•°ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œæ¸…ç†å‡½æ•°ä¼šåšäº›ä»€ä¹ˆï¼š</p><img src="image-20231114171713151.png" alt="image-20231114171713151" style="zoom:50%;" /><ol><li><strong>åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå‡ºç°è¿™æ ·çš„ç»“æœæ‰æ˜¯ç¬¦åˆé¢„æœŸçš„</strong>ã€‚é‡å¤æŒ‚è½½ç»„ä»¶ï¼Œå¯ä»¥ç¡®ä¿åœ¨ React ä¸­ç¦»å¼€å’Œè¿”å›é¡µé¢æ—¶ä¸ä¼šå¯¼è‡´ä»£ç è¿è¡Œå‡ºç°é—®é¢˜ã€‚ä¸Šé¢çš„ä»£ç ä¸­è§„å®šäº†æŒ‚è½½ç»„ä»¶æ—¶è¿æ¥æœåŠ¡å™¨ã€å¸è½½ç»„ä»¶æ—¶æ–­è¿æœåŠ¡å™¨ã€‚æ‰€ä»¥æ–­å¼€ã€è¿æ¥å†é‡æ–°è¿æ¥æ˜¯ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚å½“ä¸º Effect æ­£ç¡®å®ç°æ¸…ç†å‡½æ•°æ—¶ï¼Œæ— è®º Effect æ‰§è¡Œä¸€æ¬¡ï¼Œè¿˜æ˜¯æ‰§è¡Œã€æ¸…ç†ã€å†æ‰§è¡Œï¼Œç”¨æˆ·éƒ½ä¸ä¼šæ„Ÿå—åˆ°æ˜æ˜¾çš„å·®å¼‚ã€‚æ‰€ä»¥ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå‡ºç°é¢å¤–çš„è¿æ¥ã€æ–­è¿æ—¶ï¼Œè¿™æ˜¯ React æ­£åœ¨è°ƒè¯•ä½ çš„ä»£ç ã€‚è¿™æ˜¯å¾ˆæ­£å¸¸çš„ç°è±¡ï¼Œä¸è¦è¯•å›¾æ¶ˆé™¤å®ƒï¼</li><li><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œ<code>&quot;âœ… è¿æ¥ä¸­â€¦â€¦&quot;</code> åªä¼šè¢«æ‰“å°ä¸€æ¬¡</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ä»…åœ¨å¼€å‘ç¯å¢ƒä¸‹æ‰ä¼šé‡å¤æŒ‚è½½ç»„ä»¶ï¼Œä»¥å¸®åŠ©ä½ æ‰¾åˆ°éœ€è¦æ¸…ç†çš„ Effectã€‚ä½ å¯ä»¥é€‰æ‹©å…³é—­ <a href="https://zh-hans.react.dev/reference/react/StrictMode">ä¸¥æ ¼æ¨¡å¼</a> æ¥å…³é—­å¼€å‘ç¯å¢ƒä¸‹ç‰¹æœ‰çš„è¡Œä¸ºï¼Œä½†æˆ‘ä»¬å»ºè®®ä¿ç•™å®ƒã€‚è¿™å¯ä»¥å¸®åŠ©å‘ç°è®¸å¤šä¸Šé¢è¿™æ ·çš„é”™è¯¯ã€‚</li></ol><p>å¦‚ä½•å¤„ç†åœ¨å¼€å‘ç¯å¢ƒä¸­ Effect æ‰§è¡Œä¸¤æ¬¡ï¼Ÿ </p><ul><li>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact æœ‰æ„é‡å¤æŒ‚è½½ä½ çš„ç»„ä»¶ï¼Œä»¥æŸ¥æ‰¾åƒä¸Šé¢ç¤ºä¾‹ä¸­çš„é”™è¯¯ã€‚<strong>æ­£ç¡®çš„æ€åº¦æ˜¯â€œå¦‚ä½•ä¿®å¤ Effect ä»¥ä¾¿å®ƒåœ¨é‡å¤æŒ‚è½½åèƒ½æ­£å¸¸å·¥ä½œâ€ï¼Œè€Œä¸æ˜¯â€œå¦‚ä½•åªè¿è¡Œä¸€æ¬¡ Effectâ€</strong>ã€‚</li><li>é€šå¸¸çš„è§£å†³åŠæ³•æ˜¯å®ç°æ¸…ç†å‡½æ•°ã€‚æ¸…ç†å‡½æ•°åº”è¯¥åœæ­¢æˆ–æ’¤é”€ Effect æ­£åœ¨æ‰§è¡Œçš„ä»»ä½•æ“ä½œã€‚ç®€å•æ¥è¯´ï¼Œç”¨æˆ·ä¸åº”è¯¥æ„Ÿå—åˆ° Effect åªæ‰§è¡Œä¸€æ¬¡ï¼ˆå¦‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼‰å’Œæ‰§è¡Œâ€œæŒ‚è½½ â†’ æ¸…ç† â†’ æŒ‚è½½â€è¿‡ç¨‹ï¼ˆå¦‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼‰ä¹‹é—´çš„å·®å¼‚ã€‚</li></ul><p>å¸¸ç”¨çš„ Effect åº”ç”¨æ¨¡å¼ï¼š</p><ol><li><p><mark>æ§åˆ¶é React ç»„ä»¶</mark>ï¼šæœ‰æ—¶éœ€è¦æ·»åŠ ä¸æ˜¯ä½¿ç”¨ React ç¼–å†™çš„ UI å°éƒ¨ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ è¦å‘é¡µé¢æ·»åŠ åœ°å›¾ç»„ä»¶ï¼Œå¹¶ä¸”å®ƒæœ‰ä¸€ä¸ª <code>setZoomLevel()</code> æ–¹æ³•ï¼Œä½ å¸Œæœ›è°ƒæ•´ç¼©æ”¾çº§åˆ«ï¼ˆzoom levelï¼‰å¹¶ä¸ React ä»£ç ä¸­çš„ <code>zoomLevel</code> state å˜é‡ä¿æŒåŒæ­¥ã€‚Effect çœ‹èµ·æ¥åº”è¯¥ä¸ä¸‹é¢ç±»ä¼¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f4ls8olqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f4ls8olqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> map = mapRef.<span class="hljs-property">current</span>;  map.<span class="hljs-title function_">setZoomLevel</span>(zoomLevel);<br>&#125;, [zoomLevel]);<br></code></pre></td></tr></table></div></figure><p>è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦æ¸…ç†ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šè°ƒç”¨ Effect ä¸¤æ¬¡ï¼Œä½†è¿™ä¸¤æ¬¡æŒ‚è½½æ—¶ä¾èµ–é¡¹ <code>zoomLevel</code> éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä¼šè·³è¿‡æ‰§è¡Œç¬¬äºŒæ¬¡æŒ‚è½½æ—¶çš„ Effectã€‚å¼€å‘ç¯å¢ƒä¸­å®ƒå¯èƒ½ä¼šç¨å¾®æ…¢ä¸€äº›ï¼Œä½†è¿™é—®é¢˜ä¸å¤§ï¼Œå› ä¸ºå®ƒåœ¨ç”Ÿäº§ä¸­ä¸ä¼šè¿›è¡Œä¸å¿…è¦çš„é‡å¤æŒ‚è½½ã€‚</p><p>æŸäº› API å¯èƒ½ä¸å…è®¸è¿ç»­è°ƒç”¨ä¸¤æ¬¡ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„ <code>showModal</code>æ–¹æ³•åœ¨è¿ç»­è°ƒç”¨ä¸¤æ¬¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ­¤æ—¶å®ç°æ¸…ç†å‡½æ•°å¹¶ä½¿å…¶å…³é—­å¯¹è¯æ¡†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sauj5xlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sauj5xlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> dialog = dialogRef.<span class="hljs-property">current</span>;<br>  dialog.<span class="hljs-title function_">showModal</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> dialog.<span class="hljs-title function_">close</span>();<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒEffect å°†è°ƒç”¨ <code>showModal()</code>ï¼Œç„¶åç«‹å³è°ƒç”¨ <code>close()</code>ï¼Œç„¶åå†æ¬¡è°ƒç”¨ <code>showModal()</code>ã€‚è¿™ä¸è°ƒç”¨åªä¸€æ¬¡ <code>showModal()</code> çš„æ•ˆæœç›¸åŒã€‚ä¹Ÿæ­£å¦‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çœ‹åˆ°çš„é‚£æ ·ã€‚</p></li><li><p><mark>è®¢é˜…äº‹ä»¶</mark>ï¼šå¦‚æœ Effect è®¢é˜…äº†æŸäº›äº‹ä»¶ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥é€€è®¢è¿™äº›äº‹ä»¶ï¼š</p></li></ol>   <figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ov623ulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ov623ulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params">e</span>) &#123;    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollX</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>);<br><br>  &#125; <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, handleScroll);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, handleScroll);<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>   åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒEffect ä¼šè°ƒç”¨ <code>addEventListener()</code>ï¼Œç„¶åç«‹å³è°ƒç”¨ <code>removeEventListener()</code>ï¼Œç„¶åå†è°ƒç”¨ç›¸åŒçš„ <code>addEventListener()</code>ï¼Œè¿™ä¸åªè®¢é˜…ä¸€æ¬¡äº‹ä»¶çš„ Effect ç­‰æ•ˆï¼›è¿™ä¹Ÿä¸ç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åªè°ƒç”¨ä¸€æ¬¡ <code>addEventListener()</code> å…·æœ‰ç›¸åŒçš„æ„ŸçŸ¥æ•ˆæœã€‚</p><ol start="3"><li><p><mark>è§¦å‘åŠ¨ç”»</mark>ï¼šå¦‚æœ Effect å¯¹æŸäº›å†…å®¹åŠ å…¥äº†åŠ¨ç”»ï¼Œæ¸…ç†å‡½æ•°åº”å°†åŠ¨ç”»é‡ç½®ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1oelzilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1oelzilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> node = ref.<span class="hljs-property">current</span>;<br>  node.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">/*  è§¦å‘åŠ¨ç”»  */</span> <br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;    node.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">/*  é‡ç½®ä¸ºåˆå§‹å€¼  */</span> <br>  &#125;;<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œé€æ˜åº¦ç”± <code>1</code> å˜ä¸º <code>0</code>ï¼Œå†å˜ä¸º <code>1</code>ã€‚è¿™ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç›´æ¥å°†å…¶è®¾ç½®ä¸º <code>1</code> å…·æœ‰ç›¸åŒçš„æ„ŸçŸ¥æ•ˆæœï¼Œå¦‚æœä½ ä½¿ç”¨æ”¯æŒè¿‡æ¸¡çš„ç¬¬ä¸‰æ–¹åŠ¨ç”»åº“ï¼Œä½ çš„æ¸…ç†å‡½æ•°åº”å°†æ—¶é—´è½´é‡ç½®ä¸ºå…¶åˆå§‹çŠ¶æ€ã€‚</p></li><li><p><mark>è·å–æ•°æ®</mark>ï¼šå¦‚æœ Effect å°†ä¼šè·å–æ•°æ®ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥è¦ä¹ˆ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController">ä¸­æ­¢è¯¥æ•°æ®è·å–æ“ä½œ</a>ï¼Œè¦ä¹ˆå¿½ç•¥å…¶ç»“æœï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cd4g18lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cd4g18lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startFetching</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchTodos</span>(userId);<br>    <span class="hljs-keyword">if</span> (!ignore) &#123;<br>      <span class="hljs-title function_">setTodos</span>(json);<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">startFetching</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>    ignore = <span class="hljs-literal">true</span>;<br>  &#125;;<br>&#125;, [userId]);<br></code></pre></td></tr></table></div></figure><p>æˆ‘ä»¬æ— æ³•æ’¤æ¶ˆå·²ç»å‘ç”Ÿçš„ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯æ¸…ç†å‡½æ•°åº”å½“ç¡®ä¿è·å–æ•°æ®çš„è¿‡ç¨‹ä»¥åŠè·å–åˆ°çš„ç»“æœä¸ä¼šç»§ç»­å½±å“ç¨‹åºè¿è¡Œã€‚å¦‚æœ <code>userId</code> ä» <code>&#39;Alice&#39;</code> å˜ä¸º <code>&#39;Bob&#39;</code>ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿ <code>&#39;Alice&#39;</code> å“åº”æ•°æ®è¢«å¿½ç•¥ï¼Œå³ä½¿å®ƒåœ¨ <code>&#39;Bob&#39;</code> ä¹‹ååˆ°è¾¾ã€‚</p><p><strong>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæµè§ˆå™¨è°ƒè¯•å·¥å…·çš„â€œç½‘ç»œâ€é€‰é¡¹å¡ä¸­ä¼šå‡ºç°ä¸¤ä¸ª fetch è¯·æ±‚</strong>ã€‚è¿™æ˜¯æ­£å¸¸çš„ã€‚ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ª Effect å°†ç«‹å³è¢«æ¸…ç†ï¼Œè€Œ <code>ignore</code> å°†è¢«è®¾ç½®ä¸º <code>true</code>ã€‚å› æ­¤ï¼Œå³ä½¿æœ‰é¢å¤–çš„è¯·æ±‚ï¼Œç”±äºæœ‰ <code>if (!ignore)</code> åˆ¤æ–­æ£€æŸ¥ï¼Œä¹Ÿä¸ä¼šå½±å“ç¨‹åºçŠ¶æ€ã€‚</p><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåªä¼šæ˜¾ç¤ºå‘é€äº†ä¸€æ¡è·å–è¯·æ±‚</strong>ã€‚å¦‚æœå¼€å‘ç¯å¢ƒä¸­ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ç»™ä½ é€ æˆäº†å›°æ‰°ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ç§å¯ä»¥åˆ é™¤é‡å¤è¯·æ±‚ã€å¹¶ç¼“å­˜è¯·æ±‚å“åº”çš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-lg51m2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-lg51m2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> todos = <span class="hljs-title function_">useSomeDataLibrary</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">$&#123;userId&#125;</span>/todos`</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ä»…å¯ä»¥æé«˜å¼€å‘ä½“éªŒï¼Œè¿˜å¯ä»¥è®©ä½ çš„åº”ç”¨ç¨‹åºé€Ÿåº¦æ›´å¿«ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶ï¼Œå¦‚æœæ•°æ®å·²ç»è¢«ç¼“å­˜äº†ï¼Œé‚£ä¹ˆå°±ä¸å¿…å†æ¬¡ç­‰å¾…åŠ è½½ã€‚ä½ å¯ä»¥è‡ªå·±æ„å»ºè¿™æ ·çš„ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¾ˆå¤šåœ¨ Effect ä¸­æ‰‹åŠ¨åŠ è½½æ•°æ®çš„æ›¿ä»£æ–¹æ³•ã€‚</p><ul><li><p>Effect ä¸­æœ‰å“ªäº›å¥½çš„æ•°æ®è·å–æ›¿ä»£æ–¹æ¡ˆï¼Ÿ</p><p>åœ¨ Effect ä¸­è°ƒç”¨ <code>fetch</code> è¯·æ±‚æ•°æ® <a href="https://www.robinwieruch.de/react-hooks-fetch-data/">æ˜¯ä¸€ç§éå¸¸å—æ¬¢è¿çš„æ–¹å¼</a>ï¼Œç‰¹åˆ«æ˜¯åœ¨å®¢æˆ·ç«¯åº”ç”¨ä¸­ã€‚ç„¶è€Œï¼Œå®ƒéå¸¸ä¾èµ–æ‰‹åŠ¨æ“ä½œï¼Œæœ‰å¾ˆå¤šçš„ç¼ºç‚¹ï¼š</p><ul><li><strong>Effect ä¸èƒ½åœ¨æœåŠ¡ç«¯æ‰§è¡Œ</strong>ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨æœ€åˆä¼ é€’çš„ HTML ä¸ä¼šåŒ…å«ä»»ä½•æ•°æ®ã€‚å®¢æˆ·ç«¯çš„æµè§ˆå™¨å¿…é¡»ä¸‹è½½æ‰€æœ‰ JavaScript è„šæœ¬æ¥æ¸²æŸ“åº”ç”¨ç¨‹åºï¼Œç„¶åæ‰èƒ½åŠ è½½æ•°æ®â€”â€”è¿™å¹¶ä¸æç¬‘ã€‚</li><li><strong>ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®å®¹æ˜“äº§ç”Ÿç½‘ç»œç€‘å¸ƒï¼ˆnetwork waterfallï¼‰</strong>ã€‚é¦–å…ˆæ¸²æŸ“äº†çˆ¶ç»„ä»¶ï¼Œå®ƒä¼šè·å–ä¸€äº›æ•°æ®å¹¶è¿›è¡Œæ¸²æŸ“ï¼›ç„¶åæ¸²æŸ“å­ç»„ä»¶ï¼Œæ¥ç€å­ç»„ä»¶å¼€å§‹è·å–å®ƒä»¬çš„æ•°æ®ã€‚å¦‚æœç½‘ç»œé€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œè¿™ç§æ–¹å¼æ¯”åŒæ—¶è·å–æ‰€æœ‰æ•°æ®è¦æ…¢å¾—å¤šã€‚</li><li><strong>ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®é€šå¸¸æ„å‘³ç€æ— æ³•é¢„åŠ è½½æˆ–ç¼“å­˜æ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»„ä»¶å¸è½½åç„¶åå†æ¬¡æŒ‚è½½ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»å†æ¬¡è·å–æ•°æ®ã€‚</li><li><strong>è¿™ä¸æ˜¯å¾ˆç¬¦åˆäººæœºäº¤äº’åŸåˆ™</strong>ã€‚å¦‚æœä½ ä¸æƒ³å‡ºç°åƒ <a href="https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect">æ¡ä»¶ç«äº‰ï¼ˆrace conditionï¼‰</a> ä¹‹ç±»çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½ éœ€è¦ç¼–å†™æ›´å¤šçš„æ ·æ¿ä»£ç ã€‚</li></ul><p>ä»¥ä¸Šæ‰€åˆ—å‡ºæ¥çš„ç¼ºç‚¹å¹¶ä¸æ˜¯ React ç‰¹æœ‰çš„ã€‚åœ¨ä»»ä½•æ¡†æ¶æˆ–è€…åº“ä¸Šçš„ç»„ä»¶æŒ‚è½½è¿‡ç¨‹ä¸­è·å–æ•°æ®ï¼Œéƒ½ä¼šé‡åˆ°è¿™äº›é—®é¢˜ã€‚ä¸è·¯ç”±ä¸€æ ·ï¼Œè¦åšå¥½æ•°æ®è·å–å¹¶éæ˜“äº‹ï¼Œå› æ­¤æˆ‘ä»¬æ¨èä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><strong>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ <a href="https://zh-hans.react.dev/learn/start-a-new-react-project#production-grade-react-frameworks">æ¡†æ¶</a> ï¼Œä½¿ç”¨å…¶å†…ç½®çš„æ•°æ®è·å–æœºåˆ¶</strong>ã€‚ç°ä»£ React æ¡†æ¶é›†æˆäº†é«˜æ•ˆçš„æ•°æ®è·å–æœºåˆ¶ï¼Œä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚</li><li><strong>å¦åˆ™ï¼Œè¯·è€ƒè™‘ä½¿ç”¨æˆ–æ„å»ºå®¢æˆ·ç«¯ç¼“å­˜</strong>ã€‚ç›®å‰å—æ¬¢è¿çš„å¼€æºè§£å†³æ–¹æ¡ˆæ˜¯ <a href="https://tanstack.com/query/latest">React Query</a>ã€<a href="https://swr.vercel.app/">useSWR</a> å’Œ <a href="https://beta.reactrouter.com/en/main/start/overview">React Router v6.4+</a>ã€‚ä½ ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨å¹•åä½¿ç”¨ Effectï¼Œä½†æ˜¯è¯·æ³¨æ„æ·»åŠ ç”¨äºåˆ é™¤é‡å¤è¯·æ±‚ã€ç¼“å­˜å“åº”å’Œé¿å…ç½‘ç»œç€‘å¸ƒï¼ˆé€šè¿‡é¢„åŠ è½½æ•°æ®æˆ–å°†æ•°æ®éœ€æ±‚æå‡åˆ°è·¯ç”±ï¼‰çš„é€»è¾‘ã€‚</li></ul><p>å¦‚æœè¿™äº›æ–¹æ³•éƒ½ä¸é€‚åˆä½ ï¼Œä½ å¯ä»¥ç»§ç»­ç›´æ¥åœ¨ Effect ä¸­è·å–æ•°æ®ã€‚</p></li></ul></li><li><p><mark>å‘é€åˆ†ææŠ¥å‘Š</mark>ï¼šè€ƒè™‘åœ¨è®¿é—®é¡µé¢æ—¶å‘é€æ—¥å¿—åˆ†æï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e5qetrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e5qetrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">logVisit</span>(url); <span class="hljs-comment">/*  å‘é€ POST è¯·æ±‚  */</span><br>&#125;, [url]);<br></code></pre></td></tr></table></div></figure><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œ<code>logVisit</code> ä¼šä¸ºæ¯ä¸ª URL å‘é€ä¸¤æ¬¡è¯·æ±‚ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šæƒ³å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<strong>ä¸è¿‡æˆ‘ä»¬å»ºè®®ä¸å¿…ä¿®æ”¹æ­¤å¤„ä»£ç </strong>ï¼Œä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè¿è¡Œä¸€æ¬¡å’Œè¿è¡Œä¸¤æ¬¡ä¹‹é—´ä¸ä¼š <strong>æ„ŸçŸ¥</strong> åˆ°è¡Œä¸ºå·®å¼‚ã€‚ä»å®é™…çš„è§’åº¦æ¥çœ‹ï¼Œ<code>logVisit</code> ä¸åº”è¯¥åœ¨å¼€å‘ç¯å¢ƒä¸­åšä»»ä½•å½±å“ç”Ÿäº§äº‹æƒ…ã€‚ç”±äºæ¯æ¬¡ä¿å­˜ä»£ç æ–‡ä»¶æ—¶éƒ½ä¼šé‡æ–°æŒ‚è½½ç»„ä»¶ï¼Œå› æ­¤åœ¨å¼€å‘ç¯å¢ƒä¸­ä¼šé¢å¤–è®°å½•è®¿é—®æ¬¡æ•°ã€‚</p><p><strong>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ä¼šäº§ç”Ÿæœ‰é‡å¤çš„è®¿é—®æ—¥å¿—</strong>ã€‚</p><p>ä¸ºäº†è°ƒè¯•å‘é€çš„åˆ†æäº‹ä»¶ï¼Œå¯ä»¥å°†åº”ç”¨éƒ¨ç½²åˆ°ä¸€ä¸ªè¿è¡Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹çš„æš‚å­˜ç¯å¢ƒï¼Œæˆ–è€…æš‚æ—¶å–æ¶ˆ <a href="https://zh-hans.react.dev/reference/react/StrictMode">ä¸¥æ ¼æ¨¡å¼</a> åŠå…¶ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­é‡æ–°åŠ è½½æ£€æŸ¥ï¼›è¿˜å¯ä»¥ä»è·¯ç”±å˜æ›´äº‹ä»¶å¤„ç†ç¨‹åºä¸­å‘é€åˆ†ææ•°æ®ï¼Œè€Œä¸æ˜¯ä» Effect ä¸­å‘é€ã€‚ä¸ºäº†æ›´ç²¾ç¡®çš„åˆ†æï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API">Intersection Observer</a> æ¥è·Ÿè¸ªå“ªäº›ç»„ä»¶ä½äºè§†å£ä¸­ä»¥åŠå®ƒä»¬ä¿æŒå¯è§çš„æ—¶é—´ã€‚</p></li><li><p><mark>åˆå§‹åŒ–åº”ç”¨æ—¶ä¸éœ€è¦ä½¿ç”¨ Effect çš„æƒ…å½¢</mark>ï¼šæŸäº›é€»è¾‘åº”è¯¥åªåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ï¼ŒéªŒè¯ç™»é™†çŠ¶æ€å’ŒåŠ è½½æœ¬åœ°ç¨‹åºæ•°æ®ã€‚ä½ å¯ä»¥å°†å…¶æ”¾åœ¨ç»„ä»¶ä¹‹å¤–ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p2bh07lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p2bh07lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123; <span class="hljs-comment">/*  æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ  */</span> <br>  <span class="hljs-title function_">checkAuthToken</span>();  <span class="hljs-title function_">loadDataFromLocalStorage</span>();<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¿è¯äº†è¿™ç§é€»è¾‘åœ¨æµè§ˆå™¨åŠ è½½é¡µé¢ååªè¿è¡Œä¸€æ¬¡ã€‚</p></li><li><p><mark>ä¸è¦åœ¨ Effect ä¸­æ‰§è¡Œè´­ä¹°å•†å“ä¸€ç±»çš„æ“ä½œ</mark>ï¼šæœ‰æ—¶ï¼Œå³ä½¿ç¼–å†™äº†ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œä¹Ÿä¸èƒ½é¿å…æ‰§è¡Œä¸¤æ¬¡ Effectã€‚ä¾‹å¦‚ï¼ŒEffect åŒ…å«ä¼šå‘é€ POST è¯·æ±‚ä»¥æ‰§è¡Œè´­ä¹°æ“ä½œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-082bk0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-082bk0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  ğŸ”´ é”™è¯¯ï¼šæ­¤å¤„çš„ Effect ä¼šåœ¨å¼€å‘ç¯å¢ƒä¸­æ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™åœ¨ä»£ç ä¸­æ˜¯æœ‰é—®é¢˜çš„ã€‚  */</span> <br>  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/buy&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span> &#125;);<br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>ä¸€æ–¹é¢ï¼Œå¼€å‘ç¯å¢ƒä¸‹ï¼ŒEffect ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œè¿™æ„å‘³ç€è´­ä¹°æ“ä½œæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œä½†æ˜¯è¿™å¹¶éæ˜¯é¢„æœŸçš„ç»“æœï¼Œæ‰€ä»¥ä¸åº”è¯¥æŠŠè¿™ä¸ªä¸šåŠ¡é€»è¾‘æ”¾åœ¨ Effect ä¸­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç”¨æˆ·è½¬åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œç„¶åæŒ‰â€œåé€€â€æŒ‰é’®å›åˆ°äº†è¿™ä¸ªç•Œé¢ï¼Œè¯¥æ€ä¹ˆåŠï¼ŸEffect ä¼šéšç€ç»„ä»¶å†æ¬¡æŒ‚è½½è€Œå†æ¬¡æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·é‡æ–°è®¿é—®æŸä¸ªé¡µé¢æ—¶ï¼Œä¸åº”å½“æ‰§è¡Œè´­ä¹°æ“ä½œï¼›å½“åªæœ‰ç”¨æˆ·ç‚¹å‡»â€œè´­ä¹°â€æŒ‰é’®æ—¶ï¼Œæ‰æ‰§è¡Œè´­ä¹°æ“ä½œã€‚</p><p>å› æ­¤ï¼Œâ€œè´­ä¹°â€çš„æ“ä½œä¸åº”ç”±ç»„ä»¶çš„æŒ‚è½½ã€æ¸²æŸ“å¼•èµ·çš„ï¼›å®ƒæ˜¯ç”±ç‰¹å®šçš„äº¤äº’ä½œç”¨å¼•èµ·çš„ï¼Œå®ƒåº”è¯¥åªåœ¨ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶è¿è¡Œã€‚å› æ­¤ï¼Œ<strong>å®ƒä¸åº”è¯¥å†™åœ¨ Effect ä¸­ï¼Œåº”å½“æŠŠ <code>/api/buy</code> è¯·æ±‚æ“ä½œç§»åŠ¨åˆ°è´­ä¹°æŒ‰é’®äº‹ä»¶å¤„ç†ç¨‹åºä¸­</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a9mywmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a9mywmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">/*  âœ… è´­ä¹°å•†å“åº”å½“åœ¨äº‹ä»¶ä¸­æ‰§è¡Œï¼Œå› ä¸ºè¿™æ˜¯ç”±ç‰¹å®šçš„æ“ä½œå¼•èµ·çš„ã€‚  */</span> <br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/buy&#x27;</span>, &#123; <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span> &#125;);<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>è¿™ä¸ªä¾‹å­è¯´æ˜å¦‚æœé‡æ–°æŒ‚è½½ç ´åäº†åº”ç”¨ç¨‹åºçš„é€»è¾‘ï¼Œåˆ™é€šå¸¸å«æœ‰æœªè¢«å‘ç°çš„é”™è¯¯</strong>ã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®ä¸€ä¸ªé¡µé¢ä¸åº”è¯¥ä¸è®¿é—®å®ƒã€ç‚¹å‡»é“¾æ¥ç„¶åæŒ‰ä¸‹è¿”å›é”®å†æ¬¡æŸ¥çœ‹é¡µé¢æœ‰ä»€ä¹ˆä¸åŒã€‚React é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­é‡å¤æŒ‚è½½ç»„ä»¶ä»¥éªŒè¯ç»„ä»¶æ˜¯å¦éµå®ˆæ­¤åŸåˆ™ã€‚</p></li></ol><p>ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setTimeout"><code>setTimeout</code></a> æ¥å®‰æ’æ§åˆ¶å°æ—¥å¿—ï¼Œåœ¨ Effect è¿è¡Œåä¸‰ç§’é’Ÿæ˜¾ç¤ºè¾“å…¥æ–‡æœ¬ã€‚æ¸…ç†å‡½æ•°ä¼šå–æ¶ˆæŒ‚èµ·çš„è¶…æ—¶ã€‚ä»æŒ‰ä¸‹â€œæŒ‚è½½ç»„ä»¶â€å¼€å§‹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8yrcohlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8yrcohlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Playground</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onTimeout</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;â° &#x27;</span> + text);<br>    &#125;<br><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ğŸ”µ å®‰æ’ &quot;&#x27;</span> + text + <span class="hljs-string">&#x27;&quot; æ—¥å¿—&#x27;</span>);<br>    <span class="hljs-keyword">const</span> timeoutId = <span class="hljs-built_in">setTimeout</span>(onTimeout, <span class="hljs-number">3000</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ğŸŸ¡ å–æ¶ˆ &quot;&#x27;</span> + text + <span class="hljs-string">&#x27;&quot; æ—¥å¿—&#x27;</span>);<br>      <span class="hljs-built_in">clearTimeout</span>(timeoutId);<br>    &#125;;<br>  &#125;, [text]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        æ—¥å¿—å†…å®¹ï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;text&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setText(e.target.value)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;text&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(!show)&#125;&gt;</span><br><span class="language-xml">        &#123;show ? &#x27;å¸è½½&#x27; : &#x27;æŒ‚è½½&#x27;&#125; ç»„ä»¶</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Playground</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨æœ€å¼€å§‹æ—¶å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ—¥å¿—è¾“å‡ºï¼š<code>å®‰æ’ &quot;a&quot; æ—¥å¿—</code>ï¼Œ<code>å–æ¶ˆ &quot;a&quot; æ—¥å¿—</code>ï¼Œè¿˜æœ‰ä¸€ä¸ª <code>å®‰æ’ &quot;a&quot; æ—¥å¿—</code>ã€‚ä¸‰ç§’åï¼Œè¿˜ä¼šæœ‰ä¸€æ¡æ—¥å¿—æ˜¾ç¤ºï¼š<code>a</code>ã€‚æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œé¢å¤–çš„å®‰æ’&#x2F;å–æ¶ˆåŠ¨ä½œäº§ç”Ÿçš„åŸå› æ˜¯å› ä¸º React åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œä¼šé‡æ–°æŒ‚è½½ç»„ä»¶ä¸€æ¬¡ï¼Œä»¥éªŒè¯ä½ æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†æ¸…ç†å‡½æ•°ã€‚</p><p>ç°åœ¨ç¼–è¾‘è¾“å…¥æ¡†ï¼Œè¾“å…¥ <code>abc</code>ã€‚å¦‚æœè¾“å…¥é€Ÿåº¦è¶³å¤Ÿå¿«ï¼Œä½ ä¼šçœ‹åˆ° <code>å®‰æ’ &quot;ab&quot; æ—¥å¿—</code>ï¼Œç´§æ¥ç€çš„æ˜¯ <code>å–æ¶ˆ &quot;ab&quot; æ—¥å¿—</code> å’Œ <code>å®‰æ’ &quot;abc&quot; æ—¥å¿—</code>ã€‚<strong>React æ€»æ˜¯åœ¨æ‰§è¡Œä¸‹ä¸€è½®æ¸²æŸ“çš„ Effect ä¹‹å‰æ¸…ç†ä¸Šä¸€è½®æ¸²æŸ“çš„ Effect</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿ä½ å¿«é€Ÿè¾“å…¥ï¼Œæœ€å¤šä¹Ÿåªæœ‰ä¸€ä¸ªå®‰æ’æ“ä½œã€‚</p><p>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€äº›å†…å®¹ï¼Œç„¶åç«‹å³æŒ‰ä¸‹â€œå¸è½½ç»„ä»¶â€æŒ‰é’®ã€‚æ³¨æ„å¸è½½æ—¶å¦‚ä½•æ¸…ç†æœ€åä¸€è½®æ¸²æŸ“çš„ Effectã€‚åœ¨è¿™é‡Œï¼Œå®ƒåœ¨è§¦å‘å¸è½½ä¹‹å‰ï¼Œæ¸…é™¤äº†æœ€åä¸€æ¬¡å®‰æ’æ“ä½œã€‚</p><p>æœ€åï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­æ³¨é‡Šæ‰æ¸…ç†å‡½æ•°ï¼Œè¿™æ ·å®‰æ’æ“ä½œå°±ä¸ä¼šè¢«å–æ¶ˆã€‚å°è¯•å¿«é€Ÿè¾“å…¥ <code>abcde</code>ã€‚ä½ é¢„æœŸä¸‰ç§’é’Ÿå†…ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè®¡æ—¶å™¨å®‰æ’å†…çš„ <code>console.log(text)</code> ä¼šæ‰“å° <strong>æœ€æ–°</strong> çš„ <code>text</code> å¹¶äº§ç”Ÿäº”ä¸ª <code>abcde</code> æ—¥å¿—å—ï¼ŸéªŒè¯ä½ çš„ç›´è§‰å§ï¼</p><p>ä¸‰ç§’åï¼Œä½ åº”è¯¥çœ‹åˆ°ä¸€ç³»åˆ—æ—¥å¿—ï¼š<code>a</code>ã€<code>ab</code>ã€<code>abc</code>ã€<code>abcd</code> ä¸ <code>abcde</code>ï¼Œè€Œä¸æ˜¯äº”ä¸ª <code>abcde</code>ã€‚<strong>æ¯ä¸ª Effect éƒ½ä¼šâ€œæ•è·â€å…¶å¯¹åº”æ¸²æŸ“çš„ <code>text</code> å€¼</strong>ã€‚<code>text</code> state å‘ç”Ÿå˜åŒ–å¹¶ä¸é‡è¦ï¼šæ¥è‡ª <code>text = &#39;ab&#39;</code> çš„æ¸²æŸ“çš„ Effect å§‹ç»ˆä¼šå¾—åˆ° <code>&#39;ab&#39;</code>ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªæ¸²æŸ“çš„ Effect éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚å¦‚æœä½ å¯¹è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„æ„Ÿåˆ°å¥½å¥‡ï¼Œä½ å¯ä»¥é˜…è¯»æœ‰å…³ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures">é—­åŒ…</a> çš„å†…å®¹ã€‚</p><hr><p>æŒ‚è½½åèšç„¦äºè¡¨å•å­—æ®µï¼šè¡¨å•ä¸­æ¸²æŸ“äº†ä¸€ä¸ª <code>&lt;MyInput /&gt;</code> ç»„ä»¶ã€‚</p><p>ä½¿ç”¨è¾“å…¥æ¡†çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLElement/focus"><code>focus()</code></a> æ–¹æ³•ï¼Œä»¥åœ¨ <code>MyInput</code> å‡ºç°åœ¨å±å¹•ä¸Šæ—¶è‡ªåŠ¨èšç„¦ã€‚å¦‚æœä½ ç†Ÿæ‚‰ <code>autoFocus</code> å±æ€§ï¼Œè¯·å‡è£…å®ƒä¸å­˜åœ¨ï¼šæˆ‘ä»¬æ­£åœ¨ä»å¤´å¼€å§‹é‡æ–°å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><p>è§£ç­”ï¼š<mark>åœ¨æ¸²æŸ“æœŸé—´è°ƒç”¨ <code>ref.current.focus()</code> æœ¬èº«æ˜¯ä¸æ­£ç¡®çš„ã€‚å› ä¸ºè¿™ä¼šäº§ç”Ÿâ€œå‰¯ä½œç”¨â€ã€‚å‰¯ä½œç”¨è¦ä¹ˆåº”è¯¥æ”¾åœ¨äº‹ä»¶å¤„ç†ç¨‹åºé‡Œé¢ï¼Œè¦ä¹ˆåœ¨ <code>useEffect</code> ä¸­</mark>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‰¯ä½œç”¨æ˜¯ç»„ä»¶æ¸²æŸ“å¼•èµ·çš„ï¼Œè€Œä¸æ˜¯ä»»ä½•ç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ï¼Œå› æ­¤åº”è¯¥å°†å®ƒæ”¾åœ¨ Effect ä¸­ã€‚</p><p>ä¸ºäº†ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼Œå¯ä»¥å¯¹ <code>ref.current.focus()</code> çš„è°ƒç”¨åŒ…è£¹åœ¨ Effect ä¸­ã€‚ç„¶åç¡®ä¿è¿™ä¸ª Effect åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œè€Œä¸æ˜¯åœ¨æ¯ä¸€è½®æ¸²æŸ“æ—¶éƒ½æ‰§è¡Œï¼Œå¯ä»¥ä¸º Effect çš„å£°æ˜åŠ ä¸€ä¸ªç©ºçš„ä¾èµ–æ•°ç»„ <code>[]</code>ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l4nrurlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l4nrurlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useEffect, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">&#123; value, onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;onChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="form.gif" alt="form" style="zoom:50%;" /><hr><p><mark>æœ‰æ¡ä»¶åœ°èšç„¦äºè¡¨å•</mark>ï¼šä¸‹é¢çš„è¡¨å•æ¸²æŸ“ä¸¤ä¸ª <code>&lt;MyInput /&gt;</code> ç»„ä»¶ã€‚</p><p>æŒ‰ä¸‹â€œå±•ç¤ºè¡¨å•â€ï¼ŒåŒæ—¶æ³¨æ„è‡ªåŠ¨èšç„¦äºç¬¬äºŒä¸ªè¾“å…¥æ¡†ï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ª <code>&lt;MyInput /&gt;</code> ç»„ä»¶éƒ½åœ¨è¯•å›¾æŠŠç„¦ç‚¹å¾€è‡ªèº«ä¸Šè½¬ç§»ã€‚<mark>å½“ä½ è¿ç»­ä¸ºä¸¤ä¸ªè¾“å…¥æ¡†è°ƒç”¨ <code>focus()</code> æ—¶ï¼Œæ€»æ˜¯èšç„¦äºæœ€åé¢çš„è¾“å…¥æ¡†</mark>ã€‚</p><p>å‡è®¾èšç„¦äºç¬¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œé‚£ä¹ˆï¼Œç¬¬ä¸€ä¸ª <code>MyInput</code> ç»„ä»¶ç°åœ¨æ¥æ”¶åˆ° <code>shouldFocus</code> å±æ€§ï¼Œå¹¶ä¸”åº”å½“è¢«è®¾ç½®ä¸º <code>true</code>ã€‚æ›´æ”¹ä¸‹ç¨‹åºé€»è¾‘ï¼Œè§„å®šä»…å½“ <code>MyInput</code> æ¥æ”¶åˆ°çš„ <code>shouldFocus</code> å±æ€§ä¸º <code>true</code> æ—¶æ‰è°ƒç”¨ <code>focus()</code> ã€‚</p><p>è§£ç­”ï¼šå‘ Effect ä¸­åŠ å…¥æ¡ä»¶é€»è¾‘ã€‚ç”±äº Effect ä½¿ç”¨äº† <code>shouldFocus</code>ï¼Œä½ éœ€è¦ä¸º Effect æŒ‡å®š <code>shouldFocus</code> è¿™ä¸ªä¾èµ–é¡¹ã€‚è¿™ä¹Ÿæ„å‘³ç€å¦‚æœè¾“å…¥æ¡†çš„ <code>shouldFocus</code> ç”± <code>false</code> å˜ä¸º <code>true</code> æ—¶ï¼Œå®ƒæ‰ä¼šåœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶è·å¾—ç„¦ç‚¹ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9trj3clqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9trj3clqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useEffect, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">&#123; shouldFocus, value, onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (shouldFocus) &#123;<br>      ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">focus</span>();<br>    &#125;<br>  &#125;, [shouldFocus]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;value&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;onChange&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="form2.gif" alt="form2" style="zoom:50%;" /><hr><p><mark>ä¿®å¤è®¡æ—¶å™¨è§¦å‘ä¸¤æ¬¡çš„é—®é¢˜</mark>ï¼šä¸‹é¢çš„ <code>Counter</code> ç»„ä»¶æ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œåº”è¯¥æ¯ç§’é€’å¢ä¸€æ¬¡ã€‚åœ¨ç»„ä»¶æŒ‚è½½æ—¶ï¼Œå®ƒè°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/setInterval"><code>setInterval</code></a>ã€‚è¿™ä¼šå¯¼è‡´ <code>onTick</code> æ¯ç§’è¿è¡Œä¸€æ¬¡ã€‚<code>onTick</code> å‡½æ•°ä¼šé€’å¢è®¡æ•°å™¨ã€‚</p><p>ç„¶è€Œï¼Œè®¡æ•°å™¨ä¸æ˜¯æ¯ç§’é€’å¢ä¸€æ¬¡ï¼Œè€Œæ˜¯ä¸¤æ¬¡ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ‰¾å‡ºé”™è¯¯çš„åŸå› å¹¶ä¿®å¤å®ƒã€‚</p><p>è§£ç­”ï¼šåœ¨ <a href="https://zh-hans.react.dev/reference/react/StrictMode">ä¸¥æ ¼æ¨¡å¼</a> ä¸‹ï¼ŒReact åœ¨å¼€å‘æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¼šé‡å¤æŒ‚è½½ä¸€æ¬¡ã€‚è¿™ä¹Ÿå°±å¯¼è‡´è®¡æ•°å™¨ç»„ä»¶è¢«æŒ‚è½½äº†ä¸¤æ¬¡ã€‚æ‰€ä»¥ï¼Œè®¡æ—¶å™¨ä¹Ÿè¢«è®¾ç«‹äº†ä¸¤æ¬¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¡æ•°å™¨æ¯ç§’é€’å¢ä¸¤æ¬¡çš„åŸå› ã€‚</p><p>ç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯ React æœ¬èº«çš„é”™ï¼šè€Œæ˜¯ Effect ä»£ç ä¸­æœ¬èº«å°±å­˜åœ¨é—®é¢˜ã€‚React åªä¸è¿‡æŠŠè¿™ä¸ªé—®é¢˜æ”¾å¤§äº†ã€‚çœŸæ­£çš„é”™è¯¯åŸå› æ˜¯è¿™æ ·çš„ Effect å¯åŠ¨åï¼Œä½†æ²¡æœ‰æä¾›æ¸…ç†å‡½æ•°ï¼Œæ‰€ä»¥ä¸Šä¸€æ¬¡çš„ Effect æ®‹ç•™å°±æ²¡æœ‰è¢«é™¤å»ã€‚</p><p>è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä¿å­˜ <code>setInterval</code> è¿”å›çš„ interval IDï¼Œå¹¶ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/clearInterval"><code>clearInterval</code></a> å®ç°ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v6pnpnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v6pnpnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onTick</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(onTick, <span class="hljs-number">1000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(intervalId);<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="count.gif" alt="count" style="zoom:50%;" /><p>åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä»ç„¶ä¼šé‡å¤æŒ‚è½½ä¸€æ¬¡ç»„ä»¶ï¼Œé€šè¿‡æ”¾å¤§é—®é¢˜ï¼Œä»¥ç¡®ä¿å·²ç»æ­£ç¡®åœ°å®ç°äº†æ¸…ç†å‡½æ•°ã€‚è¿™æ ·ï¼Œè°ƒç”¨ä¸€æ¬¡ <code>setInterval</code> åå°±ç´§æ¥ç€è°ƒç”¨ <code>clearInterval</code>ï¼Œç„¶åå†è°ƒç”¨ <code>setInterval</code>ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å¼€å‘ç¯å¢ƒä¸åŒï¼ŒReact åªæŒ‚è½½ä¸€æ¬¡ç»„ä»¶ï¼Œå³åªè°ƒç”¨ä¸€æ¬¡ <code>setInterval</code>ã€‚ä¸¤ç§æƒ…å†µä¸‹ç”¨æˆ·æ„ŸçŸ¥çš„æ•ˆæœæ˜¯ç›¸åŒçš„ï¼šè®¡æ•°å™¨æ¯ç§’é€’å¢ä¸€æ¬¡ã€‚</p><hr><p>ä¿®å¤åœ¨ Effect ä¸­è·å–æ•°æ®çš„é—®é¢˜ï¼šä¸‹é¢è¿™ä¸ªç»„ä»¶æ˜¾ç¤ºæ‰€é€‰äººç‰©çš„ä¼ è®°ã€‚å®ƒåœ¨æŒ‚è½½æ—¶å’Œæ¯å½“ <code>person</code> æ”¹å˜æ—¶é€šè¿‡è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>fetchBio(person)</code> æ¥åŠ è½½ä¼ è®°ã€‚è¯¥å¼‚æ­¥å‡½æ•°è¿”å›ä¸€ä¸ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>ï¼Œæœ€ç»ˆè§£æä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å½“è·å–å®Œæˆæ—¶ï¼Œå®ƒè°ƒç”¨ <code>setBio</code> ä»¥å°†è¯¥å­—ç¬¦ä¸²æ˜¾ç¤ºåœ¨é€‰æ‹©æ¡†ä¸‹æ–¹ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-16tb3flqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-16tb3flqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; fetchBio &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./api.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [person, setPerson] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Alice&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [bio, setBio] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setBio</span>(<span class="hljs-literal">null</span>);<br>    <span class="hljs-title function_">fetchBio</span>(person).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> &#123;<br>      <span class="hljs-title function_">setBio</span>(result);<br>    &#125;);<br>  &#125;, [person]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;person&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> &#123;</span><br><span class="language-xml">        setPerson(e.target.value);</span><br><span class="language-xml">      &#125;&#125;&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Alice&quot;</span>&gt;</span>Alice<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Bob&quot;</span>&gt;</span>Bob<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Taylor&quot;</span>&gt;</span>Taylor<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>&#123;bio ?? &#x27;åŠ è½½ä¸­â€¦â€¦&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="bio.gif" alt="bio" style="zoom:50%;" /><p>è¿™æ®µä»£ç ä¸­æœ‰ä¸€ä¸ªé”™è¯¯ã€‚è¯•è¯•é¦–å…ˆé€‰æ‹© <code>Alice</code>ï¼Œç„¶åé€‰æ‹© <code>Bob</code>ï¼Œç„¶åç´§æ¥ç€é€‰æ‹© <code>Taylor</code>ã€‚å¦‚æœæ“ä½œå¾—è¶³å¤Ÿå¿«ï¼Œä¼šæ³¨æ„åˆ°è¿™ä¸ªé”™è¯¯ï¼šTaylor è¢«é€‰ä¸­äº†ï¼Œä½†ä¸‹é¢çš„ä¸€æ®µå´è¯´ï¼šâ€œè¿™æ˜¯Bobçš„ä¼ è®°ã€‚â€</p><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">å¦‚æœ Effect éœ€è¦å¼‚æ­¥è·å–æŸäº›æ•°æ®ï¼Œå®ƒé€šå¸¸éœ€è¦æ¸…ç†å‡½æ•°ã€‚</p><p>è§£ç­”ï¼šè§¦å‘é—®é¢˜æ—¶ï¼Œç¨‹åºçš„æŒ‡ä»¤åºåˆ—æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é€‰ä¸­ <code>&#39;Bob&#39;</code> è§¦å‘ <code>fetchBio(&#39;Bob&#39;)</code></li><li>é€‰ä¸­ <code>&#39;Taylor&#39;</code> è§¦å‘ <code>fetchBio(&#39;Taylor&#39;)</code></li><li><strong>åœ¨ <code>&#39;Bob&#39;</code> çš„æ•°æ®å®ŒæˆåŠ è½½ä¹‹å‰ï¼Œå°±å·²ç»å®Œæˆäº†å¯¹ <code>&#39;Taylor&#39;</code> çš„æ•°æ®çš„åŠ è½½</strong></li><li>åŠ è½½ <code>&#39;Taylor&#39;</code> æ•°æ®çš„ Effect è°ƒç”¨äº† <code>setBio(&#39;è¿™æ˜¯Taylorçš„ä¼ è®°&#39;)</code></li><li>åŠ è½½å®Œæˆ <code>&#39;Bob&#39;</code> çš„æ•°æ®</li><li>åŠ è½½ <code>&#39;Bob&#39;</code> æ•°æ®çš„ Effect è°ƒç”¨äº† <code>setBio(&#39;è¿™æ˜¯Bobçš„ä¼ è®°&#39;)</code></li></ul><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå³ä½¿ Taylor è¢«é€‰ä¸­äº†ï¼Œä½†æ˜¾ç¤ºçš„ä»ç„¶æ˜¯ Bob çš„æ•°æ®ã€‚è¿™ç§é—®é¢˜è¢«ç§°ä¹‹ä¸º <a href="https://en.wikipedia.org/wiki/Race_condition">æ¡ä»¶ç«äº‰</a>ï¼Œå› ä¸ºä¸¤ä¸ªå¼‚æ­¥æ“ä½œéƒ½åœ¨å½¼æ­¤ç«äº‰ï¼Œè°å…ˆè°åæ˜¯ä¸å¯é¢„æœŸçš„ã€‚</p><p>ä¸ºäº†ä¿®å¤è¿™ç§é—®é¢˜ï¼Œåœ¨ Effect ä¸­æ·»åŠ æ¸…ç†å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8ohwd8lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8ohwd8lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">setBio</span>(<span class="hljs-literal">null</span>);<br>    <span class="hljs-title function_">fetchBio</span>(person).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (!ignore) &#123;<br>            <span class="hljs-title function_">setBio</span>(result);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>        ignore = <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;, [person]);<br></code></pre></td></tr></table></div></figure><p>å…¶å®ï¼Œæ¯ä¸ª Effect éƒ½å¯ä»¥åœ¨é‡Œé¢è®¾ç½®ä¸€ä¸ª <code>ignore</code> æ ‡è®°å˜é‡ã€‚åœ¨æœ€å¼€å§‹ï¼Œ<code>ignore</code> è¢«è®¾ç½®ä¸º <code>false</code>ã€‚ç„¶è€Œï¼Œå½“ Effect æ‰§è¡Œæ¸…ç†å‡½æ•°åï¼ˆå°±åƒä½ é€‰ä¸­äº†åˆ—è¡¨ä¸­ä¸åŒçš„äººæ—¶ï¼‰ï¼Œ<code>ignore</code> å°±ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚æ‰€ä»¥æ­¤æ—¶è¯·æ±‚å®Œæˆçš„é¡ºåºå¹¶ä¸é‡è¦ã€‚åªæœ‰æœ€åé€‰ä¸­çš„äººåœ¨æ‰§è¡Œå®ƒçš„ Effect æ—¶ï¼Œ<code>ignore</code> ä¼šè¢«è®¾ä¸º <code>false</code>ï¼Œæ‰€ä»¥å®ƒä¼šè°ƒç”¨ <code>setBio(result)</code>ã€‚è€Œä¹‹å‰çš„ Effect éƒ½è¢«æ¸…ç†æ‰äº†ã€‚æ‰€ä»¥æ£€æŸ¥ <code>if (!ignore)</code> ä¼šé˜»æ­¢è°ƒç”¨ <code>setBio</code>ï¼š</p><ul><li>é€‰ä¸­ <code>&#39;Bob&#39;</code> è§¦å‘ <code>fetchBio(&#39;Bob&#39;)</code></li><li>é€‰ä¸­ <code>&#39;Taylor&#39;</code> è§¦å‘ <code>fetchBio(&#39;Taylor&#39;)</code>ï¼Œ<strong>ç„¶åæ¸…ç†ä¹‹å‰åŠ è½½ï¼ˆBobï¼‰æ•°æ®æ—¶çš„ Effect</strong></li><li>åœ¨åŠ è½½å®Œ <code>&#39;Bob&#39;</code> çš„æ•°æ® <strong>ä¹‹å‰</strong>ï¼Œå°±å·²ç»å®ŒæˆåŠ è½½ <code>&#39;Taylor&#39;</code> çš„æ•°æ®</li><li>æ¸²æŸ“ <code>&#39;Taylor&#39;</code> æ—¶çš„ Effect è°ƒç”¨ <code>setBio(&#39;è¿™æ˜¯Taylorçš„ä¼ è®°&#39;)</code></li><li>åŠ è½½å®Œæˆ <code>&#39;Bob&#39;</code> çš„æ•°æ®</li><li>æ¸²æŸ“ <code>&#39;Bob&#39;</code> æ—¶çš„ Effect ä¸ä¼šåšä»»ä½•äº‹æƒ…ï¼Œå› ä¸º <code>ignore</code> å·²ç»è¢«è®¾ä¸ºäº† <code>true</code>ã€‚</li></ul><p>é™¤äº†å¿½ç•¥è¿‡æ—¶ API è°ƒç”¨çš„ç»“æœå¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController"><code>AbortController</code></a> æ¥å–æ¶ˆä¸å†éœ€è¦çš„è¯·æ±‚ã€‚ç„¶è€Œï¼Œä»…é è¿™ä¸ªè¿˜ä¸è¶³ä»¥é˜²æ­¢ç«æ€-æ¡ä»¶ã€‚æ›´å¤šçš„å¼‚æ­¥æ­¥éª¤å¯èƒ½ä¼šåœ¨è·å–ä¹‹åé“¾æ¥èµ·æ¥ï¼Œå› æ­¤ä½¿ç”¨æ˜¾å¼æ ‡è®°ï¼Œå¦‚ <code>ignore</code> å˜é‡ï¼Œæ˜¯ä¿®å¤è¿™ç±»é—®é¢˜æœ€å¯é çš„æ–¹æ³•ã€‚</p><h2 id="4-ä½ å¯èƒ½ä¸éœ€è¦-Effect"><a href="#4-ä½ å¯èƒ½ä¸éœ€è¦-Effect" class="headerlink" title="4.ä½ å¯èƒ½ä¸éœ€è¦ Effect"></a>4.ä½ å¯èƒ½ä¸éœ€è¦ Effect</h2><p>Effect æ˜¯ React èŒƒå¼ä¸­çš„ä¸€ä¸ªé€ƒè„±æ–¹æ¡ˆã€‚å®ƒä»¬è®©ä½ å¯ä»¥ â€œé€ƒå‡ºâ€ React å¹¶ä½¿ç»„ä»¶å’Œä¸€äº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œæ¯”å¦‚é React ç»„ä»¶ã€ç½‘ç»œå’Œæµè§ˆå™¨ DOMã€‚å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œä½ æƒ³æ ¹æ® props æˆ– state çš„å˜åŒ–æ¥æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„ stateï¼‰ï¼Œä½ å°±ä¸åº”è¯¥ä½¿ç”¨ Effectã€‚ç§»é™¤ä¸å¿…è¦çš„ Effect å¯ä»¥è®©ä½ çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œè¿è¡Œå¾—æ›´å¿«ï¼Œå¹¶ä¸”æ›´å°‘å‡ºé”™ã€‚</p><p>æœ‰ä¸¤ç§ä¸å¿…ä½¿ç”¨ Effect çš„å¸¸è§æƒ…å†µï¼š</p><ul><li><strong>ä½ ä¸å¿…ä½¿ç”¨ Effect æ¥è½¬æ¢æ¸²æŸ“æ‰€éœ€çš„æ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³åœ¨å±•ç¤ºä¸€ä¸ªåˆ—è¡¨å‰å…ˆåšç­›é€‰ã€‚ä½ çš„ç›´è§‰å¯èƒ½æ˜¯å†™ä¸€ä¸ªå½“åˆ—è¡¨å˜åŒ–æ—¶æ›´æ–° state å˜é‡çš„ Effectã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä½æ•ˆçš„ã€‚å½“ä½ æ›´æ–°è¿™ä¸ª state æ—¶ï¼ŒReact é¦–å…ˆä¼šè°ƒç”¨ä½ çš„ç»„ä»¶å‡½æ•°æ¥è®¡ç®—åº”è¯¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å†…å®¹ã€‚ç„¶å React ä¼šæŠŠè¿™äº›å˜åŒ–â€œ<a href="https://zh-hans.react.dev/learn/render-and-commit">æäº¤</a>â€åˆ° DOM ä¸­æ¥æ›´æ–°å±å¹•ã€‚ç„¶å React ä¼šæ‰§è¡Œä½ çš„ Effectã€‚å¦‚æœä½ çš„ Effect ä¹Ÿç«‹å³æ›´æ–°äº†è¿™ä¸ª stateï¼Œå°±ä¼šé‡æ–°æ‰§è¡Œæ•´ä¸ªæµç¨‹ã€‚ä¸ºäº†é¿å…ä¸å¿…è¦çš„æ¸²æŸ“æµç¨‹ï¼Œåº”åœ¨ä½ çš„ç»„ä»¶é¡¶å±‚è½¬æ¢æ•°æ®ã€‚è¿™äº›ä»£ç ä¼šåœ¨ä½ çš„ props æˆ– state å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°æ‰§è¡Œã€‚</li><li><strong>ä½ ä¸å¿…ä½¿ç”¨ Effect æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶</strong>ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³åœ¨ç”¨æˆ·è´­ä¹°ä¸€ä¸ªäº§å“æ—¶å‘é€ä¸€ä¸ª <code>/api/buy</code> çš„ POST è¯·æ±‚å¹¶å±•ç¤ºä¸€ä¸ªæç¤ºã€‚åœ¨è¿™ä¸ªè´­ä¹°æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œä½ ç¡®åˆ‡åœ°çŸ¥é“ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä½†æ˜¯å½“ä¸€ä¸ª Effect è¿è¡Œæ—¶ï¼Œä½ å´ä¸çŸ¥é“ç”¨æˆ·åšäº†ä»€ä¹ˆï¼ˆä¾‹å¦‚ï¼Œç‚¹å‡»äº†å“ªä¸ªæŒ‰é’®ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ é€šå¸¸åº”è¯¥åœ¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†ç”¨æˆ·äº‹ä»¶ã€‚</li></ul><p>ä½  <strong>çš„ç¡®</strong> å¯ä»¥ä½¿ç”¨ Effect æ¥å’Œå¤–éƒ¨ç³»ç»Ÿ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#what-are-effects-and-how-are-they-different-from-events">åŒæ­¥</a> ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ª Effect æ¥ä¿æŒä¸€ä¸ª jQuery çš„ç»„ä»¶å’Œ React state ä¹‹é—´çš„åŒæ­¥ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Effect æ¥è·å–æ•°æ®ï¼šä¾‹å¦‚ï¼Œä½ å¯ä»¥åŒæ­¥å½“å‰çš„æŸ¥è¯¢æœç´¢å’ŒæŸ¥è¯¢ç»“æœã€‚è¯·è®°ä½ï¼Œæ¯”èµ·ç›´æ¥åœ¨ä½ çš„ç»„ä»¶ä¸­å†™ Effectï¼Œç°ä»£ <a href="https://zh-hans.react.dev/learn/start-a-new-react-project#production-grade-react-frameworks">æ¡†æ¶</a> æä¾›äº†æ›´åŠ é«˜æ•ˆçš„ï¼Œå†…ç½®çš„æ•°æ®è·å–æœºåˆ¶ã€‚</p><hr><p><mark>æ ¹æ® props æˆ– state æ¥æ›´æ–° state</mark>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ª state å˜é‡çš„ç»„ä»¶ï¼š<code>firstName</code> å’Œ <code>lastName</code>ã€‚ä½ æƒ³é€šè¿‡æŠŠå®ƒä»¬è”ç»“èµ·æ¥è®¡ç®—å‡º <code>fullName</code>ã€‚æ­¤å¤–ï¼Œæ¯å½“ <code>firstName</code> å’Œ <code>lastName</code> å˜åŒ–æ—¶ï¼Œä½ å¸Œæœ› <code>fullName</code> éƒ½èƒ½æ›´æ–°ã€‚ä½ çš„ç¬¬ä¸€ç›´è§‰å¯èƒ½æ˜¯æ·»åŠ ä¸€ä¸ª state å˜é‡ï¼š<code>fullName</code>ï¼Œå¹¶åœ¨ä¸€ä¸ª Effect ä¸­æ›´æ–°å®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fvnjgflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fvnjgflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Taylor&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Swift&#x27;</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šå¤šä½™çš„ state å’Œä¸å¿…è¦çš„ Effect  */</span> <br>  <span class="hljs-keyword">const</span> [fullName, setFullName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setFullName</span>(firstName + <span class="hljs-string">&#x27; &#x27;</span> + lastName);<br>  &#125;, [firstName, lastName]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¤§å¯ä¸å¿…è¿™ä¹ˆå¤æ‚ã€‚è€Œä¸”è¿™æ ·æ•ˆç‡ä¹Ÿä¸é«˜ï¼šå®ƒå…ˆæ˜¯ç”¨ <code>fullName</code> çš„æ—§å€¼æ‰§è¡Œäº†æ•´ä¸ªæ¸²æŸ“æµç¨‹ï¼Œç„¶åç«‹å³ä½¿ç”¨æ›´æ–°åçš„å€¼åˆé‡æ–°æ¸²æŸ“äº†ä¸€éã€‚è®©æˆ‘ä»¬ç§»é™¤ state å˜é‡å’Œ Effectï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d9i6lilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d9i6lilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Taylor&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Swift&#x27;</span>);<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šåœ¨æ¸²æŸ“æœŸé—´è¿›è¡Œè®¡ç®—  */</span> <br>  <span class="hljs-keyword">const</span> fullName = firstName + <span class="hljs-string">&#x27; &#x27;</span> + lastName;<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>å¦‚æœä¸€ä¸ªå€¼å¯ä»¥åŸºäºç°æœ‰çš„ props æˆ– state è®¡ç®—å¾—å‡ºï¼Œ<a href="https://zh-hans.react.dev/learn/choosing-the-state-structure#avoid-redundant-state">ä¸è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ª state</a>ï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“æœŸé—´ç›´æ¥è®¡ç®—è¿™ä¸ªå€¼</strong>ã€‚è¿™å°†ä½¿ä½ çš„ä»£ç æ›´å¿«ï¼ˆé¿å…äº†å¤šä½™çš„ â€œçº§è”â€ æ›´æ–°ï¼‰ã€æ›´ç®€æ´ï¼ˆç§»é™¤äº†ä¸€äº›ä»£ç ï¼‰ä»¥åŠæ›´å°‘å‡ºé”™ï¼ˆé¿å…äº†ä¸€äº›å› ä¸ºä¸åŒçš„ state å˜é‡ä¹‹é—´æ²¡æœ‰æ­£ç¡®åŒæ­¥è€Œå¯¼è‡´çš„é—®é¢˜ï¼‰ã€‚å¦‚æœè¿™ä¸ªè§‚ç‚¹å¯¹ä½ æ¥è¯´å¾ˆæ–°å¥‡ï¼Œ<a href="https://zh-hans.react.dev/learn/thinking-in-react#step-3-find-the-minimal-but-complete-representation-of-ui-state">React å“²å­¦</a> ä¸­è§£é‡Šäº†ä»€ä¹ˆå€¼åº”è¯¥ä½œä¸º stateã€‚</p><hr><p><mark>ç¼“å­˜æ˜‚è´µçš„è®¡ç®—</mark>ï¼šè¿™ä¸ªç»„ä»¶ä½¿ç”¨å®ƒæ¥æ”¶åˆ°çš„ props ä¸­çš„ <code>filter</code> å¯¹å¦ä¸€ä¸ª prop <code>todos</code> è¿›è¡Œç­›é€‰ï¼Œè®¡ç®—å¾—å‡º <code>visibleTodos</code>ã€‚ä½ çš„ç›´è§‰å¯èƒ½æ˜¯æŠŠç»“æœå­˜åˆ°ä¸€ä¸ª state ä¸­ï¼Œå¹¶åœ¨ Effect ä¸­æ›´æ–°å®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hdxw81lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hdxw81lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, filter &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [newTodo, setNewTodo] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šå¤šä½™çš„ state å’Œä¸å¿…è¦çš„ Effect  */</span><br>  <span class="hljs-keyword">const</span> [visibleTodos, setVisibleTodos] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">setVisibleTodos</span>(<span class="hljs-title function_">getFilteredTodos</span>(todos, filter));<br>  &#125;, [todos, filter]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å°±åƒä¹‹å‰çš„ä¾‹å­ä¸€æ ·ï¼Œè¿™æ—¢æ²¡æœ‰å¿…è¦ï¼Œä¹Ÿå¾ˆä½æ•ˆã€‚é¦–å…ˆï¼Œç§»é™¤ state å’Œ Effectï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ob22sxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ob22sxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, filter &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [newTodo, setNewTodo] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  âœ… å¦‚æœ getFilteredTodos() çš„è€—æ—¶ä¸é•¿ï¼Œè¿™æ ·å†™å°±å¯ä»¥äº†ã€‚  */</span> <br>  <span class="hljs-keyword">const</span> visibleTodos = <span class="hljs-title function_">getFilteredTodos</span>(todos, filter);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ®µä»£ç æ²¡æœ‰é—®é¢˜ï¼ä½†æ˜¯ï¼Œ<code>getFilteredTodos()</code> çš„è€—æ—¶å¯èƒ½ä¼šå¾ˆé•¿ï¼Œæˆ–è€…ä½ æœ‰å¾ˆå¤š <code>todos</code>ã€‚è¿™äº›æƒ…å†µä¸‹ï¼Œå½“ <code>newTodo</code> è¿™æ ·ä¸ç›¸å…³çš„ state å˜é‡å˜åŒ–æ—¶ï¼Œä½ å¹¶ä¸æƒ³é‡æ–°æ‰§è¡Œ <code>getFilteredTodos()</code>ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a> Hook ç¼“å­˜ï¼ˆæˆ–è€…è¯´ <a href="https://en.wikipedia.org/wiki/Memoization">è®°å¿†ï¼ˆmemoizeï¼‰</a>ï¼‰ä¸€ä¸ªæ˜‚è´µçš„è®¡ç®—ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-74n8ixlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-74n8ixlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useMemo, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, filter &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [newTodo, setNewTodo] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> visibleTodos = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/*  âœ… é™¤é todos æˆ– filter ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°æ‰§è¡Œ  */</span> <br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getFilteredTodos</span>(todos, filter);<br>  &#125;, [todos, filter]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æˆ–è€…å†™æˆä¸€è¡Œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ennfvilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ennfvilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useMemo, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">TodoList</span>(<span class="hljs-params">&#123; todos, filter &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [newTodo, setNewTodo] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  âœ… é™¤é todos æˆ– filter å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°æ‰§è¡Œ getFilteredTodos()  */</span> <br>  <span class="hljs-keyword">const</span> visibleTodos = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getFilteredTodos</span>(todos, filter), [todos, filter]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>è¿™ä¼šå‘Šè¯‰ Reactï¼Œé™¤é <code>todos</code> æˆ– <code>filter</code> å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸è¦é‡æ–°æ‰§è¡Œä¼ å…¥çš„å‡½æ•°</strong>ã€‚React ä¼šåœ¨åˆæ¬¡æ¸²æŸ“çš„æ—¶å€™è®°ä½ <code>getFilteredTodos()</code> çš„è¿”å›å€¼ã€‚åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œå®ƒä¼šæ£€æŸ¥ <code>todos</code> æˆ– <code>filter</code> æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœå®ƒä»¬è·Ÿä¸Šæ¬¡æ¸²æŸ“æ—¶ä¸€æ ·ï¼Œ<code>useMemo</code> ä¼šç›´æ¥è¿”å›å®ƒæœ€åä¿å­˜çš„ç»“æœã€‚å¦‚æœä¸ä¸€æ ·ï¼ŒReact å°†å†æ¬¡è°ƒç”¨ä¼ å…¥çš„å‡½æ•°ï¼ˆå¹¶ä¿å­˜å®ƒçš„ç»“æœï¼‰ã€‚</p><p>ä½ ä¼ å…¥ <a href="https://zh-hans.react.dev/reference/react/useMemo"><code>useMemo</code></a> çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œæ‰€ä»¥å®ƒä»…é€‚ç”¨äº <a href="https://zh-hans.react.dev/learn/keeping-components-pure">çº¯å‡½æ•°</a> åœºæ™¯ã€‚</p><hr><p><mark>å½“ props å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰ state </mark>ï¼š<code>ProfilePage</code> ç»„ä»¶æ¥æ”¶ä¸€ä¸ª propï¼š<code>userId</code>ã€‚é¡µé¢ä¸Šæœ‰ä¸€ä¸ªè¯„è®ºè¾“å…¥æ¡†ï¼Œä½ ç”¨äº†ä¸€ä¸ª stateï¼š<code>comment</code> æ¥ä¿å­˜å®ƒçš„å€¼ã€‚æœ‰ä¸€å¤©ï¼Œä½ å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“ä½ ä»ä¸€ä¸ªäººçš„ä¸ªäººèµ„æ–™å¯¼èˆªåˆ°å¦ä¸€ä¸ªæ—¶ï¼Œ<code>comment</code> æ²¡æœ‰è¢«é‡ç½®ã€‚è¿™å¯¼è‡´å¾ˆå®¹æ˜“ä¸å°å¿ƒæŠŠè¯„è®ºå‘é€åˆ°ä¸æ­£ç¡®çš„ä¸ªäººèµ„æ–™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ æƒ³åœ¨ <code>userId</code> å˜åŒ–æ—¶ï¼Œæ¸…é™¤ <code>comment</code> å˜é‡ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fokx2plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fokx2plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [comment, setComment] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šå½“ prop å˜åŒ–æ—¶ï¼Œåœ¨ Effect ä¸­é‡ç½® state  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setComment</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  &#125;, [userId]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½†è¿™æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸º <code>ProfilePage</code> å’Œå®ƒçš„å­ç»„ä»¶é¦–å…ˆä¼šç”¨æ—§å€¼æ¸²æŸ“ï¼Œç„¶åå†ç”¨æ–°å€¼é‡æ–°æ¸²æŸ“ã€‚å¹¶ä¸”è¿™æ ·åšä¹Ÿå¾ˆå¤æ‚ï¼Œå› ä¸ºä½ éœ€è¦åœ¨ <code>ProfilePage</code> é‡Œé¢ <strong>æ‰€æœ‰</strong> å…·æœ‰ state çš„ç»„ä»¶ä¸­éƒ½å†™è¿™æ ·çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯„è®ºåŒºçš„ UI æ˜¯åµŒå¥—çš„ï¼Œä½ å¯èƒ½ä¹Ÿæƒ³æ¸…é™¤åµŒå¥—çš„ comment stateã€‚</p><p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªç”¨æˆ·çš„ä¸ªäººèµ„æ–™ç»„ä»¶æä¾›ä¸€ä¸ªæ˜ç¡®çš„é”®æ¥å‘Šè¯‰ React å®ƒä»¬åŸåˆ™ä¸Šæ˜¯ <strong>ä¸åŒ</strong> çš„ä¸ªäººèµ„æ–™ç»„ä»¶ã€‚å°†ä½ çš„ç»„ä»¶æ‹†åˆ†ä¸ºä¸¤ä¸ªç»„ä»¶ï¼Œå¹¶ä»å¤–éƒ¨çš„ç»„ä»¶ä¼ é€’ä¸€ä¸ª <code>key</code> å±æ€§ç»™å†…éƒ¨çš„ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2ke96ylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2ke96ylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Profile</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">userId</span>=<span class="hljs-string">&#123;userId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;userId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Profile</span>(<span class="hljs-params">&#123; userId &#125;</span>) &#123;<br>  <span class="hljs-comment">// âœ… å½“ key å˜åŒ–æ—¶ï¼Œè¯¥ç»„ä»¶å†…çš„ comment æˆ–å…¶ä»– state ä¼šè‡ªåŠ¨è¢«é‡ç½®</span><br>  <span class="hljs-keyword">const</span> [comment, setComment] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>é€šå¸¸ï¼Œå½“åœ¨ç›¸åŒçš„ä½ç½®æ¸²æŸ“ç›¸åŒçš„ç»„ä»¶æ—¶ï¼ŒReact ä¼šä¿ç•™çŠ¶æ€ã€‚<strong>é€šè¿‡å°† <code>userId</code> ä½œä¸º <code>key</code> ä¼ é€’ç»™ <code>Profile</code> ç»„ä»¶ï¼Œä½¿  React å°†å…·æœ‰ä¸åŒ <code>userId</code> çš„ä¸¤ä¸ª <code>Profile</code> ç»„ä»¶è§†ä¸ºä¸¤ä¸ªä¸åº”å…±äº«ä»»ä½•çŠ¶æ€çš„ä¸åŒç»„ä»¶</strong>ã€‚æ¯å½“ keyï¼ˆè¿™é‡Œæ˜¯ <code>userId</code>ï¼‰å˜åŒ–æ—¶ï¼ŒReact å°†é‡æ–°åˆ›å»º DOMï¼Œå¹¶ <a href="https://zh-hans.react.dev/learn/preserving-and-resetting-state#option-2-resetting-state-with-a-key">é‡ç½®</a> <code>Profile</code> ç»„ä»¶å’Œå®ƒçš„æ‰€æœ‰å­ç»„ä»¶çš„ stateã€‚ç°åœ¨ï¼Œå½“åœ¨ä¸åŒçš„ä¸ªäººèµ„æ–™ä¹‹é—´å¯¼èˆªæ—¶ï¼Œ<code>comment</code> åŒºåŸŸå°†è‡ªåŠ¨è¢«æ¸…ç©ºã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰å¤–éƒ¨çš„ <code>ProfilePage</code> ç»„ä»¶è¢«å¯¼å‡ºå¹¶åœ¨é¡¹ç›®ä¸­å¯¹å…¶ä»–æ–‡ä»¶å¯è§ã€‚æ¸²æŸ“ <code>ProfilePage</code> çš„é‚£äº›ç»„ä»¶ä¸ç”¨ä¼ é€’ <code>key</code> ç»™å®ƒï¼šå®ƒä»¬åªéœ€æŠŠ <code>userId</code> ä½œä¸ºå¸¸è§„ prop ä¼ å…¥å³å¯ã€‚è€Œ <code>ProfilePage</code> å°†å…¶ä½œä¸º <code>key</code> ä¼ é€’ç»™å†…éƒ¨çš„ <code>Profile</code> ç»„ä»¶æ˜¯å®ƒçš„å®ç°ç»†èŠ‚è€Œå·²ã€‚</p><hr><p><mark>å½“ prop å˜åŒ–æ—¶è°ƒæ•´éƒ¨åˆ† state </mark>ï¼šæœ‰æ—¶å€™ï¼Œå½“ prop å˜åŒ–æ—¶ï¼Œä½ å¯èƒ½åªæƒ³é‡ç½®æˆ–è°ƒæ•´éƒ¨åˆ† state ï¼Œè€Œä¸æ˜¯æ‰€æœ‰ stateã€‚</p><p><code>List</code> ç»„ä»¶æ¥æ”¶ä¸€ä¸ª <code>items</code> åˆ—è¡¨ä½œä¸º propï¼Œç„¶åç”¨ state å˜é‡ <code>selection</code> æ¥ä¿æŒå·²é€‰ä¸­çš„é¡¹ã€‚å½“ <code>items</code> æ¥æ”¶åˆ°ä¸€ä¸ªä¸åŒçš„æ•°ç»„æ—¶ï¼Œä½ æƒ³å°† <code>selection</code> é‡ç½®ä¸º <code>null</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-iblydblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-iblydblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isReverse, setIsReverse] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [selection, setSelection] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šå½“ prop å˜åŒ–æ—¶ï¼Œåœ¨ Effect ä¸­è°ƒæ•´ state  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">setSelection</span>(<span class="hljs-literal">null</span>);<br>  &#125;, [items]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸å¤ªç†æƒ³ã€‚æ¯å½“ <code>items</code> å˜åŒ–æ—¶ï¼Œ<code>List</code> åŠå…¶å­ç»„ä»¶ä¼šå…ˆä½¿ç”¨æ—§çš„ <code>selection</code> å€¼æ¸²æŸ“ã€‚ç„¶å React ä¼šæ›´æ–° DOM å¹¶æ‰§è¡Œ Effectã€‚æœ€åï¼Œè°ƒç”¨ <code>setSelection(null)</code> å°†å¯¼è‡´ <code>List</code> åŠå…¶å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œé‡æ–°å¯åŠ¨æ•´ä¸ªæµç¨‹ã€‚</p><p>è®©æˆ‘ä»¬ä»åˆ é™¤ Effect å¼€å§‹ã€‚å–è€Œä»£ä¹‹çš„æ˜¯åœ¨æ¸²æŸ“æœŸé—´ç›´æ¥è°ƒæ•´ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-818pxblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-818pxblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isReverse, setIsReverse] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [selection, setSelection] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">/* å¥½ä¸€äº›ï¼šåœ¨æ¸²æŸ“æœŸé—´è°ƒæ•´ state   */</span> <br>  <span class="hljs-keyword">const</span> [prevItems, setPrevItems] = <span class="hljs-title function_">useState</span>(items);<br>  <span class="hljs-keyword">if</span> (items !== prevItems) &#123;<br>    <span class="hljs-title function_">setPrevItems</span>(items);<br>    <span class="hljs-title function_">setSelection</span>(<span class="hljs-literal">null</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åƒè¿™æ · <a href="https://zh-hans.react.dev/reference/react/useState#storing-information-from-previous-renders">å­˜å‚¨å‰åºæ¸²æŸ“çš„ä¿¡æ¯</a> å¯èƒ½å¾ˆéš¾ç†è§£ï¼Œä½†å®ƒæ¯”åœ¨ Effect ä¸­æ›´æ–°è¿™ä¸ª state è¦å¥½ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ç›´æ¥è°ƒç”¨äº† <code>setSelection</code>ã€‚å½“å®ƒæ‰§è¡Œåˆ° <code>return</code> è¯­å¥é€€å‡ºåï¼ŒReact å°† <strong>ç«‹å³</strong> é‡æ–°æ¸²æŸ“ <code>List</code>ã€‚æ­¤æ—¶ React è¿˜æ²¡æœ‰æ¸²æŸ“ <code>List</code> çš„å­ç»„ä»¶æˆ–æ›´æ–° DOMï¼Œè¿™ä½¿å¾— <code>List</code> çš„å­ç»„ä»¶å¯ä»¥è·³è¿‡æ¸²æŸ“æ—§çš„ <code>selection</code> å€¼ã€‚</p><p>åœ¨æ¸²æŸ“æœŸé—´æ›´æ–°ç»„ä»¶æ—¶ï¼ŒReact ä¼šä¸¢å¼ƒå·²ç»è¿”å›çš„ JSX å¹¶ç«‹å³å°è¯•é‡æ–°æ¸²æŸ“ã€‚ä¸ºäº†é¿å…éå¸¸ç¼“æ…¢çš„çº§è”é‡è¯•ï¼ŒReact åªå…è®¸åœ¨æ¸²æŸ“æœŸé—´æ›´æ–° <strong>åŒä¸€</strong> ç»„ä»¶çš„çŠ¶æ€ã€‚å¦‚æœä½ åœ¨æ¸²æŸ“æœŸé—´æ›´æ–°å¦ä¸€ä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œä½ ä¼šçœ‹åˆ°ä¸€æ¡æŠ¥é”™ä¿¡æ¯ã€‚æ¡ä»¶åˆ¤æ–­ <code>items !== prevItems</code> æ˜¯å¿…è¦çš„ï¼Œå®ƒå¯ä»¥é¿å…æ— é™å¾ªç¯ã€‚ä½ å¯ä»¥åƒè¿™æ ·è°ƒæ•´ stateï¼Œä½†ä»»ä½•å…¶ä»–å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚å˜åŒ– DOM æˆ–è®¾ç½®çš„å»¶æ—¶ï¼‰åº”è¯¥ç•™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°æˆ– Effect ä¸­ï¼Œä»¥ <a href="https://zh-hans.react.dev/learn/keeping-components-pure">ä¿æŒç»„ä»¶çº¯ç²¹</a>ã€‚</p><p><strong>è™½ç„¶è¿™ç§æ–¹å¼æ¯” Effect æ›´é«˜æ•ˆï¼Œä½†å¤§å¤šæ•°ç»„ä»¶ä¹Ÿä¸éœ€è¦å®ƒ</strong>ã€‚æ— è®ºä½ æ€ä¹ˆåšï¼Œæ ¹æ® props æˆ–å…¶ä»– state æ¥è°ƒæ•´ state éƒ½ä¼šä½¿æ•°æ®æµæ›´éš¾ç†è§£å’Œè°ƒè¯•ã€‚æ€»æ˜¯æ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡æ·»åŠ  <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect#resetting-all-state-when-a-prop-changes">key æ¥é‡ç½®æ‰€æœ‰ state</a>ï¼Œæˆ–è€… <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect#updating-state-based-on-props-or-state">åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æ‰€éœ€å†…å®¹</a>ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å­˜å‚¨å·²é€‰ä¸­çš„ <strong>item ID</strong> è€Œä¸æ˜¯å­˜å‚¨ï¼ˆå¹¶é‡ç½®ï¼‰å·²é€‰ä¸­çš„ <strong>item</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xwq6molqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xwq6molqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; items &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isReverse, setIsReverse] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> [selectedId, setSelectedId] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šåœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æ‰€éœ€å†…å®¹  */</span> <br>  <span class="hljs-keyword">const</span> selection = items.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> === selectedId) ?? <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨å®Œå…¨ä¸éœ€è¦ â€œè°ƒæ•´â€ state äº†ã€‚å¦‚æœåŒ…å«å·²é€‰ä¸­ ID çš„é¡¹å‡ºç°åœ¨åˆ—è¡¨ä¸­ï¼Œåˆ™ä»ç„¶ä¿æŒé€‰ä¸­çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¡¹ï¼Œåˆ™åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—çš„ <code>selection</code> å°†ä¼šæ˜¯ <code>null</code>ã€‚è¡Œä¸ºä¸åŒäº†ï¼Œä½†å¯ä»¥è¯´æ›´å¥½äº†ï¼Œå› ä¸ºå¤§å¤šæ•°å¯¹ <code>items</code> çš„æ›´æ”¹ä»å¯ä»¥ä¿æŒé€‰ä¸­çŠ¶æ€ã€‚</p><hr><p><mark>åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å…±äº«é€»è¾‘</mark>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªäº§å“é¡µé¢ï¼Œä¸Šé¢æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼ˆè´­ä¹°å’Œä»˜æ¬¾ï¼‰ï¼Œéƒ½å¯ä»¥è®©ä½ è´­ä¹°è¯¥äº§å“ã€‚å½“ç”¨æˆ·å°†äº§å“æ·»åŠ è¿›è´­ç‰©è½¦æ—¶ï¼Œä½ æƒ³æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ã€‚åœ¨ä¸¤ä¸ªæŒ‰é’®çš„ click äº‹ä»¶å¤„ç†å‡½æ•°ä¸­éƒ½è°ƒç”¨ <code>showNotification()</code> æ„Ÿè§‰æœ‰ç‚¹é‡å¤ï¼Œæ‰€ä»¥ä½ å¯èƒ½æƒ³æŠŠè¿™ä¸ªé€»è¾‘æ”¾åœ¨ä¸€ä¸ª Effect ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-maks7ulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-maks7ulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; product, addToCart &#125;</span>) &#123;<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šåœ¨ Effect ä¸­å¤„ç†å±äºäº‹ä»¶ç‰¹å®šçš„é€»è¾‘  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (product.<span class="hljs-property">isInCart</span>) &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">`å·²æ·»åŠ  <span class="hljs-subst">$&#123;product.name&#125;</span> è¿›è´­ç‰©è½¦ï¼`</span>);<br>    &#125;<br>  &#125;, [product]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleBuyClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">addToCart</span>(product);<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCheckoutClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">addToCart</span>(product);<br>    <span class="hljs-title function_">navigateTo</span>(<span class="hljs-string">&#x27;/checkout&#x27;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ª Effect æ˜¯å¤šä½™çš„ã€‚è€Œä¸”å¾ˆå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ çš„åº”ç”¨åœ¨é¡µé¢é‡æ–°åŠ è½½ä¹‹å‰ â€œè®°ä½â€ äº†è´­ç‰©è½¦ä¸­çš„äº§å“ã€‚å¦‚æœä½ æŠŠä¸€ä¸ªäº§å“æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­å¹¶åˆ·æ–°é¡µé¢ï¼Œé€šçŸ¥å°†å†æ¬¡å‡ºç°ã€‚æ¯æ¬¡åˆ·æ–°è¯¥äº§å“é¡µé¢æ—¶ï¼Œå®ƒéƒ½ä¼šå‡ºç°ã€‚è¿™æ˜¯å› ä¸º <code>product.isInCart</code> åœ¨é¡µé¢åŠ è½½æ—¶å·²ç»æ˜¯ <code>true</code> äº†ï¼Œæ‰€ä»¥ä¸Šé¢çš„ Effect æ¯æ¬¡éƒ½ä¼šè°ƒç”¨ <code>showNotification()</code>ã€‚</p><p><strong>å½“ä½ ä¸ç¡®å®šæŸäº›ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­è¿˜æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ—¶ï¼Œå…ˆè‡ªé—® ä¸ºä»€ä¹ˆ è¦æ‰§è¡Œè¿™äº›ä»£ç ã€‚Effect åªç”¨æ¥æ‰§è¡Œé‚£äº›æ˜¾ç¤ºç»™ç”¨æˆ·æ—¶ç»„ä»¶ éœ€è¦æ‰§è¡Œ çš„ä»£ç </strong>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šçŸ¥åº”è¯¥åœ¨ç”¨æˆ· <strong>æŒ‰ä¸‹æŒ‰é’®</strong> åå‡ºç°ï¼Œè€Œä¸æ˜¯å› ä¸ºé¡µé¢æ˜¾ç¤ºå‡ºæ¥æ—¶ï¼åˆ é™¤ Effect å¹¶å°†å…±äº«çš„é€»è¾‘æ”¾å…¥ä¸€ä¸ªè¢«ä¸¤ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨çš„å‡½æ•°ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vc7i9tlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vc7i9tlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductPage</span>(<span class="hljs-params">&#123; product, addToCart &#125;</span>) &#123;<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šäº‹ä»¶ç‰¹å®šçš„é€»è¾‘åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†  */</span> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">buyProduct</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">addToCart</span>(product);<br>    <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">`å·²æ·»åŠ  <span class="hljs-subst">$&#123;product.name&#125;</span> è¿›è´­ç‰©è½¦ï¼`</span>);<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleBuyClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">buyProduct</span>();<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCheckoutClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">buyProduct</span>();<br>    <span class="hljs-title function_">navigateTo</span>(<span class="hljs-string">&#x27;/checkout&#x27;</span>);<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ—¢ç§»é™¤äº†ä¸å¿…è¦çš„ Effectï¼Œåˆä¿®å¤äº†é—®é¢˜ã€‚</p><hr><p><mark>å‘é€ POST è¯·æ±‚ </mark>ï¼šè¿™ä¸ª <code>Form</code> ç»„ä»¶ä¼šå‘é€ä¸¤ç§ POST è¯·æ±‚ã€‚å®ƒåœ¨é¡µé¢åŠ è½½ä¹‹é™…ä¼šå‘é€ä¸€ä¸ªåˆ†æè¯·æ±‚ã€‚å½“ä½ å¡«å†™è¡¨æ ¼å¹¶ç‚¹å‡»æäº¤æŒ‰é’®æ—¶ï¼Œå®ƒä¼šå‘ <code>/api/register</code> æ¥å£å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bqocgalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bqocgalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šè¿™ä¸ªé€»è¾‘åº”è¯¥åœ¨ç»„ä»¶æ˜¾ç¤ºæ—¶æ‰§è¡Œ  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/analytics/event&#x27;</span>, &#123; <span class="hljs-attr">eventName</span>: <span class="hljs-string">&#x27;visit_form&#x27;</span> &#125;);<br>  &#125;, []);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šåœ¨ Effect ä¸­å¤„ç†å±äºäº‹ä»¶ç‰¹å®šçš„é€»è¾‘  */</span> <br>  <span class="hljs-keyword">const</span> [jsonToSubmit, setJsonToSubmit] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (jsonToSubmit !== <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/register&#x27;</span>, jsonToSubmit);<br>    &#125;<br>  &#125;, [jsonToSubmit]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-title function_">setJsonToSubmit</span>(&#123; firstName, lastName &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è®©æˆ‘ä»¬åº”ç”¨ä¸ä¹‹å‰ç¤ºä¾‹ç›¸åŒçš„å‡†åˆ™ã€‚</p><p>åˆ†æè¯·æ±‚åº”è¯¥ä¿ç•™åœ¨ Effect ä¸­ã€‚è¿™æ˜¯ <strong>å› ä¸º</strong> å‘é€åˆ†æè¯·æ±‚æ˜¯è¡¨å•æ˜¾ç¤ºæ—¶å°±éœ€è¦æ‰§è¡Œçš„ï¼ˆåœ¨å¼€å‘ç¯å¢ƒä¸­å®ƒä¼šå‘é€ä¸¤æ¬¡ï¼Œè¯· <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#sending-analytics">å‚è€ƒè¿™é‡Œ</a> äº†è§£å¦‚ä½•å¤„ç†ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œå‘é€åˆ° <code>/api/register</code> çš„ POST è¯·æ±‚å¹¶ä¸æ˜¯ç”±è¡¨å• <strong>æ˜¾ç¤º</strong> æ—¶å¼•èµ·çš„ã€‚ä½ åªæƒ³åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´ç‚¹å‘é€è¯·æ±‚ï¼šå½“ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶ã€‚å®ƒåº”è¯¥åªåœ¨è¿™ä¸ª <strong>ç‰¹å®šçš„äº¤äº’</strong> ä¸­å‘ç”Ÿã€‚åˆ é™¤ç¬¬äºŒä¸ª Effectï¼Œå°†è¯¥ POST è¯·æ±‚ç§»å…¥äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5fg6felqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5fg6felqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šè¿™ä¸ªé€»è¾‘åº”è¯¥åœ¨ç»„ä»¶æ˜¾ç¤ºæ—¶æ‰§è¡Œ  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/analytics/event&#x27;</span>, &#123; <span class="hljs-attr">eventName</span>: <span class="hljs-string">&#x27;visit_form&#x27;</span> &#125;);<br>  &#125;, []);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">e</span>) &#123;<br>    e.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šäº‹ä»¶ç‰¹å®šçš„é€»è¾‘åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†  */</span> <br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/register&#x27;</span>, &#123; firstName, lastName &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“ä½ å†³å®šå°†æŸäº›é€»è¾‘æ”¾å…¥äº‹ä»¶å¤„ç†å‡½æ•°è¿˜æ˜¯ Effect ä¸­æ—¶ï¼Œä½ éœ€è¦å›ç­”çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹å®ƒæ˜¯ <strong>æ€æ ·çš„é€»è¾‘</strong>ã€‚å¦‚æœè¿™ä¸ªé€»è¾‘æ˜¯ç”±æŸä¸ªç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚å¦‚æœæ˜¯ç”±ç”¨æˆ·åœ¨å±å¹•ä¸Š <strong>çœ‹åˆ°</strong> ç»„ä»¶æ—¶å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ Effect ä¸­ã€‚</p><hr><p><mark>é“¾å¼è®¡ç®—</mark>ï¼šæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³é“¾æ¥å¤šä¸ª Effectï¼Œæ¯ä¸ª Effect éƒ½åŸºäºæŸäº› state æ¥è°ƒæ•´å…¶ä»–çš„ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1yizl3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1yizl3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Game</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [card, setCard] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [goldCardCount, setGoldCardCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [round, setRound] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">const</span> [isGameOver, setIsGameOver] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šé“¾æ¥å¤šä¸ª Effect ä»…ä»…ä¸ºäº†ç›¸äº’è§¦å‘è°ƒæ•´ state  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (card !== <span class="hljs-literal">null</span> &amp;&amp; card.<span class="hljs-property">gold</span>) &#123;<br>      <span class="hljs-title function_">setGoldCardCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);<br>    &#125;<br>  &#125;, [card]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (goldCardCount &gt; <span class="hljs-number">3</span>) &#123;<br>      <span class="hljs-title function_">setRound</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r + <span class="hljs-number">1</span>)<br>      <span class="hljs-title function_">setGoldCardCount</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>  &#125;, [goldCardCount]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (round &gt; <span class="hljs-number">5</span>) &#123;<br>      <span class="hljs-title function_">setIsGameOver</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>  &#125;, [round]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æ¸¸æˆç»“æŸï¼&#x27;</span>);<br>  &#125;, [isGameOver]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlaceCard</span>(<span class="hljs-params">nextCard</span>) &#123;<br>    <span class="hljs-keyword">if</span> (isGameOver) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æ¸¸æˆå·²ç»ç»“æŸäº†ã€‚&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setCard</span>(nextCard);<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒéå¸¸ä½æ•ˆï¼šåœ¨é“¾å¼çš„æ¯ä¸ª <code>set</code> è°ƒç”¨ä¹‹é—´ï¼Œç»„ä»¶ï¼ˆåŠå…¶å­ç»„ä»¶ï¼‰éƒ½ä¸å¾—ä¸é‡æ–°æ¸²æŸ“ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼ˆ<code>setCard</code> â†’ æ¸²æŸ“ â†’ <code>setGoldCardCount</code> â†’ æ¸²æŸ“ â†’ <code>setRound</code> â†’ æ¸²æŸ“ â†’ <code>setIsGameOver</code> â†’ æ¸²æŸ“ï¼‰æœ‰ä¸‰æ¬¡ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚</p><p>å³ä½¿ä¸è€ƒè™‘æ¸²æŸ“æ•ˆç‡é—®é¢˜ï¼Œéšç€ä»£ç ä¸æ–­æ‰©å±•ï¼Œä½ ä¼šé‡åˆ°è¿™æ¡ â€œé“¾å¼â€ è°ƒç”¨ä¸ç¬¦åˆæ–°éœ€æ±‚çš„æƒ…å†µã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œä½ ç°åœ¨éœ€è¦æ·»åŠ ä¸€ç§æ–¹æ³•æ¥å›æº¯æ¸¸æˆçš„å†å²è®°å½•ï¼Œå¯ä»¥é€šè¿‡æ›´æ–°æ¯ä¸ª state å˜é‡åˆ°ä¹‹å‰çš„å€¼æ¥å®ç°ã€‚ç„¶è€Œï¼Œå°† <code>card</code> è®¾ç½®ä¸ºä¹‹å‰çš„çš„æŸä¸ªå€¼ä¼šå†æ¬¡è§¦å‘ Effect é“¾å¹¶æ›´æ”¹ä½ æ­£åœ¨æ˜¾ç¤ºçš„æ•°æ®ã€‚è¿™æ ·çš„ä»£ç å¾€å¾€æ˜¯åƒµç¡¬è€Œè„†å¼±çš„ã€‚</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ï¼šå°½å¯èƒ½åœ¨æ¸²æŸ“æœŸé—´è¿›è¡Œè®¡ç®—ï¼Œä»¥åŠåœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒæ•´ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t2atdxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t2atdxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Game</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [card, setCard] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [goldCardCount, setGoldCardCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> [round, setRound] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-comment">/*  âœ… å°½å¯èƒ½åœ¨æ¸²æŸ“æœŸé—´è¿›è¡Œè®¡ç®—  */</span> <br>  <span class="hljs-keyword">const</span> isGameOver = round &gt; <span class="hljs-number">5</span>;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handlePlaceCard</span>(<span class="hljs-params">nextCard</span>) &#123;<br>    <span class="hljs-keyword">if</span> (isGameOver) &#123;<br>      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;æ¸¸æˆå·²ç»ç»“æŸäº†ã€‚&#x27;</span>);<br>    &#125;<br>    <span class="hljs-comment">/*  âœ… åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è®¡ç®—å‰©ä¸‹çš„æ‰€æœ‰ state  */</span> <br>    <span class="hljs-title function_">setCard</span>(nextCard);<br>    <span class="hljs-keyword">if</span> (nextCard.<span class="hljs-property">gold</span>) &#123;<br>      <span class="hljs-keyword">if</span> (goldCardCount &lt;= <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-title function_">setGoldCardCount</span>(goldCardCount + <span class="hljs-number">1</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>     <span class="hljs-title function_">setGoldCardCount</span>(<span class="hljs-number">0</span>);<br>        <span class="hljs-title function_">setRound</span>(round + <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span> (round === <span class="hljs-number">5</span>) &#123;<br>          <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;æ¸¸æˆç»“æŸï¼&#x27;</span>);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></div></figure><p>è¿™é«˜æ•ˆå¾—å¤šã€‚æ­¤å¤–ï¼Œå¦‚æœä½ å®ç°äº†ä¸€ä¸ªå›æº¯æ¸¸æˆå†å²çš„æ–¹æ³•ï¼Œç°åœ¨ä½ å¯ä»¥å°†æ¯ä¸ª state å˜é‡è®¾ç½®ä¸ºä¹‹å‰çš„ä»»ä½•çš„ä¸€ä¸ªå€¼ï¼Œè€Œä¸ä¼šè§¦å‘æ¯ä¸ªè°ƒæ•´å…¶ä»–å€¼çš„ Effect é“¾ã€‚å¦‚æœä½ éœ€è¦åœ¨å¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¹‹é—´å¤ç”¨é€»è¾‘ï¼Œå¯ä»¥ <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect#sharing-logic-between-event-handlers">æå–æˆä¸€ä¸ªå‡½æ•°</a> å¹¶åœ¨è¿™äº›äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è°ƒç”¨å®ƒã€‚</p><p>è¯·è®°ä½ï¼Œåœ¨äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨ï¼Œ<a href="https://zh-hans.react.dev/learn/state-as-a-snapshot">state çš„è¡Œä¸ºç±»ä¼¼å¿«ç…§</a>ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ä½ è°ƒç”¨äº† <code>setRound(round + 1)</code>ï¼Œ<code>round</code> å˜é‡ä»ç„¶æ˜¯ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶çš„å€¼ã€‚å¦‚æœä½ éœ€è¦ä½¿ç”¨ä¸‹ä¸€ä¸ªå€¼è¿›è¡Œè®¡ç®—ï¼Œåˆ™éœ€è¦åƒè¿™æ ·æ‰‹åŠ¨å®šä¹‰å®ƒï¼š<code>const nextRound = round + 1</code>ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½  <strong>æ— æ³•</strong> åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ç›´æ¥è®¡ç®—å‡ºä¸‹ä¸€ä¸ª stateã€‚ä¾‹å¦‚ï¼Œè¯•æƒ³ä¸€ä¸ªå…·æœ‰å¤šä¸ªä¸‹æ‹‰èœå•çš„è¡¨å•ï¼Œå¦‚æœä¸‹ä¸€ä¸ªä¸‹æ‹‰èœå•çš„é€‰é¡¹å–å†³äºå‰ä¸€ä¸ªä¸‹æ‹‰èœå•é€‰æ‹©çš„å€¼ã€‚è¿™æ—¶ï¼ŒEffect é“¾æ˜¯åˆé€‚çš„ï¼Œå› ä¸ºä½ éœ€è¦ä¸ç½‘ç»œè¿›è¡ŒåŒæ­¥ã€‚</p><hr><p><mark>åˆå§‹åŒ–åº”ç”¨ </mark>ï¼šæœ‰äº›é€»è¾‘åªéœ€è¦åœ¨åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</p><p>ä½ å¯èƒ½æƒ³æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªé¡¶å±‚ç»„ä»¶çš„ Effect ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-k2nfzblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-k2nfzblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šæŠŠåªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„é€»è¾‘æ”¾åœ¨ Effect ä¸­  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">loadDataFromLocalStorage</span>();<br>    <span class="hljs-title function_">checkAuthToken</span>();<br>  &#125;, []);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼Œä½ å¾ˆå¿«å°±ä¼šå‘ç°å®ƒåœ¨ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">å¼€å‘ç¯å¢ƒä¼šæ‰§è¡Œä¸¤æ¬¡</a>ã€‚è¿™ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜â€”â€”ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä½¿èº«ä»½éªŒè¯ token æ— æ•ˆï¼Œå› ä¸ºè¯¥å‡½æ•°ä¸æ˜¯ä¸ºè¢«è°ƒç”¨ä¸¤æ¬¡è€Œè®¾è®¡çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå½“ç»„ä»¶é‡æ–°æŒ‚è½½æ—¶åº”è¯¥å…·æœ‰ä¸€è‡´æ€§ã€‚åŒ…æ‹¬ä½ çš„é¡¶å±‚ <code>App</code> ç»„ä»¶ã€‚</p><p>å°½ç®¡åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å®ƒå¯èƒ½æ°¸è¿œä¸ä¼šè¢«é‡æ–°æŒ‚è½½ï¼Œä½†åœ¨æ‰€æœ‰ç»„ä»¶ä¸­éµå¾ªç›¸åŒçš„çº¦æŸæ¡ä»¶å¯ä»¥æ›´å®¹æ˜“åœ°ç§»åŠ¨å’Œå¤ç”¨ä»£ç ã€‚å¦‚æœæŸäº›é€»è¾‘å¿…é¡»åœ¨ <strong>æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡</strong>ï¼Œè€Œä¸æ˜¯åœ¨ <strong>æ¯æ¬¡ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡</strong>ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªé¡¶å±‚å˜é‡æ¥è®°å½•å®ƒæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡äº†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0qjg1qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0qjg1qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">let</span> didInit = <span class="hljs-literal">false</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (!didInit) &#123;<br>      didInit = <span class="hljs-literal">true</span>;<br>      <span class="hljs-comment">/*  âœ… åªåœ¨æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡  */</span> <br>      <span class="hljs-title function_">loadDataFromLocalStorage</span>();<br>      <span class="hljs-title function_">checkAuthToken</span>();<br>    &#125;<br>  &#125;, []);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ ä¹Ÿå¯ä»¥åœ¨æ¨¡å—åˆå§‹åŒ–å’Œåº”ç”¨æ¸²æŸ“ä¹‹å‰æ‰§è¡Œå®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v6sn38lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v6sn38lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span>) &#123; <span class="hljs-comment">// æ£€æµ‹æˆ‘ä»¬æ˜¯å¦åœ¨æµè§ˆå™¨ç¯å¢ƒ</span><br>   <span class="hljs-comment">/*  âœ… åªåœ¨æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡  */</span> <br>  <span class="hljs-title function_">checkAuthToken</span>(); <span class="hljs-title function_">loadDataFromLocalStorage</span>();<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>é¡¶å±‚ä»£ç ä¼šåœ¨ç»„ä»¶è¢«å¯¼å…¥æ—¶æ‰§è¡Œä¸€æ¬¡â€”â€”å³ä½¿å®ƒæœ€ç»ˆå¹¶æ²¡æœ‰è¢«æ¸²æŸ“ã€‚ä¸ºäº†é¿å…åœ¨å¯¼å…¥ä»»æ„ç»„ä»¶æ—¶é™ä½æ€§èƒ½æˆ–äº§ç”Ÿæ„å¤–è¡Œä¸ºï¼Œè¯·ä¸è¦è¿‡åº¦ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚å°†åº”ç”¨çº§åˆ«çš„åˆå§‹åŒ–é€»è¾‘ä¿ç•™åœ¨åƒ <code>App.js</code> è¿™æ ·çš„æ ¹ç»„ä»¶æ¨¡å—æˆ–ä½ çš„åº”ç”¨å…¥å£ä¸­ã€‚</p><p><mark>é€šçŸ¥çˆ¶ç»„ä»¶æœ‰å…³ state å˜åŒ–çš„ä¿¡æ¯ </mark>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªæœ‰å…·æœ‰å†…éƒ¨ state <code>isOn</code> çš„ <code>Toggle</code> ç»„ä»¶ï¼Œè¯¥ state å¯ä»¥æ˜¯ <code>true</code> æˆ– <code>false</code>ã€‚æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼æ¥è¿›è¡Œåˆ‡æ¢ï¼ˆé€šè¿‡ç‚¹å‡»æˆ–æ‹–åŠ¨ï¼‰ã€‚ä½ å¸Œæœ›åœ¨ <code>Toggle</code> çš„ state å˜åŒ–æ—¶é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œå› æ­¤ä½ æš´éœ²äº†ä¸€ä¸ª <code>onChange</code> äº‹ä»¶å¹¶åœ¨ <code>Effect</code> ä¸­è°ƒç”¨å®ƒï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a1qevplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a1qevplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">&#123; onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOn, setIsOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šonChange å¤„ç†å‡½æ•°æ‰§è¡Œçš„æ—¶é—´å¤ªæ™šäº†  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">onChange</span>(isOn);<br>  &#125;, [isOn, onChange])<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setIsOn</span>(!isOn);<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDragEnd</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCloserToRightEdge</span>(e)) &#123;<br>      <span class="hljs-title function_">setIsOn</span>(<span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">setIsOn</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œè¿™ä¸å¤ªç†æƒ³ã€‚<code>Toggle</code> é¦–å…ˆæ›´æ–°å®ƒçš„ stateï¼Œç„¶å React ä¼šæ›´æ–°å±å¹•ã€‚ç„¶å React æ‰§è¡Œ Effect ä¸­çš„ä»£ç ï¼Œè°ƒç”¨ä»çˆ¶ç»„ä»¶ä¼ å…¥çš„ <code>onChange</code> å‡½æ•°ã€‚ç°åœ¨çˆ¶ç»„ä»¶å¼€å§‹æ›´æ–°å®ƒè‡ªå·±çš„ stateï¼Œå¼€å¯å¦ä¸€ä¸ªæ¸²æŸ“æµç¨‹ã€‚æ›´å¥½çš„æ–¹å¼æ˜¯åœ¨å•ä¸ªæµç¨‹ä¸­å®Œæˆæ‰€æœ‰æ“ä½œã€‚</p><p>åˆ é™¤ Effectï¼Œå¹¶åœ¨åŒä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ›´æ–° <strong>ä¸¤ä¸ª</strong> ç»„ä»¶çš„ stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ns0ubblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ns0ubblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">&#123; onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOn, setIsOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateToggle</span>(<span class="hljs-params">nextIsOn</span>) &#123;<br>    <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šåœ¨è§¦å‘å®ƒä»¬çš„äº‹ä»¶ä¸­æ‰§è¡Œæ‰€æœ‰æ›´æ–°  */</span> <br>    <span class="hljs-title function_">setIsOn</span>(nextIsOn);<br>    <span class="hljs-title function_">onChange</span>(nextIsOn);<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">updateToggle</span>(!isOn);<br>  &#125;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDragEnd</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCloserToRightEdge</span>(e)) &#123;<br>      <span class="hljs-title function_">updateToggle</span>(<span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">updateToggle</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>Toggle</code> ç»„ä»¶åŠå…¶çˆ¶ç»„ä»¶éƒ½åœ¨äº‹ä»¶å¤„ç†æœŸé—´æ›´æ–°äº†å„è‡ªçš„ stateã€‚React ä¼š <a href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">æ‰¹é‡</a> å¤„ç†æ¥è‡ªä¸åŒç»„ä»¶çš„æ›´æ–°ï¼Œæ‰€ä»¥åªä¼šæœ‰ä¸€ä¸ªæ¸²æŸ“æµç¨‹ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥å®Œå…¨ç§»é™¤è¯¥ stateï¼Œå¹¶ä»çˆ¶ç»„ä»¶ä¸­æ¥æ”¶ <code>isOn</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ohsj6wlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ohsj6wlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/*  âœ… ä¹Ÿå¾ˆå¥½ï¼šè¯¥ç»„ä»¶å®Œå…¨ç”±å®ƒçš„çˆ¶ç»„ä»¶æ§åˆ¶  */</span> <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">&#123; isOn, onChange &#125;</span>) &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">onChange</span>(!isOn);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDragEnd</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCloserToRightEdge</span>(e)) &#123;<br>      <span class="hljs-title function_">onChange</span>(<span class="hljs-literal">true</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-title function_">onChange</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>â€œ<a href="https://zh-hans.react.dev/learn/sharing-state-between-components">çŠ¶æ€æå‡</a>â€ å…è®¸çˆ¶ç»„ä»¶é€šè¿‡åˆ‡æ¢è‡ªèº«çš„ state æ¥å®Œå…¨æ§åˆ¶ <code>Toggle</code> ç»„ä»¶ã€‚è¿™æ„å‘³ç€çˆ¶ç»„ä»¶ä¼šåŒ…å«æ›´å¤šçš„é€»è¾‘ï¼Œä½†æ•´ä½“ä¸Šéœ€è¦å…³å¿ƒçš„çŠ¶æ€å˜å°‘äº†ã€‚æ¯å½“ä½ å°è¯•ä¿æŒä¸¤ä¸ªä¸åŒçš„ state å˜é‡ä¹‹é—´çš„åŒæ­¥æ—¶ï¼Œè¯•è¯•çŠ¶æ€æå‡ï¼</p><p><mark>å°†æ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶</mark>ï¼š<code>Child</code> ç»„ä»¶è·å–äº†ä¸€äº›æ•°æ®å¹¶åœ¨ Effect ä¸­ä¼ é€’ç»™ <code>Parent</code> ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vnmdlhlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vnmdlhlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">onFetched</span>=<span class="hljs-string">&#123;setData&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; onFetched &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useSomeAPI</span>();<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šåœ¨ Effect ä¸­ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (data) &#123;<br>      <span class="hljs-title function_">onFetched</span>(data);<br>    &#125;<br>  &#125;, [onFetched, data]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ React ä¸­ï¼Œæ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ã€‚å½“ä½ åœ¨å±å¹•ä¸Šçœ‹åˆ°äº†ä¸€äº›é”™è¯¯æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€è·¯è¿½è¸ªç»„ä»¶æ ‘æ¥å¯»æ‰¾é”™è¯¯ä¿¡æ¯æ˜¯ä»å“ªä¸ªç»„ä»¶ä¼ é€’ä¸‹æ¥çš„ï¼Œä»è€Œæ‰¾åˆ°ä¼ é€’äº†é”™è¯¯çš„ prop æˆ–å…·æœ‰é”™è¯¯çš„ state çš„ç»„ä»¶ã€‚å½“å­ç»„ä»¶åœ¨ Effect ä¸­æ›´æ–°å…¶çˆ¶ç»„ä»¶çš„ state æ—¶ï¼Œæ•°æ®æµå˜å¾—éå¸¸éš¾ä»¥è¿½è¸ªã€‚æ—¢ç„¶å­ç»„ä»¶å’Œçˆ¶ç»„ä»¶éƒ½éœ€è¦ç›¸åŒçš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥è®©çˆ¶ç»„ä»¶è·å–é‚£äº›æ•°æ®ï¼Œå¹¶å°†å…¶ <strong>å‘ä¸‹ä¼ é€’</strong> ç»™å­ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yx9m4jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yx9m4jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">useSomeAPI</span>();<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šå‘å­ç»„ä»¶ä¼ é€’æ•°æ®  */</span> <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;data&#125;</span> /&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params">&#123; data &#125;</span>) &#123;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ›´ç®€å•ï¼Œå¹¶ä¸”å¯ä»¥ä¿æŒæ•°æ®æµçš„å¯é¢„æµ‹æ€§ï¼šæ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ã€‚</p><p><mark>è®¢é˜…å¤–éƒ¨ store </mark>ï¼šæœ‰æ—¶å€™ï¼Œä½ çš„ç»„ä»¶å¯èƒ½éœ€è¦è®¢é˜… React state ä¹‹å¤–çš„ä¸€äº›æ•°æ®ã€‚è¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªç¬¬ä¸‰æ–¹åº“æˆ–å†…ç½®æµè§ˆå™¨ APIã€‚ç”±äºè¿™äº›æ•°æ®å¯èƒ½åœ¨ React æ— æ³•æ„ŸçŸ¥çš„æƒ…å†µä¸‹å‘å˜åŒ–ï¼Œä½ éœ€è¦åœ¨ä½ çš„ç»„ä»¶ä¸­æ‰‹åŠ¨è®¢é˜…å®ƒä»¬ã€‚è¿™ç»å¸¸ä½¿ç”¨ Effect æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zvkjwmlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zvkjwmlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useOnlineStatus</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">/*  ä¸ç†æƒ³ï¼šåœ¨ Effect ä¸­æ‰‹åŠ¨è®¢é˜… store  */</span><br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateState</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(navigator.<span class="hljs-property">onLine</span>);<br>    &#125;<br>    <span class="hljs-title function_">updateState</span>();<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, updateState);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, updateState);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, updateState);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, updateState);<br>    &#125;;<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> isOnline;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatIndicator</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ªç»„ä»¶è®¢é˜…äº†ä¸€ä¸ªå¤–éƒ¨çš„ store æ•°æ®ï¼ˆåœ¨è¿™é‡Œï¼Œæ˜¯æµè§ˆå™¨çš„ <code>navigator.onLine</code> APIï¼‰ã€‚ç”±äºè¿™ä¸ª API åœ¨æœåŠ¡ç«¯ä¸å­˜åœ¨ï¼ˆå› æ­¤ä¸èƒ½ç”¨äºåˆå§‹çš„ HTMLï¼‰ï¼Œå› æ­¤ state æœ€åˆè¢«è®¾ç½®ä¸º <code>true</code>ã€‚æ¯å½“æµè§ˆå™¨ store ä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç»„ä»¶éƒ½ä¼šæ›´æ–°å®ƒçš„ stateã€‚</p><p>å°½ç®¡é€šå¸¸å¯ä»¥ä½¿ç”¨ Effect æ¥å®ç°æ­¤åŠŸèƒ½ï¼Œä½† React ä¸ºæ­¤é’ˆå¯¹æ€§åœ°æä¾›äº†ä¸€ä¸ª Hook ç”¨äºè®¢é˜…å¤–éƒ¨ storeã€‚åˆ é™¤ Effect å¹¶å°†å…¶æ›¿æ¢ä¸ºè°ƒç”¨ <a href="https://zh-hans.react.dev/reference/react/useSyncExternalStore"><code>useSyncExternalStore</code></a>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zj6lm5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zj6lm5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">callback</span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, callback); <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, callback);<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, callback);    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, callback);<br>  &#125;;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useOnlineStatus</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">/*  âœ… éå¸¸å¥½ï¼šç”¨å†…ç½®çš„ Hook è®¢é˜…å¤–éƒ¨ store  */</span> <br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useSyncExternalStore</span>(<br>    subscribe, <span class="hljs-comment">// åªè¦ä¼ é€’çš„æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼ŒReact ä¸ä¼šé‡æ–°è®¢é˜…</span><br>    <span class="hljs-function">() =&gt;</span> navigator.<span class="hljs-property">onLine</span>, <span class="hljs-comment">// å¦‚ä½•åœ¨å®¢æˆ·ç«¯è·å–å€¼</span><br>    <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// å¦‚ä½•åœ¨æœåŠ¡ç«¯è·å–å€¼</span><br>  );<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatIndicator</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸æ‰‹åŠ¨ä½¿ç”¨ Effect å°†å¯å˜æ•°æ®åŒæ­¥åˆ° React state ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•èƒ½å‡å°‘é”™è¯¯ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªåƒä¸Šé¢çš„ <code>useOnlineStatus()</code> è¿™æ ·çš„è‡ªå®šä¹‰ Hookï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦åœ¨å„ä¸ªç»„ä»¶ä¸­é‡å¤å†™è¿™äº›ä»£ç ã€‚<a href="https://zh-hans.react.dev/reference/react/useSyncExternalStore">é˜…è¯»æ›´å¤šå…³äºåœ¨ React ç»„ä»¶ä¸­è®¢é˜…å¤–éƒ¨æ•°æ® store çš„ä¿¡æ¯</a>ã€‚</p><p>è·å–æ•°æ®ï¼šè®¸å¤šåº”ç”¨ä½¿ç”¨ Effect æ¥å‘èµ·æ•°æ®è·å–è¯·æ±‚ã€‚åƒè¿™æ ·åœ¨ Effect ä¸­å†™ä¸€ä¸ªæ•°æ®è·å–è¯·æ±‚æ˜¯ç›¸å½“å¸¸è§çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zvim8tlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zvim8tlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchResults</span>(<span class="hljs-params">&#123; query &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/*  ğŸ”´ é¿å…ï¼šæ²¡æœ‰æ¸…é™¤é€»è¾‘çš„è·å–æ•°æ®  */</span> <br>    <span class="hljs-title function_">fetchResults</span>(query, page).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>      <span class="hljs-title function_">setResults</span>(json);<br>    &#125;);<br>  &#125;, [query, page]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNextPageClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setPage</span>(page + <span class="hljs-number">1</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½  <strong>ä¸éœ€è¦</strong> æŠŠè¿™ä¸ªæ•°æ®è·å–é€»è¾‘è¿ç§»åˆ°ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚</p><p>è¿™å¯èƒ½çœ‹èµ·æ¥ä¸ä¹‹å‰éœ€è¦å°†é€»è¾‘æ”¾å…¥äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ç¤ºä¾‹ç›¸çŸ›ç›¾ï¼ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°è¿™å¹¶ä¸æ˜¯ <strong>é”®å…¥äº‹ä»¶</strong>ï¼Œè¿™æ˜¯åœ¨è¿™é‡Œè·å–æ•°æ®çš„ä¸»è¦åŸå› ã€‚æœç´¢è¾“å…¥æ¡†çš„å€¼ç»å¸¸ä» URL ä¸­é¢„å¡«å……ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸å…³å¿ƒè¾“å…¥æ¡†çš„æƒ…å†µä¸‹å¯¼èˆªåˆ°åé€€å’Œå‰è¿›é¡µé¢ã€‚</p><p><code>page</code> å’Œ <code>query</code> çš„æ¥æºå…¶å®å¹¶ä¸é‡è¦ã€‚åªè¦è¯¥ç»„ä»¶å¯è§ï¼Œä½ å°±éœ€è¦é€šè¿‡å½“å‰ <code>page</code> å’Œ <code>query</code> çš„å€¼ï¼Œä¿æŒ <code>results</code> å’Œç½‘ç»œæ•°æ®çš„ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects">åŒæ­¥</a>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯ä¸€ä¸ª Effect çš„åŸå› ã€‚</p><p>ç„¶è€Œï¼Œä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å‡è®¾ä½ å¿«é€Ÿåœ°è¾“å…¥ <code>â€œhelloâ€</code>ã€‚é‚£ä¹ˆ <code>query</code> ä¼šä» <code>â€œhâ€</code> å˜æˆ <code>â€œheâ€</code>ï¼Œ<code>â€œhelâ€</code>ï¼Œ<code>â€œhellâ€</code> æœ€åæ˜¯ <code>â€œhelloâ€</code>ã€‚è¿™ä¼šè§¦å‘ä¸€è¿ä¸²ä¸åŒçš„æ•°æ®è·å–è¯·æ±‚ï¼Œä½†æ— æ³•ä¿è¯å¯¹åº”çš„è¿”å›é¡ºåºã€‚ä¾‹å¦‚ï¼Œ<code>â€œhellâ€</code> çš„å“åº”å¯èƒ½åœ¨ <code>â€œhelloâ€</code> çš„å“åº” <strong>ä¹‹å</strong> è¿”å›ã€‚ç”±äºå®ƒçš„ <code>setResults()</code> æ˜¯åœ¨æœ€åè¢«è°ƒç”¨çš„ï¼Œä½ å°†ä¼šæ˜¾ç¤ºé”™è¯¯çš„æœç´¢ç»“æœã€‚è¿™ç§æƒ…å†µè¢«ç§°ä¸º â€œ<a href="https://en.wikipedia.org/wiki/Race_condition">ç«æ€æ¡ä»¶</a>â€ï¼šä¸¤ä¸ªä¸åŒçš„è¯·æ±‚ â€œç›¸äº’ç«äº‰â€ï¼Œå¹¶ä»¥ä¸ä½ é¢„æœŸä¸ç¬¦çš„é¡ºåºè¿”å›ã€‚</p><p><strong>ä¸ºäº†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ª <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#fetching-data">æ¸…ç†å‡½æ•°</a> æ¥å¿½ç•¥è¾ƒæ—©çš„è¿”å›ç»“æœï¼š</strong></p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-crz083lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-crz083lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchResults</span>(<span class="hljs-params">&#123; query &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">fetchResults</span>(query, page).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (!ignore) &#123;<br>        <span class="hljs-title function_">setResults</span>(json);<br>      &#125;<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      ignore = <span class="hljs-literal">true</span>;<br>    &#125;;<br>  &#125;, [query, page]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNextPageClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setPage</span>(page + <span class="hljs-number">1</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ç¡®ä¿äº†å½“ä½ åœ¨ Effect ä¸­è·å–æ•°æ®æ—¶ï¼Œé™¤äº†æœ€åä¸€æ¬¡è¯·æ±‚çš„æ‰€æœ‰è¿”å›ç»“æœéƒ½å°†è¢«å¿½ç•¥ã€‚</p><p>å¤„ç†ç«æ€æ¡ä»¶å¹¶ä¸æ˜¯å®ç°æ•°æ®è·å–çš„å”¯ä¸€éš¾ç‚¹ã€‚ä½ å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ç¼“å­˜å“åº”ç»“æœï¼ˆä½¿ç”¨æˆ·ç‚¹å‡»åé€€æŒ‰é’®æ—¶å¯ä»¥ç«‹å³çœ‹åˆ°å…ˆå‰çš„å±å¹•å†…å®¹ï¼‰ï¼Œå¦‚ä½•åœ¨æœåŠ¡ç«¯è·å–æ•°æ®ï¼ˆä½¿æœåŠ¡ç«¯åˆå§‹æ¸²æŸ“çš„ HTML ä¸­åŒ…å«è·å–åˆ°çš„å†…å®¹è€Œä¸æ˜¯åŠ è½½åŠ¨ç”»ï¼‰ï¼Œä»¥åŠå¦‚ä½•é¿å…ç½‘ç»œç€‘å¸ƒï¼ˆä½¿å­ç»„ä»¶ä¸å¿…ç­‰å¾…æ¯ä¸ªçˆ¶ç»„ä»¶çš„æ•°æ®è·å–å®Œæ¯•åæ‰å¼€å§‹è·å–æ•°æ®ï¼‰ã€‚</p><p><strong>è¿™äº›é—®é¢˜é€‚ç”¨äºä»»ä½• UI åº“ï¼Œè€Œä¸ä»…ä»…æ˜¯ Reactã€‚è§£å†³è¿™äº›é—®é¢˜å¹¶ä¸å®¹æ˜“ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç°ä»£ <a href="https://zh-hans.react.dev/learn/start-a-new-react-project#production-grade-react-frameworks">æ¡†æ¶</a> æä¾›äº†æ¯”åœ¨ Effect ä¸­è·å–æ•°æ®æ›´æœ‰æ•ˆçš„å†…ç½®æ•°æ®è·å–æœºåˆ¶çš„åŸå› ã€‚</strong></p><p>å¦‚æœä½ ä¸ä½¿ç”¨æ¡†æ¶ï¼ˆä¹Ÿä¸æƒ³å¼€å‘è‡ªå·±çš„æ¡†æ¶ï¼‰ï¼Œä½†å¸Œæœ›ä½¿ä» Effect ä¸­è·å–æ•°æ®æ›´ç¬¦åˆäººç±»ç›´è§‰ï¼Œè¯·è€ƒè™‘åƒè¿™ä¸ªä¾‹å­ä¸€æ ·ï¼Œå°†è·å–é€»è¾‘æå–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e8mta5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e8mta5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchResults</span>(<span class="hljs-params">&#123; query &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [page, setPage] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">const</span> params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(&#123; query, page &#125;);<br>  <span class="hljs-keyword">const</span> results = <span class="hljs-title function_">useData</span>(<span class="hljs-string">`/api/search?<span class="hljs-subst">$&#123;params&#125;</span>`</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleNextPageClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setPage</span>(page + <span class="hljs-number">1</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useData</span>(<span class="hljs-params">url</span>) &#123;<br>  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">fetch</span>(url)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (!ignore) &#123;<br>          <span class="hljs-title function_">setData</span>(json);<br>        &#125;<br>      &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      ignore = <span class="hljs-literal">true</span>;<br>    &#125;;<br>  &#125;, [url]);<br>  <span class="hljs-keyword">return</span> data;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½ å¯èƒ½è¿˜æƒ³æ·»åŠ ä¸€äº›é”™è¯¯å¤„ç†é€»è¾‘ä»¥åŠè·Ÿè¸ªå†…å®¹æ˜¯å¦å¤„äºåŠ è½½ä¸­ã€‚ä½ å¯ä»¥è‡ªå·±ç¼–å†™è¿™æ ·çš„ Hookï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ React ç”Ÿæ€ä¸­å·²ç»å­˜åœ¨çš„è®¸å¤šè§£å†³æ–¹æ¡ˆã€‚<strong>è™½ç„¶ä»…ä»…ä½¿ç”¨è‡ªå®šä¹‰ Hook ä¸å¦‚ä½¿ç”¨æ¡†æ¶å†…ç½®çš„æ•°æ®è·å–æœºåˆ¶é«˜æ•ˆï¼Œä½†å°†æ•°æ®è·å–é€»è¾‘ç§»åŠ¨åˆ°è‡ªå®šä¹‰ Hook ä¸­å°†ä½¿åç»­é‡‡ç”¨é«˜æ•ˆçš„æ•°æ®è·å–ç­–ç•¥æ›´åŠ å®¹æ˜“ã€‚</strong></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“ä½ ä¸å¾—ä¸ç¼–å†™ Effect æ—¶ï¼Œè¯·ç•™æ„æ˜¯å¦å¯ä»¥å°†æŸæ®µåŠŸèƒ½æå–åˆ°ä¸“é—¨çš„å†…ç½® API æˆ–ä¸€ä¸ªæ›´å…·å£°æ˜æ€§çš„è‡ªå®šä¹‰ Hook ä¸­ï¼Œæ¯”å¦‚ä¸Šé¢çš„ <code>useData</code>ã€‚ä½ ä¼šå‘ç°ç»„ä»¶ä¸­çš„åŸå§‹ <code>useEffect</code> è°ƒç”¨è¶Šå°‘ï¼Œç»´æŠ¤åº”ç”¨å°†å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><h2 id="5-å“åº”å¼-Effect-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#5-å“åº”å¼-Effect-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5.å“åº”å¼ Effect çš„ç”Ÿå‘½å‘¨æœŸ"></a>5.å“åº”å¼ Effect çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>Effect ä¸ç»„ä»¶æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚ç»„ä»¶å¯ä»¥æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ã€‚Effect åªèƒ½åšä¸¤ä»¶äº‹ï¼šå¼€å§‹åŒæ­¥æŸäº›ä¸œè¥¿ï¼Œç„¶ååœæ­¢åŒæ­¥å®ƒã€‚å¦‚æœ Effect ä¾èµ–äºéšæ—¶é—´å˜åŒ–çš„ props å’Œ stateï¼Œè¿™ä¸ªå¾ªç¯å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡ã€‚React æä¾›äº†ä»£ç æ£€æŸ¥è§„åˆ™æ¥æ£€æŸ¥æ˜¯å¦æ­£ç¡®åœ°æŒ‡å®šäº† Effect çš„ä¾èµ–é¡¹ï¼Œè¿™èƒ½å¤Ÿä½¿ Effect ä¸æœ€æ–°çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚</p><p><mark>æ¯ä¸ª React ç»„ä»¶éƒ½ç»å†ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸ</mark>ï¼š</p><ol><li>å½“ç»„ä»¶è¢«æ·»åŠ åˆ°å±å¹•ä¸Šæ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ <strong>æŒ‚è½½</strong>ã€‚</li><li>å½“ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼Œé€šå¸¸æ˜¯ä½œä¸ºå¯¹äº¤äº’çš„å“åº”ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ <strong>æ›´æ–°</strong>ã€‚</li><li>å½“ç»„ä»¶ä»å±å¹•ä¸Šç§»é™¤æ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ <strong>å¸è½½</strong>ã€‚</li></ol><p><strong>è¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ€è€ƒç»„ä»¶çš„æ–¹å¼ï¼Œä½†å¹¶ä¸é€‚ç”¨äº Effect</strong>ã€‚ç›¸åï¼Œå°è¯•ä»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­è·³è„±å‡ºæ¥ï¼Œç‹¬ç«‹æ€è€ƒ Effectã€‚Effect æè¿°äº†å¦‚ä½•å°†å¤–éƒ¨ç³»ç»Ÿä¸å½“å‰çš„ props å’Œ state åŒæ­¥ã€‚éšç€ä»£ç çš„å˜åŒ–ï¼ŒåŒæ­¥çš„é¢‘ç‡å¯èƒ½ä¼šå¢åŠ æˆ–å‡å°‘ã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè€ƒè™‘ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚Effect å°†ç»„ä»¶è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s177yzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s177yzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>Effect çš„ä¸»ä½“éƒ¨åˆ†æŒ‡å®šäº†å¦‚ä½• <strong>å¼€å§‹åŒæ­¥</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hwc8mflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hwc8mflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>connection.<span class="hljs-title function_">connect</span>();<br></code></pre></td></tr></table></div></figure><p>Effect è¿”å›çš„æ¸…ç†å‡½æ•°æŒ‡å®šäº†å¦‚ä½• <strong>åœæ­¢åŒæ­¥</strong>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q8i0lslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q8i0lslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx">connection.<span class="hljs-title function_">disconnect</span>();<br></code></pre></td></tr></table></div></figure><p>ä½ å¯èƒ½ä¼šç›´è§‚åœ°è®¤ä¸ºå½“ç»„ä»¶æŒ‚è½½æ—¶ React ä¼š <strong>å¼€å§‹åŒæ­¥</strong>ï¼Œè€Œå½“ç»„ä»¶å¸è½½æ—¶ä¼š <strong>åœæ­¢åŒæ­¥</strong>ã€‚ç„¶è€Œï¼Œäº‹æƒ…å¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼æœ‰æ—¶ï¼Œåœ¨ç»„ä»¶ä¿æŒæŒ‚è½½çŠ¶æ€çš„åŒæ—¶ï¼Œå¯èƒ½è¿˜éœ€è¦ <strong>å¤šæ¬¡å¼€å§‹å’Œåœæ­¢åŒæ­¥</strong>ã€‚</p><p>æœ‰äº› Effect æ ¹æœ¬ä¸è¿”å›æ¸…ç†å‡½æ•°ã€‚<a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹</a>ï¼Œå¯èƒ½å¸Œæœ›è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œä½†å¦‚æœæ²¡æœ‰è¿”å›ï¼ŒReact å°†è¡¨ç°å¾—å¥½åƒè¿”å›äº†ä¸€ä¸ªç©ºçš„æ¸…ç†å‡½æ•°ã€‚</p><hr><p><mark>ä¸ºä»€ä¹ˆåŒæ­¥å¯èƒ½éœ€è¦å¤šæ¬¡è¿›è¡Œ</mark>ï¼šæƒ³è±¡ä¸€ä¸‹ï¼Œè¿™ä¸ª <code>ChatRoom</code> ç»„ä»¶æ¥æ”¶ <code>roomId</code> å±æ€§ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©ã€‚å‡è®¾åˆå§‹æ—¶ï¼Œç”¨æˆ·é€‰æ‹©äº† <code>&quot;general&quot;</code> ä½œä¸º <code>roomId</code>ã€‚åº”ç”¨ç¨‹åºä¼šæ˜¾ç¤º <code>&quot;general&quot;</code> èŠå¤©å®¤ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y3vfnrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y3vfnrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId /* <span class="hljs-string">&quot;general&quot;</span> */ &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ UI æ˜¾ç¤ºä¹‹åï¼ŒReact å°†è¿è¡Œ Effect æ¥ <strong>å¼€å§‹åŒæ­¥</strong>ã€‚å®ƒè¿æ¥åˆ° <code>&quot;general&quot;</code> èŠå¤©å®¤ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-44cuxalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-44cuxalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId /* <span class="hljs-string">&quot;general&quot;</span> */ &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  è¿æ¥åˆ° &quot;general&quot; èŠå¤©å®¤  */</span> <br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>(); <span class="hljs-comment">/*  æ–­å¼€ä¸ &quot;general&quot; èŠå¤©å®¤çš„è¿æ¥  */</span> <br>    &#125;;<br>  &#125;, [roomId]);<br></code></pre></td></tr></table></div></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ã€‚</p><p>ä¹‹åï¼Œç”¨æˆ·åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©äº†ä¸åŒçš„æˆ¿é—´ï¼ˆä¾‹å¦‚ <code>&quot;travel&quot;</code> ï¼‰ã€‚é¦–å…ˆï¼ŒReact ä¼šæ›´æ–° UIï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-efghtblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-efghtblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId /* <span class="hljs-string">&quot;travel&quot;</span> */ &#125;</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ€è€ƒæ¥ä¸‹æ¥åº”è¯¥å‘ç”Ÿä»€ä¹ˆã€‚ç”¨æˆ·åœ¨ç•Œé¢ä¸­çœ‹åˆ° <code>&quot;travel&quot;</code> æ˜¯å½“å‰é€‰å®šçš„èŠå¤©å®¤ã€‚ç„¶è€Œï¼Œä¸Šæ¬¡è¿è¡Œçš„ Effect ä»ç„¶è¿æ¥åˆ° <code>&quot;general&quot;</code> èŠå¤©å®¤ã€‚**<code>roomId</code> å±æ€§å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥ä¹‹å‰ Effect æ‰€åšçš„äº‹æƒ…ï¼ˆè¿æ¥åˆ° <code>&quot;general&quot;</code> èŠå¤©å®¤ï¼‰ä¸å†ä¸ UI åŒ¹é…**ã€‚</p><p>æ­¤æ—¶ï¼Œä½ å¸Œæœ› React æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š</p><ol><li>åœæ­¢ä¸æ—§çš„ <code>roomId</code> åŒæ­¥ï¼ˆæ–­å¼€ä¸ <code>&quot;general&quot;</code> èŠå¤©å®¤çš„è¿æ¥ï¼‰</li><li>å¼€å§‹ä¸æ–°çš„ <code>roomId</code> åŒæ­¥ï¼ˆè¿æ¥åˆ° <code>&quot;travel&quot;</code> èŠå¤©å®¤ï¼‰</li></ol><p><strong>å¹¸è¿çš„æ˜¯ï¼Œä½ å·²ç»æ•™ä¼šäº† React å¦‚ä½•æ‰§è¡Œè¿™ä¸¤ä¸ªæ“ä½œ</strong>ï¼Effect çš„ä¸»ä½“éƒ¨åˆ†æŒ‡å®šäº†å¦‚ä½•å¼€å§‹åŒæ­¥ï¼Œè€Œæ¸…ç†å‡½æ•°æŒ‡å®šäº†å¦‚ä½•åœæ­¢åŒæ­¥ã€‚ç°åœ¨ï¼ŒReact åªéœ€è¦æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå’Œæ­£ç¡®çš„ props å’Œ state æ¥è°ƒç”¨å®ƒä»¬ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><hr><p><mark>React å¦‚ä½•é‡æ–°åŒæ­¥ Effect </mark>ï¼šå›æƒ³ä¸€ä¸‹ï¼Œ<code>ChatRoom</code> ç»„ä»¶å·²ç»æ¥æ”¶åˆ°äº† <code>roomId</code> å±æ€§çš„æ–°å€¼ã€‚ä¹‹å‰å®ƒæ˜¯ <code>&quot;general&quot;</code>ï¼Œç°åœ¨å˜æˆäº† <code>&quot;travel&quot;</code>ã€‚React éœ€è¦é‡æ–°åŒæ­¥ Effectï¼Œä»¥é‡æ–°è¿æ¥åˆ°ä¸åŒçš„èŠå¤©å®¤ã€‚</p><p>ä¸ºäº† <strong>åœæ­¢åŒæ­¥</strong>ï¼ŒReact å°†è°ƒç”¨ Effect è¿”å›çš„æ¸…ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°åœ¨è¿æ¥åˆ° <code>&quot;general&quot;</code> èŠå¤©å®¤åè¿”å›ã€‚ç”±äº <code>roomId</code> ä¸º <code>&quot;general&quot;</code>ï¼Œæ¸…ç†å‡½æ•°å°†æ–­å¼€ä¸ <code>&quot;general&quot;</code> èŠå¤©å®¤çš„è¿æ¥ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rm17yglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rm17yglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId /* <span class="hljs-string">&quot;general&quot;</span> */ &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  è¿æ¥åˆ° &quot;general&quot; èŠå¤©å®¤  */</span> <br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>(); <span class="hljs-comment">/* æ–­å¼€ä¸ &quot;general&quot; èŠå¤©å®¤çš„è¿æ¥   */</span> <br>    &#125;;<br></code></pre></td></tr></table></div></figure><p>ç„¶åï¼ŒReact å°†è¿è¡Œåœ¨æ­¤æ¸²æŸ“æœŸé—´æä¾›çš„ Effectã€‚è¿™æ¬¡ï¼Œ<code>roomId</code> ä¸º <code>&quot;travel&quot;</code>ï¼Œå› æ­¤å®ƒå°† <strong>å¼€å§‹åŒæ­¥</strong> åˆ° <code>&quot;travel&quot;</code> èŠå¤©å®¤ï¼ˆç›´åˆ°æœ€ç»ˆä¹Ÿè°ƒç”¨äº†æ¸…ç†å‡½æ•°ï¼‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-egloj5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-egloj5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId /* <span class="hljs-string">&quot;travel&quot;</span> */ &#125;</span>) &#123;<br>    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  è¿æ¥åˆ° &quot;travel&quot; èŠå¤©å®¤  */</span> <br>        connection.<span class="hljs-title function_">connect</span>();<br>    &#125;<br></code></pre></td></tr></table></div></figure><p>å¤šäºäº†è¿™ä¸€ç‚¹ï¼Œç°åœ¨å·²ç»è¿æ¥åˆ°äº†ç”¨æˆ·åœ¨ UI ä¸­é€‰æ‹©çš„åŒä¸€ä¸ªèŠå¤©å®¤ã€‚é¿å…äº†ç¾éš¾ï¼</p><p>æ¯å½“ç»„ä»¶ä½¿ç”¨ä¸åŒçš„ <code>roomId</code> é‡æ–°æ¸²æŸ“åï¼ŒEffect å°†é‡æ–°è¿›è¡ŒåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç”¨æˆ·å°† <code>roomId</code> ä» <code>&quot;travel&quot;</code> æ›´æ”¹ä¸º <code>&quot;music&quot;</code>ã€‚React å°†å†æ¬¡é€šè¿‡è°ƒç”¨æ¸…ç†å‡½æ•° <strong>åœæ­¢åŒæ­¥</strong> Effectï¼ˆæ–­å¼€ä¸ <code>&quot;travel&quot;</code> èŠå¤©å®¤çš„è¿æ¥ï¼‰ã€‚ç„¶åï¼Œå®ƒå°†é€šè¿‡ä½¿ç”¨æ–°çš„ <code>roomId</code> å±æ€§å†æ¬¡è¿è¡Œ Effect çš„ä¸»ä½“éƒ¨åˆ† <strong>å¼€å§‹åŒæ­¥</strong>ï¼ˆè¿æ¥åˆ° <code>&quot;music&quot;</code> èŠå¤©å®¤ï¼‰ã€‚</p><p>æœ€åï¼Œå½“ç”¨æˆ·åˆ‡æ¢åˆ°ä¸åŒçš„å±å¹•æ—¶ï¼Œ<code>ChatRoom</code> ç»„ä»¶å°†è¢«å¸è½½ã€‚ç°åœ¨æ²¡æœ‰å¿…è¦ä¿æŒè¿æ¥äº†ã€‚React å°† <strong>æœ€åä¸€æ¬¡åœæ­¢åŒæ­¥</strong> Effectï¼Œå¹¶ä» <code>&quot;music&quot;</code> èŠå¤©å®¤æ–­å¼€è¿æ¥ã€‚ </p><p>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä» <code>ChatRoom</code> ç»„ä»¶çš„è§’åº¦æ‰€å‘ç”Ÿçš„ä¸€åˆ‡ï¼š</p><ol><li><code>ChatRoom</code> ç»„ä»¶æŒ‚è½½ï¼Œ<code>roomId</code> è®¾ç½®ä¸º <code>&quot;general&quot;</code></li><li><code>ChatRoom</code> ç»„ä»¶æ›´æ–°ï¼Œ<code>roomId</code> è®¾ç½®ä¸º <code>&quot;travel&quot;</code></li><li><code>ChatRoom</code> ç»„ä»¶æ›´æ–°ï¼Œ<code>roomId</code> è®¾ç½®ä¸º <code>&quot;music&quot;</code></li><li><code>ChatRoom</code> ç»„ä»¶å¸è½½</li></ol><p>åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µï¼ŒEffect æ‰§è¡Œäº†ä¸åŒçš„æ“ä½œï¼š</p><ol><li>Effect è¿æ¥åˆ°äº† <code>&quot;general&quot;</code> èŠå¤©å®¤</li><li>Effect æ–­å¼€äº†ä¸ <code>&quot;general&quot;</code> èŠå¤©å®¤çš„è¿æ¥ï¼Œå¹¶è¿æ¥åˆ°äº† <code>&quot;travel&quot;</code> èŠå¤©å®¤</li><li>Effect æ–­å¼€äº†ä¸ <code>&quot;travel&quot;</code> èŠå¤©å®¤çš„è¿æ¥ï¼Œå¹¶è¿æ¥åˆ°äº† <code>&quot;music&quot;</code> èŠå¤©å®¤</li><li>Effect æ–­å¼€äº†ä¸ <code>&quot;music&quot;</code> èŠå¤©å®¤çš„è¿æ¥</li></ol><p>ç°åœ¨è®©æˆ‘ä»¬ä» Effect æœ¬èº«çš„è§’åº¦æ¥æ€è€ƒæ‰€å‘ç”Ÿçš„äº‹æƒ…ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n573b8lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n573b8lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  Effect è¿æ¥åˆ°äº†é€šè¿‡ roomId æŒ‡å®šçš„èŠå¤©å®¤...  */</span> <br>  <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>  connection.<span class="hljs-title function_">connect</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/*  ...ç›´åˆ°å®ƒæ–­å¼€è¿æ¥  */</span> <br>    connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;;<br>&#125;, [roomId]);<br></code></pre></td></tr></table></div></figure><p>è¿™æ®µä»£ç çš„ç»“æ„å¯èƒ½ä¼šå°†æ‰€å‘ç”Ÿçš„äº‹æƒ…çœ‹ä½œæ˜¯ä¸€ç³»åˆ—ä¸é‡å çš„æ—¶é—´æ®µï¼š</p><ol><li>Effect è¿æ¥åˆ°äº† <code>&quot;general&quot;</code> èŠå¤©å®¤ï¼ˆç›´åˆ°æ–­å¼€è¿æ¥ï¼‰</li><li>Effect è¿æ¥åˆ°äº† <code>&quot;travel&quot;</code> èŠå¤©å®¤ï¼ˆç›´åˆ°æ–­å¼€è¿æ¥ï¼‰</li><li>Effect è¿æ¥åˆ°äº† <code>&quot;music&quot;</code> èŠå¤©å®¤ï¼ˆç›´åˆ°æ–­å¼€è¿æ¥ï¼‰</li></ol><p>ä¹‹å‰ï¼Œä½ æ˜¯ä»ç»„ä»¶çš„è§’åº¦æ€è€ƒçš„ã€‚å½“ä½ ä»ç»„ä»¶çš„è§’åº¦æ€è€ƒæ—¶ï¼Œå¾ˆå®¹æ˜“å°† Effect è§†ä¸ºåœ¨ç‰¹å®šæ—¶é—´ç‚¹è§¦å‘çš„â€œå›è°ƒå‡½æ•°â€æˆ–â€œç”Ÿå‘½å‘¨æœŸäº‹ä»¶â€ï¼Œä¾‹å¦‚â€œæ¸²æŸ“åâ€æˆ–â€œå¸è½½å‰â€ã€‚è¿™ç§æ€ç»´æ–¹å¼å¾ˆå¿«å˜å¾—å¤æ‚ï¼Œæ‰€ä»¥æœ€å¥½é¿å…ä½¿ç”¨ã€‚</p><p><strong>ç›¸åï¼Œå§‹ç»ˆä¸“æ³¨äºå•ä¸ªå¯åŠ¨&#x2F;åœæ­¢å‘¨æœŸã€‚æ— è®ºç»„ä»¶æ˜¯æŒ‚è½½ã€æ›´æ–°è¿˜æ˜¯å¸è½½ï¼Œéƒ½ä¸åº”è¯¥æœ‰å½±å“ã€‚åªéœ€è¦æè¿°å¦‚ä½•å¼€å§‹åŒæ­¥å’Œå¦‚ä½•åœæ­¢ã€‚å¦‚æœåšå¾—å¥½ï¼ŒEffect å°†èƒ½å¤Ÿåœ¨éœ€è¦æ—¶å§‹ç»ˆå…·å¤‡å¯åŠ¨å’Œåœæ­¢çš„å¼¹æ€§</strong>ã€‚</p><p>è¿™å¯èƒ½ä¼šè®©ä½ æƒ³èµ·å½“ç¼–å†™åˆ›å»º JSX çš„æ¸²æŸ“é€»è¾‘æ—¶ï¼Œå¹¶ä¸è€ƒè™‘ç»„ä»¶æ˜¯æŒ‚è½½è¿˜æ˜¯æ›´æ–°ã€‚æè¿°çš„æ˜¯åº”è¯¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å†…å®¹ï¼Œè€Œ React ä¼š <a href="https://zh-hans.react.dev/learn/reacting-to-input-with-state">è§£å†³å…¶ä½™çš„é—®é¢˜</a>ã€‚</p><hr><p><mark>React å¦‚ä½•éªŒè¯ Effect å¯ä»¥é‡æ–°è¿›è¡ŒåŒæ­¥ </mark>ï¼šè¿™é‡Œæœ‰ä¸€ä¸ªå¯ä»¥äº’åŠ¨çš„å®æ—¶ç¤ºä¾‹ã€‚ç‚¹å‡»â€œæ‰“å¼€èŠå¤©â€æ¥æŒ‚è½½ <code>ChatRoom</code> ç»„ä»¶ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r9v9mllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r9v9mllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        é€‰æ‹©èŠå¤©å®¤ï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>æ‰€æœ‰<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>æ—…æ¸¸<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>éŸ³ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(!show)&#125;&gt;</span><br><span class="language-xml">        &#123;show ? &#x27;å…³é—­èŠå¤©&#x27; : &#x27;æ‰“å¼€èŠå¤©&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6ugq4qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6ugq4qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  å®é™…çš„å®ç°å°†ä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ° &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€ &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¯·æ³¨æ„ï¼Œå½“ç»„ä»¶é¦–æ¬¡æŒ‚è½½æ—¶ï¼Œä¼šçœ‹åˆ°ä¸‰ä¸ªæ—¥å¿—ï¼š</p><ol><li><code>âœ… è¿æ¥åˆ° &quot;general&quot; èŠå¤©å®¤ï¼Œä½äº https://localhost:1234...</code> <em>(ä»…é™å¼€å‘ç¯å¢ƒ)</em></li><li><code>âŒ ä» &quot;general&quot; èŠå¤©å®¤æ–­å¼€è¿æ¥ï¼Œä½äº https://localhost:1234.</code> <em>(ä»…é™å¼€å‘ç¯å¢ƒ)</em></li><li><code>âœ… è¿æ¥åˆ° &quot;general&quot; èŠå¤©å®¤ï¼Œä½äº https://localhost:1234...</code></li></ol><p>å‰ä¸¤ä¸ªæ—¥å¿—ä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒã€‚åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact æ€»æ˜¯ä¼šé‡æ–°æŒ‚è½½æ¯ä¸ªç»„ä»¶ä¸€æ¬¡ã€‚</p><p><strong>React é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­ç«‹å³å¼ºåˆ¶ Effect é‡æ–°è¿›è¡ŒåŒæ­¥æ¥éªŒè¯å…¶æ˜¯å¦èƒ½å¤Ÿé‡æ–°åŒæ­¥</strong>ã€‚è¿™å¯èƒ½è®©ä½ æƒ³èµ·æ‰“å¼€é—¨å¹¶é¢å¤–å…³é—­å®ƒä»¥æ£€æŸ¥é—¨é”æ˜¯å¦æœ‰æ•ˆçš„æƒ…æ™¯ã€‚React åœ¨å¼€å‘ç¯å¢ƒä¸­é¢å¤–å¯åŠ¨å’Œåœæ­¢ Effect ä¸€æ¬¡ï¼Œä»¥æ£€æŸ¥ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development">æ˜¯å¦æ­£ç¡®å®ç°äº†å®ƒçš„æ¸…ç†åŠŸèƒ½</a>ã€‚</p><p>å®é™…ä¸Šï¼ŒEffect é‡æ–°è¿›è¡ŒåŒæ­¥çš„ä¸»è¦åŸå› æ˜¯å®ƒæ‰€ä½¿ç”¨çš„æŸäº›æ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ›´æ”¹æ‰€é€‰çš„èŠå¤©å®¤ã€‚æ³¨æ„å½“ <code>roomId</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒEffect ä¼šé‡æ–°è¿›è¡ŒåŒæ­¥ã€‚</p><p>ç„¶è€Œï¼Œè¿˜å­˜åœ¨å…¶ä»–ä¸€äº›ä¸å¯»å¸¸çš„æƒ…å†µéœ€è¦é‡æ–°è¿›è¡ŒåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°è¯•åœ¨èŠå¤©æ‰“å¼€æ—¶ç¼–è¾‘ <code>serverUrl</code>ã€‚æ³¨æ„å½“ä¿®æ”¹ä»£ç æ—¶ï¼ŒEffectä¼šé‡æ–°è¿›è¡ŒåŒæ­¥ã€‚å°†æ¥ï¼ŒReact å¯èƒ½ä¼šæ·»åŠ æ›´å¤šä¾èµ–äºé‡æ–°åŒæ­¥çš„åŠŸèƒ½ã€‚</p><hr><p><mark>React å¦‚ä½•çŸ¥é“éœ€è¦é‡æ–°è¿›è¡Œ Effect çš„åŒæ­¥ </mark>ï¼šä½ å¯èƒ½æƒ³çŸ¥é“ React æ˜¯å¦‚ä½•çŸ¥é“åœ¨ <code>roomId</code> æ›´æ”¹åéœ€è¦é‡æ–°åŒæ­¥ Effectã€‚è¿™æ˜¯å› ä¸º <strong>ä½ å‘Šè¯‰äº† React</strong> å®ƒçš„ä»£ç ä¾èµ–äº <code>roomId</code>ï¼Œé€šè¿‡å°†å…¶åŒ…å«åœ¨ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#step-2-specify-the-effect-dependencies">ä¾èµ–åˆ—è¡¨</a> ä¸­ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cc64zjlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cc64zjlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123; <span class="hljs-comment">// roomId å±æ€§å¯èƒ½ä¼šéšæ—¶é—´å˜åŒ–ã€‚</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  è¿™ä¸ª Effect è¯»å–äº† roomId  */</span> <br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId]); <span class="hljs-comment">/*  å› æ­¤ï¼Œä½ å‘Šè¯‰ React è¿™ä¸ª Effect &quot;ä¾èµ–äº&quot; roomId  */</span> <br></code></pre></td></tr></table></div></figure><p>ä¸‹é¢æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š</p><ol><li>ä½ çŸ¥é“ <code>roomId</code> æ˜¯ propï¼Œè¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»å‘ç”Ÿå˜åŒ–ã€‚</li><li>ä½ çŸ¥é“ Effect è¯»å–äº† <code>roomId</code>ï¼ˆå› æ­¤å…¶é€»è¾‘ä¾èµ–äºå¯èƒ½ä¼šåœ¨ä¹‹åå‘ç”Ÿå˜åŒ–çš„å€¼ï¼‰ã€‚</li><li>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å°†å…¶æŒ‡å®šä¸º Effect çš„ä¾èµ–é¡¹ï¼ˆä»¥ä¾¿åœ¨ <code>roomId</code> å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è¿›è¡ŒåŒæ­¥ï¼‰ã€‚</li></ol><p>æ¯æ¬¡åœ¨ç»„ä»¶é‡æ–°æ¸²æŸ“åï¼ŒReact éƒ½ä¼šæŸ¥çœ‹ä¼ é€’çš„ä¾èµ–é¡¹æ•°ç»„ã€‚å¦‚æœæ•°ç»„ä¸­çš„ä»»ä½•å€¼ä¸ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶åœ¨ç›¸åŒä½ç½®ä¼ é€’çš„å€¼ä¸åŒï¼ŒReact å°†é‡æ–°åŒæ­¥ Effectã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœåœ¨åˆå§‹æ¸²æŸ“æ—¶ä¼ é€’äº† <code>[&quot;general&quot;]</code>ï¼Œç„¶ååœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ä¼ é€’äº† <code>[&quot;travel&quot;]</code>ï¼ŒReact å°†æ¯”è¾ƒ <code>&quot;general&quot;</code> å’Œ <code>&quot;travel&quot;</code>ã€‚è¿™äº›æ˜¯ä¸åŒçš„å€¼ï¼ˆä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is"><code>Object.is</code></a> è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œå› æ­¤ React å°†é‡æ–°åŒæ­¥ Effectã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç»„ä»¶é‡æ–°æ¸²æŸ“ä½† <code>roomId</code> æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ŒEffect å°†ç»§ç»­è¿æ¥åˆ°ç›¸åŒçš„æˆ¿é—´ã€‚</p><hr><p>æ¯ä¸ª Effect è¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ã€‚ </p><p>æŠµåˆ¶å°†ä¸ Effect æ— å…³çš„é€»è¾‘æ·»åŠ åˆ°å·²ç»ç¼–å†™çš„ Effect ä¸­ï¼Œä»…ä»…å› ä¸ºè¿™äº›é€»è¾‘éœ€è¦ä¸ Effect åŒæ—¶è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·è®¿é—®æˆ¿é—´æ—¶å‘é€ä¸€ä¸ªåˆ†æäº‹ä»¶ã€‚ä½ å·²ç»æœ‰ä¸€ä¸ªä¾èµ–äº <code>roomId</code> çš„ Effectï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šæƒ³è¦å°†åˆ†æè°ƒç”¨æ·»åŠ åˆ°é‚£é‡Œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yigvnzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yigvnzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">logVisit</span>(roomId);<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä»¥åç»™è¿™ä¸ª Effect æ·»åŠ äº†å¦ä¸€ä¸ªéœ€è¦é‡æ–°å»ºç«‹è¿æ¥çš„ä¾èµ–é¡¹ã€‚å¦‚æœè¿™ä¸ª Effect é‡æ–°è¿›è¡ŒåŒæ­¥ï¼Œå®ƒå°†ä¸ºç›¸åŒçš„æˆ¿é—´è°ƒç”¨ <code>logVisit(roomId)</code>ï¼Œè€Œè¿™ä¸æ˜¯ä½ çš„æ„å›¾ã€‚è®°å½•è®¿é—®è¡Œä¸ºæ˜¯ <strong>ä¸€ä¸ªç‹¬ç«‹çš„è¿‡ç¨‹</strong>ï¼Œä¸è¿æ¥ä¸åŒã€‚å°†å®ƒä»¬ä½œä¸ºä¸¤ä¸ªå•ç‹¬çš„ Effect ç¼–å†™ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2ykubzlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2ykubzlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">logVisit</span>(roomId);<br>  &#125;, [roomId]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>  &#125;, [roomId]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>ä»£ç ä¸­çš„æ¯ä¸ª Effect åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ã€‚</strong></p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œåˆ é™¤ä¸€ä¸ª Effect ä¸ä¼šå½±å“å¦ä¸€ä¸ª Effect çš„é€»è¾‘ã€‚è¿™è¡¨æ˜å®ƒä»¬åŒæ­¥ä¸åŒçš„å†…å®¹ï¼Œå› æ­¤å°†å®ƒä»¬æ‹†åˆ†å¼€æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå°†ä¸€ä¸ªå†…èšçš„é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„ Effectsï¼Œä»£ç å¯èƒ½ä¼šçœ‹èµ·æ¥æ›´åŠ â€œæ¸…æ™°â€ï¼Œä½† <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect#chains-of-computations">ç»´æŠ¤èµ·æ¥ä¼šæ›´åŠ å›°éš¾</a>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ åº”è¯¥è€ƒè™‘è¿™äº›è¿‡ç¨‹æ˜¯ç›¸åŒè¿˜æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œä¸æ˜¯åªè€ƒè™‘ä»£ç æ˜¯å¦çœ‹èµ·æ¥æ›´æ•´æ´ã€‚</p><hr><p><mark>Effect ä¼šâ€œå“åº”â€äºå“åº”å¼å€¼ </mark>ï¼šEffect è¯»å–äº†ä¸¤ä¸ªå˜é‡ï¼ˆ<code>serverUrl</code> å’Œ <code>roomId</code>ï¼‰ï¼Œä½†æ˜¯åªå°† <code>roomId</code> æŒ‡å®šä¸ºä¾èµ–é¡¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-26mgwxlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-26mgwxlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¸ºä»€ä¹ˆ <code>serverUrl</code> ä¸éœ€è¦ä½œä¸ºä¾èµ–é¡¹å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸º <code>serverUrl</code> æ°¸è¿œä¸ä¼šå› ä¸ºé‡æ–°æ¸²æŸ“è€Œå‘ç”Ÿå˜åŒ–ã€‚æ— è®ºç»„ä»¶é‡æ–°æ¸²æŸ“å¤šå°‘æ¬¡ä»¥åŠåŸå› æ˜¯ä»€ä¹ˆï¼Œ<code>serverUrl</code> éƒ½ä¿æŒä¸å˜ã€‚æ—¢ç„¶ <code>serverUrl</code> ä»ä¸å˜åŒ–ï¼Œå°†å…¶æŒ‡å®šä¸ºä¾èµ–é¡¹å°±æ²¡æœ‰æ„ä¹‰ã€‚æ¯•ç«Ÿï¼Œä¾èµ–é¡¹åªæœ‰åœ¨éšæ—¶é—´å˜åŒ–æ—¶æ‰ä¼šèµ·ä½œç”¨ï¼</p><p>å¦ä¸€æ–¹é¢ï¼Œ<code>roomId</code> åœ¨é‡æ–°æ¸²æŸ“æ—¶å¯èƒ½ä¼šä¸åŒã€‚<strong>åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„ propsã€state å’Œå…¶ä»–å€¼éƒ½æ˜¯ å“åº”å¼ çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è®¡ç®—çš„ï¼Œå¹¶å‚ä¸äº† React çš„æ•°æ®æµ</strong>ã€‚</p><p>å¦‚æœ <code>serverUrl</code> æ˜¯çŠ¶æ€å˜é‡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å“åº”å¼çš„ã€‚å“åº”å¼å€¼å¿…é¡»åŒ…å«åœ¨ä¾èµ–é¡¹ä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hn3w8jlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hn3w8jlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123; <span class="hljs-comment">/*  Props éšæ—¶é—´å˜åŒ–  */</span> <br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>); <span class="hljs-comment">/*  State å¯èƒ½éšæ—¶é—´å˜åŒ–  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  Effect è¯»å– props å’Œ state  */</span> <br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId, serverUrl]); <span class="hljs-comment">/* å› æ­¤ï¼Œä½ å‘Šè¯‰ React è¿™ä¸ª Effect &quot;ä¾èµ–äº&quot; props å’Œ state   */</span> <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>é€šè¿‡å°† <code>serverUrl</code> åŒ…å«åœ¨ä¾èµ–é¡¹ä¸­ï¼Œç¡®ä¿ Effect åœ¨å…¶å‘ç”Ÿå˜åŒ–åé‡æ–°åŒæ­¥ã€‚</p><p>å°è¯•åœ¨æ­¤æ²™ç›’ä¸­æ›´æ”¹æ‰€é€‰çš„èŠå¤©å®¤æˆ–ç¼–è¾‘æœåŠ¡å™¨ URLï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qda7yalqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qda7yalqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId, serverUrl]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        æœåŠ¡å™¨ URLï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;serverUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setServerUrl(e.target.value)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        é€‰æ‹©èŠå¤©å®¤ï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>æ‰€æœ‰<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>æ—…æ¸¸<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>éŸ³ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3jnmz2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3jnmz2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/* å®é™…çš„å®ç°å°†ä¼šè¿æ¥åˆ°æœåŠ¡å™¨   */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ° &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€ &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ— è®ºä½•æ—¶æ›´æ”¹ä¸€ä¸ªç±»ä¼¼ <code>roomId</code> æˆ– <code>serverUrl</code> çš„å“åº”å¼å€¼ï¼Œè¯¥ Effect éƒ½ä¼šé‡æ–°è¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨ã€‚</p><hr><p><mark>æ²¡æœ‰ä¾èµ–é¡¹çš„ Effect çš„å«ä¹‰ </mark>ï¼šå¦‚æœå°† <code>serverUrl</code> å’Œ <code>roomId</code> éƒ½ç§»å‡ºç»„ä»¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5s3f35lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5s3f35lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;general&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, []); <span class="hljs-comment">/*  âœ… å£°æ˜çš„æ‰€æœ‰ä¾èµ–  */</span> <br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ Effect çš„ä»£ç ä¸ä½¿ç”¨ä»»ä½•å“åº”å¼å€¼ï¼Œå› æ­¤å®ƒçš„ä¾èµ–å¯ä»¥æ˜¯ç©ºçš„ (<code>[]</code>)ã€‚</p><p>ä»ç»„ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œç©ºçš„ <code>[]</code> ä¾èµ–æ•°ç»„æ„å‘³ç€è¿™ä¸ª Effect ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿æ¥åˆ°èŠå¤©å®¤ï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶æ–­å¼€è¿æ¥ã€‚ï¼ˆè¯·è®°ä½ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä»ä¼š <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#how-react-verifies-that-your-effect-can-re-synchronize">é¢å¤–æ‰§è¡Œä¸€æ¬¡</a> æ¥å¯¹é€»è¾‘è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚ï¼‰</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-uqz2vnlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-uqz2vnlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;general&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(!show)&#125;&gt;</span><br><span class="language-xml">        &#123;show ? &#x27;å…³é—­èŠå¤©&#x27; : &#x27;æ‰“å¼€èŠå¤©&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-py9gp3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-py9gp3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  å®é™…çš„å®ç°å°†ä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ° &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€ &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç„¶è€Œï¼Œå¦‚æœä½  <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#thinking-from-the-effects-perspective">ä» Effect çš„è§’åº¦æ€è€ƒ</a>ï¼Œæ ¹æœ¬ä¸éœ€è¦è€ƒè™‘æŒ‚è½½å’Œå¸è½½ã€‚é‡è¦çš„æ˜¯ï¼Œä½ å·²ç»æŒ‡å®šäº† Effect å¦‚ä½•å¼€å§‹å’Œåœæ­¢åŒæ­¥ã€‚ç›®å‰ï¼Œå®ƒæ²¡æœ‰ä»»ä½•å“åº”å¼ä¾èµ–ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¸Œæœ›ç”¨æˆ·éšæ—¶é—´æ”¹å˜ <code>roomId</code> æˆ– <code>serverUrl</code>ï¼ˆå®ƒä»¬å°†å˜ä¸ºå“åº”å¼ï¼‰ï¼ŒEffect çš„ä»£ç ä¸éœ€è¦æ”¹å˜ã€‚åªéœ€è¦å°†å®ƒä»¬æ·»åŠ åˆ°ä¾èµ–é¡¹ä¸­å³å¯ã€‚</p><hr><p><mark>åœ¨ç»„ä»¶ä¸»ä½“ä¸­å£°æ˜çš„æ‰€æœ‰å˜é‡éƒ½æ˜¯å“åº”å¼çš„</mark>ï¼šProps å’Œ state å¹¶ä¸æ˜¯å”¯ä¸€çš„å“åº”å¼å€¼ã€‚ä»å®ƒä»¬è®¡ç®—å‡ºçš„å€¼ä¹Ÿæ˜¯å“åº”å¼çš„ã€‚å¦‚æœ props æˆ– state å‘ç”Ÿå˜åŒ–ï¼Œç»„ä»¶å°†é‡æ–°æ¸²æŸ“ï¼Œä»ä¸­è®¡ç®—å‡ºçš„å€¼ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Effect ä½¿ç”¨çš„ç»„ä»¶ä¸»ä½“ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åº”è¯¥åœ¨ä¾èµ–åˆ—è¡¨ä¸­ã€‚</p><p>å‡è®¾ç”¨æˆ·å¯ä»¥åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©èŠå¤©æœåŠ¡å™¨ï¼Œä½†ä»–ä»¬è¿˜å¯ä»¥åœ¨è®¾ç½®ä¸­é…ç½®é»˜è®¤æœåŠ¡å™¨ã€‚å‡è®¾ä½ å·²ç»å°†è®¾ç½®çŠ¶æ€æ”¾å…¥äº† <a href="https://zh-hans.react.dev/learn/scaling-up-with-reducer-and-context">ä¸Šä¸‹æ–‡</a>ï¼Œå› æ­¤ä»è¯¥ä¸Šä¸‹æ–‡ä¸­è¯»å– <code>settings</code>ã€‚ç°åœ¨ï¼Œå¯ä»¥æ ¹æ® props ä¸­é€‰æ‹©çš„æœåŠ¡å™¨å’Œé»˜è®¤æœåŠ¡å™¨æ¥è®¡ç®— <code>serverUrl</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vbd4g4lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vbd4g4lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId, selectedServerUrl &#125;</span>) &#123; <span class="hljs-comment">/*  roomId æ˜¯å“åº”å¼çš„  */</span> <br>  <span class="hljs-keyword">const</span> settings = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">SettingsContext</span>); <span class="hljs-comment">/* settings æ˜¯å“åº”å¼çš„   */</span><br>  <span class="hljs-keyword">const</span> serverUrl = selectedServerUrl ?? settings.<span class="hljs-property">defaultServerUrl</span>; <span class="hljs-comment">/*  serverUrl æ˜¯å“åº”å¼çš„  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">/*  Effect è¯»å–äº† roomId å’Œ serverUrl  */</span> <br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId, serverUrl]); <span class="hljs-comment">/*  å› æ­¤ï¼Œå½“å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒéœ€è¦é‡æ–°åŒæ­¥ï¼  */</span> <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>serverUrl</code> ä¸æ˜¯ prop æˆ– state å˜é‡ã€‚å®ƒæ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è®¡ç®—çš„æ™®é€šå˜é‡ã€‚ä½†æ˜¯å®ƒæ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è®¡ç®—çš„ï¼Œæ‰€ä»¥å®ƒå¯èƒ½ä¼šå› ä¸ºé‡æ–°æ¸²æŸ“è€Œæ”¹å˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒæ˜¯å“åº”å¼çš„ã€‚</p><p><strong>ç»„ä»¶å†…éƒ¨çš„æ‰€æœ‰å€¼ï¼ˆåŒ…æ‹¬ propsã€state å’Œç»„ä»¶ä½“å†…çš„å˜é‡ï¼‰éƒ½æ˜¯å“åº”å¼çš„ã€‚ä»»ä½•å“åº”å¼å€¼éƒ½å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“æ—¶å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å°†å“åº”å¼å€¼åŒ…æ‹¬åœ¨ Effect çš„ä¾èµ–é¡¹ä¸­</strong>ã€‚</p><p>æ¢å¥è¯è¯´ï¼ŒEffect å¯¹ç»„ä»¶ä½“å†…çš„æ‰€æœ‰å€¼éƒ½ä¼šâ€œreactâ€ã€‚</p><hr><p><mark>React ä¼šéªŒè¯æ˜¯å¦å°†æ¯ä¸ªå“åº”å¼å€¼éƒ½æŒ‡å®šä¸ºäº†ä¾èµ–é¡¹</mark>ï¼šå¦‚æœæ£€æŸ¥å·¥å…· <a href="https://zh-hans.react.dev/learn/editor-setup#linting">é…ç½®äº† React</a>ï¼Œå®ƒå°†æ£€æŸ¥ Effect ä»£ç ä¸­ä½¿ç”¨çš„æ¯ä¸ªå“åº”å¼å€¼æ˜¯å¦å·²å£°æ˜ä¸ºå…¶ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹æ˜¯ä¸€ä¸ª lint é”™è¯¯ï¼Œå› ä¸º <code>roomId</code> å’Œ <code>serverUrl</code> éƒ½æ˜¯å“åº”å¼çš„ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-o7nu3alqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-o7nu3alqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123; <span class="hljs-comment">/*  roomId æ˜¯å“åº”å¼çš„  */</span> <br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>); <span class="hljs-comment">/*  serverUrl æ˜¯å“åº”å¼çš„  */</span> <br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []); <span class="hljs-comment">/*  &lt;-- è¿™é‡Œæœ‰äº›é—®é¢˜ï¼  */</span> <br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        æœåŠ¡å™¨ URLï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;serverUrl&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setServerUrl(e.target.value)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        é€‰æ‹©èŠå¤©å®¤ï¼š&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>æ‰€æœ‰<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>æ—…æ¸¸<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>éŸ³ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-942sedlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-942sedlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  å®é™…çš„å®ç°å°†ä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ° &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€ &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; æˆ¿é—´ï¼Œä½äº&#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™å¯èƒ½çœ‹èµ·æ¥åƒæ˜¯ React é”™è¯¯ï¼Œä½†å®é™…ä¸Š React æ˜¯åœ¨æŒ‡å‡ºä»£ç ä¸­çš„ bugã€‚<code>roomId</code> å’Œ <code>serverUrl</code> éƒ½å¯èƒ½éšæ—¶é—´æ”¹å˜ï¼Œä½†å¿˜è®°äº†åœ¨å®ƒä»¬æ”¹å˜æ—¶é‡æ–°åŒæ­¥ Effectã€‚å³ä½¿ç”¨æˆ·åœ¨ UI ä¸­é€‰æ‹©äº†ä¸åŒçš„å€¼ï¼Œä»ç„¶ä¿æŒè¿æ¥åˆ°åˆå§‹çš„ <code>roomId</code> å’Œ <code>serverUrl</code>ã€‚</p><p>è¦ä¿®å¤è¿™ä¸ª bugï¼Œè¯·æŒ‰ç…§æ£€æŸ¥å·¥å…·çš„å»ºè®®å°† <code>roomId</code> å’Œ <code>serverUrl</code> ä½œä¸º Effect çš„ä¾èµ–è¿›è¡ŒæŒ‡å®šï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fi01y5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fi01y5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123; <span class="hljs-comment">/*  roomId æ˜¯å“åº”å¼çš„  */</span> <br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>); <span class="hljs-comment">/*  serverUrl æ˜¯å“åº”å¼çš„  */</span> <br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [serverUrl, roomId]); <span class="hljs-comment">/*  âœ… å£°æ˜çš„æ‰€æœ‰ä¾èµ–  */</span> <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä¸Šé¢çš„æ²™ç›’ä¸­å°è¯•è¿™ä¸ªä¿®å¤æ–¹æ³•ã€‚éªŒè¯ä¸€ä¸‹æ˜¯å¦æ¶ˆé™¤äº†æ£€æŸ¥å·¥å…·çš„é”™è¯¯ï¼Œå¹¶ä¸”åœ¨éœ€è¦æ—¶èŠå¤©ä¼šé‡æ–°è¿æ¥ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒReact <strong>çŸ¥é“</strong> ä¸€ä¸ªå€¼æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œå³ä½¿å®ƒåœ¨ç»„ä»¶å†…éƒ¨å£°æ˜ã€‚ä¾‹å¦‚ï¼Œä» <code>useState</code> è¿”å›çš„ <code>set</code> å‡½æ•°å’Œä» <code>useRef</code> è¿”å›çš„ ref å¯¹è±¡æ˜¯ <strong>ç¨³å®šçš„</strong> â€”â€”å®ƒä»¬ä¿è¯åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¸ä¼šæ”¹å˜ã€‚ç¨³å®šå€¼ä¸æ˜¯å“åº”å¼çš„ï¼Œå› æ­¤å¯ä»¥ä»åˆ—è¡¨ä¸­çœç•¥å®ƒä»¬ã€‚åŒ…æ‹¬å®ƒä»¬æ˜¯å…è®¸çš„ï¼šå®ƒä»¬ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥æ— å…³ç´§è¦ã€‚</p><hr><p><mark>å½“ä½ ä¸æƒ³è¿›è¡Œé‡æ–°åŒæ­¥æ—¶è¯¥æ€ä¹ˆåŠ </mark>ï¼šåœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œé€šè¿‡å°† <code>roomId</code> å’Œ <code>serverUrl</code> åˆ—ä¸ºä¾èµ–é¡¹æ¥ä¿®å¤äº† lint é”™è¯¯ã€‚</p><p>ç„¶è€Œï¼Œå¯ä»¥é€šè¿‡å‘æ£€æŸ¥å·¥å…·â€œè¯æ˜â€è¿™äº›å€¼ä¸æ˜¯å“åº”å¼å€¼ï¼Œå³å®ƒä»¬ <strong>ä¸ä¼š</strong> å› ä¸ºé‡æ–°æ¸²æŸ“è€Œæ”¹å˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>serverUrl</code> å’Œ <code>roomId</code> ä¸ä¾èµ–äºæ¸²æŸ“å¹¶ä¸”å§‹ç»ˆå…·æœ‰ç›¸åŒçš„å€¼ï¼Œå¯ä»¥å°†å®ƒä»¬ç§»åˆ°ç»„ä»¶å¤–éƒ¨ã€‚ç°åœ¨å®ƒä»¬ä¸éœ€è¦æˆä¸ºä¾èµ–é¡¹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v2mbi9lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v2mbi9lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>; <span class="hljs-comment">/*  serverUrl ä¸æ˜¯å“åº”å¼çš„  */</span> <br><span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;general&#x27;</span>; <span class="hljs-comment">/*  roomId ä¸æ˜¯å“åº”å¼çš„  */</span> <br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, []); <span class="hljs-comment">/*  âœ… å£°æ˜çš„æ‰€æœ‰ä¾èµ–  */</span> <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ä¹Ÿå¯ä»¥å°†å®ƒä»¬ <strong>ç§»åŠ¨åˆ° Effect å†…éƒ¨</strong>ã€‚å®ƒä»¬ä¸æ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è®¡ç®—çš„ï¼Œå› æ­¤å®ƒä»¬ä¸æ˜¯å“åº”å¼çš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tqnphklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tqnphklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>; <span class="hljs-comment">/* serverUrl ä¸æ˜¯å“åº”å¼çš„   */</span> <br>    <span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;general&#x27;</span>; <span class="hljs-comment">/*  roomId ä¸æ˜¯å“åº”å¼çš„  */</span> <br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>()<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, []); <span class="hljs-comment">/*  âœ… å£°æ˜çš„æ‰€æœ‰ä¾èµ–  */</span> <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>Effect æ˜¯ä¸€æ®µå“åº”å¼çš„ä»£ç å—</strong>ã€‚å®ƒä»¬åœ¨è¯»å–çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è¿›è¡ŒåŒæ­¥ã€‚ä¸äº‹ä»¶å¤„ç†ç¨‹åºä¸åŒï¼Œäº‹ä»¶å¤„ç†ç¨‹åºåªåœ¨æ¯æ¬¡äº¤äº’æ—¶è¿è¡Œä¸€æ¬¡ï¼Œè€Œ Effect åˆ™åœ¨éœ€è¦è¿›è¡ŒåŒæ­¥æ—¶è¿è¡Œã€‚</p><p><strong>ä¸èƒ½â€œé€‰æ‹©â€ä¾èµ–é¡¹</strong>ã€‚ä¾èµ–é¡¹å¿…é¡»åŒ…æ‹¬ Effect ä¸­è¯»å–çš„æ¯ä¸ª <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive">å“åº”å¼å€¼</a>ã€‚ä»£ç æ£€æŸ¥å·¥å…·ä¼šå¼ºåˆ¶æ‰§è¡Œæ­¤è§„åˆ™ã€‚æœ‰æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å‡ºç°æ— é™å¾ªç¯çš„é—®é¢˜ï¼Œæˆ–è€… Effect è¿‡äºé¢‘ç¹åœ°é‡æ–°è¿›è¡ŒåŒæ­¥ã€‚ä¸è¦é€šè¿‡ç¦ç”¨ä»£ç æ£€æŸ¥æ¥è§£å†³è¿™äº›é—®é¢˜ï¼ä¸‹é¢æ˜¯ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><strong>æ£€æŸ¥ Effect æ˜¯å¦è¡¨ç¤ºäº†ç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹</strong>ã€‚å¦‚æœ Effect æ²¡æœ‰è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼Œ<a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect">å¯èƒ½æ˜¯ä¸å¿…è¦çš„</a>ã€‚å¦‚æœå®ƒåŒæ—¶è¿›è¡Œäº†å‡ ä¸ªç‹¬ç«‹çš„åŒæ­¥æ“ä½œï¼Œ<a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process">å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª Effect</a>ã€‚</li><li><strong>å¦‚æœæƒ³è¯»å– props æˆ– state çš„æœ€æ–°å€¼ï¼Œä½†åˆä¸æƒ³å¯¹å…¶åšå‡ºååº”å¹¶é‡æ–°åŒæ­¥ Effect</strong>ï¼Œå¯ä»¥å°† Effect æ‹†åˆ†ä¸ºå…·æœ‰ååº”æ€§çš„éƒ¨åˆ†ï¼ˆä¿ç•™åœ¨ Effect ä¸­ï¼‰å’Œéååº”æ€§çš„éƒ¨åˆ†ï¼ˆæå–ä¸ºåä¸º â€œEffect Eventâ€ çš„å†…å®¹ï¼‰ã€‚<a href="https://zh-hans.react.dev/learn/separating-events-from-effects">é˜…è¯»å…³äºå°†äº‹ä»¶ä¸ Effect åˆ†ç¦»çš„å†…å®¹</a>ã€‚</li><li><strong>é¿å…å°†å¯¹è±¡å’Œå‡½æ•°ä½œä¸ºä¾èµ–é¡¹</strong>ã€‚å¦‚æœåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­åˆ›å»ºå¯¹è±¡å’Œå‡½æ•°ï¼Œç„¶ååœ¨ Effect ä¸­è¯»å–å®ƒä»¬ï¼Œå®ƒä»¬å°†åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¸åŒã€‚è¿™å°†å¯¼è‡´ Effect æ¯æ¬¡éƒ½é‡æ–°åŒæ­¥ã€‚<a href="https://zh-hans.react.dev/learn/removing-effect-dependencies">é˜…è¯»æœ‰å…³ä» Effect ä¸­åˆ é™¤ä¸å¿…è¦ä¾èµ–é¡¹çš„æ›´å¤šå†…å®¹</a>ã€‚</li></ul><p>æ£€æŸ¥å·¥å…·æ˜¯ä½ çš„æœ‹å‹ï¼Œä½†å®ƒä»¬çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚æ£€æŸ¥å·¥å…·åªçŸ¥é“ä¾èµ–å…³ç³»æ˜¯å¦ <strong>é”™è¯¯</strong>ã€‚å®ƒå¹¶ä¸çŸ¥é“æ¯ç§æƒ…å†µä¸‹çš„ <strong>æœ€ä½³</strong> è§£å†³æ–¹æ³•ã€‚å¦‚æœé™æ€ä»£ç åˆ†æå·¥å…·å»ºè®®æ·»åŠ æŸä¸ªä¾èµ–å…³ç³»ï¼Œä½†æ·»åŠ è¯¥ä¾èµ–å…³ç³»ä¼šå¯¼è‡´å¾ªç¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€åº”è¯¥å¿½ç•¥é™æ€ä»£ç åˆ†æå·¥å…·ã€‚éœ€è¦ä¿®æ”¹ Effect å†…éƒ¨ï¼ˆæˆ–å¤–éƒ¨ï¼‰çš„ä»£ç ï¼Œä½¿å¾—è¯¥å€¼ä¸æ˜¯å“åº”å¼çš„ï¼Œä¹Ÿä¸ <strong>éœ€è¦</strong> æˆä¸ºä¾èµ–é¡¹ã€‚</p><p>å¦‚æœæœ‰ä¸€ä¸ªç°æœ‰çš„ä»£ç åº“ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›åƒè¿™æ ·ç¦ç”¨äº†æ£€æŸ¥å·¥å…·çš„ Effectï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qvwuyolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qvwuyolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/*  ğŸ”´ é¿å…è¿™æ ·ç¦ç”¨é™æ€ä»£ç åˆ†æå·¥å…·ï¼šslint-ignore-next-line react-hooks/exhaustive-deps  */</span> <br>&#125;, []);<br></code></pre></td></tr></table></div></figure><h2 id="6-å°†äº‹ä»¶ä»-Effect-ä¸­åˆ†å¼€"><a href="#6-å°†äº‹ä»¶ä»-Effect-ä¸­åˆ†å¼€" class="headerlink" title="6.å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€"></a>6.å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€</h2><p>äº‹ä»¶å¤„ç†å‡½æ•°åªæœ‰åœ¨ä½ å†æ¬¡æ‰§è¡ŒåŒæ ·çš„äº¤äº’æ—¶æ‰ä¼šé‡æ–°è¿è¡Œã€‚Effect å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¸€æ ·ï¼Œå®ƒåªæœ‰åœ¨è¯»å–çš„ props æˆ– state å€¼å’Œä¸Šä¸€æ¬¡æ¸²æŸ“ä¸ä¸€æ ·æ—¶æ‰ä¼šé‡æ–°åŒæ­¥ã€‚æœ‰æ—¶ä½ éœ€è¦è¿™ä¸¤ç§è¡Œä¸ºçš„æ··åˆä½“ï¼šå³ä¸€ä¸ª Effect åªåœ¨å“åº”æŸäº›å€¼æ—¶é‡æ–°è¿è¡Œï¼Œä½†æ˜¯åœ¨å…¶ä»–å€¼å˜åŒ–æ—¶ä¸é‡æ–°è¿è¡Œã€‚</p><p>é¦–å…ˆè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect çš„åŒºåˆ«ã€‚</p><p>å‡è®¾ä½ æ­£åœ¨å®ç°ä¸€ä¸ªèŠå¤©å®¤ç»„ä»¶ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p><ol><li>ç»„ä»¶åº”è¯¥è‡ªåŠ¨è¿æ¥é€‰ä¸­çš„èŠå¤©å®¤ã€‚</li><li>æ¯å½“ä½ ç‚¹å‡»â€œSendâ€æŒ‰é’®ï¼Œç»„ä»¶åº”è¯¥åœ¨å½“å‰èŠå¤©ç•Œé¢å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚</li></ol><p>å‡è®¾ä½ å·²ç»å®ç°äº†è¿™éƒ¨åˆ†ä»£ç ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ç¡®å®šåº”è¯¥æ”¾åœ¨å“ªé‡Œã€‚ä½ æ˜¯åº”è¯¥ç”¨äº‹ä»¶å¤„ç†å‡½æ•°è¿˜æ˜¯ Effect å‘¢ï¼Ÿæ¯å½“ä½ éœ€è¦å›ç­”è¿™ä¸ªé—®é¢˜æ—¶ï¼Œè¯·è€ƒè™‘ä¸€ä¸‹ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects#what-are-effects-and-how-are-they-different-from-events">ä¸ºä»€ä¹ˆä»£ç éœ€è¦è¿è¡Œ</a>ã€‚</p><hr><p><mark>äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç‰¹å®šçš„äº¤äº’æ“ä½œæ—¶è¿è¡Œ</mark>ï¼šä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œå‘é€æ¶ˆæ¯æ˜¯ <strong>å› ä¸º</strong> ä»–ç‚¹å‡»äº†ç‰¹å®šçš„â€œSendâ€æŒ‰é’®ã€‚å¦‚æœåœ¨ä»»æ„æ—¶é—´æˆ–è€…å› ä¸ºå…¶ä»–åŸå› å‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·ä¼šè§‰å¾—éå¸¸æ··ä¹±ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‘é€æ¶ˆæ¯åº”è¯¥ä½¿ç”¨äº‹ä»¶å¤„ç†å‡½æ•°ã€‚äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯è®©ä½ å¤„ç†ç‰¹å®šçš„äº¤äº’æ“ä½œçš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-oozv0vlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-oozv0vlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">/*    */</span><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSendClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">sendMessage</span>(message);<br>  &#125;<br>  <span class="hljs-comment">/*    */</span><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;message&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setMessage(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSendClick&#125;</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å€ŸåŠ©äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä½ å¯ä»¥ç¡®ä¿ <code>sendMessage(message)</code> <strong>åª</strong> åœ¨ç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™è¿è¡Œã€‚</p><hr><p><mark>æ¯å½“éœ€è¦åŒæ­¥ï¼ŒEffect å°±ä¼šè¿è¡Œ </mark>ï¼šå›æƒ³ä¸€ä¸‹ï¼Œä½ è¿˜éœ€è¦è®©ç»„ä»¶å’ŒèŠå¤©å®¤ä¿æŒè¿æ¥ã€‚ä»£ç æ”¾å“ªé‡Œå‘¢ï¼Ÿ</p><p>è¿è¡Œè¿™ä¸ªä»£ç çš„ <strong>åŸå› </strong> ä¸æ˜¯ç‰¹å®šçš„äº¤äº’æ“ä½œã€‚ç”¨æˆ·ä¸ºä»€ä¹ˆæˆ–æ€ä¹ˆå¯¼èˆªåˆ°èŠå¤©å®¤å±å¹•çš„éƒ½ä¸é‡è¦ã€‚æ—¢ç„¶ç”¨æˆ·æ­£åœ¨çœ‹å®ƒå¹¶ä¸”èƒ½å¤Ÿå’Œå®ƒäº¤äº’ï¼Œç»„ä»¶å°±è¦å’Œé€‰ä¸­çš„èŠå¤©æœåŠ¡å™¨ä¿æŒè¿æ¥ã€‚å³ä½¿èŠå¤©å®¤ç»„ä»¶æ˜¾ç¤ºçš„æ˜¯åº”ç”¨çš„åˆå§‹å±å¹•ï¼Œç”¨æˆ·æ ¹æœ¬è¿˜æ²¡æœ‰æ‰§è¡Œä»»ä½•äº¤äº’ï¼Œä»ç„¶åº”è¯¥éœ€è¦ä¿æŒè¿æ¥ã€‚è¿™å°±æ˜¯è¿™é‡Œç”¨ Effect çš„åŸå› ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-70rxiklqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-70rxiklqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-comment">/*    */</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>();<br>    &#125;;<br>  &#125;, [roomId]);<br>  <span class="hljs-comment">/*    */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p><strong>æ— è®º</strong> ç”¨æˆ·æ˜¯å¦æ‰§è¡ŒæŒ‡å®šäº¤äº’æ“ä½œï¼Œè¿™æ®µä»£ç éƒ½å¯ä»¥ä¿è¯å½“å‰é€‰ä¸­çš„èŠå¤©å®¤æœåŠ¡å™¨ä¸€ç›´æœ‰ä¸€ä¸ªæ´»è·ƒè¿æ¥ã€‚ç”¨æˆ·æ˜¯å¦åªå¯åŠ¨äº†åº”ç”¨ï¼Œæˆ–é€‰ä¸­äº†ä¸åŒçš„èŠå¤©å®¤ï¼Œåˆæˆ–è€…å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•åè¿”å›ï¼ŒEffect éƒ½å¯ä»¥ç¡®ä¿ç»„ä»¶å’Œå½“å‰é€‰ä¸­çš„èŠå¤©å®¤ä¿æŒåŒæ­¥ï¼Œå¹¶åœ¨å¿…è¦æ—¶ <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#why-synchronization-may-need-to-happen-more-than-once">é‡æ–°è¿æ¥</a>ã€‚</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gzaeiolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gzaeiolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection, sendMessage &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSendClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">sendMessage</span>(message);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to the &#123;roomId&#125; room!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;message&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setMessage(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSendClick&#125;</span>&gt;</span>Send<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Choose the chat room:&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>general<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>travel<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>music<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setShow(!show)&#125;&gt;</span><br><span class="language-xml">        &#123;show ? &#x27;Close chat&#x27; : &#x27;Open chat&#x27;&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>&#125;</span><br><span class="language-xml">      &#123;show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span>&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ifdr8qlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ifdr8qlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">message</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ğŸ”µ You sent: &#x27;</span> + message);<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… Connecting to &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; room at &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ Disconnected from &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; room at &#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p><mark>å“åº”å¼å€¼å’Œå“åº”å¼é€»è¾‘ </mark>ï¼šç›´è§‚ä¸Šï¼Œä½ å¯ä»¥è¯´äº‹ä»¶å¤„ç†å‡½æ•°æ€»æ˜¯â€œæ‰‹åŠ¨â€è§¦å‘çš„ï¼Œä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ã€‚å¦ä¸€æ–¹é¢ï¼Œ Effect æ˜¯è‡ªåŠ¨è§¦å‘ï¼šæ¯å½“éœ€è¦ä¿æŒåŒæ­¥çš„æ—¶å€™ä»–ä»¬å°±ä¼šå¼€å§‹è¿è¡Œå’Œé‡æ–°è¿è¡Œã€‚</p><p>æœ‰ä¸€ä¸ªæ›´ç²¾ç¡®çš„æ–¹å¼æ¥è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç»„ä»¶å†…éƒ¨å£°æ˜çš„ state å’Œ props å˜é‡è¢«ç§°ä¸º  å“åº”å¼å€¼ã€‚æœ¬ç¤ºä¾‹ä¸­çš„ <code>serverUrl</code> ä¸æ˜¯å“åº”å¼å€¼ï¼Œä½† <code>roomId</code> å’Œ <code>message</code> æ˜¯ã€‚ä»–ä»¬å‚ä¸ç»„ä»¶çš„æ¸²æŸ“æ•°æ®æµï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rt5c1zlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rt5c1zlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [message, setMessage] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åƒè¿™æ ·çš„å“åº”å¼å€¼å¯ä»¥å› ä¸ºé‡æ–°æ¸²æŸ“è€Œå˜åŒ–ã€‚ä¾‹å¦‚ç”¨æˆ·å¯èƒ½ä¼šç¼–è¾‘ <code>message</code> æˆ–è€…åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰ä¸­ä¸åŒçš„ <code>roomId</code>ã€‚äº‹ä»¶å¤„ç†å‡½æ•°å’Œ Effect å¯¹äºå˜åŒ–çš„å“åº”æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li><strong>äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„</strong>ã€‚é™¤éç”¨æˆ·åˆæ‰§è¡Œäº†åŒæ ·çš„æ“ä½œï¼ˆä¾‹å¦‚ç‚¹å‡»ï¼‰ï¼Œå¦åˆ™è¿™æ®µé€»è¾‘ä¸ä¼šå†è¿è¡Œã€‚äº‹ä»¶å¤„ç†å‡½æ•°å¯ä»¥åœ¨â€œä¸å“åº”â€ä»–ä»¬å˜åŒ–çš„æƒ…å†µä¸‹è¯»å–å“åº”å¼å€¼ã€‚</li><li><strong>Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„</strong>ã€‚å¦‚æœ Effect è¦è¯»å–å“åº”å¼å€¼ï¼Œ<a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">ä½ å¿…é¡»å°†å®ƒæŒ‡å®šä¸ºä¾èµ–é¡¹</a>ã€‚å¦‚æœæ¥ä¸‹æ¥çš„é‡æ–°æ¸²æŸ“å¼•èµ·é‚£ä¸ªå€¼å˜åŒ–ï¼ŒReact å°±ä¼šä½¿ç”¨æ–°å€¼é‡æ–°è¿è¡Œ Effect å†…çš„é€»è¾‘ã€‚</li></ul><p>è®©æˆ‘ä»¬é‡æ–°çœ‹çœ‹å‰é¢çš„ç¤ºä¾‹æ¥è¯´æ˜å·®å¼‚ã€‚</p><p><mark>äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„</mark>ï¼šçœ‹è¿™è¡Œä»£ç ã€‚è¿™ä¸ªé€»è¾‘æ˜¯å“åº”å¼çš„å—ï¼Ÿ</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e2448blqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e2448blqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">sendMessage</span>(message);<br></code></pre></td></tr></table></div></figure><p>ä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œ**<code>message</code> çš„å˜åŒ–å¹¶ä¸æ„å‘³ç€ä»–ä»¬æƒ³è¦å‘é€æ¶ˆæ¯**ã€‚å®ƒåªèƒ½è¡¨æ˜ç”¨æˆ·æ­£åœ¨è¾“å…¥ã€‚æ¢å¥è¯è¯´ï¼Œå‘é€æ¶ˆæ¯çš„é€»è¾‘ä¸åº”è¯¥æ˜¯å“åº”å¼çš„ã€‚å®ƒä¸åº”è¯¥ä»…ä»…å› ä¸º å“åº”å¼å€¼ å˜åŒ–è€Œå†æ¬¡è¿è¡Œã€‚è¿™å°±æ˜¯åº”è¯¥æŠŠå®ƒå½’å…¥äº‹ä»¶å¤„ç†å‡½æ•°çš„åŸå› ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nt1bd7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nt1bd7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSendClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">sendMessage</span>(message);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯éå“åº”å¼çš„ï¼Œæ‰€ä»¥ <code>sendMessage(message)</code> åªä¼šåœ¨ç”¨æˆ·ç‚¹å‡»â€œSendâ€æŒ‰é’®çš„æ—¶å€™è¿è¡Œã€‚</p><p><mark>Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ </mark>ï¼šç°åœ¨è®©æˆ‘ä»¬è¿”å›è¿™å‡ è¡Œä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y6xmc3lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y6xmc3lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>connection.<span class="hljs-title function_">connect</span>();<br></code></pre></td></tr></table></div></figure><p>ä»ç”¨æˆ·è§’åº¦å‡ºå‘ï¼Œ**<code>roomId</code> çš„å˜åŒ–æ„å‘³ç€ä»–ä»¬çš„ç¡®æƒ³è¦è¿æ¥åˆ°ä¸åŒçš„æˆ¿é—´**ã€‚æ¢å¥è¯è¯´ï¼Œè¿æ¥æˆ¿é—´çš„é€»è¾‘åº”è¯¥æ˜¯å“åº”å¼çš„ã€‚ä½  <strong>éœ€è¦</strong> è¿™å‡ è¡Œä»£ç å’Œå“åº”å¼å€¼â€œä¿æŒåŒæ­¥â€ï¼Œå¹¶åœ¨å€¼ä¸åŒæ—¶å†æ¬¡è¿è¡Œã€‚è¿™å°±æ˜¯å®ƒè¢«å½’å…¥ Effect çš„åŸå› ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w1hz1plqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w1hz1plqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>        connection.<span class="hljs-title function_">disconnect</span>()<br>    &#125;;<br>&#125;, [roomId]);<br></code></pre></td></tr></table></div></figure><p>Effect æ˜¯å“åº”å¼çš„ï¼Œæ‰€ä»¥ <code>createConnection(serverUrl, roomId)</code> å’Œ <code>connection.connect()</code> ä¼šå› ä¸º <code>roomId</code> æ¯ä¸ªä¸åŒçš„å€¼è€Œè¿è¡Œã€‚Effect è®©èŠå¤©å®¤è¿æ¥å’Œå½“å‰é€‰ä¸­çš„æˆ¿é—´ä¿æŒäº†åŒæ­¥ã€‚</p><hr><p><mark>ä» Effect ä¸­æå–éå“åº”å¼é€»è¾‘ </mark>ï¼šå½“ä½ æƒ³æ··åˆä½¿ç”¨å“åº”å¼é€»è¾‘å’Œéå“åº”å¼é€»è¾‘æ—¶ï¼Œäº‹æƒ…å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³åœ¨ç”¨æˆ·è¿æ¥åˆ°èŠå¤©å®¤æ—¶å±•ç¤ºä¸€ä¸ªé€šçŸ¥ã€‚å¹¶ä¸”é€šè¿‡ä» props ä¸­è¯»å–å½“å‰ themeï¼ˆdark æˆ–è€… lightï¼‰æ¥å±•ç¤ºå¯¹åº”é¢œè‰²çš„é€šçŸ¥ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-eu2ik5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-eu2ik5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId, theme &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connected&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Connected!&#x27;</span>, theme);<br>    &#125;);<br>    connection.<span class="hljs-title function_">connect</span>();<br></code></pre></td></tr></table></div></figure><p>ä½†æ˜¯ <code>theme</code> æ˜¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå®ƒä¼šç”±äºé‡æ–°æ¸²æŸ“è€Œå˜åŒ–ï¼‰ï¼Œå¹¶ä¸” <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼éƒ½å¿…é¡»åœ¨å…¶ä¾èµ–é¡¹ä¸­å£°æ˜</a>ã€‚ç°åœ¨ä½ å¿…é¡»æŠŠ <code>theme</code> ä½œä¸º Effect çš„ä¾èµ–é¡¹ä¹‹ä¸€ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mhixq2lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mhixq2lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId, theme &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connected&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Connected!&#x27;</span>, theme);<br>    &#125;);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      connection.<span class="hljs-title function_">disconnect</span>()<br>    &#125;;<br>  &#125;, [roomId, theme]); <span class="hljs-comment">/*  âœ… å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹  */</span> <br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>ç”¨è¿™ä¸ªä¾‹å­è¯•ä¸€ä¸‹ï¼Œçœ‹ä½ èƒ½å¦çœ‹å‡ºè¿™ä¸ªç”¨æˆ·ä½“éªŒé—®é¢˜ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mth7uelqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mth7uelqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection, sendMessage &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; showNotification &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./notifications.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId, theme &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connected&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Connected!&#x27;</span>, theme);<br>    &#125;);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId, theme]);<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to the &#123;roomId&#125; room!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [isDark, setIsDark] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Choose the chat room:&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>general<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>travel<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>music<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">checked</span>=<span class="hljs-string">&#123;isDark&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setIsDark(e.target.checked)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        Use dark theme</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">theme</span>=<span class="hljs-string">&#123;isDark</span> ? &#x27;<span class="hljs-attr">dark</span>&#x27; <span class="hljs-attr">:</span> &#x27;<span class="hljs-attr">light</span>&#x27;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4br4eclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4br4eclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">let</span> connectedCallback;<br>  <span class="hljs-keyword">let</span> timeout;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (connectedCallback) &#123;<br>          <span class="hljs-title function_">connectedCallback</span>();<br>        &#125;<br>      &#125;, <span class="hljs-number">100</span>);<br>    &#125;,<br>    <span class="hljs-title function_">on</span>(<span class="hljs-params">event, callback</span>) &#123;<br>      <span class="hljs-keyword">if</span> (connectedCallback) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Cannot add the handler twice.&#x27;</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (event !== <span class="hljs-string">&#x27;connected&#x27;</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Only &quot;connected&quot; event is supported.&#x27;</span>);<br>      &#125;<br>      connectedCallback = callback;<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-built_in">clearTimeout</span>(timeout);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>notifications.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vtz0xylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vtz0xylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Toastify</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;toastify-js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;toastify-js/src/toastify.css&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showNotification</span>(<span class="hljs-params">message, theme</span>) &#123;<br>  <span class="hljs-title class_">Toastify</span>(&#123;<br>    <span class="hljs-attr">text</span>: message,<br>    <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>,<br>    <span class="hljs-attr">gravity</span>: <span class="hljs-string">&#x27;top&#x27;</span>,<br>    <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;right&#x27;</span>,<br>    <span class="hljs-attr">style</span>: &#123;<br>      <span class="hljs-attr">background</span>: theme === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-string">&#x27;black&#x27;</span> : <span class="hljs-string">&#x27;white&#x27;</span>,<br>      <span class="hljs-attr">color</span>: theme === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-string">&#x27;white&#x27;</span> : <span class="hljs-string">&#x27;black&#x27;</span>,<br>    &#125;,<br>  &#125;).<span class="hljs-title function_">showToast</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“ <code>roomId</code> å˜åŒ–æ—¶ï¼ŒèŠå¤©ä¼šå’Œé¢„æœŸä¸€æ ·é‡æ–°è¿æ¥ã€‚ä½†æ˜¯ç”±äº <code>theme</code> ä¹Ÿæ˜¯ä¸€ä¸ªä¾èµ–é¡¹ï¼Œæ‰€ä»¥æ¯æ¬¡ä½ åœ¨ dark å’Œ light ä¸»é¢˜é—´åˆ‡æ¢æ—¶ï¼ŒèŠå¤© <strong>ä¹Ÿä¼š</strong> é‡è¿ã€‚è¿™ä¸æ˜¯å¾ˆå¥½ï¼</p><p>æ¢è¨€ä¹‹ï¼Œå³ä½¿å®ƒåœ¨ Effect å†…éƒ¨ï¼ˆè¿™æ˜¯å“åº”å¼çš„ï¼‰ï¼Œä½ ä¹Ÿä¸æƒ³è®©è¿™è¡Œä»£ç å˜æˆå“åº”å¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nmp3r5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nmp3r5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Connected!&#x27;</span>, theme);<br></code></pre></td></tr></table></div></figure><p>ä½ éœ€è¦ä¸€ä¸ªå°†è¿™ä¸ªéå“åº”å¼é€»è¾‘å’Œå‘¨å›´å“åº”å¼ Effect éš”ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚</p><h2 id="7-ç§»é™¤-Effect-ä¾èµ–"><a href="#7-ç§»é™¤-Effect-ä¾èµ–" class="headerlink" title="7.ç§»é™¤ Effect ä¾èµ–"></a>7.ç§»é™¤ Effect ä¾èµ–</h2><p>å½“ç¼–å†™ Effect æ—¶ï¼Œlinter ä¼šéªŒè¯æ˜¯å¦å·²ç»å°† Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå¦‚ props å’Œ stateï¼‰åŒ…å«åœ¨ Effect çš„ä¾èµ–ä¸­ã€‚è¿™å¯ä»¥ç¡®ä¿ Effect ä¸ç»„ä»¶çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚ä¸å¿…è¦çš„ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´ Effect è¿è¡Œè¿‡äºé¢‘ç¹ï¼Œç”šè‡³äº§ç”Ÿæ— é™å¾ªç¯ã€‚è¯·æŒ‰ç…§æœ¬æŒ‡å—å®¡æŸ¥å¹¶ç§»é™¤ Effect ä¸­ä¸å¿…è¦çš„ä¾èµ–ã€‚</p><p><mark>ä¾èµ–åº”è¯¥å’Œä»£ç ä¿æŒä¸€è‡´ </mark>ï¼šå½“ä½ ç¼–å†™ Effect æ—¶ï¼Œæ— è®ºè¿™ä¸ª Effect è¦åšä»€ä¹ˆï¼Œä½ é¦–å…ˆè¦æ˜ç¡®å…¶ <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect">ç”Ÿå‘½å‘¨æœŸ</a>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d29u12lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d29u12lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>        connection.<span class="hljs-title function_">connect</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ è®¾ç½® Effect çš„ä¾èµ–æ˜¯ç©ºæ•°ç»„ï¼ˆ<code>[]</code>ï¼‰ï¼Œé‚£ä¹ˆ linter å°†ä¼šå»ºè®®åˆé€‚çš„ä¾èµ–ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kg54bhlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kg54bhlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []); <span class="hljs-comment">/*  &lt;-- ä¿®å¤è¿™é‡Œçš„ä¾èµ–ï¼  */</span> <br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;æ‰€æœ‰&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        é€‰æ‹©èŠå¤©å®¤ï¼š</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ‰€æœ‰&quot;</span>&gt;</span>æ‰€æœ‰<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ—…æ¸¸&quot;</span>&gt;</span>æ—…æ¸¸<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;éŸ³ä¹&quot;</span>&gt;</span>éŸ³ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3rqzsplqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3rqzsplqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ°â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŒ‰ç…§ linter çš„å»ºè®®ï¼ŒæŠŠå®ƒä»¬å¡«è¿›å»ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p93jp5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p93jp5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span> <br>&#125;<br></code></pre></td></tr></table></div></figure><p><a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">Effect â€œååº”â€å“åº”å¼å€¼</a> å› ä¸ºè¿™é‡Œçš„ <code>roomId</code> æ˜¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå®ƒå¯èƒ½éšé‡æ–°æ¸²æŸ“è€Œæ”¹å˜ï¼‰ï¼Œæ‰€ä»¥ linter ä¼šéªŒè¯ä½ æ˜¯å¦å°†å®ƒæŒ‡å®šä¸ºä¾èµ–ã€‚å¦‚æœ <code>roomId</code> å˜æˆä¸åŒçš„å€¼ï¼ŒReact å°†é‡æ–°è¿è¡Œ Effectã€‚è¿™å¯ä»¥ç¡®ä¿èŠå¤©ç•Œé¢ä¸æ‰€é€‰æˆ¿é—´ä¿æŒä¸€è‡´ï¼Œå¹¶æŠŠå˜åŒ–â€œåé¦ˆâ€ç»™ä¸‹æ‹‰èœå•ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jm1l2klqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jm1l2klqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;æ‰€æœ‰&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        é€‰æ‹©èŠå¤©å®¤ï¼š</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ‰€æœ‰&quot;</span>&gt;</span>æ‰€æœ‰<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æ—…æ¸¸&quot;</span>&gt;</span>æ—…æ¸¸<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;éŸ³ä¹&quot;</span>&gt;</span>éŸ³ä¹<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span> <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vc1o2slqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vc1o2slqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ°â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p><mark>å½“è¦ç§»é™¤ä¸€ä¸ªä¾èµ–æ—¶ï¼Œè¯·è¯æ˜å®ƒä¸æ˜¯ä¸€ä¸ªä¾èµ–</mark>ï¼šæ³¨æ„ï¼Œä½ ä¸èƒ½â€œé€‰æ‹©â€ Effect çš„ä¾èµ–ã€‚æ¯ä¸ªè¢« Effect æ‰€ä½¿ç”¨çš„å“åº”å¼å€¼ï¼Œå¿…é¡»åœ¨ä¾èµ–ä¸­å£°æ˜ã€‚ä¾èµ–æ˜¯ç”± Effect çš„ä»£ç å†³å®šçš„ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wpt56olqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wpt56olqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123; <span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªå“åº”å¼å€¼</span><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId); <span class="hljs-comment">// Effect åœ¨è¿™é‡Œè¯»å–å“åº”å¼å€¼</span><br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]); <span class="hljs-comment">// âœ… æ‰€ä»¥ä½ å¿…é¡»åœ¨ä¾èµ–ä¸­å£°æ˜ Effect ä½¿ç”¨çš„å“åº”å¼å€¼</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p><a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#all-variables-declared-in-the-component-body-are-reactive">å“åº”å¼å€¼</a> åŒ…æ‹¬ props ä»¥åŠæ‰€æœ‰ä½ ç›´æ¥åœ¨ç»„ä»¶ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚ç”±äº <code>roomId</code> æ˜¯å“åº”å¼å€¼ï¼Œä½ ä¸èƒ½æŠŠå®ƒä»ä¾èµ–ä¸­ç§»é™¤ã€‚linter ä¸å…è®¸è¿™æ ·åšï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cbwaj7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cbwaj7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []); <span class="hljs-comment">// ğŸ”´ React Hook useEffect ç¼ºå¤±ä¾èµ–: &#x27;roomId&#x27;</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>linter æ˜¯å¯¹çš„ï¼ ç”±äº <code>roomId</code> å¯èƒ½ä¼šéšæ—¶é—´å˜åŒ–ï¼Œè¿™ä¼šåœ¨ä»£ç ä¸­å¼•å…¥é”™è¯¯ã€‚</p><p><strong>ç§»é™¤ä¸€ä¸ªä¾èµ–ï¼Œä½ éœ€è¦å‘ linter è¯æ˜å…¶ä¸éœ€è¦è¿™ä¸ªä¾èµ–</strong>ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† <code>roomId</code> ç§»å‡ºç»„ä»¶ï¼Œä»¥è¯æ˜å®ƒä¸æ˜¯å“åº”çš„ï¼Œä¹Ÿä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0apcsllqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0apcsllqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;éŸ³ä¹&#x27;</span>; <span class="hljs-comment">// ä¸å†æ˜¯å“åº”å¼å€¼</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []); <span class="hljs-comment">// âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ <code>roomId</code> ä¸æ˜¯å“åº”å¼å€¼ï¼ˆå¹¶ä¸”ä¸èƒ½åœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ï¼‰ï¼Œé‚£å®ƒä¸å°±ä¸æ˜¯ä¾èµ–ï¼š</p><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cw0vw0lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cw0vw0lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> serverUrl = <span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>;<br><span class="hljs-keyword">const</span> roomId = <span class="hljs-string">&#x27;éŸ³ä¹&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(serverUrl, roomId);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿æ¥åˆ° &#123;roomId&#125; æˆ¿é—´ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vat0znlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vat0znlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">serverUrl, roomId</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°å®é™…ä¸Šä¼šè¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… è¿æ¥åˆ°â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ æ–­å¼€â€œ&#x27;</span> + roomId + <span class="hljs-string">&#x27;â€æˆ¿é—´ï¼Œåœ¨ &#x27;</span> + serverUrl);<br>    &#125;<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç°åœ¨å¯ä»¥æŒ‡å®š <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means">ç©ºï¼ˆ<code>[]</code>ï¼‰ä¾èµ–</a>ã€‚Effect <strong>çœŸçš„ä¸</strong> ä¾èµ–ä»»ä½•å“åº”å¼å€¼äº†ï¼Œä¹Ÿ <strong>çœŸçš„ä¸</strong> éœ€è¦åœ¨ç»„ä»¶çš„ props æˆ– state æ”¹å˜æ—¶é‡æ–°è¿è¡Œã€‚</p><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°å·¥ä½œæµç¨‹ä¸­æœ‰ä¸€ä¸ªæ¨¡å¼ï¼š</p><ol><li>é¦–å…ˆï¼Œä½  <strong>æ”¹å˜ Effect çš„ä»£ç </strong> æˆ–å“åº”å¼å€¼çš„å£°æ˜æ–¹å¼ã€‚</li><li>ç„¶åï¼Œä½ é‡‡çº³ linter çš„å»ºè®®ï¼Œè°ƒæ•´ä¾èµ–ï¼Œä»¥ <strong>åŒ¹é…ä½ æ‰€æ”¹å˜çš„ä»£ç </strong>ã€‚</li><li>å¦‚æœä½ å¯¹ä¾èµ–ä¸æ»¡æ„ï¼Œä½ å¯ä»¥ <strong>å›åˆ°ç¬¬ä¸€æ­¥</strong>ï¼ˆå¹¶å†æ¬¡ä¿®æ”¹ä»£ç ï¼‰ã€‚</li></ol><p>æœ€åä¸€éƒ¨åˆ†å¾ˆé‡è¦ã€‚<strong>å¦‚æœä½ æƒ³æ”¹å˜ä¾èµ–ï¼Œé¦–å…ˆè¦æ”¹å˜æ‰€æ¶‰åŠåˆ°çš„ä»£ç </strong>ã€‚ä½ å¯ä»¥æŠŠä¾èµ–çœ‹ä½œæ˜¯ <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency">Effectçš„ä»£ç æ‰€ä¾èµ–çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨</a>ã€‚ä½ ä¸è¦ <strong>é€‰æ‹©</strong> æŠŠä»€ä¹ˆæ”¾åœ¨è¿™ä¸ªåˆ—è¡¨ä¸Šã€‚è¯¥åˆ—è¡¨ <strong>æè¿°äº†</strong> ä»£ç ã€‚è¦æ”¹å˜ä¾èµ–ï¼Œè¯·æ”¹å˜ä»£ç ã€‚</p><p>è¿™å¯èƒ½æ„Ÿè§‰å°±åƒè§£æ–¹ç¨‹ä¸€æ ·ã€‚ä½ æœ‰ä¸€ä¸ªç›®æ ‡ï¼ˆä¾‹å¦‚ï¼Œç§»é™¤ä¸€ä¸ªä¾èµ–ï¼‰ï¼Œä½ éœ€è¦â€œæ‰¾åˆ°â€ä¸è¯¥ç›®æ ‡ç›¸åŒ¹é…çš„ä»£ç ã€‚ä¸æ˜¯æ¯ä¸ªäººéƒ½è§‰å¾—è§£æ–¹ç¨‹å¾ˆæœ‰è¶£ï¼Œå†™ Effect ä¹Ÿæ˜¯å¦‚æ­¤ï¼å¹¸è¿çš„æ˜¯ï¼Œä¸‹é¢æœ‰ä¸€äº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆä½ å¯ä»¥å»å°è¯•ã€‚</p><p>å¦‚æœä½ æœ‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ä»£ç åº“ï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€äº›åƒè¿™æ ·æŠ‘åˆ¶ linter çš„ä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gkjuzglqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gkjuzglqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/* ğŸ”´ é¿å…åƒè¿™æ ·æŠ‘åˆ¶ linter çš„è­¦å‘Šæˆ–é”™è¯¯æç¤ºï¼šeslint-ignore-next-line react-hooks/exhaustive-deps   */</span> <br>&#125;, []);<br></code></pre></td></tr></table></div></figure><p>å½“ä¾èµ–ä¸ä»£ç ä¸åŒ¹é…æ—¶ï¼Œææœ‰å¯èƒ½å¼•å…¥ bugã€‚é€šè¿‡æŠ‘åˆ¶ linterï¼Œä½ æ˜¯åœ¨ Effect æ‰€ä¾èµ–çš„å€¼ä¸Šå¯¹ React â€œæ’’è°â€ã€‚</p><hr><p><mark>ç§»é™¤éå¿…éœ€çš„ä¾èµ–</mark>ï¼šæ¯å½“ä½ è°ƒæ•´ Effect çš„ä¾èµ–ä»¥é€‚é…ä»£ç æ—¶ï¼Œè¯·æ³¨æ„ä¸€ä¸‹å½“å‰çš„ä¾èµ–ã€‚å½“è¿™äº›ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®© Effect é‡æ–°è¿è¡Œæ˜¯å¦æœ‰æ„ä¹‰ï¼Ÿæœ‰æ—¶ï¼Œç­”æ¡ˆæ˜¯â€œä¸â€ï¼š</p><ul><li>ä½ å¯èƒ½æƒ³åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹é‡æ–°æ‰§è¡Œ Effect çš„ <strong>ä¸åŒéƒ¨åˆ†</strong>ã€‚</li><li>ä½ å¯èƒ½æƒ³åªè¯»å–æŸä¸ªä¾èµ–çš„ <strong>æœ€æ–°å€¼</strong>ï¼Œè€Œä¸æ˜¯å¯¹å…¶å˜åŒ–åšå‡ºâ€œååº”â€ã€‚</li><li>ä¾èµ–å¯èƒ½ä¼šå› ä¸ºå®ƒçš„ç±»å‹æ˜¯å¯¹è±¡æˆ–å‡½æ•°è€Œ <strong>æ— æ„é—´</strong> æ”¹å˜å¤ªé¢‘ç¹ã€‚</li></ul><p>ä¸ºäº†æ‰¾åˆ°æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼Œä½ éœ€è¦å›ç­”å…³äº Effect çš„å‡ ä¸ªé—®é¢˜ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›é—®é¢˜ã€‚</p><p>ä½ åº”è¯¥è€ƒè™‘çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œè¿™æ®µä»£ç æ˜¯å¦åº”è¯¥æˆä¸º Effectã€‚</p><p>æƒ³è±¡ä¸€ä¸ªè¡¨å•ï¼Œåœ¨æäº¤æ—¶ä½ å°† <code>submitted</code> çŠ¶æ€å˜é‡è®¾ç½®ä¸º <code>true</code>ï¼Œå¹¶åœ¨ <code>submitted</code> ä¸º <code>true</code> æ—¶ï¼Œéœ€è¦å‘é€ POST è¯·æ±‚å¹¶æ˜¾ç¤ºé€šçŸ¥ã€‚ä½ æŠŠè¿™ä¸ªé€»è¾‘æ”¾åœ¨ Effect å†…ï¼Œå¹¶æ ¹æ® <code>submitted</code> ä¸º <code>true</code> â€œååº”â€ã€‚</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v2afxhlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v2afxhlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [submitted, setSubmitted] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (submitted) &#123;<br>     <span class="hljs-comment">/*  ğŸ”´ é¿å…: Effect ä¸­æœ‰ç‰¹å®šäº‹ä»¶çš„é€»è¾‘  */</span> <br>      <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/register&#x27;</span>);<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Successfully registered!&#x27;</span>);<br>    &#125;<br>  &#125;, [submitted]);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setSubmitted</span>(<span class="hljs-literal">true</span>);<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åæ¥ï¼Œä½ æƒ³é€šè¿‡è¯»å–å½“å‰çš„ä¸»é¢˜å€¼æ¥è°ƒæ•´é€šçŸ¥ä¿¡æ¯çš„æ ·å¼ã€‚å› ä¸º <code>theme</code> æ˜¯åœ¨ç»„ä»¶ä¸­å£°æ˜çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯å“åº”å¼å€¼ï¼Œä½ å†³å®šæŠŠå®ƒä½œä¸ºä¾èµ–åŠ å…¥ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sa841klqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sa841klqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [submitted, setSubmitted] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (submitted) &#123;<br>      <span class="hljs-comment">/*  ğŸ”´ é¿å…: Effect ä¸­æœ‰ç‰¹å®šäº‹ä»¶çš„é€»è¾‘  */</span> <br>      <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/register&#x27;</span>);<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Successfully registered!&#x27;</span>, theme);<br>    &#125;<br>  &#125;, [submitted, theme]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">setSubmitted</span>(<span class="hljs-literal">true</span>);<br>  &#125;  <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœè¿™ä¹ˆåšï¼Œä½ å°†å¼•å…¥ä¸€ä¸ªé”™è¯¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ å…ˆæäº¤è¡¨å•ï¼Œç„¶ååˆ‡æ¢æš—äº®ä¸»é¢˜ã€‚å½“ <code>theme</code> æ”¹å˜åï¼ŒEffect é‡æ–°è¿è¡Œï¼Œè¿™å°†å¯¼è‡´æ˜¾ç¤ºä¸¤æ¬¡ç›¸åŒçš„é€šçŸ¥ï¼</p><p><strong>é¦–å…ˆï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œä»£ç ä¸åº”è¯¥ä»¥ Effect å®ç°</strong>ã€‚ä½ æƒ³å‘é€è¿™ä¸ª POST è¯·æ±‚ï¼Œå¹¶åœ¨ <strong>æäº¤è¡¨å•æ—¶æ˜¾ç¤ºé€šçŸ¥</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹å®šçš„äº¤äº’ã€‚ç‰¹å®šçš„äº¤äº’è¯·å°†è¯¥é€»è¾‘ç›´æ¥æ”¾åˆ°ç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ogb5imlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ogb5imlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> theme = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">/*  âœ… å¥½ï¼šä»äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨ç‰¹å®šäºäº‹ä»¶çš„é€»è¾‘  */</span> <br>    <span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/register&#x27;</span>);<br>    <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;Successfully registered!&#x27;</span>, theme);<br>  &#125; <br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ï¼Œä»£ç åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œå®ƒä¸æ˜¯å“åº”å¼çš„ â€”â€” æ‰€ä»¥å®ƒåªåœ¨ç”¨æˆ·æäº¤è¡¨å•æ—¶è¿è¡Œã€‚é˜…è¯»æ›´å¤šå…³äº <a href="https://zh-hans.react.dev/learn/separating-events-from-effects#reactive-values-and-reactive-logic">åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå’Œ Effect ä¹‹é—´åšå‡ºé€‰æ‹©</a> å’Œ <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect">å¦‚ä½•åˆ é™¤ä¸å¿…è¦çš„ Effect</a>ã€‚</p><p>ä¸‹ä¸€ä¸ªåº”è¯¥é—®è‡ªå·±çš„é—®é¢˜æ˜¯ï¼ŒEffect æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…ã€‚</p><p>å¦‚ä¸‹ä¾‹å­ï¼Œä½ æ­£åœ¨å®ç°è¿è¾“è¡¨å•ï¼Œç”¨æˆ·éœ€è¦é€‰æ‹©ä»–ä»¬çš„åŸå¸‚å’Œåœ°åŒºã€‚ä½ æ ¹æ®æ‰€é€‰çš„â€œå›½å®¶â€ä»æœåŠ¡å™¨ä¸Šè·å–â€œåŸå¸‚â€åˆ—è¡¨ï¼Œç„¶ååœ¨ä¸‹æ‹‰èœå•ä¸­æ˜¾ç¤ºï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3862hulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3862hulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ShippingForm</span>(<span class="hljs-params">&#123; country &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [cities, setCities] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [city, setCity] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/cities?country=<span class="hljs-subst">$&#123;country&#125;</span>`</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (!ignore) &#123;<br>          <span class="hljs-title function_">setCities</span>(json);<br>        &#125;<br>      &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      ignore = <span class="hljs-literal">true</span>;<br>    &#125;;<br>  &#125;, [country]); <span class="hljs-comment">/* âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜   */</span> <br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯ä¸€ä¸ª <a href="https://zh-hans.react.dev/learn/you-might-not-need-an-effect#fetching-data">åœ¨Effectä¸­è·å–æ•°æ®</a> çš„å¥½ä¾‹å­ï¼š<code>cities</code> state é€šè¿‡ç½‘ç»œå’Œ <code>country</code> props è¿›è¡Œâ€œåŒæ­¥â€ã€‚ä½†ä½ ä¸èƒ½åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿™æ ·åšï¼Œå› ä¸ºä½ éœ€è¦åœ¨ <code>ShippingForm</code> æ˜¾ç¤ºæ—¶å’Œ <code>country</code> å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆä¸ç®¡æ˜¯å“ªä¸ªäº¤äº’å¯¼è‡´çš„ï¼‰ç«‹å³è·å–ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å‡è®¾ä½ è¦ä¸ºåŸå¸‚åŒºåŸŸæ·»åŠ ç¬¬äºŒä¸ªé€‰æ‹©æ¡†ï¼Œå®ƒåº”è¯¥è·å–å½“å‰é€‰æ‹©çš„ <code>city</code> çš„ <code>areas</code>ã€‚ä½ ä¹Ÿè®¸ä¼šåœ¨åŒä¸€ä¸ª Effect ä¸­æ·»åŠ ç¬¬äºŒä¸ª <code>fetch</code> è°ƒç”¨æ¥è·å–åœ°åŒºåˆ—è¡¨ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-plrylilqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-plrylilqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ShippingForm</span>(<span class="hljs-params">&#123; country &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [cities, setCities] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [city, setCity] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [areas, setAreas] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/cities?country=<span class="hljs-subst">$&#123;country&#125;</span>`</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (!ignore) &#123;<br>          <span class="hljs-title function_">setCities</span>(json);<br>        &#125;<br>      &#125;);<br>    <span class="hljs-comment">/*  ğŸ”´ é¿å…: å•ä¸ª Effect åŒæ­¥ä¸¤ä¸ªç‹¬ç«‹é€»è¾‘å¤„ç†  */</span> <br>    <span class="hljs-keyword">if</span> (city) &#123;<br>      <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/areas?city=<span class="hljs-subst">$&#123;city&#125;</span>`</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (!ignore) &#123;<br>            <span class="hljs-title function_">setAreas</span>(json);<br>          &#125;<br>        &#125;);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      ignore = <span class="hljs-literal">true</span>;<br>    &#125;;<br>  &#125;, [country, city]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span> <br></code></pre></td></tr></table></div></figure><p>ç„¶è€Œï¼Œç”±äº Effect ç°åœ¨ä½¿ç”¨ <code>city</code> state å˜é‡ï¼Œä½ ä¸å¾—ä¸æŠŠ <code>city</code> åŠ å…¥åˆ°ä¾èµ–ä¸­ã€‚è¿™åˆå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šå½“ç”¨æˆ·é€‰æ‹©ä¸åŒçš„åŸå¸‚æ—¶ï¼ŒEffect å°†é‡æ–°è¿è¡Œå¹¶è°ƒç”¨ <code>fetchCities(country)</code>ã€‚è¿™å°†å¯¼è‡´ä¸å¿…è¦åœ°å¤šæ¬¡è·å–åŸå¸‚åˆ—è¡¨ã€‚</p><p><strong>è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºï¼Œä½ åœ¨åŒæ­¥ä¸¤ä¸ªä¸åŒçš„ã€ä¸ç›¸å…³çš„ä¸œè¥¿</strong>ï¼š</p><ol><li>ä½ æƒ³è¦æ ¹æ® <code>country</code> props é€šè¿‡ç½‘ç»œåŒæ­¥ <code>city</code> state</li><li>ä½ æƒ³è¦æ ¹æ® <code>city</code> çŠ¶æ€é€šè¿‡ç½‘ç»œåŒæ­¥ <code>areas</code> state</li></ol><p>å°†é€»è¾‘åˆ†åˆ° 2 ä¸ª Effect ä¸­ï¼Œæ¯ä¸ª Effect ä»…å“åº”å…¶éœ€è¦åŒæ­¥å“åº”çš„ propsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e2qfv1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e2qfv1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ShippingForm</span>(<span class="hljs-params">&#123; country &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [cities, setCities] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/cities?country=<span class="hljs-subst">$&#123;country&#125;</span>`</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (!ignore) &#123;<br>          <span class="hljs-title function_">setCities</span>(json);<br>        &#125;<br>      &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      ignore = <span class="hljs-literal">true</span>;<br>    &#125;;<br>  &#125;, [country]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span><br>  <span class="hljs-keyword">const</span> [city, setCity] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-keyword">const</span> [areas, setAreas] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (city) &#123;<br>      <span class="hljs-keyword">let</span> ignore = <span class="hljs-literal">false</span>;<br>      <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/areas?city=<span class="hljs-subst">$&#123;city&#125;</span>`</span>)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> &#123;<br>          <span class="hljs-keyword">if</span> (!ignore) &#123;<br>            <span class="hljs-title function_">setAreas</span>(json);<br>          &#125;<br>        &#125;);<br>      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>        ignore = <span class="hljs-literal">true</span>;<br>      &#125;;<br>    &#125;<br>  &#125;, [city]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span> <br></code></pre></td></tr></table></div></figure><p>ç°åœ¨ï¼Œç¬¬ä¸€ä¸ª Effect åªåœ¨ <code>country</code> æ”¹å˜æ—¶é‡æ–°è¿è¡Œï¼Œè€Œç¬¬äºŒä¸ª Effect åœ¨ <code>city</code> æ”¹å˜æ—¶é‡æ–°è¿è¡Œã€‚ä½ å·²ç»æŒ‰ç›®çš„æŠŠå®ƒä»¬åˆ†å¼€äº†ï¼šä¸¤ä»¶ä¸åŒçš„äº‹æƒ…ç”±ä¸¤ä¸ªç‹¬ç«‹çš„ Effect æ¥åŒæ­¥ã€‚ä¸¤ä¸ªç‹¬ç«‹çš„ Effect æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ä¾èµ–ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šåœ¨æ— æ„ä¸­ç›¸äº’è§¦å‘ã€‚</p><p>æœ€ç»ˆå®Œæˆçš„ä»£ç æ¯”æœ€åˆçš„è¦é•¿ï¼Œä½†æ˜¯æ‹†åˆ†è¿™äº› Effect æ˜¯éå¸¸æ­£ç¡®çš„ã€‚<a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process">æ¯ä¸ª Effect åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹</a>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåˆ é™¤ä¸€ä¸ª Effect å¹¶ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ª Effect çš„é€»è¾‘ã€‚è¿™æ„å‘³ç€ä»–ä»¬ <strong>åŒæ­¥ä¸åŒçš„äº‹æƒ…</strong>ï¼Œåˆ†å¼€ä»–ä»¬å¤„ç†æ˜¯ä¸€ä»¶å¥½äº‹ã€‚å¦‚æœä½ æ‹…å¿ƒé‡å¤ä»£ç çš„é—®é¢˜ï¼Œä½ å¯ä»¥é€šè¿‡ <a href="https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks">æå–ç›¸åŒé€»è¾‘åˆ°è‡ªå®šä¹‰ Hook</a> æ¥æå‡ä»£ç è´¨é‡ã€‚</p><hr><p><mark>æ˜¯å¦åœ¨è¯»å–ä¸€äº›çŠ¶æ€æ¥è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Ÿ </mark>ï¼šæ¯æ¬¡æœ‰æ–°çš„æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¿™ä¸ª Effect ä¼šç”¨æ–°åˆ›å»ºçš„æ•°ç»„æ›´æ–° <code>messages</code> stateï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e0c9jqlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e0c9jqlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [messages, setMessages] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">receivedMessage</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setMessages</span>([...messages, receivedMessage]);<br>    &#125;);<br>    <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>å®ƒä½¿ç”¨ <code>messages</code> å˜é‡æ¥ <a href="https://zh-hans.react.dev/learn/updating-arrays-in-state">åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„</a>ï¼šä»æ‰€æœ‰ç°æœ‰çš„æ¶ˆæ¯å¼€å§‹ï¼Œå¹¶åœ¨æœ€åæ·»åŠ æ–°çš„æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œç”±äº <code>messages</code> æ˜¯ä¸€ä¸ªç”± Effect è¯»å–çš„å“åº”å¼å€¼ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä¾èµ–ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zm42aolqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zm42aolqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [messages, setMessages] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">receivedMessage</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setMessages</span>([...messages, receivedMessage]);<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId, messages]); <span class="hljs-comment">/*  âœ… æ‰€æœ‰ä¾èµ–å·²å£°æ˜  */</span> <br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è€Œè®© <code>messages</code> æˆä¸ºä¾èµ–ä¼šå¸¦æ¥é—®é¢˜ã€‚</p><p>æ¯å½“ä½ æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œ<code>setMessages()</code> å°±ä¼šä½¿è¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“ä¸€ä¸ªæ–°çš„ <code>messages</code> æ•°ç»„ï¼Œå…¶ä¸­åŒ…æ‹¬æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç„¶è€Œï¼Œç”±äºè¯¥ Effect ç°åœ¨ä¾èµ–äº <code>messages</code>ï¼Œè¿™ <strong>ä¹Ÿå°†</strong> é‡æ–°åŒæ­¥è¯¥ Effectã€‚æ‰€ä»¥æ¯æ¡æ–°æ¶ˆæ¯éƒ½ä¼šä½¿èŠå¤©é‡æ–°è¿æ¥ã€‚ç”¨æˆ·ä¸ä¼šå–œæ¬¢è¿™æ ·ï¼</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸è¦åœ¨ Effect é‡Œé¢è¯»å– <code>messages</code>ã€‚ç›¸åï¼Œåº”è¯¥å°†ä¸€ä¸ª <a href="https://zh-hans.react.dev/reference/react/useState#updating-state-based-the-previous-state">state æ›´æ–°å‡½æ•°</a> ä¼ é€’ç»™ <code>setMessages</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5k5i43lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5k5i43lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [messages, setMessages] = <span class="hljs-title function_">useState</span>([]);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>();<br>    connection.<span class="hljs-title function_">connect</span>();<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">receivedMessage</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">msgs</span> =&gt;</span> [...msgs, receivedMessage]);<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId]); <br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p><strong>æ³¨æ„ Effect ç°åœ¨æ ¹æœ¬ä¸è¯»å– <code>messages</code> å˜é‡</strong>ã€‚ä½ åªéœ€è¦ä¼ é€’ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œæ¯”å¦‚ <code>msgs =&gt; [...msgs, receivedMessage]</code>ã€‚React <a href="https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates">å°†æ›´æ–°ç¨‹åºå‡½æ•°æ”¾å…¥é˜Ÿåˆ—</a> å¹¶å°†åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æœŸé—´å‘å…¶æä¾› <code>msgs</code> å‚æ•°ã€‚è¿™å°±æ˜¯ Effect æœ¬èº«ä¸å†éœ€è¦ä¾èµ– <code>messages</code> çš„åŸå› ã€‚ä¿®å¤åï¼Œæ¥æ”¶èŠå¤©æ¶ˆæ¯å°†ä¸å†ä½¿èŠå¤©é‡æ–°è¿æ¥ã€‚</p><h2 id="8-ä½¿ç”¨è‡ªå®šä¹‰-Hook-å¤ç”¨é€»è¾‘"><a href="#8-ä½¿ç”¨è‡ªå®šä¹‰-Hook-å¤ç”¨é€»è¾‘" class="headerlink" title="8.ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘"></a>8.ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘</h2><p>React æœ‰ä¸€äº›å†…ç½® Hookï¼Œä¾‹å¦‚ <code>useState</code>ï¼Œ<code>useContext</code> å’Œ <code>useEffect</code>ã€‚æœ‰æ—¶ä½ éœ€è¦ä¸€ä¸ªç”¨é€”æ›´ç‰¹æ®Šçš„ Hookï¼šä¾‹å¦‚è·å–æ•°æ®ï¼Œè®°å½•ç”¨æˆ·æ˜¯å¦åœ¨çº¿æˆ–è€…è¿æ¥èŠå¤©å®¤ã€‚è™½ç„¶ React ä¸­å¯èƒ½æ²¡æœ‰è¿™äº› Hookï¼Œä½†æ˜¯ä½ å¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚åˆ›å»ºè‡ªå·±çš„ Hookã€‚</p><hr><p><mark>è‡ªå®šä¹‰ Hookï¼šç»„ä»¶é—´å…±äº«é€»è¾‘ </mark>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€æ¬¾é‡åº¦ä¾èµ–ç½‘ç»œçš„åº”ç”¨ï¼ˆå’Œå¤§å¤šæ•°åº”ç”¨ä¸€æ ·ï¼‰ã€‚å½“ç”¨æˆ·ä½¿ç”¨åº”ç”¨æ—¶ç½‘ç»œæ„å¤–æ–­å¼€ï¼Œä½ éœ€è¦æé†’ä»–ã€‚ä½ ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿçœ‹ä¸Šå»ç»„ä»¶éœ€è¦ä¸¤ä¸ªä¸œè¥¿ï¼š</p><ol><li>ä¸€ä¸ªè¿½è¸ªç½‘ç»œæ˜¯å¦åœ¨çº¿çš„ stateã€‚</li><li>ä¸€ä¸ªè®¢é˜…å…¨å±€ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/online_event"><code>online</code></a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/offline_event"><code>offline</code></a> äº‹ä»¶å¹¶æ›´æ–°ä¸Šè¿° state çš„ Effectã€‚</li></ol><p>è¿™ä¼šè®©ç»„ä»¶ä¸ç½‘ç»œçŠ¶æ€ä¿æŒ <a href="https://zh-hans.react.dev/learn/synchronizing-with-effects">åŒæ­¥</a>ã€‚ä½ ä¹Ÿè®¸å¯ä»¥åƒè¿™æ ·å¼€å§‹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-poj33hlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-poj33hlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">StatusBar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOnline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOffline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    &#125;;<br>  &#125;, []);<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;isOnline ? &#x27;âœ… Online&#x27; : &#x27;âŒ Disconnected&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¯•ç€å¼€å¯å’Œå…³é—­ç½‘ç»œï¼Œæ³¨æ„è§‚å¯Ÿ <code>StatusBar</code> ç»„ä»¶åº”å¯¹ä½ çš„è¡Œä¸ºæ˜¯å¦‚ä½•æ›´æ–°çš„ã€‚</p><p>å‡è®¾ç°åœ¨ä½ æƒ³åœ¨å¦ä¸€ä¸ªä¸åŒçš„ç»„ä»¶é‡Œ <strong>ä¹Ÿ</strong> ä½¿ç”¨åŒæ ·çš„é€»è¾‘ã€‚ä½ å¸Œæœ›å®ç°ä¸€ä¸ªä¿å­˜æŒ‰é’®ï¼Œæ¯å½“ç½‘ç»œæ–­å¼€è¿™ä¸ªæŒ‰é’®å°±ä¼šä¸å¯ç”¨å¹¶ä¸”æ˜¾ç¤ºâ€œReconnectingâ€¦â€è€Œä¸æ˜¯â€œSave progressâ€ã€‚</p><p>ä½ å¯ä»¥ä»å¤åˆ¶ç²˜è´´ <code>isOnline</code> state å’Œåˆ†æ”¯é‡Œè°ƒç”¨getSor Effect åˆ° <code>SaveButton</code> ç»„ä»¶å¼€å§‹ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-is3dhclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-is3dhclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SaveButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOnline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOffline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    &#125;;<br>  &#125;, []);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSaveClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… Progress saved&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;!isOnline&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSaveClick&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;isOnline ? &#x27;Save progress&#x27; : &#x27;Reconnecting...&#x27;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¦‚æœä½ å…³é—­ç½‘ç»œï¼Œå¯ä»¥å‘ç°è¿™ä¸ªæŒ‰é’®çš„å¤–è§‚å˜äº†ã€‚</p><p>è¿™ä¸¤ä¸ªç»„ä»¶éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†ä¸å¹¸çš„æ˜¯ä»–ä»¬çš„é€»è¾‘é‡å¤äº†ã€‚ä»–ä»¬çœ‹ä¸Šå»æœ‰ä¸åŒçš„ <strong>è§†è§‰å¤–è§‚</strong>ï¼Œä½†ä½ ä¾ç„¶æƒ³å¤ç”¨ä»–ä»¬çš„é€»è¾‘ã€‚</p><hr><p><mark>ä»ç»„ä»¶ä¸­æå–è‡ªå®šä¹‰ Hook </mark>ï¼šå‡è®¾æœ‰ä¸€ä¸ªå†…ç½® Hook <code>useOnlineStatus</code>ï¼Œå®ƒä¸ <a href="https://zh-hans.react.dev/reference/react/useState"><code>useState</code></a> å’Œ <a href="https://zh-hans.react.dev/reference/react/useEffect"><code>useEffect</code></a> ç›¸ä¼¼ã€‚é‚£ä¹ˆä½ å°±å¯ä»¥ç®€åŒ–è¿™ä¸¤ä¸ªç»„ä»¶å¹¶ç§»é™¤ä»–ä»¬ä¹‹é—´çš„é‡å¤éƒ¨åˆ†ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zagj0ulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zagj0ulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">StatusBar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;isOnline ? &#x27;âœ… Online&#x27; : &#x27;âŒ Disconnected&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">SaveButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSaveClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… Progress saved&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;!isOnline&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSaveClick&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;isOnline ? &#x27;Save progress&#x27; : &#x27;Reconnecting...&#x27;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å°½ç®¡ç›®å‰è¿˜æ²¡æœ‰è¿™æ ·çš„å†…ç½® Hookï¼Œä½†æ˜¯ä½ å¯ä»¥è‡ªå·±å†™ã€‚å£°æ˜ä¸€ä¸ª <code>useOnlineStatus</code> å‡½æ•°ï¼Œå¹¶æŠŠç»„ä»¶é‡Œæ—©å‰å†™çš„æ‰€æœ‰é‡å¤ä»£ç ç§»å…¥è¯¥å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-o4qr8dlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-o4qr8dlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useOnlineStatus</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOnline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOffline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    &#125;;<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> isOnline;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨å‡½æ•°ç»“å°¾å¤„è¿”å› <code>isOnline</code>ã€‚è¿™å¯ä»¥è®©ç»„ä»¶è¯»å–åˆ°è¯¥å€¼ï¼š</p><p>App.js</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0ty7uflqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0ty7uflqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useOnlineStatus &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ueOnlineStatus.js&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">StatusBar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#123;isOnline ? &#x27;âœ… Online&#x27; : &#x27;âŒ Disconnected&#x27;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">SaveButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSaveClick</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… Progress saved&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">&#123;!isOnline&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleSaveClick&#125;</span>&gt;</span></span><br><span class="language-xml">      &#123;isOnline ? &#x27;Save progress&#x27; : &#x27;Reconnecting...&#x27;&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>  );<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">SaveButton</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">StatusBar</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>useOnlineStatus.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rovrgclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rovrgclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useOnlineStatus</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOnline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleOffline</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-title function_">setIsOnline</span>(<span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;online&#x27;</span>, handleOnline);<br>      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;offline&#x27;</span>, handleOffline);<br>    &#125;;<br>  &#125;, []);<br>  <span class="hljs-keyword">return</span> isOnline;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åˆ‡æ¢ç½‘ç»œçŠ¶æ€éªŒè¯ä¸€ä¸‹æ˜¯å¦ä¼šåŒæ—¶æ›´æ–°ä¸¤ä¸ªç»„ä»¶ã€‚</p><p>ç°åœ¨ç»„ä»¶é‡Œæ²¡æœ‰é‚£ä¹ˆå¤šçš„é‡å¤é€»è¾‘äº†ã€‚<strong>æ›´é‡è¦çš„æ˜¯ï¼Œç»„ä»¶å†…éƒ¨çš„ä»£ç æè¿°çš„æ˜¯æƒ³è¦åšä»€ä¹ˆï¼ˆä½¿ç”¨åœ¨çº¿çŠ¶æ€ï¼ï¼‰ï¼Œè€Œä¸æ˜¯æ€ä¹ˆåšï¼ˆé€šè¿‡è®¢é˜…æµè§ˆå™¨äº‹ä»¶å®Œæˆï¼‰</strong>ã€‚</p><p>å½“æå–é€»è¾‘åˆ°è‡ªå®šä¹‰ Hook æ—¶ï¼Œä½ å¯ä»¥éšè—å¦‚ä½•å¤„ç†å¤–éƒ¨ç³»ç»Ÿæˆ–è€…æµè§ˆå™¨ API è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„ç»†èŠ‚ã€‚ç»„ä»¶å†…éƒ¨çš„ä»£ç è¡¨è¾¾çš„æ˜¯ç›®æ ‡è€Œä¸æ˜¯å…·ä½“å®ç°ã€‚</p><hr><p><mark>Hook çš„åç§°å¿…é¡»æ°¸è¿œä»¥ <code>use</code> å¼€å¤´ </mark>ï¼šReact åº”ç”¨æ˜¯ç”±ç»„ä»¶æ„æˆï¼Œè€Œç»„ä»¶ç”±å†…ç½®æˆ–è‡ªå®šä¹‰ Hook æ„æˆã€‚å¯èƒ½ä½ ç»å¸¸ä½¿ç”¨åˆ«äººå†™çš„è‡ªå®šä¹‰ Hookï¼Œä½†å¶å°”ä¹Ÿè¦è‡ªå·±å†™ï¼</p><p>ä½ å¿…é¡»éµå¾ªä»¥ä¸‹è¿™äº›å‘½åå…¬çº¦ï¼š</p><ol><li><strong>React ç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>ï¼Œæ¯”å¦‚ <code>StatusBar</code> å’Œ <code>SaveButton</code>ã€‚React ç»„ä»¶è¿˜éœ€è¦è¿”å›ä¸€äº› React èƒ½å¤Ÿæ˜¾ç¤ºçš„å†…å®¹ï¼Œæ¯”å¦‚ä¸€æ®µ JSXã€‚</li><li><strong>Hook çš„åç§°å¿…é¡»ä»¥ <code>use</code> å¼€å¤´ï¼Œç„¶åç´§è·Ÿä¸€ä¸ªå¤§å†™å­—æ¯</strong>ï¼Œå°±åƒå†…ç½®çš„ <a href="https://zh-hans.react.dev/reference/react/useState"><code>useState</code></a> æˆ–è€…æœ¬æ–‡æ—©å‰çš„è‡ªå®šä¹‰ <code>useOnlineStatus</code> ä¸€æ ·ã€‚Hook å¯ä»¥è¿”å›ä»»æ„å€¼ã€‚</li></ol><p>è¿™ä¸ªå…¬çº¦ä¿è¯ä½ å§‹ç»ˆèƒ½ä¸€çœ¼è¯†åˆ«å‡ºç»„ä»¶å¹¶ä¸”çŸ¥é“å®ƒçš„ stateï¼ŒEffect ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§å¯èƒ½â€œéšè—â€åœ¨å“ªé‡Œã€‚ä¾‹å¦‚å¦‚æœä½ åœ¨ç»„ä»¶å†…éƒ¨çœ‹è§ <code>getColor()</code> å‡½æ•°è°ƒç”¨ï¼Œå°±å¯ä»¥ç¡®å®šå®ƒé‡Œé¢ä¸å¯èƒ½åŒ…å« React stateï¼Œå› ä¸ºå®ƒçš„åç§°æ²¡æœ‰ä»¥ <code>use</code> å¼€å¤´ã€‚ä½†æ˜¯åƒ <code>useOnlineStatus()</code> è¿™æ ·çš„å‡½æ•°è°ƒç”¨å°±å¾ˆå¯èƒ½åŒ…å«å¯¹å†…éƒ¨å…¶ä»– Hook çš„è°ƒç”¨ï¼</p><p>å¦‚æœä½ ä¸º <a href="https://zh-hans.react.dev/learn/editor-setup#linting">React é…ç½®äº†</a> ä»£ç æ£€æŸ¥å·¥å…·ï¼Œå®ƒä¼šå¼ºåˆ¶æ‰§è¡Œè¿™ä¸ªå‘½åå…¬çº¦ã€‚ç°åœ¨æ»‘åŠ¨åˆ°ä¸Šé¢çš„ sandboxï¼Œå¹¶å°† <code>useOnlineStatus</code> é‡å‘½åä¸º <code>getOnlineStatus</code>ã€‚æ³¨æ„æ­¤æ—¶ä»£ç æ£€æŸ¥å·¥å…·å°†ä¸ä¼šå†å…è®¸ä½ åœ¨å…¶å†…éƒ¨è°ƒç”¨ <code>useState</code> æˆ–è€… <code>useEffect</code>ã€‚åªæœ‰ Hook å’Œç»„ä»¶å¯ä»¥è°ƒç”¨å…¶ä»– Hookï¼</p><hr><p><mark>æ¸²æŸ“æœŸé—´è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°éƒ½åº”è¯¥ä»¥ use å‰ç¼€å¼€å¤´ä¹ˆï¼Ÿ </mark>ï¼šä¸ã€‚æ²¡æœ‰ <strong>è°ƒç”¨</strong> Hook çš„å‡½æ•°ä¸éœ€è¦ <strong>å˜æˆ</strong> Hookã€‚</p><p>å¦‚æœå‡½æ•°æ²¡æœ‰è°ƒç”¨ä»»ä½• Hookï¼Œè¯·é¿å…ä½¿ç”¨ <code>use</code> å‰ç¼€ã€‚ è€Œæ˜¯ <strong>ä¸å¸¦</strong> <code>use</code> å‰ç¼€æŠŠå®ƒå½“æˆå¸¸è§„å‡½æ•°å»å†™ã€‚ä¾‹å¦‚ä¸‹é¢çš„ <code>useSorted</code>  æ²¡æœ‰è°ƒç”¨ Hookï¼Œæ‰€ä»¥å«å®ƒ <code>getSorted</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l4rwwylqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l4rwwylqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">// ğŸ”´ Avoid: æ²¡æœ‰è°ƒç”¨å…¶ä»–Hookçš„Hook</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useSorted</span>(<span class="hljs-params">items</span>) &#123;<br>  <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">slice</span>().<span class="hljs-title function_">sort</span>();<br>&#125;<br><span class="hljs-comment">// âœ… Good: æ²¡æœ‰ä½¿ç”¨Hookçš„å¸¸è§„å‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getSorted</span>(<span class="hljs-params">items</span>) &#123;<br>  <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">slice</span>().<span class="hljs-title function_">sort</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™ä¿è¯ä½ çš„ä»£ç å¯ä»¥åœ¨åŒ…å«æ¡ä»¶è¯­å¥åœ¨å†…çš„ä»»ä½•åœ°æ–¹è°ƒç”¨è¿™ä¸ªå¸¸è§„å‡½æ•°ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-km58kclqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-km58kclqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">List</span>(<span class="hljs-params">&#123; items, shouldSort &#125;</span>) &#123;<br>  <span class="hljs-keyword">let</span> displayedItems = items;<br>  <span class="hljs-keyword">if</span> (shouldSort) &#123;<br>    <span class="hljs-comment">/*  âœ… åœ¨æ¡ä»¶åˆ†æ”¯é‡Œè°ƒç”¨getSorted()æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºå®ƒä¸æ˜¯Hook  */</span> <br>    displayedItems = <span class="hljs-title function_">getSorted</span>(items);<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>å“ªæ€•å†…éƒ¨åªä½¿ç”¨äº†ä¸€ä¸ª Hookï¼Œä½ ä¹Ÿåº”è¯¥ç»™è¿™ä¸ªå‡½æ•°åŠ  <code>use</code> å‰ç¼€ï¼ˆè®©å®ƒæˆä¸ºä¸€ä¸ª Hookï¼‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ph8si1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ph8si1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/*  âœ… Good: ä¸€ä¸ªä½¿ç”¨äº†å…¶ä»–Hookçš„Hook  */</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useAuth</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">Auth</span>);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æŠ€æœ¯ä¸Š React å¯¹æ­¤å¹¶ä¸å¼ºåˆ¶è¦æ±‚ã€‚åŸåˆ™ä¸Šä½ å¯ä»¥å†™å‡ºä¸è°ƒç”¨å…¶ä»– Hook çš„ Hookã€‚ä½†è¿™å¸¸å¸¸ä¼šéš¾ä»¥ç†è§£ä¸”å—é™ï¼Œæ‰€ä»¥æœ€å¥½é¿å…è¿™ç§æ–¹å¼ã€‚ä½†æ˜¯å®ƒåœ¨æå°‘æ•°åœºæ™¯ä¸‹å¯èƒ½æ˜¯æœ‰ç›Šçš„ã€‚ä¾‹å¦‚å‡½æ•°ç›®å‰ä¹Ÿè®¸å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½• Hookï¼Œä½†æ˜¯ä½ è®¡åˆ’æœªæ¥åœ¨è¯¥å‡½æ•°å†…éƒ¨æ·»åŠ ä¸€äº› Hook è°ƒç”¨ã€‚é‚£ä¹ˆä½¿ç”¨ <code>use</code> å‰ç¼€å‘½åå°±å¾ˆæœ‰æ„ä¹‰ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mem5zwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mem5zwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-comment">/*  âœ… Good: ä¹‹åå¯èƒ½ä½¿ç”¨å…¶ä»–Hookçš„Hook  */</span> <br><span class="hljs-keyword">function</span> <span class="hljs-title function_">useAuth</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">/*  <span class="hljs-doctag">TODO:</span> å½“è®¤è¯åŠŸèƒ½å®ç°ä»¥åï¼Œæ›¿æ¢è¿™ä¸€è¡Œï¼š  */</span> <br>  <span class="hljs-comment">/*  è¿”å› useContext(Auth)ï¼›  */</span> <br>  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">TEST_USER</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ¥ä¸‹æ¥ç»„ä»¶å°±ä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚å½“ä½ åœ¨å†…éƒ¨å®é™…æ·»åŠ äº† Hook è°ƒç”¨æ—¶ï¼Œè¿™ä¸€ç‚¹å°†å˜å¾—å¾ˆé‡è¦ã€‚å¦‚æœä½ ï¼ˆç°åœ¨æˆ–è€…ä¹‹åï¼‰æ²¡æœ‰è®¡åˆ’åœ¨å†…éƒ¨ä½¿ç”¨ Hookï¼Œè¯·ä¸è¦è®©å®ƒå˜æˆ Hookã€‚</p><hr><p><mark>è‡ªå®šä¹‰ Hook å…±äº«çš„æ˜¯çŠ¶æ€é€»è¾‘ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«</mark>ï¼šä¹‹å‰çš„ä¾‹å­é‡Œï¼Œå½“ä½ å¼€å¯æˆ–å…³é—­ç½‘ç»œæ—¶ï¼Œä¸¤ä¸ªç»„ä»¶ä¸€èµ·æ›´æ–°äº†ã€‚ä½†æ˜¯ä¸¤ä¸ªç»„ä»¶å…±äº« state å˜é‡ <code>isOnline</code> è¿™ç§æƒ³æ³•æ˜¯é”™çš„ã€‚çœ‹è¿™æ®µä»£ç ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-aky043lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-aky043lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">StatusBar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>  <span class="hljs-comment">/*    */</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">SaveButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> isOnline = <span class="hljs-title function_">useOnlineStatus</span>();<br>  <span class="hljs-comment">/*    */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>å®ƒçš„å·¥ä½œæ–¹å¼å’Œä½ ä¹‹å‰æå–çš„é‡å¤ä»£ç ä¸€æ¨¡ä¸€æ ·ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a04x4xlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a04x4xlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">StatusBar</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/*    */</span><br>  &#125;, []);<br>  <span class="hljs-comment">/*    */</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">SaveButton</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [isOnline, setIsOnline] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>   <span class="hljs-comment">/*    */</span><br>  &#125;, []);<br>  <span class="hljs-comment">/*    */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ˜¯å®Œå…¨ç‹¬ç«‹çš„ä¸¤ä¸ª state å˜é‡å’Œ Effectï¼åªæ˜¯ç¢°å·§åŒä¸€æ—¶é—´å€¼ä¸€æ ·ï¼Œå› ä¸ºä½ ä½¿ç”¨äº†ç›¸åŒçš„å¤–éƒ¨å€¼åŒæ­¥ä¸¤ä¸ªç»„ä»¶ï¼ˆæ— è®ºç½‘ç»œæ˜¯å¦å¼€å¯ï¼‰ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸åŒçš„ç¤ºä¾‹ã€‚çœ‹ä¸‹é¢çš„ <code>Form</code> ç»„ä»¶ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-jbpxuwlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-jbpxuwlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>);<br>  <span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleFirstNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setFirstName</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLastNameChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setLastName</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        First name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;firstName&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleFirstNameChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Last name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;lastName&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleLastNameChange&#125;</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Good morning, &#123;firstName&#125; &#123;lastName&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ¯ä¸ªè¡¨å•åŸŸéƒ½æœ‰ä¸€éƒ¨åˆ†é‡å¤çš„é€»è¾‘ï¼š</p><ol><li>éƒ½æœ‰ä¸€ä¸ª stateï¼ˆ<code>firstName</code> å’Œ <code>lastName</code>ï¼‰ã€‚</li><li>éƒ½æœ‰ change äº‹ä»¶çš„å¤„ç†å‡½æ•°ï¼ˆ<code>handleFirstNameChange</code> å’Œ <code>handleLastNameChange</code>ï¼‰ã€‚</li><li>éƒ½æœ‰ä¸ºè¾“å…¥æ¡†æŒ‡å®š <code>value</code> å’Œ <code>onChange</code> å±æ€§çš„ JSXã€‚</li></ol><p>ä½ å¯ä»¥æå–é‡å¤çš„é€»è¾‘åˆ°è‡ªå®šä¹‰ Hook <code>useFormInput</code>ï¼š</p><p>useFormInput.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b5ckkblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b5ckkblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useFormInput</span>(<span class="hljs-params">initialValue</span>) &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(initialValue);<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleChange</span>(<span class="hljs-params">e</span>) &#123;<br>    <span class="hljs-title function_">setValue</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> inputProps = &#123;<br>    <span class="hljs-attr">value</span>: value,<br>    <span class="hljs-attr">onChange</span>: handleChange<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> inputProps;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-uoi9b7lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-uoi9b7lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useFormInput &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useFormInput.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> firstNameProps = <span class="hljs-title function_">useFormInput</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>);<br>  <span class="hljs-keyword">const</span> lastNameProps = <span class="hljs-title function_">useFormInput</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        First name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...firstNameProps</span>&#125; /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Last name:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> &#123;<span class="hljs-attr">...lastNameProps</span>&#125; /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>Good morning, &#123;firstNameProps.value&#125; &#123;lastNameProps.value&#125;.<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„å®ƒåªå£°æ˜äº† <strong>ä¸€ä¸ª</strong> state å˜é‡ï¼Œå«åš <code>value</code>ã€‚</p><p>ä½† <code>Form</code> ç»„ä»¶è°ƒç”¨äº† <strong>ä¸¤æ¬¡</strong> <code>useFormInput</code>ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6byfydlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6byfydlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> firstNameProps = <span class="hljs-title function_">useFormInput</span>(<span class="hljs-string">&#x27;Mary&#x27;</span>);<br>  <span class="hljs-keyword">const</span> lastNameProps = <span class="hljs-title function_">useFormInput</span>(<span class="hljs-string">&#x27;Poppins&#x27;</span>);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒå·¥ä½œçš„æ—¶å€™åƒå£°æ˜äº†ä¸¤ä¸ªå•ç‹¬çš„ state å˜é‡ï¼</p><p><strong>è‡ªå®šä¹‰ Hook å…±äº«çš„åªæ˜¯çŠ¶æ€é€»è¾‘è€Œä¸æ˜¯çŠ¶æ€æœ¬èº«ã€‚å¯¹ Hook çš„æ¯ä¸ªè°ƒç”¨å®Œå…¨ç‹¬ç«‹äºå¯¹åŒä¸€ä¸ª Hook çš„å…¶ä»–è°ƒç”¨</strong>ã€‚è¿™å°±æ˜¯ä¸Šé¢ä¸¤ä¸ª sandbox ç»“æœå®Œå…¨ç›¸åŒçš„åŸå› ã€‚å¦‚æœæ„¿æ„ï¼Œä½ å¯ä»¥åˆ’ä¸Šå»è¿›è¡Œæ¯”è¾ƒã€‚æå–è‡ªå®šä¹‰ Hook å‰åç»„ä»¶çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚</p><p>å½“ä½ éœ€è¦åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´å…±äº« state æœ¬èº«æ—¶ï¼Œéœ€è¦ <a href="https://zh-hans.react.dev/learn/sharing-state-between-components">å°†å˜é‡æå‡å¹¶ä¼ é€’ä¸‹å»</a>ã€‚</p><hr><p><mark>åœ¨ Hook ä¹‹é—´ä¼ é€’å“åº”å€¼</mark>ï¼šæ¯å½“ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè‡ªå®šä¹‰ Hook ä¸­çš„ä»£ç å°±ä¼šé‡æ–°è¿è¡Œã€‚è¿™å°±æ˜¯ç»„ä»¶å’Œè‡ªå®šä¹‰ Hook éƒ½ <a href="https://zh-hans.react.dev/learn/keeping-components-pure">éœ€è¦æ˜¯çº¯å‡½æ•°</a> çš„åŸå› ã€‚æˆ‘ä»¬åº”è¯¥æŠŠè‡ªå®šä¹‰ Hook çš„ä»£ç çœ‹ä½œç»„ä»¶ä¸»ä½“çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç”±äºè‡ªå®šä¹‰ Hook ä¼šéšç€ç»„ä»¶ä¸€èµ·é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥ç»„ä»¶å¯ä»¥ä¸€ç›´æ¥æ”¶åˆ°æœ€æ–°çš„ props å’Œ stateã€‚æƒ³çŸ¥é“è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œé‚£å°±çœ‹çœ‹è¿™ä¸ªèŠå¤©å®¤çš„ç¤ºä¾‹ã€‚ä¿®æ”¹ ServeUrl æˆ–è€… roomIDï¼š</p><p>notifications.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-41c00slqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-41c00slqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Toastify</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;toastify-js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;toastify-js/src/toastify.css&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showNotification</span>(<span class="hljs-params">message, theme = <span class="hljs-string">&#x27;dark&#x27;</span></span>) &#123;<br>  <span class="hljs-title class_">Toastify</span>(&#123;<br>    <span class="hljs-attr">text</span>: message,<br>    <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>,<br>    <span class="hljs-attr">gravity</span>: <span class="hljs-string">&#x27;top&#x27;</span>,<br>    <span class="hljs-attr">position</span>: <span class="hljs-string">&#x27;right&#x27;</span>,<br>    <span class="hljs-attr">style</span>: &#123;<br>      <span class="hljs-attr">background</span>: theme === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-string">&#x27;black&#x27;</span> : <span class="hljs-string">&#x27;white&#x27;</span>,<br>      <span class="hljs-attr">color</span>: theme === <span class="hljs-string">&#x27;dark&#x27;</span> ? <span class="hljs-string">&#x27;white&#x27;</span> : <span class="hljs-string">&#x27;black&#x27;</span>,<br>    &#125;,<br>  &#125;).<span class="hljs-title function_">showToast</span>();<br>&#125;<br></code></pre></td></tr></table></div></figure><p>chat.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x47uvblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x47uvblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">&#123; serverUrl, roomId &#125;</span>) &#123;<br>  <span class="hljs-comment">/*  çœŸæ­£çš„å®ç°ä¼šå®é™…è¿æ¥åˆ°æœåŠ¡å™¨  */</span> <br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> serverUrl !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Expected serverUrl to be a string. Received: &#x27;</span> + serverUrl);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> roomId !== <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Expected roomId to be a string. Received: &#x27;</span> + roomId);<br>  &#125;<br>  <span class="hljs-keyword">let</span> intervalId;<br>  <span class="hljs-keyword">let</span> messageCallback;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âœ… Connecting to &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; room at &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;...&#x27;</span>);<br>      <span class="hljs-built_in">clearInterval</span>(intervalId);<br>      intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-keyword">if</span> (messageCallback) &#123;<br>          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>) &#123;<br>            <span class="hljs-title function_">messageCallback</span>(<span class="hljs-string">&#x27;hey&#x27;</span>)<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-title function_">messageCallback</span>(<span class="hljs-string">&#x27;lol&#x27;</span>);<br>          &#125;<br>        &#125;<br>      &#125;, <span class="hljs-number">3000</span>);<br>    &#125;,<br>    <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-built_in">clearInterval</span>(intervalId);<br>      messageCallback = <span class="hljs-literal">null</span>;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;âŒ Disconnected from &quot;&#x27;</span> + roomId + <span class="hljs-string">&#x27;&quot; room at &#x27;</span> + serverUrl + <span class="hljs-string">&#x27;&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-title function_">on</span>(<span class="hljs-params">event, callback</span>) &#123;<br>      <span class="hljs-keyword">if</span> (messageCallback) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Cannot add the handler twice.&#x27;</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (event !== <span class="hljs-string">&#x27;message&#x27;</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Only &quot;message&quot; event is supported.&#x27;</span>);<br>      &#125;<br>      messageCallback = callback;<br>    &#125;,<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ChatRoom.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fubvz1lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fubvz1lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; createConnection &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./chat.js&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; showNotification &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./notifications.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br><br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = &#123;<br>      <span class="hljs-attr">serverUrl</span>: serverUrl,<br>      <span class="hljs-attr">roomId</span>: roomId<br>    &#125;;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(options);<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;New message: &#x27;</span> + msg);<br>    &#125;);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId, serverUrl]);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Server URL:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;serverUrl&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setServerUrl(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to the &#123;roomId&#125; room!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>App.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dnf2pslqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dnf2pslqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatRoom</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ChatRoom.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> [roomId, setRoomId] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;general&#x27;</span>);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Choose the chat room:&#123;&#x27; &#x27;&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">select</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setRoomId(e.target.value)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;general&quot;</span>&gt;</span>general<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;travel&quot;</span>&gt;</span>travel<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;music&quot;</span>&gt;</span>music<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ChatRoom</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">roomId</span>=<span class="hljs-string">&#123;roomId&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å½“ä½ ä¿®æ”¹ <code>serverUrl</code> æˆ–è€… <code>roomId</code> æ—¶ï¼ŒEffect ä¼šå¯¹ <a href="https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values">ä½ çš„ä¿®æ”¹åšå‡ºâ€œå“åº”â€</a> å¹¶é‡æ–°åŒæ­¥ã€‚ä½ å¯ä»¥é€šè¿‡æ¯æ¬¡ä¿®æ”¹ Effect ä¾èµ–é¡¹æ—¶èŠå¤©å®¤é‡è¿çš„æ§åˆ¶å°æ¶ˆæ¯æ¥åŒºåˆ†ã€‚</p><p>ç°åœ¨å°† Effect ä»£ç ç§»å…¥è‡ªå®šä¹‰ Hookï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y6nrgulqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y6nrgulqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useChatRoom</span>(<span class="hljs-params">&#123; serverUrl, roomId &#125;</span>) &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> options = &#123;<br>      <span class="hljs-attr">serverUrl</span>: serverUrl,<br>      <span class="hljs-attr">roomId</span>: roomId<br>    &#125;;<br>    <span class="hljs-keyword">const</span> connection = <span class="hljs-title function_">createConnection</span>(options);<br>    connection.<span class="hljs-title function_">connect</span>();<br>    connection.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">&#x27;New message: &#x27;</span> + msg);<br>    &#125;);<br>    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> connection.<span class="hljs-title function_">disconnect</span>();<br>  &#125;, [roomId, serverUrl]);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™è®© <code>ChatRoom</code> ç»„ä»¶è°ƒç”¨è‡ªå®šä¹‰ Hookï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒå†…éƒ¨æ€ä¹ˆå·¥ä½œï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6sl5nblqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6sl5nblqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br>  <span class="hljs-title function_">useChatRoom</span>(&#123;<br>    <span class="hljs-attr">roomId</span>: roomId,<br>    <span class="hljs-attr">serverUrl</span>: serverUrl<br>  &#125;);<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Server URL:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;serverUrl&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setServerUrl(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to the &#123;roomId&#125; room!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™çœ‹ä¸Šå»ç®€æ´å¤šäº†ï¼ˆä½†æ˜¯å®ƒåšçš„æ˜¯åŒä¸€ä»¶äº‹ï¼‰ï¼</p><p>æ³¨æ„é€»è¾‘ <strong>ä»ç„¶å“åº”</strong> props å’Œ state çš„å˜åŒ–ã€‚å°è¯•ç¼–è¾‘ server URL æˆ–é€‰ä¸­çš„æˆ¿é—´ï¼š</p><p>ChatRoom.jsï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-uhaydrlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-uhaydrlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; useChatRoom &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useChatRoom.js&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br><br>  <span class="hljs-title function_">useChatRoom</span>(&#123;<br>    <span class="hljs-attr">roomId</span>: roomId,<br>    <span class="hljs-attr">serverUrl</span>: serverUrl<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">        Server URL:</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;serverUrl&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;e</span> =&gt;</span> setServerUrl(e.target.value)&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to the &#123;roomId&#125; room!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„ä½ å¦‚ä½•è·å– Hook çš„è¿”å›å€¼ï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ga9tw5lqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ga9tw5lqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br>  <span class="hljs-title function_">useChatRoom</span>(&#123;<br>    <span class="hljs-attr">roomId</span>: roomId,<br>    <span class="hljs-attr">serverUrl</span>: serverUrl<br>  &#125;);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>å¹¶æŠŠå®ƒä½œä¸ºè¾“å…¥ä¼ ç»™å¦ä¸€ä¸ª Hookï¼š</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nf5nodlqv4htb1" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nf5nodlqv4htb1"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ChatRoom</span>(<span class="hljs-params">&#123; roomId &#125;</span>) &#123;<br>  <span class="hljs-keyword">const</span> [serverUrl, setServerUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;https://localhost:1234&#x27;</span>);<br>  <span class="hljs-title function_">useChatRoom</span>(&#123;<br>    <span class="hljs-attr">roomId</span>: roomId,<br>    <span class="hljs-attr">serverUrl</span>: serverUrl<br>  &#125;);<br>  <span class="hljs-comment">// ...</span><br></code></pre></td></tr></table></div></figure><p>æ¯æ¬¡ <code>ChatRoom</code> ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå®ƒå°±ä¼šä¼ æœ€æ–°çš„ <code>roomId</code> å’Œ <code>serverUrl</code> åˆ°ä½ çš„ Hookã€‚è¿™å°±æ˜¯æ¯å½“é‡æ–°æ¸²æŸ“åä»–ä»¬çš„å€¼ä¸ä¸€æ ·æ—¶ä½ çš„ Effect ä¼šé‡è¿èŠå¤©å®¤çš„åŸå› ã€‚ï¼ˆå¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡éŸ³è§†é¢‘å¤„ç†è½¯ä»¶ï¼Œåƒè¿™æ ·çš„ Hook é“¾ä¹Ÿè®¸ä¼šè®©ä½ æƒ³èµ·éŸ³è§†é¢‘æ•ˆæœé“¾ã€‚å¥½ä¼¼ <code>useState</code> çš„è¾“å‡ºä½œä¸º <code>useChatRoom</code> çš„è¾“å…¥ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
      <tag>TypeScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº”.Typoraä½¿ç”¨æŒ‡å—</title>
    <link href="/2023/10/16/Typora%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2023/10/16/Typora%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<p>Typora å®˜ç½‘ï¼š<a href="https://typoraio.cn/">https://typoraio.cn/</a></p><p>Typora ä¸»é¢˜ï¼š<a href="https://theme.typora.io/">https://theme.typora.io/</a></p><hr><p>æ¿€æ´» Typora1.7 ç‰ˆæœ¬ï¼š</p><ol><li><p>é¦–å…ˆä¸‹è½½ä¸‰ä¸ªæ–‡ä»¶ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰ï¼š</p><img src="image-20231102102909272.png" alt="image-20231102102909272" style="zoom:50%;" /></li><li><p>è¿è¡Œtypora-setup-x64.exeï¼Œå¤åˆ¶å¦å¤–ä¸¤ä¸ªæ–‡ä»¶åˆ°å®‰è£…åŒ…çš„è·¯å¾„ä¸‹ï¼š</p><img src="image-20231102102505005.png" alt="image-20231102102505005" style="zoom:50%;" /></li><li><p>åœ¨å½“å‰å®‰è£…åŒ…è·¯å¾„ä¸‹æ‰“å¼€cmdè¿è¡Œlicense-gen.exeï¼š</p><img src="image-20231102102550661.png" alt="image-20231102102550661" style="zoom:50%;" /></li><li><p>ç”¨ç®¡ç†å‘˜èº«ä»½è¿è¡ŒTyporaCrack.exe</p></li><li><p>è¿è¡Œå®Œæˆåè¾“å…¥é‚®ç®±åœ°å€å’Œåºåˆ—å·ï¼ˆå³æ¿€æ´»ç ï¼‰ï¼š</p><img src="image-20231102102833246.png" alt="image-20231102102833246" style="zoom:30%;" /></li><li><p>æ¿€æ´»æˆåŠŸï¼š</p><img src="image-20231102102813692.png" alt="image-20231102102813692" style="zoom:30%;" /></li></ol><p>æ›´æ–°themeså’Œconfæ–‡ä»¶å¤¹ã€æ‰“å¼€é«˜çº§è®¾ç½®ã€‘ï¼š</p><img src="image-20231103103633725.png" alt="image-20231103103633725" style="zoom:50%;" /><p>ä¿®æ”¹åå¥½è®¾ç½®ï¼š</p><img src="image-20231103103533030.png" alt="image-20231103103533030" style="zoom:50%;" /><hr><p>shift+F12 è°ƒå‡ºæ§åˆ¶å°ï¼š</p><img src="image-20231016095537228.png" alt="image-20231016095537228" style="zoom:50%;" /><hr><p>åœ¨éœ€è¦åˆ†é¡µçš„æ—¶å€™ï¼Œæ·»åŠ åˆ†é¡µç¬¦ï¼Œå¯¼å‡º PDF æ—¶å¯ä»¥è¿›è¡Œåˆ†é¡µï¼š</p><ul><li><code>---</code></li><li><code>***</code></li><li><code>_____</code></li></ul><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s0dhuflqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s0dhuflqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-comment">/*æ‰‹åŠ¨åˆ†é¡µæ§åˆ¶ï¼šéœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ†é¡µç¬¦ï¼Œ &#x27;----&#x27;ã€&#x27;***&#x27; ã€&#x27;_______&#x27; */</span><br><span class="hljs-keyword">@media</span> print, (<span class="hljs-attribute">overflow-block</span>: paged) <span class="hljs-keyword">or</span> (<span class="hljs-attribute">overflow-block</span>: optional-paged) &#123;<br>  hr &#123;<br>    <span class="hljs-attribute">page-break-after</span>: always; <span class="hljs-comment">/* CSS 2 */</span><br>    <span class="hljs-attribute">break-after</span>: region; <span class="hljs-comment">/* CSS 3+ */</span><br>    <span class="hljs-comment">/* minimal layout disruption: */</span><br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">0.1mm</span>;<br>    <span class="hljs-attribute">visibility</span>: hidden;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>ä»…æ”¯æŒæ™®é€šçš„<code>html</code>æ ‡ç­¾ï¼Œä¸æ”¯æŒ<code>class</code>ã€<code>id</code>ã€<code>data-*</code>ç­‰è‡ªå®šä¹‰å±æ€§ã€‚</p><hr><p>é«˜äº®å¿«æ·é”®ï¼š</p><img src="image-20231103103407067.png" alt="image-20231103103407067" style="zoom:50%;" /><img src="image-20231103103444079.png" alt="image-20231103103444079" style="zoom:50%;" />]]></content>
    
    
    
    <tags>
      
      <tag>Typora</tag>
      
      <tag>markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å››.gitå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2023/09/06/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2023/09/06/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>Gitæ–‡æ¡£ï¼š<a href="https://git-scm.com/docs">https://git-scm.com/docs</a></p><h1 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h1><p>æ¨é€ä»£ç ï¼šgit add .           git commit -m &quot;1&quot;             git push</p><p>æ‹‰å–ä»£ç ï¼š</p><ol><li>git checkout master</li><li>git pull</li><li>git checkout dev-lan777</li><li>git merge master â€”no-commit</li><li>git pushã€sync changesã€‘</li><li>npm run dev</li></ol><p>åˆ›å»ºåˆ†æ”¯ï¼š</p><ol><li>git checkout master</li><li>git pull</li><li>git checkout -b the-name-of-my-branch</li></ol><p>åˆå¹¶åˆ†æ”¯ï¼š</p><ol><li>git add .</li><li>git commit -m &quot;1&quot;</li><li>git push</li><li>git checkout master</li><li>git pull</li><li>git merge dev-lan777 â€”no-commit<ol><li>ã€å¤„ç†mergeå†²çªçš„ä»£ç åä¿å­˜ã€‘</li><li>git add .</li><li>git commit -m &quot;2&quot;</li></ol></li><li>git pushã€maintainerè§’è‰²ã€‘</li></ol><p>æ‰“åŒ…éƒ¨ç½²ï¼š</p><ol><li>npm run build:test</li><li>git add .</li><li>git commit -m &quot;2&quot;</li><li>git push</li></ol><p>åˆ é™¤æ–‡ä»¶å¤¹ï¼šgit bashå‘½ä»¤ï¼šrm -rf node_modules</p><p>åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout -b dev-lan777</p><p>æš‚å­˜ä¿®æ”¹ï¼šgit stash</p><ul><li><code>git stash pop</code> çš„ä½œç”¨æ˜¯å°†æœ€è¿‘ä¸€æ¬¡æš‚å­˜çš„ä¿®æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ï¼Œå¹¶å°†è¯¥æš‚å­˜è®°å½•ä»å­˜å‚¨å †æ ˆä¸­ç§»é™¤ã€‚å®ƒçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š<ol><li>å°†æœ€è¿‘ä¸€æ¬¡çš„æš‚å­˜ä¿®æ”¹ä»å­˜å‚¨å †æ ˆä¸­å–å‡ºã€‚</li><li>å°†è¿™äº›ä¿®æ”¹åº”ç”¨åˆ°å½“å‰æ‰€åœ¨åˆ†æ”¯ä¸Šã€‚</li><li>å¦‚æœåº”ç”¨æˆåŠŸï¼Œåˆ™å°†è¯¥æš‚å­˜è®°å½•ä»å­˜å‚¨å †æ ˆä¸­ç§»é™¤ã€‚</li></ol></li></ul><p>æŸ¥çœ‹æ—¥å¿—ï¼šgit log â€”oneline</p><p>git rebase dev-lan777</p><p>ä¸Šä¸‹ç®­å¤´è¿”å›ä¹‹å‰çš„gitå‘½ä»¤</p><p>gitå›é€€åˆ°commit_idçš„çŠ¶æ€ï¼š</p><ol><li>git logï¼šæŸ¥çœ‹commitçš„å†å²è®°å½•åŠå…¶å¯¹åº”çš„commit_id</li><li>git reset --hard commit_id</li><li>git push origin HEAD --forceï¼šä½¿æœ¬åœ°å’Œè¿œç¨‹çš„å†…å®¹éƒ½å›é€€åˆ°commit_idå¯¹åº”çš„çŠ¶æ€ã€‚</li></ol><img src="image-20231029004846153.png" alt="image-20231029004846153" style="zoom:50%;" /><p><code>Auto packing the repository in background for optimum performance.See &quot;git help gc&quot; for manual housekeeping.</code>ï¼š</p><ol><li>git fsck --lost-foundï¼šå‡ºç°å¾ˆå¤š&quot;dangling commit&quot;</li><li>git gc --prune&#x3D;now</li></ol><p>gitæ¨é€lan-blogä¸­çš„fluidä¸»é¢˜æ–‡ä»¶å¤¹ï¼šæ¨é€fluidåå†å›åˆ°lan-blog</p><ol><li>cd themes&#x2F;fluid</li><li>git add .</li><li>git commit -m &quot;1&quot;</li><li>git push</li></ol><p><code>feat</code> æ˜¯ â€œFeatureâ€çš„ç¼©å†™ï¼Œä»£è¡¨æ–°çš„åŠŸèƒ½ç‰¹æ€§ã€‚å½“ä½ æƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ç‰¹æ€§ï¼Œæˆ–æ˜¯æ”¹è¿›ç°æœ‰çš„åŠŸèƒ½ç‰¹æ€§æ—¶ï¼Œåº”å½“ä½¿ç”¨ <code>feat</code> è¿™ä¸ªå‰ç¼€æ¥æè¿°ä½ çš„æäº¤ã€‚</p><p><a href="https://ruanyifeng.com/blog/2020/04/git-cherry-pick.html">https://ruanyifeng.com/blog/2020/04/git-cherry-pick.html</a></p><h1 id="Gitee"><a href="#Gitee" class="headerlink" title="Gitee"></a>Gitee</h1><p>Githubä»“åº“å¯¼å…¥åˆ°Giteeï¼š</p><img src="image-20231106151706877.png" alt="image-20231106151706877" style="zoom:50%;" /><p>æˆæƒGithubåï¼š</p><img src="image-20231106151617948.png" alt="image-20231106151617948" style="zoom:50%;" /><h1 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h1><img src="image-20231012112042094.png" alt="image-20231012112042094" style="zoom:50%;" /><p>åŸå› ï¼šåœ¨åˆ†æ”¯åˆ›å»ºæ—¶ï¼Œä½¿ç”¨äº†ä¸è¿œç¨‹ä¸ä¸€è‡´çš„åˆ†æ”¯åã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹<code>git push</code>é»˜è®¤è§„åˆ™<code>git config push.default upstream</code></p><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">OpenSSL SSL_read: Connection was reset, errno 10054</p><p> è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n058eslqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n058eslqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global http.sslVerify <span class="hljs-string">&quot;false&quot;</span><br>git config --global https.sslVerify <span class="hljs-string">&quot;false&quot;</span><br></code></pre></td></tr></table></div></figure><hr><p><code>fatal: unable to access &#39;https://github.com/Chanzhaoyu/chatgpt-web.git/&#39;: Failed to connect to github.com port 443 after 21343 ms: Timed out</code>ï¼š</p><img src="image-20231123171826860.png" alt="image-20231123171826860" style="zoom:50%;" /><p>æ‰“å¼€ä½¿ç”¨ä»£ç æœåŠ¡å™¨ï¼š</p><img src="image-20231123171855262.png" alt="image-20231123171855262" style="zoom:40%;" /><p>æŸ¥çœ‹åŸä»£ç†è®¾ç½®ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ba0vb2lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ba0vb2lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --get http.proxy<br>git config --get https.proxy<br></code></pre></td></tr></table></div></figure><p> å–æ¶ˆåŸä»£ç†è®¾ç½®ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r066holqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r066holqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global --<span class="hljs-built_in">unset</span> http.proxy<br>git config --global --<span class="hljs-built_in">unset</span> https.proxy<br></code></pre></td></tr></table></div></figure><p>åˆ·æ–° DNS è§£æç¼“å­˜ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wqao83lqv4htaz" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wqao83lqv4htaz"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ipconfig /flushdns<br></code></pre></td></tr></table></div></figure>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸‰.æš‘æœŸå®ä¹ é—®é¢˜æ€»ç»“</title>
    <link href="/2023/08/27/%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/"/>
    <url>/2023/08/27/%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p><mark>debugger</mark></p><p>vscodeä¸­Ctrl+shift+Pè°ƒå‡ºæ§åˆ¶é¢æ¿ï¼š</p><img src="image-20231009155049000.png" alt="image-20231009155049000" style="zoom:50%;" /><p>Ctrl+Pï¼šé€šè¿‡æ–‡ä»¶åæœç´¢æ–‡ä»¶è·¯å¾„</p><hr><p>Chromeæ’ä»¶ï¼š<code>Vue.js devtools</code></p><img src="image-20231101175926473.png" alt="image-20231101175926473" style="zoom:50%;" /><hr><p>Vueä»£ç æ¨¡æ¿ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dvx0d4lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dvx0d4lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>    <br>&lt;/script&gt;<br><br>&lt;template&gt;<br><br>&lt;/template&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br><br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><p>åœ¨vscodeç®¡ç†ä¸­ç‚¹å‡»ç”¨æˆ·ä»£ç ç‰‡æ®µcode snippetsï¼šæ–‡ä»¶â†’é¦–é€‰é¡¹â†’Configure Use Snippetsâ†’New Global Snippets fileâ†’è¾“å…¥åç§°</p><p>å€ŸåŠ©<code>https://snippet-generator.app/</code>ç”Ÿæˆä»£ç å³å¯ï¼š</p><img src="image-20230927172325096.png" alt="image-20230927172325096" style="zoom:50%;" /><p class="note note-danger">æ³¨æ„è¦åŠ ä¸Š{}</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-cp4rlxlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-cp4rlxlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs js">&#123;<br>    <span class="hljs-string">&quot;v3&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;prefix&quot;</span>: <span class="hljs-string">&quot;v3&quot;</span>,<br>      <span class="hljs-string">&quot;body&quot;</span>: [<br>        <span class="hljs-string">&quot;&lt;script setup lang=\&quot;ts\&quot;&gt;&quot;</span>,<br>        <span class="hljs-string">&quot;    &quot;</span>,<br>        <span class="hljs-string">&quot;&lt;/script&gt;&quot;</span>,<br>        <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;&lt;template&gt;&quot;</span>,<br>        <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;&lt;/template&gt;&quot;</span>,<br>        <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;&lt;style lang=\&quot;scss\&quot; scoped&gt;&quot;</span>,<br>        <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;&lt;/style&gt;&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;v3&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨ï¼šv3å›è½¦</p><hr><p>VScodeæ’ä»¶ï¼š</p><ul><li>TypeScript Vue Plugin(Volar)</li><li>Vue Language Features(Volar)</li><li>ESLintï¼šJavaScript ä»£ç æ£€æŸ¥å·¥å…·</li><li>Prettier-Code formatterï¼šä»£ç ç¼©è¿›åº”è¯¥ä½¿ç”¨ tabs è¿˜æ˜¯ç©ºæ ¼ã€‚Prettieræ ¹æ®é¢„è®¾é…ç½®çš„è§„åˆ™é‡æ–°æ ¼å¼åŒ–ä»£ç ï¼Œä»¥ä¿è¯ä»£ç æ•´æ´ã€‚è¿è¡Œ Prettierï¼Œä½ çš„æ‰€æœ‰ tabs éƒ½å°†è½¬æ¢ä¸ºç©ºæ ¼ï¼ŒåŒæ—¶ç¼©è¿›ã€å¼•å·ç­‰ä¹Ÿéƒ½å°†æ ¹æ®ä½ çš„é…ç½®è€Œæ”¹å˜ã€‚ç†æƒ³çŠ¶æ€ä¸‹ï¼Œå½“ä½ ä¿å­˜æ–‡ä»¶æ—¶ï¼ŒPrettier ä¼šè‡ªåŠ¨æ‰§è¡Œæ ¼å¼åŒ–æ“ä½œã€‚</li><li>Prettier ESLint</li><li>px2rem</li><li>Auto Close Tag</li><li>Auto Complete Tag</li><li>Auto Rename Tag</li><li>Path Intellisense</li><li>vscode-icons</li></ul><p>ç‚¹å‡»Vue Language Features(Volar)çš„æ‰©å±•è®¾ç½®ï¼šè‡ªåŠ¨è¡¥å…¨refå£°æ˜çš„å˜é‡çš„.valueï¼š</p><img src="image-20231122170831930.png" alt="image-20231122170831930" style="zoom:50%;" /><img src="value.gif" alt="value" style="zoom:50%;" /><hr><h1 id="ä¸€-Formç»„ä»¶æ›¿æ¢"><a href="#ä¸€-Formç»„ä»¶æ›¿æ¢" class="headerlink" title="ä¸€.Formç»„ä»¶æ›¿æ¢"></a>ä¸€.Formç»„ä»¶æ›¿æ¢</h1><p>el-formè¡¨å•äºŒæ¬¡å°è£…ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-owjumelqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-owjumelqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-attr">label-width</span>=<span class="hljs-string">&quot;50px&quot;</span> <span class="hljs-attr">label-position</span>=<span class="hljs-string">&quot;top&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;mini&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;accessInfo.isOwner&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;èµ·å§‹èŠ‚ç‚¹&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;ç»“æŸèŠ‚ç‚¹&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5g52v6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5g52v6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;form&quot;</span> <span class="hljs-attr">:formObj</span>=<span class="hljs-string">&quot;formObj&quot;</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">&quot;formData&quot;</span> <span class="hljs-attr">:labelWidth</span>=<span class="hljs-string">&quot;50&quot;</span> <span class="hljs-attr">:labelPosition</span>=<span class="hljs-string">&quot;&#x27;top&#x27;&quot;</span> <span class="hljs-attr">:size</span>=<span class="hljs-string">&quot;&#x27;mini&#x27;&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;accessInfo.isOwner&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fromid</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.fromid&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">toid</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.toid&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span><br></code></pre></td></tr></table></div></figure><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dgn8krlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dgn8krlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;&lt;/template&gt;<br>&lt;script&gt;<br>    import Form from &#x27;@/components/common/Form&#x27;<br>    export default&#123;<br>        components:&#123;<br>            Form<br>        &#125;,<br>        data()&#123;<br>            return&#123;<br>                formData:&#123;<br>                    fromid: &#x27;&#x27;,<br>                    toid: &#x27;&#x27;<br>                &#125;,<br>                formObj:[<br>                    &#123;<br>                        specialFormItem: true,<br>                        specialName: &quot;fromid&quot;,<br>                        label: &quot;èµ·å§‹èŠ‚ç‚¹&quot;<br>                    &#125;,<br>                    &#123;<br>                        specialFormItem: true,<br>                        specialName: &quot;toid&quot;,<br>                        label: &quot;ç»“æŸèŠ‚ç‚¹&quot;<br>                    &#125;<br>                ]<br>            &#125;<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><br/><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2mx9u5lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2mx9u5lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;åç§°&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.name&quot;</span> <span class="hljs-attr">:maxlength</span>=<span class="hljs-string">&quot;60&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;æè¿°&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;textarea&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.desc&quot;</span> <span class="hljs-attr">:maxlength</span>=<span class="hljs-string">&quot;200&quot;</span> <span class="hljs-attr">:rows</span>=<span class="hljs-string">&quot;5&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;ç±»å‹&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.type&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¯·é€‰æ‹©ç±»å‹&quot;</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;wdith:100%&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;HIVE&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;SQL&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;æ•°æ®åº“&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span> <span class="hljs-attr">filterable</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;formData.hiveDatabase&quot;</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">&quot;formData.table=&#x27;&#x27;&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¯·é€‰æ‹©æ•°æ®åº“&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;item.database&quot;</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">&quot;item.database&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item,index) in hiveDatabaseList&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r5lphzlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r5lphzlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">formObj</span>:[<br>    &#123;<br>        <span class="hljs-attr">input</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;åç§°&#x27;</span>,<br>        <span class="hljs-attr">prop</span>: <span class="hljs-string">&#x27;name&#x27;</span>,<br>        <span class="hljs-attr">maxlength</span>: <span class="hljs-number">60</span>,<br>        <span class="hljs-attr">inputStyle</span>: <span class="hljs-string">&#x27;width: 100%&#x27;</span><br>    &#125;,<br>    &#123;<br>        <span class="hljs-attr">textarea</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;æè¿°&#x27;</span>,<br>        <span class="hljs-attr">prop</span>: <span class="hljs-string">&#x27;desc&#x27;</span>,<br>        <span class="hljs-attr">maxlength</span>: <span class="hljs-number">200</span>,<br>        <span class="hljs-attr">inputStyle</span>: <span class="hljs-string">&#x27;width: 100%&#x27;</span>,<br>        <span class="hljs-attr">autosize</span>: &#123;<span class="hljs-attr">minRows</span>: <span class="hljs-number">5</span>&#125;<br>    &#125;,<br>    &#123;<br>        <span class="hljs-attr">select</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;ç±»å‹&#x27;</span>,<br>        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">&#x27;è¯·é€‰æ‹©ç±»å‹&#x27;</span>,<br>        <span class="hljs-attr">prop</span>: <span class="hljs-string">&#x27;type&#x27;</span>,<br>        <span class="hljs-attr">maxlength</span>: <span class="hljs-number">200</span>,<br>        <span class="hljs-attr">disabled</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">inputStyle</span>: <span class="hljs-string">&#x27;width: 100%&#x27;</span>,<br>        <span class="hljs-attr">options</span>: [<br>            &#123;<br>                <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;HIVE&#x27;</span>,<br>                <span class="hljs-attr">value</span>: <span class="hljs-number">0</span><br>            &#125;,<br>            &#123;<br>                <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;SQL&#x27;</span>,<br>                <span class="hljs-attr">value</span>: <span class="hljs-number">1</span><br>            &#125;,<br>        ]<br>    &#125;,<br>    &#123;<br>        <span class="hljs-attr">searchSelect</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">label</span>: <span class="hljs-string">&#x27;æ•°æ®åº“&#x27;</span>,<br>        <span class="hljs-attr">prop</span>: <span class="hljs-string">&#x27;hiveDatabase&#x27;</span>,<br>        <span class="hljs-attr">options</span>: [],<br>        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">&#x27;è¯·é€‰æ‹©æ•°æ®åº“&#x27;</span><br>    &#125;,<br>]<br></code></pre></td></tr></table></div></figure><br/><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-k4d73llqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-k4d73llqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&quot;ruleForm&quot;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;rules&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ruleForm&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;é¡¹ç›®åç§°&quot;</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;ruleForm.name&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&quot;mini&quot;</span> <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">&quot;isSharedProject==0 ? &#x27;è¯·è¾“å…¥å…±äº«é¡¹ç›®åç§°&#x27; : &#x27;è¯·è¾“å…¥æœ¬åœ°é¡¹ç›®åç§°&#x27;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-quadn0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-quadn0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">:formObj</span>=<span class="hljs-string">&quot;formObj&quot;</span> <span class="hljs-attr">:formData</span>=<span class="hljs-string">&quot;ruleForm&quot;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&quot;rules&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ruleForm&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span><br></code></pre></td></tr></table></div></figure><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ywaab0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ywaab0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;&lt;/template&gt;<br>&lt;script&gt;<br>import Form from &#x27;@/components/common/Form&#x27;<br>    export default&#123;<br>        components:&#123;<br>            Form<br>        &#125;,<br>        data()&#123;<br>            return&#123;<br>                ruleForm: &#123;<br>                    name: &#x27;&#x27;,<br>                &#125;,<br>                rules:&#123;<br>                    name: [<br>                        &#123;<br>                            required: true,<br>                            message: &#x27;è¯·è¾“å…¥é¡¹ç›®åç§°&#x27;,<br>                            trigger: &#x27;blur&#x27;,<br>                        &#125;,<br>                    ],<br>                &#125;,<br>                formObj:[<br>                    &#123;<br>                        input: true,<br>                        label: &#x27;é¡¹ç›®åç§°&#x27;,<br>                        prop: &#x27;name&#x27;,<br>                        placeholder: &quot;&quot;,<br>                        size: &quot;mini&quot;,<br>                        inputStyle: &quot;width: 100%&quot;<br>                    &#125;<br>                ]<br>            &#125;<br>        &#125;,<br>        methods: &#123;<br>            updatePlaceholder()&#123;<br>                this.formObj[0].placeholder=this.isSharedProject==0 ? &#x27;è¯·è¾“å…¥å…±äº«é¡¹ç›®åç§°&#x27; : &#x27;è¯·è¾“å…¥æœ¬åœ°é¡¹ç›®åç§°&#x27;<br>            &#125;,<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><br/><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tako0olqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tako0olqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">&#x27;formData&#x27;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#x27;mini&#x27;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#x27;formNode&#x27;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&#x27;item in formList&#x27;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&#x27;item.key&#x27;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&#x27;item.desc&#x27;</span> <span class="hljs-attr">:prop</span>=<span class="hljs-string">&#x27;item.key&#x27;</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">&#x27;item.rules&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&#x27;formData[item.key]&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;textarea&#x27;</span> <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">&quot;`Type-$&#123;(item.type&#125;\nFormat -JSON`&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>â†’</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8hivlxlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8hivlxlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;Form :formObj=&quot;formObj&quot; :formData=&quot;formData&quot; :size=&quot;&#x27;mini&#x27;&quot; ref=&quot;formNode&quot;&gt;<br>&lt;/Form&gt;<br></code></pre></td></tr></table></div></figure><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ogknm0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ogknm0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;&lt;/template&gt;<br>&lt;script&gt;<br>import Form from &#x27;@/components/common/Form&#x27;<br>    export default&#123;<br>        components:&#123;<br>            Form<br>        &#125;,<br>        data()&#123;<br>            return&#123;<br>                formData,<br>                formList,<br>                formObj:[]<br>            &#125;<br>        &#125;,<br>        created()&#123;<br>            this.updateFormObj()<br>        &#125;,<br>        methods: &#123;<br>            updateFormObj()&#123;<br>                this.formObj=this.formList.map(item=&gt;&#123;<br>                    return&#123;<br>                        key: item.key,<br>                        label: item.desc,<br>                        prop: item.key,<br>                        rules: item.rules,<br>                        textarea: true,<br>                        prop: item.key,<br>                        placeholder: `Type-$&#123;(item.type&#125;\nFormat -JSON`<br>                    &#125;<br>                &#125;)<br>            &#125;,<br>        &#125;<br>    &#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><h1 id="äºŒ-LLM"><a href="#äºŒ-LLM" class="headerlink" title="äºŒ.LLM"></a>äºŒ.LLM</h1><p class="note note-success" style="border-left: 4px solid #f0ad4e;padding: 10px 15px;color: #777;background-color: #fdf8ea;">Ctrl+,æ‰“å¼€vscodeçš„è®¾ç½®</p><h2 id="Vite"><a href="#Vite" class="headerlink" title="Vite"></a>Vite</h2><p>Viteæ˜¯ä¸€ç§æ–°å‹å‰ç«¯æ„å»ºå·¥å…·ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å‰ç«¯å¼€å‘ä½“éªŒã€‚å®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li>ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œå®ƒåŸºäº <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">åŸç”Ÿ ES æ¨¡å—</a> æä¾›äº† <a href="https://cn.vitejs.dev/guide/features.html">ä¸°å¯Œçš„å†…å»ºåŠŸèƒ½</a>ï¼Œå¦‚é€Ÿåº¦å¿«åˆ°æƒŠäººçš„ <a href="https://cn.vitejs.dev/guide/features.html#hot-module-replacement">æ¨¡å—çƒ­æ›´æ–°ï¼ˆHMRï¼‰</a>ã€‚</li><li>ä¸€å¥—æ„å»ºæŒ‡ä»¤ï¼Œå®ƒä½¿ç”¨ <a href="https://rollupjs.org/">Rollup</a> æ‰“åŒ…ä½ çš„ä»£ç ï¼Œå¹¶ä¸”å®ƒæ˜¯é¢„é…ç½®çš„ï¼Œå¯è¾“å‡ºç”¨äºç”Ÿäº§ç¯å¢ƒçš„é«˜åº¦ä¼˜åŒ–è¿‡çš„é™æ€èµ„æºã€‚</li></ul><p>åœ¨ Vite ä¸­ï¼Œ<mark>defineConfig</mark>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®šä¹‰å’Œå¯¼å‡º Vite çš„é…ç½®ã€‚å®ƒä¸»è¦ç”¨äºåˆ›å»ºä¸€ä¸ªåˆæ³•çš„é…ç½®å¯¹è±¡ï¼Œä»¥ä¾› Vite ä½¿ç”¨ã€‚</p><p>åˆ›å»ºvue+vite+tsé¡¹ç›®ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xtmm48lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xtmm48lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm create vite@latest<br></code></pre></td></tr></table></div></figure><p>é€‰æ‹©<code>Vue</code>å’Œ<code>Customize with create-vue</code>ï¼š</p><img src="image-20231125155148959.png" alt="image-20231125155148959" style="zoom:50%;" /><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6ks0lglqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6ks0lglqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vite-project-vue<br>npm install<br>npm run format<br>npm run dev<br></code></pre></td></tr></table></div></figure><img src="image-20231125155909311.png" alt="image-20231125155909311" style="zoom:50%;" /><img src="image-20231125160006850.png" alt="image-20231125160006850" style="zoom:50%;" /><p>é…ç½®åˆ«åï¼šè®¾ç½®@æŒ‡å‘srcç›®å½•ï¼Œæ·»åŠ åˆ°tsconfig.jsonæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rk7dr9lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rk7dr9lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;composite&quot;</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-string">&quot;baseUrl&quot;</span>: <span class="hljs-string">&quot;.&quot;</span>,<br>            <span class="hljs-string">&quot;paths&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;@/*&quot;</span>: [<span class="hljs-string">&quot;./src/*&quot;</span>]<br>            &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231125191448935.png" alt="image-20231125191448935" style="zoom:50%;" /><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æŠ¥é”™ï¼šæ‰¾ä¸åˆ°æ¨¡å—â€œpathâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜</p><img src="image-20231010094751290.png" alt="image-20231010094751290" style="zoom:43%;" /><p>å› ä¸ºpathæ¨¡å—æ˜¯node.jså†…ç½®çš„åŠŸèƒ½ï¼Œä½†æ˜¯node.jsæœ¬èº«å¹¶ä¸æ”¯æŒtypescriptï¼Œæ‰€ä»¥ç›´æ¥åœ¨typescripté¡¹ç›®é‡Œä½¿ç”¨æ˜¯ä¸è¡Œçš„ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šå®‰è£…<code>@types/node</code></p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wydayelqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wydayelqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @types/node --save-dev<br></code></pre></td></tr></table></div></figure><p>é‡å¯é¡¹ç›®åç”Ÿæ•ˆ</p><hr><p>æŠ¥é”™<code>Component name &quot;home&quot;should always be multi-word.eslint(vue/multi-word-component-names</code>ï¼š</p><p>åœ¨.eslintrc.cjsæ–‡ä»¶ä¸­åŠ ä¸Šï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vazd4vlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vazd4vlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">rules</span>: &#123;<br>    <span class="hljs-comment">// å…³é—­åç§°æ ¡éªŒ</span><br>    <span class="hljs-string">&#x27;vue/multi-word-component-names&#x27;</span>: <span class="hljs-string">&quot;off&quot;</span><br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æ§åˆ¶å°è­¦å‘Šï¼š[Vue warn]: Failed to resolve component: router-linkIf this is a native custom element, make sure to exclude it from component resolution via compilerOptions.isCustomElement. at < App > </p><img src="image-20231010101246698.png" alt="image-20231010101246698" style="zoom:40%;" /><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">ä¿®æ”¹ç«¯å£å· ï¼Œä½¿ç”¨localhostè®¿é—®</p><p>åœ¨vite.config.tsæ·»åŠ ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w61sx0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w61sx0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>,<span class="hljs-comment">//ç«¯å£å·</span><br>    <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,<span class="hljs-comment">//ipåœ°å€ æˆ– &#x27;0.0.0.0&#x27; æˆ– &quot;loaclhost&quot;</span><br>    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//å¯åŠ¨åæ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span><br>    <span class="hljs-attr">https</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦å¼€å¯ https</span><br>&#125;,<br></code></pre></td></tr></table></div></figure><img src="image-20231010103633427.png" alt="image-20231010103633427" style="zoom:50%;" /><p><code>&lt;router-view /&gt;</code>æ˜¯ç”¨äºå‘ˆç°è·¯ç”±ç»„ä»¶çš„å ä½ç¬¦ã€‚å½“ä½ ä½¿ç”¨ Vue Router è¿›è¡Œé¡µé¢å¯¼èˆªæ—¶ï¼Œå®ƒä¼šæ ¹æ®å½“å‰è·¯ç”±é…ç½®åŠ è½½ç›¸åº”çš„ç»„ä»¶ï¼Œå¹¶å°†å…¶æ¸²æŸ“åˆ° <code>&lt;router-view /&gt;</code> ä¸­ã€‚</p><img src="image-20231010104903812.png" alt="image-20231010104903812" style="zoom:40%;" /><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æŠ¥é”™ï¼šPreprocessor dependency "sass"not found</p><img src="image-20231011172319536.png" alt="image-20231011172319536" style="zoom:50%;" /><p>è§£å†³æ–¹æ³•ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-nk68x7lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-nk68x7lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -D sass<br></code></pre></td></tr></table></div></figure><hr><p><code>postcss-pxtorem</code>æ˜¯postcssçš„ä¸€ä¸ªæ’ä»¶ï¼Œå¯ä»¥å°†å¯¹åº”çš„åƒç´ å•ä½è½¬æ¢ä¸ºremã€‚ä¸»è¦ç”¨äºé€‚åº”ä¸åŒçš„åˆ†è¾¨ç‡çš„ç§»åŠ¨è®¾å¤‡ï¼Œä»è€Œå®ç°å“åº”å¼å¸ƒå±€ã€‚åœ¨viteä¸­å¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œé…ç½®ï¼Œå› ä¸ºviteå·²ç»é›†æˆäº†postcssã€‚</p><p>å…¶ä¸­æœ€é‡è¦çš„é…ç½®å±æ€§ä¸ºï¼š</p><ul><li>rootValueï¼šæ ¹å…ƒç´ çš„å€¼ï¼Œå³1remå¯¹åº”çš„åƒç´ å€¼å¤§å°ã€‚ä¸€èˆ¬è®¾ç½®ä¸ºè®¾è®¡ç¨¿å°ºå¯¸&#x2F;10</li></ul><p>ä»¥åŠä¸€äº›å…¶ä»–å±æ€§ï¼š</p><ul><li>propListï¼šéœ€è¦è¿›è¡Œè½¬æ¢çš„csså±æ€§çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ã€‚å¦‚ï¼š<code>*</code>æ„æ€æ˜¯å°†å…¨éƒ¨å±æ€§å•ä½éƒ½è¿›è¡Œè½¬æ¢ï¼›<code>[&quot;*position*&quot;]</code>ä¼šåŒ¹é…åˆ°<code>background-position-y</code></li><li>selectorBlackListï¼šä¸è¿›è¡Œå•ä½è½¬æ¢çš„é€‰æ‹©å™¨ã€‚å¦‚è®¾ç½®ä¸ºå­—ç¬¦ä¸²<code>body</code>ï¼Œåˆ™æ‰€æœ‰å«æœ‰bodyå­—ç¬¦ä¸²çš„é€‰æ‹©å™¨éƒ½ä¸ä¼šè¢«è¯¥æ’ä»¶è¿›è¡Œè½¬æ¢ï¼›è‹¥è®¾ç½®ä¸º<code>[/^body$/]</code>ï¼Œåˆ™<code>body</code>ä¼šè¢«åŒ¹é…åˆ°è€Œä¸æ˜¯<code>.body</code></li><li>excludeï¼šä¸éœ€è¦è¿›è¡Œå•ä½è½¬æ¢çš„æ–‡ä»¶</li><li>mediaQueryï¼šæ˜¯å¦å…è®¸åƒç´ åœ¨åª’ä½“æŸ¥è¯¢ä¸­è¿›è¡Œè½¬æ¢</li></ul><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-od5tk3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-od5tk3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install postcss-pxtorem --save-dev<br></code></pre></td></tr></table></div></figure><p>åœ¨vite.config.jsä¸­é…ç½®postcss-pxtoremï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f971uslqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f971uslqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-attr">css</span>: &#123;<br>    <span class="hljs-attr">postcss</span>: &#123;<br>        <span class="hljs-attr">plugins</span>: [<br>            <span class="hljs-title function_">postCssPxToRem</span>(&#123;<br>                <span class="hljs-attr">rootValue</span>: <span class="hljs-number">37.5</span>,<br>                <span class="hljs-attr">propList</span>: [<span class="hljs-string">&#x27;*&#x27;</span>],<br>                <span class="hljs-comment">//è½¬æ¢æˆremåä¿ç•™çš„å°æ•°ç‚¹ä½æ•°</span><br>                <span class="hljs-comment">// unitPrecision: 5,</span><br>                <span class="hljs-comment">//å°äº12pxçš„æ ·å¼ä¸è¢«æ›¿æ¢æˆrem</span><br>                <span class="hljs-comment">// minPixelValue: 12,</span><br>                <span class="hljs-comment">//selectorBlackList: [&#x27;.qz-&#x27;],// è¦å¿½ç•¥çš„é€‰æ‹©å™¨å¹¶ä¿ç•™ä¸ºpxã€‚</span><br>                <span class="hljs-comment">//å¿½ç•¥ä¸€äº›æ–‡ä»¶ï¼Œä¸è¿›è¡Œè½¬æ¢ï¼Œæ¯”å¦‚æˆ‘æƒ³å¿½ç•¥ ä¾èµ–çš„UIæ¡†æ¶</span><br>                <span class="hljs-comment">// exclude: [&#x27;node_modules&#x27;]</span><br>            &#125;)<br>        ]<br>    &#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231020143318360.png" alt="image-20231020143318360" style="zoom:50%;" /><img src="image-20231020143255549.png" alt="image-20231020143255549" style="zoom:50%;" /><p>è¡Œå†…æ ·å¼çš„pxä¸ä¼šè½¬æ¢æˆremï¼š</p><img src="image-20231023105224042.png" alt="image-20231023105224042" style="zoom:50%;" /><img src="image-20231023104657917.png" alt="image-20231023104657917" style="zoom:50%;" /><p>å¦‚æœæƒ³è®©è¡Œå†…æ ·å¼çš„pxè½¬æ¢æˆremï¼š</p><ol><li><p>æœ‰å¾ˆå¤šå…¬ç”¨çš„jså‡½æ•°ï¼Œä¸ºäº†ä¾¿äºé›†ä¸­ç®¡ç†ï¼Œå¯ä»¥åœ¨srcä¸‹é¢æ–°å»ºä¸€ä¸ªutilsæ–‡ä»¶å¤¹ç»Ÿä¸€ç®¡ç†ï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ihvxsqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ihvxsqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">px2rem</span>(<span class="hljs-params">px: <span class="hljs-built_in">string</span></span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/%/gi</span>.<span class="hljs-title function_">test</span>(px)) &#123;<span class="hljs-comment">// æœ‰ç™¾åˆ†å·%ï¼Œç‰¹æ®Šå¤„ç†ï¼Œè¡¨è¿°pcæ˜¯ä¸€ä¸ªæœ‰ç™¾åˆ†å·çš„æ•°ï¼Œæ¯”å¦‚ï¼š90%</span><br>        <span class="hljs-keyword">return</span> px<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(px) / <span class="hljs-number">192</span> + <span class="hljs-string">&#x27;rem&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231024111039721.png" alt="image-20231024111039721" style="zoom:50%;" /><p>åœ¨main.tsä¸­æ³¨å†Œå…¨å±€æ–¹æ³•$px2remï¼š</p><img src="image-20231024110931821.png" alt="image-20231024110931821" style="zoom:50%;" /><p>åœ¨vueä¸­ä½¿ç”¨ï¼š</p><img src="image-20231024112954917.png" alt="image-20231024112954917" style="zoom:50%;" /></li><li><p>ä¸ç”¨å…¨å±€æ³¨å†Œï¼Œç›´æ¥å±€éƒ¨å¼•ç”¨ï¼š</p><img src="image-20231024113151892.png" alt="image-20231024113151892" style="zoom:50%;" /></li></ol><hr><p>å‰ç«¯æŠ¥é”™<code>Access to XMLHttpRequest at &#39; http ://10.114.49.20:8000/ private / knowledge / compl etion &#39; from origin &#39; http :// localhost :8085&#39; has been bloc ked by CORS policy : Respons e to preflight request doesn &#39; t pass access control check : No &#39; Access- Control-Allow-Origin &#39; header is present on the requested resource</code>ï¼šè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºæµè§ˆå™¨çš„è·¨åŸŸå®‰å…¨ç­–ç•¥ï¼ˆCORSï¼‰å¯¼è‡´çš„ã€‚</p><p>CORSç­–ç•¥è¦æ±‚æœåŠ¡å™¨åœ¨å“åº”ä¸­æ·»åŠ ç‰¹å®šçš„å¤´éƒ¨ä¿¡æ¯ï¼Œä»¥å…è®¸æ¥è‡ªä¸åŒæºï¼ˆOriginï¼‰çš„è¯·æ±‚è®¿é—®èµ„æºã€‚åœ¨ä½ çš„é”™è¯¯ä¿¡æ¯ä¸­ï¼ŒæŠ¥å‘Šäº†æ¥è‡ªæœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆ<code>http://localhost:8085</code>ï¼‰å¯¹å¦ä¸€ä¸ªåŸŸï¼ˆ<code>http://10.114.49.20:8000</code>ï¼‰çš„è¯·æ±‚è¢«é˜»æ­¢äº†ã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å°è¯•ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol><li><p><strong>åç«¯é…ç½®ï¼š</strong> åœ¨ <code>http://10.114.49.20:8000</code> çš„æœåŠ¡å™¨ç«¯ä»£ç ä¸­ï¼Œæ·»åŠ åˆé€‚çš„å“åº”å¤´æ¥å…è®¸è·¨åŸŸè¯·æ±‚ã€‚å…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦åœ¨å“åº”ä¸­æ·»åŠ  <code>Access-Control-Allow-Origin</code> å¤´ï¼Œå°†å…¶å€¼è®¾ç½®ä¸º <code>http://localhost:8085</code>ã€‚</p></li><li><p><strong>ä½¿ç”¨ä»£ç†ï¼š</strong> å¦‚æœä½ åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨çš„æ˜¯ Vite æˆ–ç±»ä¼¼çš„å·¥å…·ï¼Œä½ å¯ä»¥å°è¯•é…ç½®å¼€å‘æœåŠ¡å™¨çš„ä»£ç†ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°æ­£ç¡®çš„åœ°å€ã€‚åœ¨ Vite ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ <code>vite.config.js</code> æ–‡ä»¶æ¥é…ç½®ä»£ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hl5elwlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hl5elwlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-attr">server</span>: &#123;<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,<span class="hljs-comment">//è®¾ç½®åœ°å€ï¼šhttp://localhost</span><br>    <span class="hljs-attr">port</span>: <span class="hljs-number">8083</span>, <span class="hljs-comment">// è®¾ç½®æœåŠ¡å¯åŠ¨ç«¯å£å·</span><br>    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®¾ç½®æœåŠ¡å¯åŠ¨æ—¶æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span><br>    <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å…è®¸è·¨åŸŸ</span><br>    <span class="hljs-attr">proxy</span>: &#123;<br>        <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>            <span class="hljs-attr">target</span>: env.<span class="hljs-property">VITE_APP_BASE_URL</span>,<span class="hljs-comment">//ä»£ç†çš„åœ°å€</span><br>            <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">&#x27;&#x27;</span>)<span class="hljs-comment">//è¿™é‡Œçš„/éœ€è¦è½¬ä¹‰</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ ·ï¼Œæ‰€æœ‰ä»¥ <code>/private</code> å¼€å¤´çš„è¯·æ±‚å°†è¢«ä»£ç†åˆ° <code>http://10.114.49.20:8000</code> åœ°å€ã€‚</p></li><li><p><strong>ä¿®æ”¹å‰ç«¯å¼€å‘æœåŠ¡å™¨çš„åœ°å€ï¼š</strong> å¦‚æœä½ æœ‰æƒé™æ›´æ”¹åç«¯æœåŠ¡å™¨çš„é…ç½®ï¼Œå¯ä»¥è€ƒè™‘å°†å‰ç«¯å¼€å‘æœåŠ¡å™¨çš„åœ°å€è®¾ç½®ä¸ºä¸åç«¯æœåŠ¡å™¨ç›¸åŒçš„åœ°å€ï¼ˆä¾‹å¦‚ <code>http://10.114.49.20:8000</code>ï¼‰ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜äº†ã€‚</p></li></ol><hr><p>ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œæ˜¯åŸºäºä¸åŒç¯å¢ƒå®ç°ä¸åŒé€»è¾‘çš„ã€‚æ¯”å¦‚ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒå°†BASE_URLè®¾ç½®æˆä¸åŒçš„å€¼ï¼Œç”¨æ¥è¯·æ±‚ä¸åŒçš„ç¯å¢ƒçš„æ¥å£ã€‚</p><p>Viteå†…ç½®äº†<code>dotenv</code>è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œ dotenvä¼šè‡ªåŠ¨è¯»å–.envæ–‡ä»¶ï¼Œ dotenv ä»ä½ çš„ ç¯å¢ƒç›®å½• ä¸­çš„ä¸‹åˆ—æ–‡ä»¶åŠ è½½é¢å¤–çš„ç¯å¢ƒå˜é‡ï¼š</p><ul><li>.envï¼šæ‰€æœ‰æƒ…å†µä¸‹éƒ½ä¼šåŠ è½½</li><li>.env.[mode]ï¼šåªåœ¨æŒ‡å®šæ¨¡å¼ä¸‹åŠ è½½</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>npm run dev</code>ä¼šåŠ è½½ .env å’Œ .env.development å†…çš„é…ç½®ï¼Œ<code>npm run build</code>ä¼šåŠ è½½ .env å’Œ .env.production å†…çš„é…ç½®ï¼Œmode å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œ --mode é€‰é¡¹æ¥é‡å†™ã€‚</p><p>åŠ è½½çš„ç¯å¢ƒå˜é‡ä¹Ÿä¼šé€šè¿‡ import.meta.env ä»¥å­—ç¬¦ä¸²å½¢å¼æš´éœ²ç»™å®¢æˆ·ç«¯æºç ã€‚ä¸ºäº†é˜²æ­¢æ„å¤–åœ°å°†ä¸€äº›ç¯å¢ƒå˜é‡æ³„æ¼åˆ°å®¢æˆ·ç«¯ï¼Œåªæœ‰ä»¥ VITE_ ä¸ºå‰ç¼€çš„å˜é‡æ‰ä¼šæš´éœ²ç»™ç»è¿‡ vite å¤„ç†çš„ä»£ç ã€‚</p><hr><p>è®¾ç½® Volar Takeover æ¨¡å¼ æ¥æ”¯æŒ Vue çš„ TS è¯­è¨€æœåŠ¡ï¼š</p><ol><li>åœ¨å½“å‰é¡¹ç›®çš„å·¥ä½œç©ºé—´ä¸‹ï¼Œç”¨ <code>Ctrl + Shift + P</code> (macOSï¼š<code>Cmd + Shift + P</code>) å”¤èµ·å‘½ä»¤é¢æ¿ã€‚</li><li>è¾“å…¥ <code>built</code>ï¼Œç„¶åé€‰æ‹©â€œExtensionsï¼šShow Built-in Extensionsâ€ã€‚</li><li>åœ¨æ’ä»¶æœç´¢æ¡†å†…è¾“å…¥ <code>typescript</code> (ä¸è¦åˆ é™¤ <code>@builtin</code> å‰ç¼€)ã€‚</li><li>ç‚¹å‡»â€œTypeScript and JavaScript Language Featuresâ€å³ä¸‹è§’çš„å°é½¿è½®ï¼Œç„¶åé€‰æ‹©â€œDisable (Workspace)â€ã€‚</li><li>é‡æ–°åŠ è½½å·¥ä½œç©ºé—´ã€‚Takeover æ¨¡å¼å°†ä¼šåœ¨ä½ æ‰“å¼€ä¸€ä¸ª Vue æˆ–è€… TS æ–‡ä»¶æ—¶è‡ªåŠ¨å¯ç”¨ã€‚</li></ol><hr><p>æŠ¥é”™<code>Cannot find module &#39;vue&#39;. Did you mean to set the &#39;moduleResolution&#39; option to &#39;noden</code>ï¼š</p><p>è§£å†³ï¼šåŠ ä¸Š&quot;moduleResolution&quot;: &quot;node&quot;</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0ld98alqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0ld98alqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-string">&quot;compilerOptions&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;target&quot;</span>: <span class="hljs-string">&quot;es2017&quot;</span>,<br>   <span class="hljs-string">&quot;module&quot;</span>:<span class="hljs-string">&quot;ES2022&quot;</span>,<br>   <span class="hljs-string">&quot;moduleResolution&quot;</span>: <span class="hljs-string">&quot;node&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></div></figure><p>axios</p><p>provide&#x2F;inject</p><p>js-cookie</p><h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p>å®‰è£…ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l853jzlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l853jzlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install vue-router -S<br></code></pre></td></tr></table></div></figure><p>srcæ–‡ä»¶å¤¹ä¸‹åˆ›å»º router æ–‡ä»¶å¤¹ï¼Œåˆ›å»º index.ts æ–‡ä»¶ï¼š</p><figure class="highlight typescript"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-i9vlgblqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-i9vlgblqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory, <span class="hljs-title class_">RouteRecordRaw</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/auditAnswer/navigation&#x27;</span>,<span class="hljs-comment">/* é‡å®šå‘ */</span><br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/auditAnswer&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;auditAnswer&#x27;</span>,<br>    <span class="hljs-comment">/* alias: [&#x27;/home&#x27;,&#x27;/home2&#x27;],   //åˆ«å */</span><br>    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/layout/home/index.vue&#x27;</span>),<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;navigation&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;navigation&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/layout/home/desc.vue&#x27;</span>) <br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;chat&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;chat&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/layout/home/chat/index.vue&#x27;</span>) <br>      &#125;<br>    ]<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/auditSQL&#x27;</span>,<br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/auditSQL/navigation&#x27;</span>,<br>  &#125;,<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/auditSQL&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;auditSQL&#x27;</span>,<br>  &#125;,<br>    <span class="hljs-attr">children</span>: [<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;navigation&#x27;</span>,<br>        <span class="hljs-comment">/* ä¸èƒ½å’Œ/auditAnswer/navigationçš„nameé‡å¤ */</span><br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;navigation2&#x27;</span>,<span class="hljs-comment">/* name: &#x27;navigation&#x27;ä¸å¯¹ */</span><br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/layout/sql/sqldesc.vue&#x27;</span>) <br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;sql&#x27;</span>,<br>        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;sql&#x27;</span>,<br>        <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;@/views/layout/sql/index.vue&#x27;</span>) <br>      &#125;<br>    ]<br>  &#125;,<br>]<br><span class="hljs-comment">/* åˆ›å»ºè·¯ç”±å®ä¾‹ */</span><br><span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>(&#123;<br>  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),<br>  routes<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router<br></code></pre></td></tr></table></div></figure><p>åœ¨ main.ts ä¸­å¼•å…¥å¹¶æ³¨å†Œï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mu3ru3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mu3ru3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; creatApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router/index&#x27;</span><br><span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./store/index&#x27;</span><br><span class="hljs-keyword">const</span> app=<span class="hljs-title function_">creatApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">use</span>(router).<span class="hljs-title function_">use</span>(store)<br></code></pre></td></tr></table></div></figure><p>è·³è½¬404é¡µé¢ï¼šåœ¨srcæ–‡ä»¶å¤¹ä¸‹çš„viewsæ–‡ä»¶å¤¹åˆ›å»ºNotFoundæ–‡ä»¶å¤¹ï¼Œåˆ›å»ºindex.vueã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fgxhxwlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fgxhxwlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>    <br>&lt;/script&gt;<br><br>&lt;template&gt;<br>&lt;p&gt;<br>        404<br>    &lt;/p&gt;<br>&lt;h5&gt;<br>        æ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨<br>    &lt;/h5&gt;<br>&lt;/template&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br><br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><p>scr&#x2F;router&#x2F;index.tsï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fejiillqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fejiillqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">NotFound</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@/view/NotFound/404.vue&#x27;</span><br><span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RouteRecordRaw</span>&gt; = [<br>  &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/:pathMatch(.*)&#x27;</span>,<span class="hljs-comment">/*pathMatch(.*)*è¡¨ç¤ºåŒ¹é…æ‰€æœ‰è·¯å¾„*/</span><br>    <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,<br>  &#125;,<br>    &#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/404&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;404&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">NotFound</span><br>  &#125;,<br>]<br></code></pre></td></tr></table></div></figure><p>ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ <code>router-link</code> æ¥åˆ›å»ºé“¾æ¥ã€‚è¿™ä½¿å¾— Vue Router å¯ä»¥åœ¨ä¸é‡æ–°åŠ è½½é¡µé¢çš„æƒ…å†µä¸‹æ›´æ”¹ URLï¼Œå¤„ç† URL çš„ç”Ÿæˆä»¥åŠç¼–ç ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-v7pnc3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-v7pnc3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/vue@3&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/vue-router@4&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello App!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ä½¿ç”¨ router-link ç»„ä»¶è¿›è¡Œå¯¼èˆª --&gt;</span><br>    <span class="hljs-comment">&lt;!--é€šè¿‡ä¼ é€’ `to` æ¥æŒ‡å®šé“¾æ¥ --&gt;</span><br>    <span class="hljs-comment">&lt;!--`&lt;router-link&gt;` å°†å‘ˆç°ä¸€ä¸ªå¸¦æœ‰æ­£ç¡® `href` å±æ€§çš„ `&lt;a&gt;` æ ‡ç­¾--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/&quot;</span>&gt;</span>Go to Home<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/about&quot;</span>&gt;</span>Go to About<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- è·¯ç”±å‡ºå£ --&gt;</span><br>  <span class="hljs-comment">&lt;!-- è·¯ç”±åŒ¹é…åˆ°çš„ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p><code>router-view</code> å°†æ˜¾ç¤ºä¸ url å¯¹åº”çš„ç»„ä»¶ã€‚ä½ å¯ä»¥æŠŠå®ƒæ”¾åœ¨ä»»ä½•åœ°æ–¹ï¼Œä»¥é€‚åº”ä½ çš„å¸ƒå±€ã€‚</p><p>å› ä¸ºæˆ‘ä»¬åœ¨ <code>setup</code> é‡Œé¢æ²¡æœ‰è®¿é—® <code>this</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å†ç›´æ¥è®¿é—® <code>this.$router</code> æˆ– <code>this.$route</code>ã€‚ä½œä¸ºæ›¿ä»£ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>useRouter</code> å’Œ <code>useRoute</code> å‡½æ•°ã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y58o2glqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y58o2glqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script lang=&quot;ts&quot; setup&gt;<br>import &#123; useRoute &#125; from &#x27;vue-router&#x27;<br>import router from &#x27;@/router&#x27;<br>const $route=useRoute()<br>    <br>onMounted(()=&gt;&#123;<br>    if($route.name===&#x27;auditSQL&#x27;)&#123;<br>        localStorage.setItem(&#x27;sqlArray&#x27;,JSON.stringify([]))<br>        homeStore.clearSqlArr()<br>    &#125;<br>/*ä¸Šä¸€ä¸ªé¡µé¢*/<br>    if(router.options.history.state.back===&#x27;/auditSQL/navigation&#x27;)&#123;&#125;<br>&#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>å°†ç»™å®šåŒ¹é…æ¨¡å¼çš„è·¯ç”±æ˜ å°„åˆ°åŒä¸€ä¸ªç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰ä¸€ä¸ª <code>User</code> ç»„ä»¶ï¼Œå®ƒåº”è¯¥å¯¹æ‰€æœ‰ç”¨æˆ·è¿›è¡Œæ¸²æŸ“ï¼Œä½†ç”¨æˆ· ID ä¸åŒã€‚åœ¨ Vue Router ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·¯å¾„ä¸­ä½¿ç”¨ä¸€ä¸ªåŠ¨æ€å­—æ®µæ¥å®ç°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè·¯å¾„å‚æ•° ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-bzlgddlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-bzlgddlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;&lt;div&gt;User&lt;/div&gt;&#x27;</span>,<br>&#125;<br><br><span class="hljs-comment">/* è¿™äº›éƒ½ä¼šä¼ é€’ç»™ `createRouter` */</span><br><span class="hljs-keyword">const</span> routes = [<br>  <span class="hljs-comment">/* åŠ¨æ€å­—æ®µä»¥å†’å·å¼€å§‹ */</span><br>  &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users/:id&#x27;</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">User</span> &#125;,<br>]<br></code></pre></td></tr></table></div></figure><p>ç°åœ¨åƒ <code>/users/johnny</code> å’Œ <code>/users/jolyne</code> è¿™æ ·çš„ URL éƒ½ä¼šæ˜ å°„åˆ°åŒä¸€ä¸ªè·¯ç”±ã€‚</p><p>&#x3D;&#x3D;è·¯å¾„å‚æ•°ç”¨å†’å· <code>:</code> è¡¨ç¤º&#x3D;&#x3D;ã€‚å½“ä¸€ä¸ªè·¯ç”±è¢«åŒ¹é…æ—¶ï¼Œå®ƒçš„paramsçš„å€¼å°†åœ¨æ¯ä¸ªç»„ä»¶ä¸­ä»¥ <code>this.$route.params</code> çš„å½¢å¼æš´éœ²å‡ºæ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ–° <code>User</code> çš„æ¨¡æ¿æ¥å‘ˆç°å½“å‰çš„ç”¨æˆ· IDï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-j2gcmulqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-j2gcmulqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = &#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;&lt;div&gt;User &#123;&#123; $route.params.id &#125;&#125;&lt;/div&gt;&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">ç¼–ç¨‹å¼å¯¼èˆª</p><p>æƒ³è¦å¯¼èˆªåˆ°ä¸åŒçš„ URLï¼Œå¯ä»¥ä½¿ç”¨ <code>router.push</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå‘ history æ ˆæ·»åŠ ä¸€ä¸ªæ–°çš„è®°å½•ï¼Œæ‰€ä»¥ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®æ—¶ï¼Œä¼šå›åˆ°ä¹‹å‰çš„ URLã€‚</p><p>å½“ä½ ç‚¹å‡» <code>&lt;router-link&gt;</code> æ—¶ï¼Œå†…éƒ¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç‚¹å‡» <code>&lt;router-link :to=&quot;...&quot;&gt;</code> ç›¸å½“äºè°ƒç”¨ <code>router.push(...)</code> ï¼š</p><table><thead><tr><th align="left">å£°æ˜å¼</th><th align="left">ç¼–ç¨‹å¼</th></tr></thead><tbody><tr><td align="left"><code>&lt;router-link :to=&quot;...&quot;&gt;</code></td><td align="left"><code>router.push(...)</code></td></tr></tbody></table><p>è¯¥æ–¹æ³•çš„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è·¯å¾„ï¼Œæˆ–è€…ä¸€ä¸ªæè¿°åœ°å€çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1fag53lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1fag53lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* å­—ç¬¦ä¸²è·¯å¾„ */</span><br>router.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;/users/eduardo&#x27;</span>)<br><br><span class="hljs-comment">/* å¸¦æœ‰è·¯å¾„çš„å¯¹è±¡ */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/users/eduardo&#x27;</span> &#125;)<br><br><span class="hljs-comment">/* å‘½åçš„è·¯ç”±ï¼Œå¹¶åŠ ä¸Šå‚æ•°ï¼Œè®©è·¯ç”±å»ºç«‹ url */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;eduardo&#x27;</span> &#125; &#125;)<br><br><span class="hljs-comment">/* å¸¦æŸ¥è¯¢å‚æ•°ï¼Œç»“æœæ˜¯ /register?plan=private */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/register&#x27;</span>, <span class="hljs-attr">query</span>: &#123; <span class="hljs-attr">plan</span>: <span class="hljs-string">&#x27;private&#x27;</span> &#125; &#125;)<br><br><span class="hljs-comment">/* å¸¦ hashï¼Œç»“æœæ˜¯ /about#team */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/about&#x27;</span>, <span class="hljs-attr">hash</span>: <span class="hljs-string">&#x27;#team&#x27;</span> &#125;)<br></code></pre></td></tr></table></div></figure><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœæä¾›äº† <code>path</code>ï¼Œ<code>params</code> ä¼šè¢«å¿½ç•¥ï¼Œä¸Šè¿°ä¾‹å­ä¸­çš„ <code>query</code> å¹¶ä¸å±äºè¿™ç§æƒ…å†µã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä¸‹é¢ä¾‹å­çš„åšæ³•ï¼Œä½ éœ€è¦æä¾›è·¯ç”±çš„ <code>name</code> æˆ–æ‰‹å†™å®Œæ•´çš„å¸¦æœ‰å‚æ•°çš„ <code>path</code> ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-17efcdlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-17efcdlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> username = <span class="hljs-string">&#x27;eduardo&#x27;</span><br><span class="hljs-comment">/* æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å»ºç«‹ urlï¼Œä½†æˆ‘ä»¬å¿…é¡»è‡ªå·±å¤„ç†ç¼–ç  */</span><br>router.<span class="hljs-title function_">push</span>(<span class="hljs-string">`/user/<span class="hljs-subst">$&#123;username&#125;</span>`</span>) <br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">`/user/<span class="hljs-subst">$&#123;username&#125;</span>`</span> &#125;) <br><span class="hljs-comment">/* å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨ `name` å’Œ `params` ä»è‡ªåŠ¨ URL ç¼–ç ä¸­è·ç›Š */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">params</span>: &#123; username &#125; &#125;) <br><br><span class="hljs-comment">/* `params` ä¸èƒ½ä¸ `path` ä¸€èµ·ä½¿ç”¨ */</span><br>router.<span class="hljs-title function_">push</span>(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/user&#x27;</span>, <span class="hljs-attr">params</span>: &#123; username &#125; &#125;)<br></code></pre></td></tr></table></div></figure><p>å½“æŒ‡å®š <code>params</code> æ—¶ï¼Œå¯æä¾› <code>string</code> æˆ– <code>number</code> å‚æ•°ï¼ˆæˆ–è€…å¯¹äºå¯é‡å¤çš„å‚æ•°å¯æä¾›ä¸€ä¸ªæ•°ç»„ï¼‰ã€‚ä»»ä½•å…¶ä»–ç±»å‹ï¼ˆå¦‚ <code>undefined</code>ã€<code>false</code> ç­‰ï¼‰éƒ½å°†è¢«è‡ªåŠ¨å­—ç¬¦ä¸²åŒ–ã€‚å¯¹äºå¯é€‰å‚æ•°ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼ˆ<code>&quot;&quot;</code>ï¼‰æ¥è·³è¿‡å®ƒã€‚</p><p>ç”±äºå±æ€§ <code>to</code> ä¸ <code>router.push</code> æ¥å—çš„å¯¹è±¡ç§ç±»ç›¸åŒï¼Œæ‰€ä»¥ä¸¤è€…çš„è§„åˆ™å®Œå…¨ç›¸åŒã€‚</p><p><code>router.push</code> å’Œæ‰€æœ‰å…¶ä»–å¯¼èˆªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª <em>Promise</em>ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç­‰åˆ°å¯¼èˆªå®Œæˆåæ‰çŸ¥é“æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7d9zltlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7d9zltlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;&lt;/template&gt;<br>&lt;script setup lang=&quot;ts&quot;&gt;<br>    import &#123; onBeforeRouteLeave, onBeforeRouteUpdate &#125; from &#x27;vue-router&#x27;<br>    import &#123; ref &#125; from &#x27;vue&#x27;<br><br>    /* ä¸ beforeRouteLeave ç›¸åŒï¼Œæ— æ³•è®¿é—® `this` */<br>    onBeforeRouteLeave((to, from) =&gt; &#123;<br>        const answer = window.confirm(<br>            &#x27;Do you really want to leave? you have unsaved changes!&#x27;<br>        )<br>        /*  å–æ¶ˆå¯¼èˆªå¹¶åœç•™åœ¨åŒä¸€é¡µé¢ä¸Š  */ <br>        if (!answer) return false<br>    &#125;)<br><br>    const userData = ref()<br><br>    /*  ä¸ beforeRouteUpdate ç›¸åŒï¼Œæ— æ³•è®¿é—® `this`  */ <br>    onBeforeRouteUpdate(async (to, from) =&gt; &#123;<br>        /*  ä»…å½“ id æ›´æ”¹æ—¶æ‰è·å–ç”¨æˆ·ï¼Œä¾‹å¦‚ä»… query æˆ– hash å€¼å·²æ›´æ”¹  */<br>        if (to.params.id !== from.params.id) &#123;<br>            userData.value = await fetchUser(to.params.id)<br>        &#125;<br>    &#125;)<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p>divè®¾ç½®åœ†è§’è¾¹æ¡†ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3limqylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3limqylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">div</span> &#123;<br>  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* è®¾ç½®è¾¹æ¡†æ ·å¼ */</span><br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/* è®¾ç½®åœ†è§’åŠå¾„ */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>è®¾ç½®æ°´å¹³å‚ç›´å±…ä¸­ï¼š</p><ol><li>ä½¿ç”¨ Flexboxï¼š</li></ol><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kjizi5lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kjizi5lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/* æ°´å¹³å±…ä¸­ */</span><br>  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* å‚ç›´å±…ä¸­ */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œçˆ¶å®¹å™¨ <code>.container</code> éœ€è¦å…·æœ‰ä¸€å®šçš„é«˜åº¦å’Œå®½åº¦ï¼Œå¹¶ä¸”è®¾ç½®ä¸º <code>display: flex;</code>ã€‚é€šè¿‡è®¾ç½® <code>justify-content: center;</code> å’Œ <code>align-items: center;</code> å¯ä»¥å°†å­å…ƒç´ æ°´å¹³å’Œå‚ç›´å±…ä¸­ã€‚</p><ol start="2"><li>ä½¿ç”¨ç»å¯¹å®šä½å’Œ transformï¼šå°†<code>container</code>è®¾ç½®ä¸ºç›¸å¯¹å®šä½(<code>position: relative</code>)ï¼Œç„¶åå°† <code>centered-element</code> è®¾ç½®ä¸ºç»å¯¹å®šä½(<code>position: absolute</code>)ï¼Œå†è®¾ç½® <code>centered-element</code> çš„<code>top</code>å’Œ<code>left</code>å³å¯ç›¸å¯¹äº <code>container</code> çš„å®½åº¦è¿›è¡Œè®¡ç®—ã€‚</li></ol><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-iu8k7nlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-iu8k7nlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br>&#125;<br><br><span class="hljs-selector-class">.centered-element</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<br>  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œçˆ¶å®¹å™¨ <code>.container</code> éœ€è¦è®¾ç½®ä¸º <code>position: relative;</code>ï¼Œç„¶ååœ¨è¦å±…ä¸­çš„å­å…ƒç´ ä¸Šæ·»åŠ  <code>.centered-element</code> ç±»ã€‚é€šè¿‡è®¾ç½® <code>top: 50%;</code>ã€<code>left: 50%;</code> å’Œ <code>transform: translate(-50%, -50%);</code> å¯ä»¥å°†å­å…ƒç´ æ°´å¹³å’Œå‚ç›´å±…ä¸­ã€‚</p><hr><p><code>&lt;el-col&gt;</code> æ˜¯ Element UI åº“ä¸­çš„æ …æ ¼å¸ƒå±€ç»„ä»¶ï¼Œç”¨äºåˆ›å»ºå“åº”å¼çš„ç½‘æ ¼ç³»ç»Ÿã€‚é€šè¿‡ä½¿ç”¨ <code>:xs</code>ã€<code>:sm</code>ã€<code>:md</code>ã€<code>:lg</code> å’Œ <code>:xl</code> è¿™äº›å±æ€§ï¼Œå¯ä»¥å®šä¹‰åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹ <code>&lt;el-col&gt;</code> å…ƒç´ æ‰€å æ®çš„åˆ—æ•°ã€‚</p><p>å¯¹äºä½ æä¾›çš„ä»£ç  <code>&lt;el-col :xs=&quot;8&quot; :sm=&quot;6&quot; :md=&quot;4&quot; :lg=&quot;3&quot; :xl=&quot;1&quot;&gt;</code>ï¼Œè¿™è¡¨ç¤ºåœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹ï¼Œåˆ—å…ƒç´  <code>&lt;el-col&gt;</code> åˆ†åˆ«å æ®çš„åˆ—æ•°ã€‚å…·ä½“è®¾ç½®å¦‚ä¸‹ï¼š</p><ul><li><code>:xs=&quot;8&quot;</code>ï¼šåœ¨è¶…å°å±å¹•è®¾å¤‡ï¼ˆ&lt;768px å®½åº¦ï¼‰ä¸‹ï¼Œè¯¥åˆ—å…ƒç´ å æ® 8 åˆ—çš„å®½åº¦ã€‚</li><li><code>:sm=&quot;6&quot;</code>ï¼šåœ¨å°å±å¹•è®¾å¤‡ï¼ˆâ‰¥768px å®½åº¦ï¼‰ä¸‹ï¼Œè¯¥åˆ—å…ƒç´ å æ® 6 åˆ—çš„å®½åº¦ã€‚</li><li><code>:md=&quot;4&quot;</code>ï¼šåœ¨ä¸­ç­‰å±å¹•è®¾å¤‡ï¼ˆâ‰¥992px å®½åº¦ï¼‰ä¸‹ï¼Œè¯¥åˆ—å…ƒç´ å æ® 4 åˆ—çš„å®½åº¦ã€‚</li><li><code>:lg=&quot;3&quot;</code>ï¼šåœ¨å¤§å±å¹•è®¾å¤‡ï¼ˆâ‰¥1200px å®½åº¦ï¼‰ä¸‹ï¼Œè¯¥åˆ—å…ƒç´ å æ® 3 åˆ—çš„å®½åº¦ã€‚</li><li><code>:xl=&quot;1&quot;</code>ï¼šåœ¨è¶…å¤§å±å¹•è®¾å¤‡ï¼ˆâ‰¥1920px å®½åº¦ï¼‰ä¸‹ï¼Œè¯¥åˆ—å…ƒç´ å æ® 1 åˆ—çš„å®½åº¦ã€‚</li></ul><p>è¿™äº›å±æ€§å€¼ä»£è¡¨äº† <code>&lt;el-col&gt;</code> å…ƒç´ åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ‰€å æ®çš„ç›¸å¯¹å®½åº¦æ¯”ä¾‹ã€‚</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-74qp45lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-74qp45lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-row</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;16&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;8&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>çˆ¶ç»„ä»¶ä¸­å¼•ç”¨å­ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3yajq6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3yajq6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>import ChildComponent from &#x27;./ChildComponent.vue&#x27;; // å¯¼å…¥å­ç»„ä»¶<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;ChildComponent /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></div></figure><hr><p>è¦å®ç°ä¸Šä¸‹ä¸¤æ å›ºå®šï¼Œä¸­é—´æ è‡ªé€‚åº”çš„å¸ƒå±€ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wiphtclqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wiphtclqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.container</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">    <span class="hljs-attribute">flex-direction</span>: column;</span><br><span class="language-css">    <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>; <span class="hljs-comment">/* è®¾ç½®å®¹å™¨é«˜åº¦ä¸ºè§†çª—é«˜åº¦ */</span></span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.header</span>,</span><br><span class="language-css">  <span class="hljs-selector-class">.footer</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">flex</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">50px</span>; <span class="hljs-comment">/* å›ºå®šé«˜åº¦ä¸º 50px */</span></span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ccc</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><br><span class="language-css">  <span class="hljs-selector-class">.content</span> &#123;</span><br><span class="language-css">    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>; <span class="hljs-comment">/* å‰©ä½™ç©ºé—´è‡ªé€‚åº” */</span></span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f0f0</span>;</span><br><span class="language-css">  &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span>ä¸Šæ å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span>ä¸­æ å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;footer&quot;</span>&gt;</span>ä¸‹æ å†…å®¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p><code>.container</code> æ˜¯ä¸€ä¸ªå…·æœ‰ Flex å¸ƒå±€çš„å®¹å™¨ï¼Œå®ƒçš„ <code>flex-direction</code> å±æ€§è¢«è®¾ç½®ä¸º <code>column</code>ï¼Œä½¿å­å…ƒç´ æŒ‰å‚ç›´æ–¹å‘æ’åˆ—ã€‚</p><p><code>.header</code> å’Œ <code>.footer</code> ç±»åˆ†åˆ«è¡¨ç¤ºä¸Šæ å’Œä¸‹æ ï¼Œå®ƒä»¬éƒ½è®¾ç½®äº†å›ºå®šçš„é«˜åº¦ï¼ˆè¿™é‡Œä¸º 50pxï¼‰ï¼Œé€šè¿‡ <code>flex: 0 0 50px</code> æŒ‡å®šä¸å¯ä¼¸ç¼©ã€åˆå§‹å¤§å°ä¸º 50pxã€‚</p><p><code>.content</code> ç±»è¡¨ç¤ºä¸­æ ï¼Œå®ƒçš„ <code>flex</code> å±æ€§è¢«è®¾ç½®ä¸º <code>1</code>ï¼Œè¡¨ç¤ºå®ƒä¼šå æ®å‰©ä½™çš„æ‰€æœ‰ç©ºé—´ï¼Œä»è€Œå®ç°è‡ªé€‚åº”çš„æ•ˆæœã€‚</p><hr><p>è¦ä¿®æ”¹ <code>&lt;el-input&gt;</code> ç»„ä»¶çš„ placeholder å­—ä½“å¤§å°ï¼Œä½ å¯ä»¥ä½¿ç”¨ CSS æ¥è¦†ç›–é»˜è®¤æ ·å¼ã€‚ä¸‹é¢æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š</p><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">[@vue/compiler-sfc] :deep usage as a combinator has been deprecated. Use :deep(<inner-selector>) instead of :deep <inner-selector>.</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t36d4olqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t36d4olqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-input class=&quot;input&quot; placeholder=&quot;è¯·è¾“å…¥å†…å®¹&quot;&gt;&lt;/el-input&gt;<br>&lt;/template&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>.input&#123;<br>    :deep(.el-input__inner) &#123;<br>        font-size: 14px; /* è®¾ç½®å ä½ç¬¦å­—ä½“å¤§å° */<br>    &#125;<br>    :deep(.el-input__wrapper) &#123;<br>        border-radius: 14px !important; /* è®¾ç½®è¾“å…¥æ¡†åœ†è§’è¾¹æ¡† */<br>    &#125;<br>&#125; <br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><p>åµŒå¥—å±‚çº§å¤šçš„è¯ï¼Œ&#x2F;deep&#x2F;åé¢ä¸èƒ½ç›´æ¥å†™å½“å‰é€‰æ‹©å™¨åï¼Œåº”è¯¥å…ˆå†™çˆ¶å…ƒç´ æˆ–è€…ç¥–å…ˆå…ƒç´ ã€‚</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ohyfablqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ohyfablqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">/deep/<span class="hljs-selector-class">.el-date-editor</span> <span class="hljs-selector-class">.el-range-separator</span>&#123;<br>    <span class="hljs-attribute">color</span>: red;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>è¦åœ¨ <code>&lt;el-input&gt;</code> è¾“å…¥æ¡†å†…çš„å³ä¾§æ”¾ç½®ä¸€ä¸ªå›¾ç‰‡ï¼Œä½ å¯ä»¥ä½¿ç”¨è¾“å…¥æ¡†çš„é™„åŠ å†…å®¹ï¼ˆ<code>append</code>ï¼‰æ¥å®ç°ã€‚</p><p>suffixå’Œappendçš„åŒºåˆ«ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qu2favlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qu2favlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;input&quot;</span> @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">&quot;handleSubmit&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">suffix</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Search&quot;</span> @<span class="hljs-attr">click.native.prevent</span>=<span class="hljs-string">&quot;handleSubmit&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20231122155958877.png" alt="image-20231122155958877" style="zoom:50%;" /><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-45r5pllqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-45r5pllqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;input&quot;</span> @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">&quot;handleSubmit&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">append</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Search&quot;</span> @<span class="hljs-attr">click.native.prevent</span>=<span class="hljs-string">&quot;handleSubmit&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20231122160035019.png" alt="image-20231122160035019" style="zoom:50%;" /><p>Vue å…è®¸åœ¨ <code>v-on</code> æˆ– <code>@</code> ç›‘å¬æŒ‰é”®äº‹ä»¶æ—¶æ·»åŠ æŒ‰é”®ä¿®é¥°ç¬¦ï¼š<code>@keyup.enter=&quot;handleSubmit&quot;</code></p><hr><p>divé‡ŒåŒ…è£¹ä¸‰ä¸ªpè®¾ç½®divä¸ºflexå¸ƒå±€ï¼Œå‰ä¸¤ä¸ªpåœ¨ä¸€æ’ï¼Œç¬¬ä¸‰ä¸ªpåœ¨ç¬¬äºŒæ’ï¼šå¦‚æœä½ æƒ³åœ¨ <code>&lt;div&gt;</code> ä¸­åŒ…è£¹ä¸‰ä¸ª <code>&lt;p&gt;</code> å…ƒç´ ï¼Œå¹¶è®¾ç½®å‰ä¸¤ä¸ª <code>&lt;p&gt;</code> å…ƒç´ åœ¨ä¸€è¡Œæ˜¾ç¤ºï¼Œç¬¬ä¸‰ä¸ª <code>&lt;p&gt;</code> å…ƒç´ åœ¨ç¬¬äºŒè¡Œï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ CSS çš„ Flex å¸ƒå±€æ¥å®ç°ã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-knrtfklqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-knrtfklqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;container&quot;&gt;<br>    &lt;p&gt;ç¬¬ä¸€ä¸ªæ®µè½&lt;/p&gt;<br>    &lt;p&gt;ç¬¬äºŒä¸ªæ®µè½&lt;/p&gt;<br>    &lt;p&gt;ç¬¬ä¸‰ä¸ªæ®µè½&lt;/p&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style scoped&gt;<br>.container &#123;<br>  display: flex;<br>  flex-wrap: wrap;<br>&#125;<br><br>.container p &#123;<br>  width: 50%; /* æ¯ä¸ªæ®µè½å æ®å®¹å™¨çš„ä¸€åŠå®½åº¦ */<br>&#125;<br><br>.container p:nth-child(3) &#123;<br>  width: 100%; /* ç¬¬ä¸‰ä¸ªæ®µè½å æ®æ•´ä¸ªå®¹å™¨å®½åº¦ */<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><p>é€šè¿‡å°† <code>.container</code> ç±»çš„ <code>display</code> å±æ€§è®¾ç½®ä¸º <code>flex</code>ï¼Œå¹¶è®¾ç½® <code>flex-wrap</code> å±æ€§ä¸º <code>wrap</code>ï¼Œå¯ä»¥è®©å®¹å™¨å†…çš„å…ƒç´ è‡ªåŠ¨æ¢è¡Œã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ç»™æ¯ä¸ª <code>&lt;p&gt;</code> å…ƒç´ è®¾ç½®äº†å®½åº¦ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œå‰ä¸¤ä¸ª <code>&lt;p&gt;</code> å…ƒç´ çš„å®½åº¦è¢«è®¾ç½®ä¸ºå®¹å™¨å®½åº¦çš„ä¸€åŠï¼ˆ50%ï¼‰ï¼Œè€Œç¬¬ä¸‰ä¸ª <code>&lt;p&gt;</code> å…ƒç´ çš„å®½åº¦è¢«è®¾ç½®ä¸ºæ•´ä¸ªå®¹å™¨çš„å®½åº¦ï¼ˆ100%ï¼‰ã€‚</p><p>è¿™æ ·ï¼Œå‰ä¸¤ä¸ª <code>&lt;p&gt;</code> å…ƒç´ ä¼šåœ¨ä¸€è¡Œæ˜¾ç¤ºï¼Œè€Œç¬¬ä¸‰ä¸ª <code>&lt;p&gt;</code> å…ƒç´ ä¼šç‹¬å ä¸€è¡Œã€‚</p><hr><p>è®¾ç½®æ–‡æœ¬æŠ˜è¡Œï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1i8jzglqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1i8jzglqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div class=&quot;text-wrapper&quot;&gt;<br>    &#123;&#123; longText &#125;&#125;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;style&gt;<br>.text-wrapper &#123;<br>  word-wrap: break-word; /* å½“å•è¯è¿‡é•¿æ—¶è‡ªåŠ¨æ¢è¡Œ */<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><p>ä½¿ç”¨äº† <code>word-wrap: break-word</code> æ ·å¼æ¥å®ç°å•è¯è¿‡é•¿æ—¶è‡ªåŠ¨æ¢è¡Œã€‚</p><hr><p>åœ¨çˆ¶ç»„ä»¶å†…å®¹è¢«æ’‘å¤§å‡ºç°æ»šåŠ¨æ¡æ—¶ï¼Œå¦‚ä½•è®©å­ç»„ä»¶å§‹ç»ˆå›ºå®šåœ¨çˆ¶ç»„ä»¶çš„å³ä¸‹è§’ï¼šçˆ¶ç»„ä»¶divè®¾ç½®<code>position:relative;</code>ï¼Œå­ç»„ä»¶divè®¾ç½®<code>position:absolute;bottom:40px;right:0;</code>ã€‚</p><p><code>overflow-y: auto;</code> å’Œ <code>overflow-y: scroll;</code> éƒ½æ˜¯ CSS ä¸­çš„å±æ€§ï¼Œç”¨äºè®¾ç½®å…ƒç´ å†…å®¹æº¢å‡ºæ—¶çš„å¤„ç†æ–¹å¼ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºæ»šåŠ¨æ¡çš„è¡Œä¸ºå’Œå¯è§æ€§ã€‚</p><ol><li><p><code>overflow-y: auto;</code></p><ul><li>å½“å†…å®¹çš„é«˜åº¦è¶…è¿‡å…ƒç´ æœ¬èº«çš„é«˜åº¦æ—¶ï¼Œä¼šè‡ªåŠ¨å‡ºç°ä¸€ä¸ªå‚ç›´æ»šåŠ¨æ¡ä¾›ç”¨æˆ·æ»šåŠ¨æŸ¥çœ‹è¶…å‡ºéƒ¨åˆ†çš„å†…å®¹ã€‚</li><li>å¦‚æœå†…å®¹æ²¡æœ‰è¶…è¿‡å…ƒç´ çš„é«˜åº¦ï¼Œåˆ™ä¸ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ã€‚</li></ul></li><li><p><code>overflow-y: scroll;</code></p><ul><li>ä¸ç®¡å†…å®¹æ˜¯å¦è¶…è¿‡äº†å…ƒç´ çš„é«˜åº¦ï¼Œå§‹ç»ˆæ˜¾ç¤ºä¸€ä¸ªå‚ç›´æ»šåŠ¨æ¡ã€‚</li><li>å³ä½¿å†…å®¹é«˜åº¦å¹¶æœªæº¢å‡ºï¼Œæ»šåŠ¨æ¡ä¹Ÿæ˜¯å¯ç”¨çš„ï¼ˆè™½ç„¶å¯èƒ½ç¦ç”¨æˆ–æ— æ³•æ“ä½œï¼‰ã€‚</li></ul></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>overflow-y: auto;</code> åªåœ¨éœ€è¦æ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ï¼Œè€Œ <code>overflow-y: scroll;</code> åˆ™å§‹ç»ˆæ˜¾ç¤ºæ»šåŠ¨æ¡ã€‚ä½¿ç”¨ <code>auto</code> é€šå¸¸æ›´åˆ©äºç”¨æˆ·ä½“éªŒï¼Œå› ä¸ºå®ƒåªåœ¨å¿…è¦æ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ï¼›è€Œ <code>scroll</code> åˆ™æ›´é€‚åˆéœ€è¦æ˜ç¡®æŒ‡ç¤ºå¯æ»šåŠ¨åŒºåŸŸçš„åœºæ™¯ã€‚</p><hr><p>ç‚¹å‡»ä¸Šç®­å¤´æŒ‰é’®è¿”å›é¡µé¢é¡¶éƒ¨ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3z04xplqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3z04xplqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup lang=&quot;ts&quot;&gt;<br>    const scrollToTop=()=&gt;&#123;<br>        if(container.value)&#123;<br>            container.value.scrollTo(&#123;<br>                top: 0,<br>                behavior: &#x27;smooth&#x27;,<br>            &#125;)<br>    &#125;<br>    &#125;<br>&lt;/script&gt;<br><br>&lt;template&gt;<br>    &lt;div ref=&quot;container&quot;&gt;<br>        &lt;ChatTool/&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></div></figure><hr><p>å°†å…ƒç´  <code>a</code> çš„æ»šåŠ¨ä½ç½®è®¾ç½®ä¸ºå®ƒçš„å†…å®¹çš„é«˜åº¦ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ik6km9lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ik6km9lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">a.<span class="hljs-property">scrollTop</span>=a.<span class="hljs-property">scrollHeight</span><br></code></pre></td></tr></table></div></figure><hr><p>è¦è®¾ç½®ä¸åŒel-treeå±‚çº§çš„å›¾æ ‡ä¸åŒï¼Œä½ å¯ä»¥é€šè¿‡åˆ¤æ–­èŠ‚ç‚¹çš„å±‚çº§æ¥åŠ¨æ€åœ°ä¸ºæ¯ä¸ªå±‚çº§è®¾ç½®ä¸åŒçš„å›¾æ ‡ã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fgycwklqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fgycwklqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-tree :data=&quot;treeData&quot;&gt;<br>    &lt;template v-slot=&quot;&#123; node, data &#125;&quot;&gt;<br>      &lt;span class=&quot;tree-node-icon&quot;&gt;<br>        &lt;i :class=&quot;getIconClass(node.level)&quot;&gt;&lt;/i&gt;<br>      &lt;/span&gt;<br>      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;<br>    &lt;/template&gt;<br>  &lt;/el-tree&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>const treeData = ref([]);<br><br>const getIconClass = (level: number): string =&gt; &#123;<br>  if (level === 1) &#123;<br>    return &#x27;iconfont icon-level1&#x27;;<br>  &#125; else if (level === 2) &#123;<br>    return &#x27;iconfont icon-level2&#x27;;<br>  &#125; else &#123;<br>    return &#x27;iconfont icon-default&#x27;;<br>  &#125;<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>è¦åœ¨æ ‘å½¢ç»“æ„çš„å„ä¸ªå±‚çº§ä¹‹é—´æ·»åŠ é—´éš™ï¼Œä½ å¯ä»¥ä½¿ç”¨ CSS çš„ <code>margin</code> å±æ€§æ¥å®ç°ã€‚</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4z02m3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4z02m3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">:<span class="hljs-built_in">deep</span>(.el-tree)&#123;<br>    <span class="hljs-selector-class">.el-tree-node__children</span>&#123;<br>        <span class="hljs-selector-class">.el-tree-node__content</span>&#123;<br>            <span class="hljs-attribute">margin-top</span>:<span class="hljs-number">10px</span>;<br>        &#125;<br>        .<span class="hljs-selector-class">.el-tree-node__children</span>&#123;<br>            <span class="hljs-attribute">padding-left</span>:<span class="hljs-number">10px</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>è¦è®¾ç½®æ¯ä¸ª <code>el-table-column</code> çš„å®½åº¦å æ¯”ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>width</code> å±æ€§é…åˆç™¾åˆ†æ¯”æ¥å®ç°ã€‚</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-uzo0wzlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-uzo0wzlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-table :data=&quot;tableData&quot; style=&quot;width: 100%&quot;&gt;<br>    &lt;el-table-column<br>      prop=&quot;name&quot;<br>      label=&quot;å§“å&quot;<br>      min-width=&quot;20%&quot;<br>    &gt;&lt;/el-table-column&gt;<br>    &lt;el-table-column<br>      prop=&quot;age&quot;<br>      label=&quot;å¹´é¾„&quot;<br>      min-width=&quot;10%&quot;<br>    &gt;&lt;/el-table-column&gt;<br>    &lt;el-table-column<br>      prop=&quot;gender&quot;<br>      label=&quot;æ€§åˆ«&quot;<br>      min-width=&quot;15%&quot;<br>    &gt;&lt;/el-table-column&gt;<br>  &lt;/el-table&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></div></figure><p>è®¾ç½®el-tableæ»šåŠ¨ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p7j989lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p7j989lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">&quot;tableData&quot;</span> <span class="hljs-attr">max-height</span>=<span class="hljs-string">&quot;200&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>è®¾ç½®el-table-columnçš„å­—ä½“é¢œè‰²ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zfg82ulqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zfg82ulqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-table :data=&quot;tableData&quot;  :header-cell-style=&quot;&#123; color: &#x27;red&#x27; &#125;&quot; :cell-style=&quot;rowCellStyle&quot;&gt;<br>    &lt;el-table-column prop=&quot;name&quot; label=&quot;å§“å&quot;&gt;<br>    &lt;/el-table-column&gt;<br>    &lt;el-table-column prop=&quot;age&quot; label=&quot;å¹´é¾„&quot;&gt;<br>    &lt;/el-table-column&gt;<br>  &lt;/el-table&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>const tableData = ref([<br>  &#123; name: &#x27;å¼ ä¸‰&#x27;, age: 20 &#125;,<br>  &#123; name: &#x27;æå››&#x27;, age: 25 &#125;<br>]);<br><br>const rowCellStyle = (&#123; row, column &#125;: &#123; row: any, column: any &#125;) =&gt; &#123;<br>  if (column.property === &#x27;name&#x27;) &#123;<br>    return &#123; color: &#x27;green&#x27; &#125;;<br>  &#125;<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼</p><p>çˆ¶ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-lfa5yvlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-lfa5yvlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>        &lt;Metainfo :parentMessage=&quot;parentMessage&quot;&gt;&lt;/Metainfo&gt;<br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></div></figure><p>å­ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-15zfuqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-15zfuqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;&#123;&#123; message &#125;&#125;&lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br><br>const props = defineProps(&#123;<br>  parentMessage: &#123;<br>    type: String,<br>    required: true<br>  &#125;<br>&#125;);<br><br>const &#123;parentMessage&#125; = toRefs(props);<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼</p><p>å­ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ckewv3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ckewv3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;button @click=&quot;sendValueToParent&quot;&gt;ç‚¹å‡»å‘é€å€¼ç»™çˆ¶ç»„ä»¶&lt;/button&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>const $emit = defineEmits([&#x27;changeValue&#x27;,&#x27;value2&#x27;]);<br><br>const sendValueToParent = () =&gt; &#123;<br>  const value = &#x27;è¿™æ˜¯å­ç»„ä»¶ä¼ é€’ç»™çˆ¶ç»„ä»¶çš„å€¼&#x27;;<br>  $emits(&#x27;changeValue&#x27;, true);<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>çˆ¶ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6e80f4lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6e80f4lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;ChildComponent @changeValue=&quot;changeValue&quot; /&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>const receivedValue = ref(&#x27;&#x27;);<br>const changeValue = (value: string) =&gt; &#123;<br>  receivedValue.value = value;<br>&#125;;<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">ã€æš‚æ—¶æœªç”Ÿæ•ˆã€‘provide injectä¼ å€¼</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mt3k6vlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mt3k6vlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;!-- æ¨¡æ¿å†…å®¹ --&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; provide &#125; from &#x27;vue&#x27;;<br><br>const setup = () =&gt; &#123;<br>  const valueToProvide: string = &#x27;è¿™æ˜¯è¦ä¼ é€’çš„å€¼&#x27;;<br>  provide(&#x27;myValue&#x27;, valueToProvide);<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>æ¥æ”¶æ–¹ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vy7fz3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vy7fz3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;!-- æ¨¡æ¿å†…å®¹ --&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; inject &#125; from &#x27;vue&#x27;;<br><br>const receivedValue: string = inject(&#x27;myValue&#x27;);<br><br>console.log(receivedValue); // è¾“å‡ºï¼šè¿™æ˜¯è¦ä¼ é€’çš„å€¼<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p>é¼ æ ‡æ‚¬æµ®åˆ°el-tableçš„æŸè¡Œååœ¨è¯¥è¡Œçš„ç¬¬ä¸€åˆ—æ˜¾ç¤ºå‡ºåŠ å·ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-t1sikqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-t1sikqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-table :data=&quot;tableData&quot; @cell-mouse-enter=&quot;cellMouseEnter&quot; @cell-mouse-leave=&quot;cellMouseLeave&quot;&gt;<br>      &lt;!-- ç¬¬ä¸€åˆ—ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½è‡ªå®šä¹‰å†…å®¹ --&gt;<br>      &lt;el-table-column label=&quot;åŠ å·&quot;&gt;<br>        &lt;template #default=&quot;&#123; row &#125;&quot;&gt;<br>          &lt;span v-if=&quot;row.showAddIcon&quot;&gt;+&lt;/span&gt;<br>        &lt;/template&gt;<br>      &lt;/el-table-column&gt;<br>    &lt;/el-table&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; reactive &#125; from &#x27;vue&#x27;;<br><br>interface TableRow &#123;<br>  name: string;<br>  age: number;<br>  gender: string;<br>  showAddIcon?: boolean;<br>&#125;<br><br>const tableData: TableRow[] = reactive([<br>  &#123; name: &#x27;å¼ ä¸‰&#x27;, age: 20, gender: &#x27;ç”·&#x27;, showAddIcon: false &#125;,<br>  &#123; name: &#x27;æå››&#x27;, age: 25, gender: &#x27;å¥³&#x27;, showAddIcon: false &#125;,<br>  &#123; name: &#x27;ç‹äº”&#x27;, age: 30, gender: &#x27;ç”·&#x27;, showAddIcon: false &#125;<br>]);<br>    <br>const cellMouseEnter=(row:number)=&gt;&#123;<br>    row.showAddIcon=true<br>&#125;<br>const cellMouseLeave=(row:number)=&gt;&#123;<br>    row.showAddIcon=false<br>&#125;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p>è¦åœ¨ <code>el-table</code> çš„æœ€åä¸€è¡Œä¸­æ’å…¥ä¸€ä¸ª <code>el-select</code>ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-eqx6x1lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-eqx6x1lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-table :data=&quot;tableData&quot;&gt;<br>        &lt;el-table-column label=&quot;è¡¨å&quot;&gt;<br>            &lt;template #default=&quot;&#123; row &#125;&quot;&gt;<br>                &lt;template v-if=&quot;row.showAddIcon===true&quot;&gt;<br>                    &lt;el-select v-model=&quot;select&quot; placeholder=&quot;è¯·é€‰æ‹©&quot; @change=&quot;(val:any)=&gt;selectChange(val,row)&quot;&gt;<br>                        &lt;el-option v-for=&quot;i in options&quot; :key=&quot;i.value&quot; :label=&quot;i.label&quot; :value=&quot;i.value&quot;&gt;<br>                        &lt;/el-option&gt;<br>                    &lt;/el-select&gt;<br>                &lt;/template&gt;<br>                &lt;template v-else&gt;<br>                    &#123;&#123;row.name&#125;&#125;<br>                &lt;/template&gt;<br>            &lt;/template&gt;<br>        &lt;/el-table-column&gt;<br>        &lt;el-table-column label=&quot;æ“ä½œ&quot;&gt;<br>            &lt;template #default=&quot;scope&quot;&gt;<br>        &lt;svg-icon iconName=&quot;icon-a-shanchu1&quot; @click=&quot;handleDelete(scope.row,scope.$index)&quot;&gt;&lt;/svg-icon&gt;<br>            &lt;/template&gt;<br>        &lt;/el-table-column&gt;<br>&lt;/el-table&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></div></figure><p>æœ‰æ—¶éœ€è¦ç”¨åˆ°<code>v-for=&quot;(i,index) in options&quot;</code>è·å–å…ƒç´ ä¸‹æ ‡ã€‚</p><hr><p>è‡ªå®šä¹‰el-buttonç¦ç”¨æ—¶çš„clickäº‹ä»¶ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qpg700lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qpg700lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-button :disabled=&quot;isDisabled&quot; @click=&quot;handleClick&quot;&gt;Click me&lt;/el-button&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>const isDisabled = ref(true); <br><br>const handleClick = () =&gt; &#123;<br>  if (!isDisabled.value) &#123;<br>    console.log(&#x27;Button clicked!&#x27;);<br>  &#125;<br>&#125;;<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p><code>trim()</code> æ˜¯å­—ç¬¦ä¸²çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºåˆ é™¤å­—ç¬¦ä¸²çš„é¦–å°¾ç©ºæ ¼ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9kvq1alqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9kvq1alqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">&#x27;  Hello, World!  &#x27;</span>;<br><span class="hljs-keyword">const</span> trimmedStr = str.<span class="hljs-title function_">trim</span>();<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(trimmedStr); <span class="hljs-comment">// è¾“å‡º: &quot;Hello, World!&quot;</span><br></code></pre></td></tr></table></div></figure><hr><p>éšæœºç”Ÿæˆidï¼šå¯ä»¥ä½¿ç”¨ UUIDï¼ˆUniversally Unique Identifierï¼‰æˆ– GUIDï¼ˆGlobally Unique Identifierï¼‰ã€‚è¿™äº›æ˜¯ç”¨äºç”Ÿæˆå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦çš„ç®—æ³•ã€‚åœ¨  ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ <code>uuid</code> æ¥ç”Ÿæˆ UUIDã€‚</p><p>uuidçš„Githubä»“åº“åœ°å€ï¼š<a href="https://github.com/uuidjs/uuid">https://github.com/uuidjs/uuid</a></p><p>é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† <code>uuid</code> åº“ã€‚å¯ä»¥ä½¿ç”¨ npm åŒ…ç®¡ç†å™¨è¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qhlecmlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qhlecmlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install uuid --save-dev<br>npm i --save-dev @types/uuid<br></code></pre></td></tr></table></div></figure><p>é‡å¯é¡¹ç›®åç”Ÿæ•ˆï¼</p><p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç”Ÿæˆä¸€ä¸ªå®Œå…¨ä¸é‡å¤çš„éšæœº IDï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n1gyj6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n1gyj6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">v4</span>: uuidv4 &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;uuid&#x27;</span>);<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateUniqueId</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> uniqueId = <span class="hljs-title function_">uuidv4</span>();<br>  <span class="hljs-keyword">return</span> uniqueId;<br>&#125;<br><br><span class="hljs-keyword">const</span> id = <span class="hljs-title function_">generateUniqueId</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id);<br></code></pre></td></tr></table></div></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>uuid</code> åº“çš„ <code>v4</code> æ–¹æ³•è¢«å¼•å…¥å¹¶å‘½åä¸º <code>uuidv4</code>ã€‚<code>generateUniqueId</code> å‡½æ•°ä½¿ç”¨ <code>uuidv4</code> æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªå®Œå…¨ä¸é‡å¤çš„éšæœº IDã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>generateUniqueId</code> å‡½æ•°æ—¶ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDã€‚è¿™æ˜¯ç”± UUID ç®—æ³•çš„ç‰¹æ€§å†³å®šçš„ã€‚</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rb3ie7lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rb3ie7lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;useRouter&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-keyword">import</span> &#123;v4 <span class="hljs-keyword">as</span> uuidv4&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;uuid&#x27;</span><br><br><span class="hljs-keyword">const</span> $router=<span class="hljs-title function_">useRouter</span>()<br><span class="hljs-keyword">let</span> uuid=<span class="hljs-title function_">uuidv4</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span>=(<span class="hljs-params">value:string</span>)=&gt;&#123;<br>$router.<span class="hljs-title function_">push</span>(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;chat&#x27;</span>,<span class="hljs-attr">query</span>:&#123;uuid,<span class="hljs-attr">question</span>:value&#125;&#125;)<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å³åœ¨urlåæ·»åŠ chat?uuid&#x3D;111&amp;question&#x3D;ä½ æ˜¯è°?</p><p>è·å–routeä¸­çš„uuidï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vvxn2jlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vvxn2jlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> uuid=$route.<span class="hljs-property">query</span>.<span class="hljs-property">uuid</span> <span class="hljs-keyword">as</span> string<br></code></pre></td></tr></table></div></figure><hr><p>å½“ä½ åˆ·æ–°é¡µé¢æ—¶ï¼Œé¡µé¢çš„å€¼æ¶ˆå¤±çš„åŸå› å¯èƒ½æ˜¯å› ä¸ºæ•°æ®æ²¡æœ‰è¢«æ­£ç¡®åœ°ä¿å­˜æˆ–æ¢å¤ã€‚</p><p>åœ¨ Web å¼€å‘ä¸­ï¼Œæµè§ˆå™¨æä¾›äº† <code>localStorage</code> å’Œ <code>sessionStorage</code> è¿™ä¸¤ä¸ª API æ¥å­˜å‚¨æ•°æ®ã€‚è¿™äº› API å…è®¸ä½ åœ¨é¡µé¢ä¹‹é—´ä¿æŒæŒä¹…çš„æ•°æ®å­˜å‚¨æˆ–ä¼šè¯çº§åˆ«çš„æ•°æ®å­˜å‚¨ã€‚</p><p>å¦‚æœé¡µé¢çš„å€¼åœ¨åˆ·æ–°åæ¶ˆå¤±ï¼Œå¯èƒ½æ˜¯å› ä¸ºä½ æ²¡æœ‰æ­£ç¡®åœ°ä½¿ç”¨è¿™äº›å­˜å‚¨æœºåˆ¶ã€‚</p><ul><li><code>localStorage</code>ï¼š<code>localStorage</code> æ˜¯ä¸€ä¸ªæŒä¹…æ€§å­˜å‚¨ï¼Œæ•°æ®å°†åœ¨æµè§ˆå™¨å…³é—­åä»ç„¶ä¿ç•™ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>localStorage.setItem(key, value)</code> æ–¹æ³•å°†å€¼å­˜å‚¨åˆ° <code>localStorage</code> ä¸­ï¼Œå¹¶ä½¿ç”¨ <code>localStorage.getItem(key)</code> æ–¹æ³•æ£€ç´¢å€¼ã€‚</li><li><code>sessionStorage</code>ï¼š<code>sessionStorage</code> æ˜¯ä¸€ä¸ªä¼šè¯çº§åˆ«çš„å­˜å‚¨ï¼Œæ•°æ®å°†åœ¨ä¼šè¯ç»“æŸæ—¶è¢«æ¸…é™¤ï¼ˆå½“ç”¨æˆ·å…³é—­æ ‡ç­¾é¡µæˆ–æµè§ˆå™¨çª—å£æ—¶ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>sessionStorage.setItem(key, value)</code> æ–¹æ³•å°†å€¼å­˜å‚¨åˆ° <code>sessionStorage</code> ä¸­ï¼Œå¹¶ä½¿ç”¨ <code>sessionStorage.getItem(key)</code> æ–¹æ³•æ£€ç´¢å€¼ã€‚</li></ul><p>è¯·ç¡®ä¿åœ¨å­˜å‚¨å€¼æ—¶ä½¿ç”¨æ­£ç¡®çš„ APIï¼Œå¹¶åœ¨é¡µé¢åŠ è½½æ—¶ä»å­˜å‚¨ä¸­æ¢å¤å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨åŠ è½½é¡µé¢æ—¶ï¼Œä½ å¯ä»¥åœ¨  ä¸­ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥æ¢å¤ <code>localStorage</code> ä¸­çš„å€¼ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-l8ijnnlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-l8ijnnlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> storedValue = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;myVariable&#x27;</span>);<br><span class="hljs-keyword">if</span> (storedValue) &#123;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è¿™æ ·ï¼Œå³ä½¿åœ¨åˆ·æ–°é¡µé¢åï¼Œæ•°æ®ä»ç„¶å¯ä»¥ä» <code>localStorage</code> ä¸­è·å–å¹¶æ¢å¤ã€‚</p><p><code>JSON.stringify</code>ï¼šå°†JavaScriptå¯¹è±¡æˆ–å€¼è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ã€‚</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-vsz960lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-vsz960lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;sqlArray&#x27;</span>,<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newSqlArray))<br></code></pre></td></tr></table></div></figure><hr><h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>ä½¿ç”¨ <code>watch</code> å‡½æ•°åœ¨æ¯æ¬¡å“åº”å¼çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘å›è°ƒå‡½æ•°ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mkd40tlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mkd40tlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;<br>    &lt;button @click=&quot;increment&quot;&gt;Increment&lt;/button&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; ref, watch &#125; from &#x27;vue&#x27;;<br><br>const count = ref(0);<br><br>function increment() &#123;<br>  count.value++;<br>&#125;<br><br>watch(count, (newValue, oldValue) =&gt; &#123;<br>  console.log(&#x27;count å‘ç”Ÿå˜åŒ–&#x27;, newValue, oldValue);<br>&#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>&lt;script setup&gt;</code> è¯­æ³•æ¥å®šä¹‰ç»„ä»¶çš„é€»è¾‘éƒ¨åˆ†ã€‚åœ¨ <code>&lt;script setup&gt;</code> ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† <code>ref</code> å’Œ <code>watch</code> å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ <code>ref</code> åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>count</code> çš„å“åº”å¼å˜é‡ï¼Œå¹¶åˆå§‹åŒ–ä¸º 0ã€‚</p><p>æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>increment</code> çš„æ–¹æ³•æ¥å¢åŠ  <code>count</code> çš„å€¼ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»‘å®š <code>count</code> å˜é‡å’Œ <code>increment</code> æ–¹æ³•ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>watch</code> å‡½æ•°æ¥è§‚å¯Ÿ <code>count</code> çš„å˜åŒ–ï¼Œå¹¶åœ¨æ¯æ¬¡å˜åŒ–æ—¶è¾“å‡ºæ—¥å¿—ã€‚</p><p><code>watch</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸åŒå½¢å¼çš„â€œæ•°æ®æºâ€ï¼šå®ƒå¯ä»¥æ˜¯ä¸€ä¸ª ref (åŒ…æ‹¬è®¡ç®—å±æ€§)ã€ä¸€ä¸ªå“åº”å¼å¯¹è±¡ã€ä¸€ä¸ª getter å‡½æ•°ã€æˆ–å¤šä¸ªæ•°æ®æºç»„æˆçš„æ•°ç»„ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d1wew2lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d1wew2lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> x = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">const</span> y = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">/* å•ä¸ª ref */</span><br><span class="hljs-title function_">watch</span>(x, <span class="hljs-function">(<span class="hljs-params">newX</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`x is <span class="hljs-subst">$&#123;newX&#125;</span>`</span>)<br>&#125;)<br><br><span class="hljs-comment">/* getter å‡½æ•° */</span> <br><span class="hljs-title function_">watch</span>(<br>  <span class="hljs-function">() =&gt;</span> x.<span class="hljs-property">value</span> + y.<span class="hljs-property">value</span>,<br>  <span class="hljs-function">(<span class="hljs-params">sum</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`sum of x + y is: <span class="hljs-subst">$&#123;sum&#125;</span>`</span>)<br>  &#125;<br>)<br><br><span class="hljs-comment">/* å¤šä¸ªæ¥æºç»„æˆçš„æ•°ç»„ */</span> <br><span class="hljs-title function_">watch</span>([x, <span class="hljs-function">() =&gt;</span> y.<span class="hljs-property">value</span>], <span class="hljs-function">(<span class="hljs-params">[newX, newY]</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`x is <span class="hljs-subst">$&#123;newX&#125;</span> and y is <span class="hljs-subst">$&#123;newY&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„ï¼Œä½ ä¸èƒ½ç›´æ¥ä¾¦å¬å“åº”å¼å¯¹è±¡çš„å±æ€§å€¼ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3lutlclqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3lutlclqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;)<br><br><span class="hljs-comment">/* é”™è¯¯ï¼Œå› ä¸º watch() å¾—åˆ°çš„å‚æ•°æ˜¯ä¸€ä¸ª number */</span><br><span class="hljs-title function_">watch</span>(obj.<span class="hljs-property">count</span>, <span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`count is: <span class="hljs-subst">$&#123;count&#125;</span>`</span>)<br>&#125;)<br></code></pre></td></tr></table></div></figure><p>è¿™é‡Œéœ€è¦ç”¨ä¸€ä¸ªè¿”å›è¯¥å±æ€§çš„ getter å‡½æ•°ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-pkmkp0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-pkmkp0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* æä¾›ä¸€ä¸ª getter å‡½æ•° */</span><br><span class="hljs-title function_">watch</span>(<br>  <span class="hljs-function">() =&gt;</span> obj.<span class="hljs-property">count</span>,<br>  <span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`count is: <span class="hljs-subst">$&#123;count&#125;</span>`</span>)<br>  &#125;<br>)<br></code></pre></td></tr></table></div></figure><p>ç›´æ¥ç»™ <code>watch()</code> ä¼ å…¥ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ª<code>æ·±å±‚ä¾¦å¬å™¨</code>â€”â€”è¯¥å›è°ƒå‡½æ•°åœ¨æ‰€æœ‰åµŒå¥—çš„å˜æ›´æ—¶éƒ½ä¼šè¢«è§¦å‘ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8nfejblqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8nfejblqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">reactive</span>(&#123; <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> &#125;)<br><br><span class="hljs-title function_">watch</span>(obj, <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">/* </span><br><span class="hljs-comment">     åœ¨åµŒå¥—çš„å±æ€§å˜æ›´æ—¶è§¦å‘</span><br><span class="hljs-comment">     æ³¨æ„ï¼š`newValue` æ­¤å¤„å’Œ `oldValue` æ˜¯ç›¸ç­‰çš„</span><br><span class="hljs-comment">     å› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼</span><br><span class="hljs-comment">  */</span><br>&#125;)<br><br>obj.<span class="hljs-property">count</span>++<br></code></pre></td></tr></table></div></figure><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸€ä¸ªè¿”å›å“åº”å¼å¯¹è±¡çš„ getter å‡½æ•°ï¼Œåªæœ‰åœ¨è¿”å›ä¸åŒçš„å¯¹è±¡æ—¶ï¼Œæ‰ä¼šè§¦å‘å›è°ƒï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-eqcv0hlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-eqcv0hlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watch</span>(<br>  <span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">someObject</span>,<br>  <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-comment">/* ä»…å½“ state.someObject è¢«æ›¿æ¢æ—¶è§¦å‘ */</span><br>  &#125;<br>)<br></code></pre></td></tr></table></div></figure><p>ä½ ä¹Ÿå¯ä»¥ç»™ä¸Šé¢è¿™ä¸ªä¾‹å­æ˜¾å¼åœ°åŠ ä¸Š <code>deep</code> é€‰é¡¹ï¼Œå¼ºåˆ¶è½¬æˆæ·±å±‚ä¾¦å¬å™¨ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ti0n32lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ti0n32lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watch</span>(<br>  <span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">someObject</span>,<br>  <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">/* æ³¨æ„ï¼š`newValue` æ­¤å¤„å’Œ `oldValue` æ˜¯ç›¸ç­‰çš„ï¼Œé™¤é state.someObject è¢«æ•´ä¸ªæ›¿æ¢äº†*/</span><br>  &#125;,<br>  &#123; <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> &#125;<br>)<br></code></pre></td></tr></table></div></figure><p class="note note-warning">æ·±åº¦ä¾¦å¬éœ€è¦éå†è¢«ä¾¦å¬å¯¹è±¡ä¸­çš„æ‰€æœ‰åµŒå¥—çš„å±æ€§ï¼Œå½“ç”¨äºå¤§å‹æ•°æ®ç»“æ„æ—¶ï¼Œå¼€é”€å¾ˆå¤§ã€‚å› æ­¤è¯·åªåœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”è¦ç•™æ„æ€§èƒ½ã€‚</p><p><mark>å³æ—¶å›è°ƒçš„ä¾¦å¬å™¨</mark>ï¼š<code>watch</code> é»˜è®¤æ˜¯æ‡’æ‰§è¡Œçš„ï¼šä»…å½“æ•°æ®æºå˜åŒ–æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå›è°ƒã€‚ä½†åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨åˆ›å»ºä¾¦å¬å™¨æ—¶ï¼Œç«‹å³æ‰§è¡Œä¸€éå›è°ƒã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³è¯·æ±‚ä¸€äº›åˆå§‹æ•°æ®ï¼Œç„¶ååœ¨ç›¸å…³çŠ¶æ€æ›´æ”¹æ—¶é‡æ–°è¯·æ±‚æ•°æ®ã€‚</p><p>å¯ä»¥é€šè¿‡ä¼ å…¥ <code>immediate: true</code> é€‰é¡¹æ¥å¼ºåˆ¶ä¾¦å¬å™¨çš„å›è°ƒç«‹å³æ‰§è¡Œï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-p2ma6xlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-p2ma6xlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watch</span>(source, <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> &#123;<br>  <span class="hljs-comment">/* ç«‹å³æ‰§è¡Œï¼Œä¸”å½“ `source` æ”¹å˜æ—¶å†æ¬¡æ‰§è¡Œ */</span><br>&#125;, &#123; <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> &#125;)<br></code></pre></td></tr></table></div></figure><p>ä¾¦å¬å™¨çš„å›è°ƒä½¿ç”¨ä¸æºå®Œå…¨ç›¸åŒçš„å“åº”å¼çŠ¶æ€æ˜¯å¾ˆå¸¸è§çš„ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼Œåœ¨æ¯å½“ <code>todoId</code> çš„å¼•ç”¨å‘ç”Ÿå˜åŒ–æ—¶ä½¿ç”¨ä¾¦å¬å™¨æ¥åŠ è½½ä¸€ä¸ªè¿œç¨‹èµ„æºï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4efch1lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4efch1lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> todoId = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)<br><br><span class="hljs-title function_">watch</span>(todoId, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<br>    <span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">$&#123;todoId.value&#125;</span>`</span><br>  )<br>  data.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()<br>&#125;, &#123; <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> &#125;)<br></code></pre></td></tr></table></div></figure><p>ç‰¹åˆ«æ˜¯æ³¨æ„ä¾¦å¬å™¨æ˜¯å¦‚ä½•ä¸¤æ¬¡ä½¿ç”¨ <code>todoId</code> çš„ï¼Œä¸€æ¬¡æ˜¯ä½œä¸ºæºï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å›è°ƒä¸­ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨<code>watchEffect</code>å‡½æ•°æ¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ã€‚<code>watchEffect()</code> å…è®¸æˆ‘ä»¬è‡ªåŠ¨è·Ÿè¸ªå›è°ƒçš„å“åº”å¼ä¾èµ–ã€‚ä¸Šé¢çš„ä¾¦å¬å™¨å¯ä»¥é‡å†™ä¸ºï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7jvf4glqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7jvf4glqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watchEffect</span>(<span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<br>    <span class="hljs-string">`https://jsonplaceholder.typicode.com/todos/<span class="hljs-subst">$&#123;todoId.value&#125;</span>`</span><br>  )<br>  data.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()<br>&#125;)<br></code></pre></td></tr></table></div></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå›è°ƒä¼šç«‹å³æ‰§è¡Œï¼Œä¸éœ€è¦æŒ‡å®š <code>immediate: true</code>ã€‚åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå®ƒä¼šè‡ªåŠ¨è¿½è¸ª <code>todoId.value</code> ä½œä¸ºä¾èµ–ï¼ˆå’Œè®¡ç®—å±æ€§ç±»ä¼¼ï¼‰ã€‚æ¯å½“ <code>todoId.value</code> å˜åŒ–æ—¶ï¼Œå›è°ƒä¼šå†æ¬¡æ‰§è¡Œã€‚æœ‰äº† <code>watchEffect()</code>ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ˜ç¡®ä¼ é€’ <code>todoId</code> ä½œä¸ºæºå€¼ã€‚</p><p>å¯¹äºè¿™ç§åªæœ‰ä¸€ä¸ªä¾èµ–é¡¹çš„ä¾‹å­æ¥è¯´ï¼Œ<code>watchEffect()</code> çš„å¥½å¤„ç›¸å¯¹è¾ƒå°ã€‚ä½†æ˜¯å¯¹äºæœ‰å¤šä¸ªä¾èµ–é¡¹çš„ä¾¦å¬å™¨æ¥è¯´ï¼Œä½¿ç”¨ <code>watchEffect()</code> å¯ä»¥æ¶ˆé™¤æ‰‹åŠ¨ç»´æŠ¤ä¾èµ–åˆ—è¡¨çš„è´Ÿæ‹…ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ éœ€è¦ä¾¦å¬ä¸€ä¸ªåµŒå¥—æ•°æ®ç»“æ„ä¸­çš„å‡ ä¸ªå±æ€§ï¼Œ<code>watchEffect()</code> å¯èƒ½ä¼šæ¯”æ·±åº¦ä¾¦å¬å™¨æ›´æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå°†åªè·Ÿè¸ªå›è°ƒä¸­è¢«ä½¿ç”¨åˆ°çš„å±æ€§ï¼Œè€Œä¸æ˜¯é€’å½’åœ°è·Ÿè¸ªæ‰€æœ‰çš„å±æ€§ã€‚</p><p class="note note-info">watchEffectä»…ä¼šåœ¨å…¶åŒæ­¥æ‰§è¡ŒæœŸé—´ï¼Œæ‰è¿½è¸ªä¾èµ–ã€‚åœ¨ä½¿ç”¨å¼‚æ­¥å›è°ƒæ—¶ï¼Œåªæœ‰åœ¨ç¬¬ä¸€ä¸ªawaitæ­£å¸¸å·¥ä½œå‰è®¿é—®åˆ°çš„å±æ€§æ‰ä¼šè¢«è¿½è¸ªã€‚</p><p><code>watch</code> å’Œ <code>watchEffect</code> éƒ½èƒ½å“åº”å¼åœ°æ‰§è¡Œæœ‰å‰¯ä½œç”¨çš„å›è°ƒã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯è¿½è¸ªå“åº”å¼ä¾èµ–çš„æ–¹å¼ï¼š</p><ul><li><code>watch</code>åªè¿½è¸ªæ˜ç¡®ä¾¦å¬çš„æ•°æ®æºã€‚å®ƒä¸ä¼šè¿½è¸ªä»»ä½•åœ¨å›è°ƒä¸­è®¿é—®åˆ°çš„ä¸œè¥¿ã€‚å¦å¤–ï¼Œä»…åœ¨æ•°æ®æºç¡®å®æ”¹å˜æ—¶æ‰ä¼šè§¦å‘å›è°ƒã€‚<code>watch</code> ä¼šé¿å…åœ¨å‘ç”Ÿå‰¯ä½œç”¨æ—¶è¿½è¸ªä¾èµ–ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬èƒ½æ›´åŠ ç²¾ç¡®åœ°æ§åˆ¶å›è°ƒå‡½æ•°çš„è§¦å‘æ—¶æœºã€‚</li><li><code>watchEffect</code>ä¼šåœ¨å‰¯ä½œç”¨å‘ç”ŸæœŸé—´è¿½è¸ªä¾èµ–ã€‚å®ƒä¼šåœ¨åŒæ­¥æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨è¿½è¸ªæ‰€æœ‰èƒ½è®¿é—®åˆ°çš„å“åº”å¼å±æ€§ã€‚è¿™æ›´æ–¹ä¾¿ï¼Œè€Œä¸”ä»£ç å¾€å¾€æ›´ç®€æ´ï¼Œä½†æœ‰æ—¶å…¶å“åº”æ€§ä¾èµ–å…³ç³»ä¼šä¸é‚£ä¹ˆæ˜ç¡®ã€‚</li></ul><p>å½“ä½ æ›´æ”¹äº†å“åº”å¼çŠ¶æ€ï¼Œå®ƒå¯èƒ½ä¼šåŒæ—¶è§¦å‘ Vue ç»„ä»¶æ›´æ–°å’Œä¾¦å¬å™¨å›è°ƒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·åˆ›å»ºçš„ä¾¦å¬å™¨å›è°ƒï¼Œéƒ½ä¼šåœ¨ Vue ç»„ä»¶æ›´æ–°<strong>ä¹‹å‰</strong>è¢«è°ƒç”¨ã€‚è¿™æ„å‘³ç€ä½ åœ¨ä¾¦å¬å™¨å›è°ƒä¸­è®¿é—®çš„ DOM å°†æ˜¯è¢« Vue æ›´æ–°ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>å¦‚æœæƒ³åœ¨ä¾¦å¬å™¨å›è°ƒä¸­èƒ½è®¿é—®è¢« Vue æ›´æ–°<strong>ä¹‹å</strong>çš„ DOMï¼Œä½ éœ€è¦æŒ‡æ˜ <code>flush: &#39;post&#39;</code> é€‰é¡¹ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1gbypylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1gbypylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">watch</span>(source, callback, &#123;<br>  <span class="hljs-attr">flush</span>: <span class="hljs-string">&#x27;post&#x27;</span><br>&#125;)<br><br><span class="hljs-title function_">watchEffect</span>(callback, &#123;<br>  <span class="hljs-attr">flush</span>: <span class="hljs-string">&#x27;post&#x27;</span><br>&#125;)<br></code></pre></td></tr></table></div></figure><p>åç½®åˆ·æ–°çš„ <code>watchEffect()</code> æœ‰ä¸ªæ›´æ–¹ä¾¿çš„åˆ«å <code>watchPostEffect()</code>ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-q90k25lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-q90k25lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; watchPostEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><br><span class="hljs-title function_">watchPostEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-comment">/* åœ¨ Vue æ›´æ–°åæ‰§è¡Œ */</span><br>&#125;)<br></code></pre></td></tr></table></div></figure><p><mark>åœæ­¢ä¾¦å¬å™¨</mark>ï¼šåœ¨ <code>setup()</code> æˆ– <code>&lt;script setup&gt;</code> ä¸­ç”¨åŒæ­¥è¯­å¥åˆ›å»ºçš„ä¾¦å¬å™¨ï¼Œä¼šè‡ªåŠ¨ç»‘å®šåˆ°å®¿ä¸»ç»„ä»¶å®ä¾‹ä¸Šï¼Œå¹¶ä¸”ä¼šåœ¨å®¿ä¸»ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢ã€‚å› æ­¤ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ æ— éœ€å…³å¿ƒæ€ä¹ˆåœæ­¢ä¸€ä¸ªä¾¦å¬å™¨ã€‚</p><p>ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œä¾¦å¬å™¨å¿…é¡»ç”¨<strong>åŒæ­¥</strong>è¯­å¥åˆ›å»ºï¼šå¦‚æœç”¨å¼‚æ­¥å›è°ƒåˆ›å»ºä¸€ä¸ªä¾¦å¬å™¨ï¼Œé‚£ä¹ˆå®ƒä¸ä¼šç»‘å®šåˆ°å½“å‰ç»„ä»¶ä¸Šï¼Œä½ å¿…é¡»æ‰‹åŠ¨åœæ­¢å®ƒï¼Œä»¥é˜²å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-syvyinlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-syvyinlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script setup&gt;<br>import &#123; watchEffect &#125; from &#x27;vue&#x27;<br><br>&lt;!--å®ƒä¼šè‡ªåŠ¨åœæ­¢--&gt;<br>watchEffect(() =&gt; &#123;&#125;)<br><br>&lt;!--è¿™ä¸ªåˆ™ä¸ä¼š--&gt;<br>setTimeout(() =&gt; &#123;<br>  watchEffect(() =&gt; &#123;&#125;)<br>&#125;, 100)<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>è¦æ‰‹åŠ¨åœæ­¢ä¸€ä¸ªä¾¦å¬å™¨ï¼Œè¯·è°ƒç”¨ <code>watch</code> æˆ– <code>watchEffect</code> è¿”å›çš„å‡½æ•°ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wk2erblqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wk2erblqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> unwatch = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;)<br><br><span class="hljs-comment">/* ...å½“è¯¥ä¾¦å¬å™¨ä¸å†éœ€è¦æ—¶ */</span><br><span class="hljs-title function_">unwatch</span>()<br></code></pre></td></tr></table></div></figure><p>æ³¨æ„ï¼Œéœ€è¦å¼‚æ­¥åˆ›å»ºä¾¦å¬å™¨çš„æƒ…å†µå¾ˆå°‘ï¼Œè¯·å°½å¯èƒ½é€‰æ‹©åŒæ­¥åˆ›å»ºã€‚å¦‚æœéœ€è¦ç­‰å¾…ä¸€äº›å¼‚æ­¥æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¡ä»¶å¼çš„ä¾¦å¬é€»è¾‘ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fogxculqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fogxculqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/* éœ€è¦å¼‚æ­¥è¯·æ±‚å¾—åˆ°çš„æ•°æ® */</span><br><span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)<br><br><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">value</span>) &#123;<br>    <span class="hljs-comment">/* æ•°æ®åŠ è½½åæ‰§è¡ŒæŸäº›æ“ä½œ... */</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></div></figure><p><code>handler</code>å‡½æ•°ä¹Ÿå¸¸ç”¨äº<code>watch</code>å’Œ<code>computed</code>ç­‰åŠŸèƒ½ä¸­ï¼Œç”¨äºç›‘å¬æ•°æ®å˜åŒ–å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚<code>handler</code>å‡½æ•°é€šå¸¸æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>newValï¼šè¡¨ç¤ºæ•°æ®å‘ç”Ÿå˜åŒ–åçš„æ–°å€¼ã€‚</li><li>oldValï¼šè¡¨ç¤ºæ•°æ®å‘ç”Ÿå˜åŒ–å‰çš„æ—§å€¼ã€‚</li></ul><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-j6k1emlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-j6k1emlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">watch</span>: &#123;<br>  <span class="hljs-string">&#x27;obj.a&#x27;</span>: &#123;<br>    <span class="hljs-title function_">handler</span>(<span class="hljs-params">newName, oldName</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;obj.a changed&#x27;</span>);<br>    &#125;,<br>    <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-comment">/* deep: true */</span><br>  &#125;<br>&#125; <br></code></pre></td></tr></table></div></figure><hr><p>ä½¿ç”¨ <code>v-model</code> æŒ‡ä»¤æ¥å®ç° <code>el-dialog</code> çš„æ˜¾ç¤ºå’Œéšè—ã€‚è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®©ä½ åŒå‘ç»‘å®šä¸€ä¸ªå€¼ï¼Œå¹¶è‡ªåŠ¨æ›´æ–°è¯¥å€¼çš„çŠ¶æ€ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3pdik1lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3pdik1lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-button @click=&quot;showDialog = true&quot;&gt;æ‰“å¼€å¯¹è¯æ¡†&lt;/el-button&gt;<br><br>    &lt;el-dialog v-model=&quot;showDialog&quot; title=&quot;å¯¹è¯æ¡†æ ‡é¢˜&quot;&gt;<br>      &lt;!-- å¯¹è¯æ¡†å†…å®¹ --&gt;<br>    &lt;/el-dialog&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>export default &#123;<br>  setup() &#123;<br>    const showDialog = ref(false);<br><br>    return &#123;<br>      showDialog,<br>    &#125;;<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>showDialog</code> çš„å“åº”å¼å˜é‡ï¼Œå¹¶å°†å…¶åˆå§‹å€¼è®¾ä¸º <code>false</code> ï¼Œè¡¨ç¤ºå¯¹è¯æ¡†é»˜è®¤æ˜¯éšè—çš„ã€‚å½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å°† <code>showDialog</code> çš„å€¼è®¾ä¸º <code>true</code> ï¼Œå¯¹è¯æ¡†å°†æ˜¾ç¤ºå‡ºæ¥ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>v-model=&quot;showDialog&quot;</code>ï¼Œæˆ‘ä»¬å°† <code>showDialog</code> çš„å€¼ä¸ <code>el-dialog</code> ç»„ä»¶çš„ <code>visible</code> å±æ€§è¿›è¡Œäº†ç»‘å®šã€‚å½“ <code>showDialog</code> çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>el-dialog</code> ç»„ä»¶çš„æ˜¾ç¤ºçŠ¶æ€ä¹Ÿä¼šç›¸åº”åœ°å‘ç”Ÿå˜åŒ–ã€‚</p><hr><p>æ•°ç»„æ·±æ‹·è´ï¼š</p><ol><li>ä½¿ç”¨ <code>Array.from()</code> æ–¹æ³•è¿›è¡Œæµ…æ‹·è´ï¼Œå†ç»“åˆ <code>map()</code> æˆ–è€… <code>JSON.parse(JSON.stringify())</code> æ–¹æ³•è¿›è¡Œæ·±æ‹·è´ï¼š</li></ol><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zv5um4lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zv5um4lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  æµ…æ‹·è´  */</span> <br><span class="hljs-keyword">const</span> shallowCopy = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(originalArray);<br><br><span class="hljs-comment">/*  æ·±æ‹·è´æ–¹å¼ä¸€ï¼šä½¿ç”¨ map()  */</span> <br><span class="hljs-keyword">const</span> deepCopy1 = originalArray.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (&#123;...item&#125;));<br><br><span class="hljs-comment">/*  æ·±æ‹·è´æ–¹å¼äºŒï¼šä½¿ç”¨ JSON.parse(JSON.stringify())  */</span> <br><span class="hljs-keyword">const</span> deepCopy2 = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(originalArray));<br></code></pre></td></tr></table></div></figure><ol start="2"><li>ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ <code>...</code> è¿›è¡Œæ·±æ‹·è´ï¼š</li></ol><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mgnhbqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mgnhbqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> deepCopy = [...originalArray];<br></code></pre></td></tr></table></div></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿°æ–¹æ³•åœ¨æ·±æ‹·è´è¿‡ç¨‹ä¸­åªé€‚ç”¨äºçº¯æ•°æ®ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€å¯¹è±¡å’Œæ•°ç»„ï¼‰ã€‚å¦‚æœæ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¼•ç”¨ç±»å‹ï¼ˆå¦‚å¯¹è±¡ï¼‰ï¼Œåˆ™ä»…æ‹·è´äº†å¼•ç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å¦‚æœéœ€è¦å®Œå…¨å¤åˆ¶å¯¹è±¡åŠå…¶åµŒå¥—å±æ€§ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¦‚ <code>lodash.cloneDeep()</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Vue 3 ç»„ä»¶ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>lodash</code> è¿›è¡Œæ·±æ‹·è´ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gyzhiilqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gyzhiilqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> cloneDeep <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash/cloneDeep&#x27;</span>;<br><br><span class="hljs-keyword">const</span> deepCopy = <span class="hljs-title function_">cloneDeep</span>(originalArray);<br></code></pre></td></tr></table></div></figure><p>è¯·æ³¨æ„ï¼Œæ·±æ‹·è´æ•°ç»„å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºåŒ…å«å¤§é‡æ•°æ®çš„æ•°ç»„ã€‚åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨æ·±æ‹·è´ã€‚</p><hr><p>urlæ›¿æ¢æ‰€æœ‰çš„ç©ºæ ¼ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ctsxz8lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ctsxz8lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;handleDecode(item)&quot;</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;textDecoration:&#x27;none&#x27;&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></div></figure><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-awabpblqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-awabpblqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDecode</span>=(<span class="hljs-params">item:string</span>)=&gt;&#123;<br>    <span class="hljs-keyword">let</span> decodeUrl=<span class="hljs-string">&#x27;/api/&#x27;</span>+decodeURIComponenr(item)<br>    <span class="hljs-keyword">let</span> replaceUrl=decodeUrl.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/ /g</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-keyword">return</span> replaceUrl<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>åŒºåˆ†åŒä¸€ç»„ä»¶å‘ˆç°ä¸åŒé¡µé¢ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1was21lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1was21lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">:gutter</span>=<span class="hljs-string">&quot;50&quot;</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;$route.name==&#x27;navigation&#x27; ? &#x27;el-row-navigation&#x27; : &#x27;el-row-chat&#x27;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">&quot;$route.name==&#x27;navigation&#x27; ? &#x27;left left-navigation&#x27; : &#x27;left left-chat&#x27;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>å…¨å±€å¼•å…¥element plusï¼š</p><figure class="highlight shell"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g5ia8vlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g5ia8vlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm i element-plus --save<br></code></pre></td></tr></table></div></figure><p>å®Œæ•´å¼•å…¥elementplusï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f56cwylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f56cwylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/*  main.ts  */</span> <br><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-plus/dist/index.css&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></div></figure><p>å¦‚æœæ‚¨ä½¿ç”¨ Volarï¼Œåœ¨ <code>tsconfig.json</code> ä¸­é€šè¿‡ <code>compilerOptions.type</code> æŒ‡å®šå…¨å±€ç»„ä»¶ç±»å‹ã€‚</p><figure class="highlight json"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-rq5xm8lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-rq5xm8lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">/*  tsconfig.json  */</span> <br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;compilerOptions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;types&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;element-plus/global&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></div></figure><hr><p>ä½¿ç”¨element pluså†…ç½®å›¾æ ‡ï¼š<a href="https://element-plus.org/zh-CN/component/icon.html#icon-collection">https://element-plus.org/zh-CN/component/icon.html#icon-collection</a></p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qb0cvzlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qb0cvzlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @element-plus/icons --save-dev<br></code></pre></td></tr></table></div></figure><p>main.tsï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4b6qptlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4b6qptlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">ElementPlusIconsVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@element-plus/icons-vue&#x27;</span><br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, component] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-title class_">ElementPlusIconsVue</span>)) &#123;<br>    app.<span class="hljs-title function_">component</span>(key, component)<br>&#125;<br></code></pre></td></tr></table></div></figure><p>ç›´æ¥ä½¿ç”¨iconå±æ€§ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-s02n08lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-s02n08lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">&quot;Search&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>element plusçš„åˆ†é¡µ  &#x2F;pageå’ŒGo toæ”¹ä¸ºä¸­æ–‡ï¼š</p><p>main.tsï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b43vytlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b43vytlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span><br><span class="hljs-keyword">import</span> zhCn <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;elementplus/dist/locale/zh-cn.mjs&#x27;</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>,&#123;<br>    <span class="hljs-attr">locale</span>: zhCn,<br>&#125;)<br></code></pre></td></tr></table></div></figure><p>srcæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»º<code>element-plus.d.ts</code>ï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-dvvyallqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-dvvyallqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;element-plus/dist/locale/zh-cn.mjs&#x27;</span>&#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-attr">zhCn</span>: <span class="hljs-built_in">any</span><br>    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> znCn<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>el-tableæ»šåŠ¨æ¡åˆ°æœ€åº•éƒ¨ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4n5m1olqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4n5m1olqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-table</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;tableRef&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-table</span>&gt;</span><br></code></pre></td></tr></table></div></figure><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8at02elqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8at02elqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span>=(<span class="hljs-params"></span>)=&gt;&#123;<br>    <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">()=&gt;</span>tableRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>,tableRef.<span class="hljs-property">value</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">bodyWrapper</span>.<span class="hljs-property">scrollHeight</span>)<br>&#125;)<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>è®¾ç½®el-buttonç‚¹å‡»å¤šæ¬¡åªè§¦å‘ä¸€æ¬¡æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3d06orlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3d06orlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;el-button @click=&quot;handleClick&quot; :disabled=&quot;isButtonDisabled&quot;&gt;æŒ‰é’®&lt;/el-button&gt;<br>&lt;/template&gt;<br><br>&lt;script setup&gt;<br>import &#123; ref &#125; from &#x27;vue&#x27;;<br><br>const isButtonDisabled = ref(false);<br><br>const handleClick = () =&gt; &#123;<br>  if (!isButtonDisabled.value) &#123;<br>    isButtonDisabled.value = true;<br>    setTimeout(() =&gt; &#123;<br>      isButtonDisabled.value = false;<br>    &#125;, 1000); <br>  &#125;<br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></div></figure><hr><p>el-tooltipçš„å†…å®¹å¯æ»šåŠ¨ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-if6diqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-if6diqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tooltip</span> <span class="hljs-attr">:enterable</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">:popper-style</span>=<span class="hljs-string">&quot;&#123;width: px2rem(&#x27;400&#x27;)&#125;&quot;</span> <span class="hljs-attr">:popper-options</span>=<span class="hljs-string">&quot;&#123;modifies:&#123;preventOverflow:&#123;boundariesElement:&#x27;window&#x27;&#125;&#125;&#125;&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span><br>        &#123;&#123;item&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">content</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;maxHeight:px2rem(&#x27;350&#x27;),overflowY: &#x27;scroll&#x27;,lineHeight:px2rem(&#x27;25&#x27;)&#125;&quot;</span>&gt;</span><br>            &#123;&#123;item&#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-tooltip</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>ä½¿ç”¨iconfontå›¾æ ‡ï¼š</p><ol><li><p><a href="https://www.iconfont.cn/%EF%BC%9A%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6">https://www.iconfont.cn/ï¼šåˆ›å»ºé¡¹ç›®ï¼ŒåŠ å…¥è´­ç‰©è½¦</a></p></li><li><p>ä½¿ç”¨font classæ–¹å¼ä¸‹è½½æ–‡ä»¶å¤¹åˆ°æœ¬åœ°ï¼š</p><img src="image-20231122173730836.png" alt="image-20231122173730836" style="zoom:50%;" /></li><li><p>æ”¾åœ¨assetsæ–‡ä»¶å¤¹ä¸‹ï¼š</p><img src="image-20231122173926927.png" alt="image-20231122173926927" style="zoom:40%;" /></li><li><p>åœ¨main.tsä¸­å¼•å…¥ï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4dp6f6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4dp6f6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@/assets/iconfont/iconfont.css&#x27;</span><br></code></pre></td></tr></table></div></figure></li></ol><hr><p>ä½¿ç”¨svgæœ‰è‰²å›¾æ ‡ï¼š</p><ol><li><p>åœ¨ components ç›®å½•ä¸‹æ–°å»º SvgIcon.vue æ–‡ä»¶</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-abahhrlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-abahhrlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!-- src/components/SvgIcon.vue --&gt;<br>&lt;template&gt;<br>  &lt;svg :class=&quot;svgClass&quot; aria-hidden=&quot;true&quot;&gt;<br>    &lt;use :xlink:href=&quot;iconClassName&quot; :fill=&quot;color&quot; /&gt;<br>  &lt;/svg&gt;<br>&lt;/template&gt;<br>&lt;script setup lang=&quot;ts&quot;&gt;<br>import &#123; computed &#125; from &#x27;vue&#x27;;<br>const props = defineProps(&#123;<br>  iconName: &#123;<br>    type: String,<br>    required: true<br>  &#125;,<br>  className: &#123;<br>    type: String,<br>    default: &#x27;&#x27;<br>  &#125;,<br>  color: &#123;<br>    type: String,<br>    default: &#x27;#409eff&#x27;<br>  &#125;<br>&#125;);<br><br>const iconClassName = computed(()=&gt;&#123;<br>  return `#$&#123;props.iconName&#125;`;<br>&#125;)<br><br>const svgClass = computed(() =&gt; &#123;<br>  if (props.className) &#123;<br>    return `svg-icon $&#123;props.className&#125;`;<br>  &#125;<br>  return &#x27;svg-icon&#x27;;<br>&#125;);<br>&lt;/script&gt;<br>&lt;style scoped&gt;<br>.svg-icon &#123;<br>  width: 1em;<br>  height: 1em;<br>  position: relative;<br>  fill: currentColor;<br>  vertical-align: -2px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure></li><li><p>åœ¨ main.ts ä¸­å…¨å±€æ³¨å†Œï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5jdex0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5jdex0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">SvgIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./components/SvgIcon.vue&#x27;</span><br><br>app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">component</span>(<span class="hljs-string">&#x27;SvgIcon&#x27;</span>, <span class="hljs-title class_">SvgIcon</span>);<br>app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></div></figure></li><li><p>å¼•å…¥iconfontå›¾æ ‡ï¼šåœ¨é¡¹ç›® assets ç›®å½•ä¸‹æ–°å»ºsvg.jsæ–‡ä»¶ï¼Œç„¶åå°† iconfont åœ¨çº¿åœ°å€ä¸­æä¾›çš„ä»£ç å…¨éƒ¨å¤åˆ¶è¿‡æ¥ã€‚ã€åŠ è½½è¾ƒæ…¢ã€‘</p><img src="image-20231127093308886.png" alt="image-20231127093308886" style="zoom:50%;" /></li><li><p>å…·ä½“ä½¿ç”¨ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wlacc2lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wlacc2lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">svg-icon</span> <span class="hljs-attr">iconName</span>=<span class="hljs-string">&quot;icon-gongzuoleixing&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">svg-icon</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li></ol><p>ä¿®æ”¹svgå›¾æ ‡é¢œè‰²ï¼Œä¿å­˜ä¸ºå‰¯æœ¬ï¼š</p><img src="image-20231023162606697.png" alt="image-20231023162606697" style="zoom:50%;" /><hr><p>å»é™¤é¦–å°¾ç©ºè¡Œï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yg5ymjlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yg5ymjlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model.trim</span>=<span class="hljs-string">&quot;inputText&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr><p>cssæ ·å¼è¦†ç›–ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f1abpjlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f1abpjlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.tocbot-list</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.95rem</span>;<br>&#125;<br><br><span class="hljs-comment">/* è¦†ç›–å‰ä¸€ä¸ªæ ·å¼ */</span><br><span class="hljs-selector-class">.tocbot-list</span> <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.75rem</span> <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><h2 id="å›¾ç‰‡å±…ä¸­"><a href="#å›¾ç‰‡å±…ä¸­" class="headerlink" title="å›¾ç‰‡å±…ä¸­"></a>å›¾ç‰‡å±…ä¸­</h2><p>è®¾ç½®<code>&lt;img src=&quot;&quot; class=&quot;align&quot;&gt;</code>çš„å±…ä¸­æ–¹å¼ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-h5wt73lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-h5wt73lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs css">//æ°´å¹³é å·¦<br><span class="hljs-selector-class">.align</span> &#123;<br>    <span class="hljs-attribute">display</span>: inline;<br>    <span class="hljs-attribute">float</span>: left;<br>&#125;<br> <br>//æ°´å¹³é å³<br><span class="hljs-selector-class">.align</span> &#123;<br>    <span class="hljs-attribute">display</span>: inline;<br>    <span class="hljs-attribute">float</span>: right;<br>&#125;<br> <br>//æ°´å¹³å±…ä¸­<br><span class="hljs-selector-class">.align</span> &#123;<br>    <span class="hljs-attribute">clear</span>: both;<br>    <span class="hljs-attribute">display</span>: block;<br>    <span class="hljs-attribute">margin</span>: auto;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>divé‡Œçš„imgæ ‡ç­¾å®ç°æ°´å¹³å‚ç›´å±…ä¸­<code>&lt;div&gt;&lt;img src=&quot;&quot;&gt;&lt;/div&gt;</code>ï¼š</p><ol><li>å°†displayè®¾ç½®æˆtable-cellï¼Œæ°´å¹³å±…ä¸­è®¾ç½®text-alignä¸ºcenterï¼Œå‚ç›´å±…ä¸­è®¾ç½®vertical-alignä¸ºmiddleï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-sq3yk6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-sq3yk6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 150px;<br>        height: 100px;<br>        display: table-cell;<br>        vertical-align: middle;<br>        text-align: center;<br>        border: 1px solid #000;<br>    &#125;<br>    img &#123;<br>        width: 50px;<br>        height: 50px;<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="2"><li>é€šè¿‡positionå®šä½å®ç°ã€‚å°†divè®¾ç½®æˆç›¸å¯¹å®šä½relativeï¼Œå°†imgè®¾ç½®æˆç»å¯¹å®šä½absoluteï¼Œleft:50%ï¼Œtop:50%,æ­¤æ—¶å›¾ç‰‡çš„å·¦ä¸Šè§’ä½äºdivçš„ä¸­å¿ƒï¼Œè¦æ˜¯å›¾ç‰‡çš„ä¸­å¿ƒä½äºdivçš„ä¸­å¿ƒï¼Œå°±éœ€è¦å°†å›¾ç‰‡å‘ä¸Šç§»åŠ¨å›¾ç‰‡é«˜åº¦çš„ä¸€åŠï¼Œå¹¶å‘å·¦ç§»åŠ¨å›¾ç‰‡å®½åº¦çš„ä¸€åŠï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-wyqn5wlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-wyqn5wlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 150px;<br>        height: 100px;<br>        position: relative;<br>        border: 1px solid #000;<br>    &#125;<br>    img &#123;<br>        width: 50px;<br>        height: 50px;<br>        position: absolute;<br>        top: 50%;<br>        left: 50%;<br>        margin-top: -25px; // é«˜åº¦çš„ä¸€åŠ<br>        margin-left: -25px; // å®½åº¦çš„ä¸€åŠ<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="3"><li>ç”¨äºä¸æ¸…æ¥šå›¾ç‰‡æˆ–å…ƒç´ çš„çœŸå®å®½é«˜æƒ…å†µï¼šé€šè¿‡positionå®šä½æ¥å®ç°ã€‚å°†divè®¾ç½®æˆç›¸å¯¹å®šä½relativeï¼Œå°†imgè®¾ç½®æˆç»å¯¹å®šä½absoluteï¼Œleft:50%ï¼Œtop:50%ï¼Œæ­¤æ—¶å›¾ç‰‡çš„å·¦ä¸Šè§’ä½äºdivçš„ä¸­å¿ƒï¼Œè¦æ˜¯å›¾ç‰‡çš„ä¸­å¿ƒä½äºdivçš„ä¸­å¿ƒï¼Œå°±éœ€è¦å°†å›¾ç‰‡å‘ä¸Šç§»åŠ¨å›¾ç‰‡é«˜åº¦çš„ä¸€åŠï¼Œå¹¶å‘å·¦ç§»åŠ¨å›¾ç‰‡å®½åº¦çš„ä¸€åŠï¼Œå¦‚æœä¸çŸ¥é“å…ƒç´ çš„å®½é«˜ï¼Œå¯ä»¥ç”¨transform: translate(-50%,-50%)ï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-g22311lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-g22311lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 150px;<br>        height: 100px;<br>        position: relative;<br>        border: 1px solid #000;<br>    &#125;<br>    img &#123;<br>        width: 50px;<br>        height: 50px;<br>        position: absolute;<br>        top: 50%;<br>        left: 50%;<br>        transform: translate(-50%,-50%);<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="4"><li>å¼¹æ€§å¸ƒå±€flexï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5o321ylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5o321ylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 150px;<br>        height: 100px;<br>        border: 1px solid #000;<br>        display: flex;<br>        justify-content: center;<br>        align-items: center;<br>        margin: 0 auto;<br>    &#125;<br>    img &#123;<br>        width: 50px;<br>        height: 50px;<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="5"><li>è®¾ç½®çˆ¶divä¸ºtable-cellå±æ€§ï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-4snggplqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-4snggplqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 200px;<br>        height: 200px;<br>        border: 1px solid #000;<br>        display: table-cell;<br>        text-align: center;<br>        vertical-align: middle;<br>    &#125;<br>    img &#123;<br>        width: 100px;<br>        height: 100px;<br>        display: inline-block;<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="6"><li>æ— å›ºå®šå®½é«˜ï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-db1swolqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-db1swolqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 200px;<br>        height: 200px;<br>        margin: 0 auto;<br>        text-align: center;<br>        position: relative;<br>        border: 1px solid #000;<br>    &#125;<br>    img &#123;<br>        width: 100px;<br>        height: 100px;<br>        position: absolute;<br>        border: 1px solid #000;<br>        left: 50%;<br>        top: 50%;<br>        -webkit-transform: translate(-50%,-50%);<br>        -moz-transform:translate(-50%,-50%);<br>        -ms-transform: translate(-50%,-50%);<br>        -o-transform: translate(-50%,-50%);<br>        transform: translate(-50%,-50%);<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><ol start="7"><li>å›ºå®šå®½é«˜ï¼š</li></ol><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w6g597lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w6g597lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;style type=&quot;text/css&quot;&gt;<br>    *&#123;<br>        margin: 0;<br>        padding: 0;<br>    &#125;<br>    div&#123;<br>        width: 200px;<br>        height: 200px;<br>        border: 1px solid #000;<br>        margin: 0 auto;<br>        text-align: center;<br>        position: relative;<br>    &#125;<br>    img &#123;<br>        width: 100px;<br>        height: 100px;<br>        position: absolute;<br>        border: 1px solid #000;<br>        left: 50%;<br>        top: 50%;<br>        margin-top: -50px;<br>        margin-left: -50px;<br>    &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><hr><p>ç‚¹å‡»æŒ‰é’®å¤åˆ¶æ–‡å­—ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-tiyjn4lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-tiyjn4lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> text = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;textarea&#x27;</span>);<br>text.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">textToCopy</span>;<br><span class="hljs-comment">/*  æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒå‰ªè´´æ¿ API å¹¶ä¸”é¡µé¢å¤„äºå®‰å…¨ä¸Šä¸‹æ–‡ä¸­  */</span><br> <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">clipboard</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">isSecureContext</span>) &#123;<br> <span class="hljs-title class_">ElMessage</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;å¤åˆ¶æˆåŠŸ&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;success&#x27;</span>,<br>    &#125;)<br>     <span class="hljs-keyword">return</span> navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">writeText</span>(text.<span class="hljs-property">value</span>);<br> &#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">/* å°†textareaæ·»åŠ åˆ°æ–‡æ¡£ä¸­ */</span><br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(textarea);<br>    <span class="hljs-comment">/* é€‰ä¸­textareaä¸­çš„æ–‡æœ¬ */</span> <br>    textarea.<span class="hljs-title function_">select</span>();<br>    <span class="hljs-title class_">ElMessage</span>(&#123;<br>        <span class="hljs-attr">message</span>: <span class="hljs-string">&#x27;å¤åˆ¶æˆåŠŸ&#x27;</span>,<br>        <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;success&#x27;</span>,<br>    &#125;)<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(res,rej)=&gt;&#123;<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">&#x27;copy&#x27;</span>) ? <span class="hljs-title function_">res</span>(<span class="hljs-string">&#x27;å¤åˆ¶æˆåŠŸ&#x27;</span>) : <span class="hljs-title function_">rej</span>(<span class="hljs-string">&#x27;å¤åˆ¶å¤±è´¥&#x27;</span>)<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(text)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>æˆ–</p><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-9tw76olqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-9tw76olqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">copyToClip</span>(<span class="hljs-params">text: string</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">input</span>: <span class="hljs-title class_">HTMLTextAreaElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;textarea&#x27;</span>)<br>      input.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&#x27;readonly&#x27;</span>, <span class="hljs-string">&#x27;readonly&#x27;</span>)<br>      input.<span class="hljs-property">value</span> = text<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(input)<br>      input.<span class="hljs-title function_">select</span>()<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">&#x27;copy&#x27;</span>))<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">&#x27;copy&#x27;</span>)<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(input)<br>      <span class="hljs-title function_">resolve</span>(text)<br>    &#125;<br>    <span class="hljs-keyword">catch</span> (error) &#123;<br>      <span class="hljs-title function_">reject</span>(error)<br>    &#125;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></div></figure><figure class="highlight jsx"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-mrwe42lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-mrwe42lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleCopy</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">copyToClip</span>(props.<span class="hljs-property">text</span> || <span class="hljs-string">&#x27;&#x27;</span>)<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&#x27;å¤åˆ¶æˆåŠŸ&#x27;</span>)<br>  &#125;<br>  <span class="hljs-keyword">catch</span> &#123;<br>    message.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;å¤åˆ¶å¤±è´¥&#x27;</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>è°ƒç”¨æ¥å£ï¼Œç»“æœè¿”å›æ•°æ®æ˜¯ä»ç¼“å­˜ä¸­æ‹¿åˆ°çš„è€Œéå®é™…æ¥å£ä¸­â€”â€”from disk cacheï¼šåœ¨utilsæ–‡ä»¶å¤¹ä¸‹çš„request.tsæ–‡ä»¶ä¸­åŠ å…¥ï¼š</p><figure class="highlight typescript"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ypehaulqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ypehaulqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> instance=axios.<span class="hljs-title function_">create</span>(&#123;<br>    <span class="hljs-attr">headers</span>: &#123;<br>        <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></div></figure><hr><p>è·å–Promiseå¯¹è±¡ä¸­çš„PromiseResultä¸­çš„æ•°æ®ï¼šPromise ç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚</p><img src="image-20231018144700439.png" alt="image-20231018144700439" style="zoom:50%;" /><ol><li>å¼‚æ­¥è·å–Promiseå¯¹è±¡çš„å€¼è¿˜å¯ä»¥ä½¿ç”¨Promiseå¯¹è±¡çš„thenæ–¹æ³•ï¼Œä½†æ˜¯thenæ–¹æ³•æ˜¯åœ¨æ¥å£è¯·æ±‚å¯¹è±¡çš„é‡Œé¢æ‰§è¡Œæ•°æ®å¤„ç†çš„æ“ä½œã€‚</li></ol><figure class="highlight javascript"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6h88etlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6h88etlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">getqueryAIRecommend</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>&#125;)<br></code></pre></td></tr></table></div></figure><ol start="2"><li>é€šè¿‡ async await æ¥è·å–ï¼šasync ç”¨äºç”³æ˜ä¸€ä¸ªfunctionæ˜¯å¼‚æ­¥çš„ï¼›è€Œawaitåˆ™å¯ä»¥è®¤ä¸ºæ˜¯ async awaitçš„ç®€å†™å½¢å¼ï¼Œæ˜¯ç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆçš„ã€‚</li></ol><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-a8sz7dlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-a8sz7dlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">getShelfList</span>(<span class="hljs-params">id</span>) &#123;<br>  letlist = [];<br>  list = <span class="hljs-keyword">await</span> <span class="hljs-title function_">infoStore</span>(id)<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(list);<br>&#125;<br></code></pre></td></tr></table></div></figure><p>async&#x2F;awiatçš„ä½¿ç”¨è§„åˆ™ï¼š</p><ol><li>asyncå’Œawaitè¦ä¸€èµ·ç”¨ï¼›</li><li>async è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªasyncå‡½æ•°ï¼Œ awaitåªèƒ½ç”¨åœ¨asyncå‡½æ•°é‡Œé¢ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼›</li><li>async è¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œawaitå°±æ˜¯ç­‰å¾…è¿™ä¸ªpromiseçš„è¿”å›ç»“æœåï¼Œå†ç»§ç»­æ‰§è¡Œï¼›</li><li>await ç­‰å¾…çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œåé¢å¿…é¡»è·Ÿä¸€ä¸ªPromiseå¯¹è±¡ï¼Œä½†æ˜¯ä¸å¿…å†™then()ï¼Œç›´æ¥å°±å¯ä»¥å¾—åˆ°è¿”å›å€¼ã€‚</li></ol><hr><p>å•è¡Œçœç•¥ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x0ltxglqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x0ltxglqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.ellipsis</span> &#123;<br>  <span class="hljs-attribute">white-space</span>: nowrap;<br>  <span class="hljs-attribute">text-overflow</span>: ellipsis;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>å¤šè¡Œçœç•¥ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8opzn0lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8opzn0lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.ellipsis</span> &#123;<br>  <span class="hljs-attribute">display</span>: -webkit-box;<br>  -webkit-line-clamp: <span class="hljs-number">2</span>;<br>  -webkit-box-orient: vertical;<br>  <span class="hljs-attribute">overflow</span>: hidden;<br>  <span class="hljs-attribute">text-overflow</span>: ellipsis;<br>&#125;<br></code></pre></td></tr></table></div></figure><p><code>-webkit-line-clamp</code> CSS å±æ€§å¯ä»¥æŠŠå—å®¹å™¨ä¸­çš„å†…å®¹é™åˆ¶ä¸ºæŒ‡å®šçš„è¡Œæ•°ã€‚å®ƒåªæœ‰åœ¨ display å±æ€§è®¾ç½®æˆ -webkit-box æˆ–è€… -webkit-inline-box å¹¶ä¸” box-orient å±æ€§è®¾ç½®æˆ verticalæ—¶æ‰æœ‰æ•ˆæœã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦è®¾ç½® overflow å±æ€§ä¸º hiddenï¼Œå¦åˆ™ï¼Œé‡Œé¢çš„å†…å®¹ä¸ä¼šè¢«è£å‡ï¼Œå¹¶ä¸”åœ¨å†…å®¹æ˜¾ç¤ºä¸ºæŒ‡å®šè¡Œæ•°åè¿˜ä¼šæ˜¾ç¤ºçœç•¥å·ã€‚</p><hr><p>tabæ ‡ç­¾é¡µï¼šè¦è®© <code>label</code> çš„å€¼ä¸º &quot;åˆ¶åº¦1&quot;ã€&quot;åˆ¶åº¦2&quot; ç­‰ï¼Œä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ’å€¼è¡¨è¾¾å¼å’Œå­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ã€‚</p><ol><li><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-0oz2gylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-0oz2gylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tab-pane</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, xindex) in tmp&quot;</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">&quot;&#x27;åˆ¶åº¦&#x27; + (xindex + 1)&quot;</span>&gt;</span><br>     <span class="hljs-comment">&lt;!-- å…¶ä»–å†…å®¹ --&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">el-tab-pane</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>åœ¨è¿™é‡Œï¼Œ<code>(xindex + 1)</code> è¡¨ç¤ºç´¢å¼• <code>xindex</code> çš„å€¼åŠ  1ï¼Œç„¶åå°†å…¶ä¸å­—ç¬¦ä¸² &quot;åˆ¶åº¦&quot; è¿›è¡Œæ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆçš„ <code>label</code> å€¼ã€‚</p><p class="note note-success" style="border-left: 4px solid #f0ad4e;padding: 10px 15px;color: #777;background-color: #fdf8ea;">ä¸åŠ æ‹¬å·ï¼šåˆ¶åº¦01 åˆ¶åº¦11 åˆ¶åº¦21</p></li><li><p>æ–¹æ³•äºŒï¼šæ’æ§½</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-irh0aylqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-irh0aylqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tab-pane</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, xindex) in tmp&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">label</span>&gt;</span>åˆ¶åº¦&#123;&#123;xindex + 1&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å…¶ä»–å†…å®¹ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-tab-pane</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li></ol><p>ä¿®æ”¹el-tab-paneçš„labelå­—ä½“å¤§å°ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-asg2d2lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-asg2d2lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">:<span class="hljs-built_in">deep</span>(.el-tabs__item)&#123;<br>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span> <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>Vueåº”ç”¨ä¸­ä»£ç é«˜äº®ï¼šå®˜ç½‘<a href="https://highlightjs.org/">https://highlightjs.org/</a></p><p>Githubä»“åº“<a href="https://github.com/highlightjs/highlight.js">https://github.com/highlightjs/highlight.js</a></p><p><a href="https://github.com/highlightjs/vue-plugin">https://github.com/highlightjs/vue-plugin</a></p><p>æ–‡æ¡£æ•™ç¨‹<a href="https://highlightjs.readthedocs.io/en/latest/">https://highlightjs.readthedocs.io/en/latest/</a></p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-gf9n0qlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-gf9n0qlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install highlight.js<br>npm install --save @highlightjs/vue-plugin<br></code></pre></td></tr></table></div></figure><p>main.tsï¼š</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8laz4glqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8laz4glqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;highlight.js/styles/github-dark-dimmed.css&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;highlight.js/lib/common&#x27;</span>;<br><span class="hljs-keyword">import</span> hljsVuePlugin <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@highlightjs/vue-plugin&quot;</span>;<br><br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)<br>app.<span class="hljs-title function_">use</span>(router)<br>app.<span class="hljs-title function_">use</span>(hljsVuePlugin)<br></code></pre></td></tr></table></div></figure><img src="image-20231027140707342.png" alt="image-20231027140707342" style="zoom:50%;" /><p>home.vueï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-zu9vknlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-zu9vknlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;script lang=&quot;ts&quot; setup&gt;<br>import &#123; px2rem &#125; from &#x27;@/utils/index&#x27;<br>const code = `<br>CREATE TABLE &quot;topic&quot; (<br>    &quot;id&quot; integer NOT NULL PRIMARY KEY,<br>    &quot;forum_id&quot; integer NOT NULL,<br>    &quot;subject&quot; varchar(255) NOT NULL<br>);<br>ALTER TABLE &quot;topic&quot;<br>ADD CONSTRAINT forum_id FOREIGN KEY (&quot;forum_id&quot;)<br>REFERENCES &quot;forum&quot; (&quot;id&quot;);<br><br>-- Initials<br>insert into &quot;topic&quot; (&quot;forum_id&quot;, &quot;subject&quot;)<br>values (2, &#x27;D&#x27;&#x27;artagnian&#x27;);<br>`<br><br>&lt;/script&gt;<br><br>&lt;template&gt;<br>  &lt;p class=&quot;input&quot; :style=&quot;&#123; fontSize: px2rem(&#x27;20px&#x27;) &#125;&quot;&gt;ä½ å¥½&lt;/p&gt;<br>  &lt;highlightjs autodetect :code=&quot;code&quot; /&gt;<br>&lt;/template&gt;<br><br>&lt;style lang=&quot;scss&quot; scoped&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></div></figure><img src="image-20231027141156678.png" alt="image-20231027141156678" style="zoom:50%;" /><p>å®ç°æ•ˆæœï¼š</p><img src="image-20231027142222797.png" alt="image-20231027142222797" style="zoom:40%;" /><hr><p>webå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼š<a href="https://www.wangeditor.com/v5">https://www.wangeditor.com/v5</a></p><figure class="highlight bash"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-y3h6vllqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-y3h6vllqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @wangeditor/editor --save<br>npm install @wangeditor/editor-for-vue@next --save<br></code></pre></td></tr></table></div></figure><p class="note note-danger" style="border-left: 4px solid #d9534f;padding: 10px 15px;color: #777;background-color: #fcf1f2;">æ— æ³•æ‰¾åˆ°æ¨¡å—@wangeditor,/editor-for-vueâ€çš„å£°æ˜æ–‡ä»¶ã€‚â€œd:/æ¡Œé¢/vite-project/node modules/@wangeditor/editor-for-vue/dist/index.esm.js'éšå¼æ‹¥æœ‰"any"ç±»å‹ã€‚There are types at'd:/æ¡Œé¢/vite-project/node_modules/@wangeditor/editor-for-vue/dist/src/index.d.ts',butthis result could not be resolved when respecting package.json "exports".The '@wangeditor/editor-for-vue'library may need to update itspackage.json or typings.ts(7016)</p><img src="image-20231027150932023.png" alt="image-20231027150932023" style="zoom:50%;" /><p>å°† wangEditor ç”¨äº Typescriptï¼šè§£å†³æ–¹æ³•ï¼šæ–°å»ºtypings.d.tsæ–‡ä»¶</p><figure class="highlight ts"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hn7zt7lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hn7zt7lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">SlateDescendant</span>, <span class="hljs-title class_">SlateElement</span>, <span class="hljs-title class_">SlateText</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@wangeditor/editor&#x27;</span><br><br><span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">&#x27;@wangeditor/editor&#x27;</span> &#123;<br>    <span class="hljs-comment">/*  æ‰©å±• Text  */</span> <br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SlateText</span> &#123;<br>        <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span><br>    &#125;<br><br>    <span class="hljs-comment">/*  æ‰©å±• Element  */</span> <br>    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SlateElement</span> &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span><br>        <span class="hljs-attr">children</span>: <span class="hljs-title class_">SlateDescendant</span>[]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231027154725474.png" alt="image-20231027154725474" style="zoom:50%;" /><p>ä¿è¯typings.d.tsæ–‡ä»¶åœ¨ <code>tsconfig.json</code> çš„ <code>include</code> ä¸­ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5fea5dlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5fea5dlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;include&quot;</span>: [<span class="hljs-string">&quot;src/**/*.ts&quot;</span>, <span class="hljs-string">&quot;src/**/*.d.ts&quot;</span>, <span class="hljs-string">&quot;src/**/*.tsx&quot;</span>, <span class="hljs-string">&quot;src/**/*.vue&quot;</span>],<br></code></pre></td></tr></table></div></figure><img src="image-20231125183648137.png" alt="image-20231125183648137" style="zoom:50%;" /><hr><p>å¤šç±»é€‰æ‹©å™¨ï¼š<code>CSS</code>ä¸­ç±»é€‰æ‹©å™¨ç”¨ç‚¹å·è¡¨ç¤ºã€‚å®é™…é¡¹ç›®ä¸­ä¸€ä¸ª<code>div</code>å…ƒç´ ä¸ºäº†èƒ½è¢«å¤šä¸ªæ ·å¼è¡¨åŒ¹é…åˆ°ï¼ˆæ ·å¼å¤ç”¨ï¼‰ï¼Œé€šå¸¸<code>div</code>çš„<code>class</code>ä¸­ç”±å¥½å‡ æ®µç»„æˆï¼Œå¦‚<code>&lt;div class=&quot;user login&quot;&gt;</code>èƒ½è¢«<code>.user</code>å’Œ<code>.login</code>ä¸¤ä¸ªé€‰æ‹©å™¨é€‰ä¸­ã€‚å¦‚æœè¿™ä¸¤ä¸ªé€‰æ‹©å™¨ä¸­æœ‰ç›¸åŒçš„å±æ€§å€¼ï¼Œåˆ™è¯¥å±æ€§å€¼å…ˆè¢«æ”¹ä¸º<code>.user</code>ä¸­çš„å€¼ï¼Œå†è¢«æ”¹ä¸º<code>.login</code>ä¸­çš„å€¼ï¼Œå³é‡å¤çš„å±æ€§ä»¥æœ€åä¸€ä¸ªé€‰æ‹©å™¨ä¸­çš„å±æ€§å€¼ä¸ºå‡†ã€‚æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-h7xa6rlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-h7xa6rlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"> </span><br><span class="language-css"><span class="hljs-selector-class">.user</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">30px</span>;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>:red;</span><br><span class="language-css">&#125;</span><br><span class="language-css"><span class="hljs-selector-class">.login</span>&#123;</span><br><span class="language-css">    <span class="hljs-attribute">background-color</span>:blue;</span><br><span class="language-css">&#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;user&#x27;</span>&gt;</span>ä½ å¥½ã€‚è¿™æ˜¯ä¸€ä¸ª DIV å…ƒç´ ï¼Œclass=&#x27;user&#x27;ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;login&#x27;</span>&gt;</span>ä½ å¥½ã€‚è¿™æ˜¯ä¸€ä¸ª DIV å…ƒç´ ï¼Œclass=&#x27;login&#x27;ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;user login&#x27;</span>&gt;</span>ä½ å¥½ã€‚è¿™æ˜¯ä¸€ä¸ª DIV å…ƒç´ ï¼Œclass=&#x27;user login&#x27;ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>ç¬¬ä¸‰ä¸ª<code>div</code>å…ƒç´ çš„èƒŒæ™¯é¢œè‰²ä»¥<code>.login</code>ä¸­çš„ä¸ºå‡†ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><img src="image-20231127093336620.png" alt="image-20231127093336620" style="zoom:50%;" /><p><code>CSS</code>ä¸­å¤šä¸ªç±»é€‰æ‹©å™¨ä¹‹é—´æœ‰æ²¡æœ‰ç©ºæ ¼æ˜¯æ€æ ·çš„åŒ¹é…è§„åˆ™ï¼Ÿ<code>.user.login</code>å’Œ<code>.user .login</code>ï¼ˆä¸­é—´æœ‰ç©ºæ ¼ï¼‰çš„åŒºåˆ«ï¼Ÿ</p><p>ç”µå•†é¡¹ç›®ä¸­çš„å¯¼èˆªæ ï¼ŒåŒ…æ‹¬ç”¨æˆ·çš„ç™»å½•&#x2F;æ³¨å†Œ&#x2F;æ³¨é”€ï¼Œä»¥åŠè´­ç‰©è½¦ç­‰ä¿¡æ¯ã€‚</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-d716dblqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-d716dblqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user-info&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user not-login&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link js-login&quot;</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link js-register&quot;</span>&gt;</span>æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user login&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link-text&quot;</span>&gt;</span><br>                    æ¬¢è¿ï¼Œ<br>                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link&quot;</span>&gt;</span>é€€å‡º<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- å³ä¾§çš„å¯¼èˆªé“¾æ¥ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-list&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./cart.html&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-shopping-cart&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br>                    è´­ç‰©è½¦(<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;cart-cont&quot;</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>)<br>                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./order-list.html&quot;</span>&gt;</span>æˆ‘çš„è®¢å•<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./user-center.html&quot;</span>&gt;</span>æˆ‘çš„MMall<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;nav-item&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;link&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;./about.html&quot;</span>&gt;</span>å…³äºMMall<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></div></figure><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1gw85jlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1gw85jlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.nav</span>&#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;<br>    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">30px</span>;<br>&#125;<br><br><span class="hljs-comment">/* ç”¨æˆ·éƒ¨åˆ† */</span><br><span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.user</span>&#123;<br>    <span class="hljs-attribute">float</span>: left;<br>&#125;<br><span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.user</span><span class="hljs-selector-class">.login</span>&#123;<br>    <span class="hljs-attribute">display</span>: none;<br>&#125;<br><span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.user</span> <span class="hljs-selector-class">.link</span>&#123;<br>    <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">5px</span>;<br>&#125;<br><br><br><span class="hljs-comment">/* å¯¼èˆªé“¾æ¥éƒ¨åˆ† */</span><br><span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.nav-list</span>&#123;<br>    <span class="hljs-attribute">float</span>: right;<br>&#125;<br><span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.nav-list</span> <span class="hljs-selector-class">.nav-item</span>&#123;<br>    <span class="hljs-attribute">display</span>: inline-block;<br>    <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">5px</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><p>è§‚å¯Ÿä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœå¯çŸ¥ï¼š</p><ul><li><code>.nav .user</code>ï¼ˆä¸­é—´æœ‰ç©ºæ ¼ï¼‰åŒ¹é…åˆ°<code>class</code>å«æœ‰<code>nav</code>çš„å…ƒç´ ä¸‹é¢çš„<code>class</code>å«æœ‰<code>user</code>çš„å…ƒç´ ï¼Œæ˜¯<code>&lt;span class=&quot;user not-login&quot;&gt;</code>å’Œ<code>&lt;span class=&quot;user login&quot;&gt;</code>ã€‚</li><li><code>.user.login</code>ï¼ˆä¸­é—´æ²¡æœ‰ç©ºæ ¼ï¼‰åŒ¹é…åˆ°<code>class</code>åŒæ—¶å«æœ‰<code>user</code>å’Œ<code>login</code>çš„å…ƒç´ ï¼Œæ˜¯<code>&lt;span class=&quot;user login&quot;&gt;</code>ã€‚</li><li><code>.nav .user.login</code>ï¼ˆ<code>.nav</code>å’Œ<code>.user</code>ä¸­é—´æœ‰ç©ºæ ¼ï¼Œ<code>.user</code>å’Œ<code>.login</code>ä¸­é—´æ²¡æœ‰ç©ºæ ¼ï¼‰åŒ¹é…åˆ°<code>class</code>å«æœ‰<code>nav</code>çš„å…ƒç´ ä¸‹é¢çš„<code>class</code>åŒæ—¶å«æœ‰<code>user</code>å’Œ<code>login</code>çš„å…ƒç´ ï¼Œæ˜¯<code>&lt;span class=&quot;user login&quot;&gt;</code>ã€‚</li></ul><hr><p><code>white-space</code> æ˜¯ CSS çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ§åˆ¶å…ƒç´ å†…ç©ºæ ¼ã€æ¢è¡Œç¬¦å’Œè¿ç»­ç©ºæ ¼çš„å¤„ç†æ–¹å¼ã€‚</p><p>è¯¥å±æ€§æœ‰ä»¥ä¸‹å‡ ä¸ªå–å€¼ï¼š</p><ul><li><code>normal</code>ï¼šåˆå¹¶è¿ç»­ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œå¿½ç•¥æ¢è¡Œç¬¦å‰åçš„ç©ºæ ¼ã€‚</li><li><code>nowrap</code>ï¼šåˆå¹¶è¿ç»­ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œä½†ä¸å…è®¸æ–‡æœ¬æ¢è¡Œã€‚</li><li><code>pre</code>ï¼šä¿ç•™è¿ç»­ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œä½†ä¸å…è®¸æ–‡æœ¬æ¢è¡Œã€‚</li><li><code>pre-wrap</code>ï¼šä¿ç•™è¿ç»­ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œå…è®¸æ–‡æœ¬æ¢è¡Œã€‚</li><li><code>pre-line</code>ï¼šåˆå¹¶è¿ç»­ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œå…è®¸æ–‡æœ¬æ¢è¡Œã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœå°† <code>white-space</code> å±æ€§è®¾ç½®ä¸º <code>pre</code>ï¼Œé‚£ä¹ˆåœ¨ HTML ä¸­å‡ºç°çš„æ‰€æœ‰ç©ºæ ¼å’Œæ¢è¡Œç¬¦éƒ½ä¼šè¢«ä¿ç•™ï¼Œè€Œä¸ä¼šè¢«æµè§ˆå™¨å¿½ç•¥æˆ–åˆå¹¶ã€‚è¿™åœ¨éœ€è¦ä¿ç•™ä»£ç æ ¼å¼æˆ–æ’ç‰ˆçš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>å¦å¤–ï¼Œ<code>white-space</code> å±æ€§è¿˜å¯ä»¥ä¸ <code>text-overflow</code> å±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œæ¥æ§åˆ¶æ–‡æœ¬æº¢å‡ºçš„å¤„ç†æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå°† <code>white-space</code> è®¾ç½®ä¸º <code>nowrap</code>ï¼Œå¹¶å°† <code>text-overflow</code> è®¾ç½®ä¸º <code>ellipsis</code>ï¼Œå¯ä»¥åœ¨æ–‡æœ¬è¿‡é•¿æ—¶è‡ªåŠ¨æˆªæ–­å¹¶æ˜¾ç¤ºçœç•¥å·ã€‚</p><hr><p>è¦åœ¨ flex å®¹å™¨ä¸­çš„ä¸¤è¡Œä¹‹é—´æ·»åŠ é—´è·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>gap</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§å®šä¹‰äº† flex å®¹å™¨å†…å„ä¸ªé¡¹ç›®ä¹‹é—´çš„é—´è·ï¼ŒåŒ…æ‹¬è¡Œä¸è¡Œä¹‹é—´çš„é—´è·ã€‚</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2vf5mjlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2vf5mjlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.container</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-wrap</span>: wrap;<br>  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/* è®¾ç½®è¡Œä¸è¡Œä¹‹é—´çš„é—´è·ä¸º 10px */</span><br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>å‡ºç°<code>hairlines</code>ç±»ï¼šã€æœªçŸ¥åŸå› ï¼šå¼•å…¥äº†åº“å¯¼è‡´ä¿®æ”¹äº†å…¨å±€æ ·å¼ã€‘</p><img src="image-20231124154048307.png" alt="image-20231124154048307" style="zoom:50%;" /><hr><h2 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h2><p><mark>ChatGPT æ‰“å­—æœºæ¶ˆæ¯å›å¤å®ç°åŸç†</mark>ï¼š<a href="https://juejin.cn/post/7229632570374783034">https://juejin.cn/post/7229632570374783034</a></p><p>åœ¨ä½¿ç”¨ ChatGPT æ—¶ï¼Œå‘ç°è¾“å…¥ prompt åï¼Œé¡µé¢æ˜¯é€æ­¥ç»™å‡ºå›å¤çš„ï¼Œèµ·åˆä»¥ä¸ºä½¿ç”¨äº† WebSckets æŒä¹…åŒ–è¿æ¥åè®®ï¼ŒæŸ¥çœ‹å…¶ç½‘ç»œè¯·æ±‚ï¼Œå‘ç°è¿™ä¸ªæ¥å£çš„é€šä¿¡æ–¹å¼å¹¶éä¼ ç»Ÿçš„ http æ¥å£æˆ–è€… WebSocketsï¼Œè€Œæ˜¯åŸºäº EventStream çš„äº‹ä»¶æµï¼Œåƒæ‰“å­—æœºä¸€æ ·ï¼Œä¸€æ®µä¸€æ®µçš„è¿”å›ç­”æ¡ˆã€‚</p><p>ChatGPT æ˜¯ä¸€ä¸ªåŸºäºæ·±åº¦å­¦ä¹ çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå¤„ç†è‡ªç„¶è¯­è¨€éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºå’Œæ—¶é—´ï¼Œå“åº”é€Ÿåº¦è‚¯å®šæ¯”æ™®é€šçš„è¯»æ•°æ®åº“è¦æ…¢çš„å¤šï¼Œæ™®é€š http æ¥å£ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œæ˜¾ç„¶å¹¶ä¸åˆé€‚ã€‚å¯¹äºè¿™ç§å•é¡¹å¯¹è¯åœºæ™¯ï¼ŒChagtGPT å°†å…ˆè®¡ç®—å‡ºçš„æ•°æ®â€œæ¨é€â€ç»™ç”¨æˆ·ï¼Œè¾¹è®¡ç®—è¾¹è¿”å›ï¼Œé¿å…ç”¨æˆ·å› ä¸ºç­‰å¾…æ—¶é—´è¿‡é•¿å…³é—­é¡µé¢ã€‚è€Œè¿™ï¼Œå¯ä»¥é‡‡ç”¨ SSE æŠ€æœ¯ã€‚</p><p>Server-Sent Events æœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼Œç®€ç§° SSEï¼Œæ˜¯ä¸€ç§æœåŠ¡ç«¯å®æ—¶<mark>ä¸»åŠ¨</mark>å‘æµè§ˆå™¨æ¨é€æ¶ˆæ¯çš„æŠ€æœ¯ã€‚</p><p>SSE æ˜¯ HTML5 ä¸­ä¸€ä¸ªä¸é€šä¿¡ç›¸å…³çš„ APIï¼Œä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæœåŠ¡ç«¯ä¸æµè§ˆå™¨ç«¯çš„é€šä¿¡åè®®ï¼ˆ<code>HTTP</code> åè®®ï¼‰åŠæµè§ˆå™¨ç«¯å¯ä¾› JavaScript ä½¿ç”¨çš„ <code>EventSource</code> å¯¹è±¡ã€‚ è¯¥API ä¸ WebSockets API çš„ä¸åŒä¹‹å¤„åœ¨äºï¼š</p><table><thead><tr><th>Server-Sent Events API</th><th>WebSockets API</th></tr></thead><tbody><tr><td>åŸºäº HTTP åè®®</td><td>åŸºäº TCP åè®®</td></tr><tr><td>å•å·¥ï¼Œåªèƒ½æœåŠ¡ç«¯å•å‘å‘é€æ¶ˆæ¯</td><td>å…¨åŒå·¥ï¼Œå¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯</td></tr><tr><td>è½»é‡çº§ï¼Œä½¿ç”¨ç®€å•</td><td>ç›¸å¯¹å¤æ‚</td></tr><tr><td>å†…ç½®æ–­çº¿é‡è¿å’Œæ¶ˆæ¯è¿½è¸ªçš„åŠŸèƒ½</td><td>ä¸åœ¨åè®®èŒƒå›´å†…ï¼Œéœ€æ‰‹åŠ¨å®ç°</td></tr><tr><td>æ–‡æœ¬æˆ–ä½¿ç”¨ Base64 ç¼–ç å’Œ gzip å‹ç¼©çš„äºŒè¿›åˆ¶æ¶ˆæ¯</td><td>ç±»å‹å¹¿æ³›</td></tr><tr><td>æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ç±»å‹</td><td>ä¸æ”¯æŒè‡ªå®šä¹‰äº‹ä»¶ç±»å‹</td></tr><tr><td>è¿æ¥æ•° HTTP&#x2F;1.1 6 ä¸ªï¼ŒHTTP&#x2F;2 å¯åå•†ï¼ˆé»˜è®¤ 100ï¼‰</td><td>è¿æ¥æ•°æ— é™åˆ¶</td></tr></tbody></table><hr><p>æœåŠ¡ç«¯å®ç°ï¼š</p><p>åè®®ï¼šSSE åè®®éå¸¸ç®€å•ï¼Œæœ¬è´¨æ˜¯æµè§ˆå™¨å‘èµ· http è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›çŠ¶æ€ä¸æ•°æ®ï¼Œå¹¶é™„å¸¦ä»¥ä¸‹ headersï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r7s4y6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r7s4y6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: text/event-stream<br><span class="hljs-title class_">Cache</span>-<span class="hljs-title class_">Control</span>: no-cache<br><span class="hljs-title class_">Connection</span>: keep-alive<br></code></pre></td></tr></table></div></figure><ul><li>SSE APIè§„å®šæ¨é€äº‹ä»¶æµçš„ MIME ç±»å‹ä¸º <code>text/event-stream</code>ã€‚</li><li>å¿…é¡»æŒ‡å®šæµè§ˆå™¨ä¸ç¼“å­˜æœåŠ¡ç«¯å‘é€çš„æ•°æ®ï¼Œä»¥ç¡®ä¿æµè§ˆå™¨å¯ä»¥å®æ—¶æ˜¾ç¤ºæœåŠ¡ç«¯å‘é€çš„æ•°æ®ã€‚</li><li>SSE æ˜¯ä¸€ä¸ªä¸€ç›´ä¿æŒå¼€å¯çš„ TCP è¿æ¥ï¼Œæ‰€ä»¥ Connection ä¸º keep-aliveã€‚</li></ul><p>æ¶ˆæ¯æ ¼å¼ï¼š</p><ul><li>EventStreamï¼ˆäº‹ä»¶æµï¼‰ä¸º <code>UTF-8</code> æ ¼å¼ç¼–ç çš„<code>æ–‡æœ¬</code>æˆ–ä½¿ç”¨ Base64 ç¼–ç å’Œ gzip å‹ç¼©çš„äºŒè¿›åˆ¶æ¶ˆæ¯ã€‚</li><li>æ¯æ¡æ¶ˆæ¯ç”±ä¸€è¡Œæˆ–å¤šè¡Œå­—æ®µï¼ˆ<code>event</code>ã€<code>id</code>ã€<code>retry</code>ã€<code>data</code>ï¼‰ç»„æˆï¼Œæ¯ä¸ªå­—æ®µç»„æˆå½¢å¼ä¸ºï¼š<code>å­—æ®µå:å­—æ®µå€¼</code>ã€‚å­—æ®µä»¥è¡Œä¸ºå•ä½ï¼Œæ¯è¡Œä¸€ä¸ªï¼ˆå³ä»¥ <code>\n</code> ç»“å°¾ï¼‰ã€‚ä»¥<code>å†’å·</code>å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œï¼Œä¼šè¢«æµè§ˆå™¨å¿½ç•¥ã€‚</li><li>æ¯æ¬¡æ¨é€ï¼Œå¯ç”±å¤šä¸ªæ¶ˆæ¯ç»„æˆï¼Œæ¯ä¸ªæ¶ˆæ¯ä¹‹é—´ä»¥ç©ºè¡Œåˆ†éš”ï¼ˆå³æœ€åä¸€ä¸ªå­—æ®µä»¥<code>\n\n</code>ç»“å°¾ï¼‰ã€‚</li></ul><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æ³¨æ„ï¼š<br/>- é™¤ä¸Šè¿°å››ä¸ªå­—æ®µå¤–ï¼Œå…¶ä»–æ‰€æœ‰å­—æ®µéƒ½ä¼šè¢«å¿½ç•¥ã€‚<br/>- å¦‚æœä¸€è¡Œå­—æ®µä¸­ä¸åŒ…å«å†’å·ï¼Œåˆ™æ•´è¡Œæ–‡æœ¬å°†è¢«è§†ä¸ºå­—æ®µåï¼Œå­—æ®µå€¼ä¸ºç©ºã€‚<br/>- æ³¨é‡Šè¡Œå¯ä»¥ç”¨æ¥é˜²æ­¢é“¾æ¥è¶…æ—¶ï¼ŒæœåŠ¡ç«¯å¯ä»¥å®šæœŸå‘æµè§ˆå™¨å‘é€ä¸€æ¡æ¶ˆæ¯æ³¨é‡Šè¡Œï¼Œä»¥ä¿æŒè¿æ¥ä¸æ–­ã€‚</p><p>eventï¼š</p><ul><li><p>äº‹ä»¶ç±»å‹ã€‚å¦‚æœæŒ‡å®šäº†è¯¥å­—æ®µï¼Œåˆ™åœ¨æµè§ˆå™¨æ”¶åˆ°è¯¥æ¡æ¶ˆæ¯æ—¶ï¼Œä¼šåœ¨å½“å‰ <code>EventSource</code> å¯¹è±¡ï¼ˆè§ 4ï¼‰ä¸Šè§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œäº‹ä»¶ç±»å‹å°±æ˜¯è¯¥å­—æ®µçš„å­—æ®µå€¼ã€‚å¯ä»¥ä½¿ç”¨ <code>addEventListener</code> æ–¹æ³•åœ¨å½“å‰ <code>EventSource</code> å¯¹è±¡ä¸Šç›‘å¬ä»»æ„ç±»å‹çš„å‘½åäº‹ä»¶ã€‚</p></li><li><p>å¦‚æœè¯¥æ¡æ¶ˆæ¯æ²¡æœ‰ <code>event</code> å­—æ®µï¼Œåˆ™ä¼šè§¦å‘ <code>EventSource</code> å¯¹è±¡ <code>onmessage</code> å±æ€§ä¸Šçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</p></li></ul><p>idï¼š</p><ul><li>äº‹ä»¶IDã€‚äº‹ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæµè§ˆå™¨ä¼šè·Ÿè¸ªäº‹ä»¶IDï¼Œå¦‚æœå‘ç”Ÿæ–­è¿ï¼Œæµè§ˆå™¨ä¼šæŠŠæ”¶åˆ°çš„æœ€åä¸€ä¸ªäº‹ä»¶IDæ”¾åˆ° HTTP Header <code>Last-Event-Id</code> ä¸­è¿›è¡Œé‡è¿ï¼Œä½œä¸ºä¸€ç§ç®€å•çš„åŒæ­¥æœºåˆ¶ã€‚</li><li>ä¾‹å¦‚å¯ä»¥åœ¨æœåŠ¡ç«¯å°†æ¯æ¬¡å‘é€çš„äº‹ä»¶IDå€¼è‡ªåŠ¨åŠ  1ï¼Œå½“æµè§ˆå™¨æ¥æ”¶åˆ°è¯¥äº‹ä»¶IDåï¼Œä¸‹æ¬¡ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åå†è¯·æ±‚çš„ Header ä¸­å°†åŒæ—¶æäº¤è¯¥äº‹ä»¶IDï¼ŒæœåŠ¡ç«¯æ£€æŸ¥è¯¥äº‹ä»¶IDæ˜¯å¦ä¸ºä¸Šæ¬¡å‘é€çš„äº‹ä»¶IDï¼Œå¦‚æœä¸ä¸Šæ¬¡å‘é€çš„äº‹ä»¶IDä¸ä¸€è‡´åˆ™è¯´æ˜æµè§ˆå™¨å­˜åœ¨ä¸æœåŠ¡å™¨è¿æ¥å¤±è´¥çš„æƒ…å†µï¼Œæœ¬æ¬¡éœ€è¦åŒæ—¶å‘é€å‰å‡ æ¬¡æµè§ˆå™¨æœªæ¥æ”¶åˆ°çš„æ•°æ®ã€‚</li></ul><p>retryï¼š</p><ul><li>é‡è¿æ—¶é—´ã€‚æ•´æ•°å€¼ï¼Œå•ä½ msï¼Œå¦‚æœä¸æœåŠ¡å™¨çš„è¿æ¥ä¸¢å¤±ï¼Œæµè§ˆå™¨å°†ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œç„¶åå°è¯•é‡æ–°è¿æ¥ã€‚å¦‚æœè¯¥å­—æ®µä¸æ˜¯æ•´æ•°å€¼ï¼Œä¼šè¢«å¿½ç•¥ã€‚</li><li>å½“æœåŠ¡ç«¯æ²¡æœ‰æŒ‡å®šæµè§ˆå™¨çš„é‡è¿æ—¶é—´æ—¶ï¼Œç”±æµè§ˆå™¨è‡ªè¡Œå†³å®šæ¯éš”å¤šä¹…ä¸æœåŠ¡ç«¯å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼ˆä¸€èˆ¬ä¸º 30sï¼‰ã€‚</li></ul><p>dataï¼š</p><ul><li>æ¶ˆæ¯æ•°æ®ã€‚æ•°æ®å†…å®¹åªèƒ½ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–‡æœ¬å½¢å¼è¿›è¡Œå‘é€ï¼Œå¦‚æœéœ€è¦å‘é€ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œéœ€è¦å°†è¯¥å¯¹è±¡ä»¥ä¸€ä¸ª JSON æ ¼å¼çš„å­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œå‘é€ã€‚åœ¨æµè§ˆå™¨æ¥æ”¶åˆ°è¯¥å­—ç¬¦ä¸²åï¼Œå†æŠŠå®ƒè¿˜åŸä¸ºä¸€ä¸ª JSON å¯¹è±¡ã€‚</li></ul><hr><p>æµè§ˆå™¨ APIï¼šåœ¨æµè§ˆå™¨ç«¯ï¼Œå¯ä»¥ä½¿ç”¨ JavaScript çš„ EventSource API åˆ›å»º <code>EventSource</code> å¯¹è±¡ç›‘å¬æœåŠ¡å™¨å‘é€çš„äº‹ä»¶ã€‚ä¸€æ—¦å»ºç«‹è¿æ¥ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥ä½¿ç”¨ HTTP å“åº”çš„ &#39;text&#x2F;event-stream&#39; å†…å®¹ç±»å‹å‘é€äº‹ä»¶æ¶ˆæ¯ï¼Œæµè§ˆå™¨åˆ™å¯ä»¥é€šè¿‡ç›‘å¬ EventSource å¯¹è±¡çš„ <code>onmessage</code>ã€<code>onopen</code> å’Œ <code>onerror</code> äº‹ä»¶æ¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</p><p>å»ºç«‹è¿æ¥ï¼š</p><ul><li>EventSource æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šURL å’Œ optionsã€‚</li><li>URL ä¸º http äº‹ä»¶æ¥æºï¼Œä¸€æ—¦ EventSource å¯¹è±¡è¢«åˆ›å»ºåï¼Œæµè§ˆå™¨ç«‹å³å¼€å§‹å¯¹è¯¥ URL åœ°å€å‘é€è¿‡æ¥çš„äº‹ä»¶è¿›è¡Œç›‘å¬ã€‚</li><li>options æ˜¯ä¸€ä¸ªå¯é€‰çš„å¯¹è±¡ï¼ŒåŒ…å« withCredentials å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦å‘é€å‡­è¯ï¼ˆcookieã€HTTPè®¤è¯ä¿¡æ¯ç­‰ï¼‰åˆ°æœåŠ¡ç«¯ï¼Œé»˜è®¤ä¸º falseã€‚</li></ul><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-7oeyf6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-7oeyf6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">&#x27;http_api_url&#x27;</span>, &#123; <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">true</span> &#125;)<br></code></pre></td></tr></table></div></figure><p>ä¸ XMLHttpRequest å¯¹è±¡ç±»å‹ï¼ŒEventSource å¯¹è±¡æœ‰ä¸€ä¸ª readyState å±æ€§å€¼ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>readyState</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>0</td><td>æµè§ˆå™¨ä¸æœåŠ¡ç«¯å°šæœªå»ºç«‹è¿æ¥æˆ–è¿æ¥å·²è¢«å…³é—­</td></tr><tr><td>1</td><td>æµè§ˆå™¨ä¸æœåŠ¡ç«¯å·²æˆåŠŸè¿æ¥ï¼Œæµè§ˆå™¨æ­£åœ¨å¤„ç†æ¥æ”¶åˆ°çš„äº‹ä»¶åŠæ•°æ®</td></tr><tr><td>2</td><td>æµè§ˆå™¨ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥å¤±è´¥ï¼Œå®¢æˆ·ç«¯ä¸å†ç»§ç»­å»ºç«‹ä¸æœåŠ¡ç«¯ä¹‹é—´çš„è¿æ¥</td></tr></tbody></table><p>å¯ä»¥ä½¿ç”¨ EventSource å¯¹è±¡çš„ <code>close</code> æ–¹æ³•å…³é—­ä¸æœåŠ¡ç«¯ä¹‹é—´çš„è¿æ¥ï¼Œä½¿æµè§ˆå™¨ä¸å†å»ºç«‹ä¸æœåŠ¡ç«¯ä¹‹é—´çš„è¿æ¥ã€‚</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-corpt4lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-corpt4lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  åˆå§‹åŒ– eventSource ç­‰çœç•¥  */</span> <br><br><span class="hljs-comment">/*  å…³é—­è¿æ¥  */</span> <br>eventSource.<span class="hljs-title function_">close</span>()<br></code></pre></td></tr></table></div></figure><p>ç›‘å¬äº‹ä»¶ï¼šEventSource å¯¹è±¡æœ¬èº«ç»§æ‰¿è‡ª EventTarget æ¥å£ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ addEventListener() æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶ã€‚EventSource å¯¹è±¡è§¦å‘çš„äº‹ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>open äº‹ä»¶ï¼šå½“æˆåŠŸè¿æ¥åˆ°æœåŠ¡ç«¯æ—¶è§¦å‘ã€‚</li><li>message äº‹ä»¶ï¼šå½“æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯æ—¶è§¦å‘ã€‚è¯¥äº‹ä»¶å¯¹è±¡çš„ data å±æ€§åŒ…å«äº†æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯å†…å®¹ã€‚</li><li>error äº‹ä»¶ï¼šå½“å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚è¯¥äº‹ä»¶å¯¹è±¡çš„ event å±æ€§åŒ…å«äº†é”™è¯¯ä¿¡æ¯ã€‚</li></ul><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ct635blqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ct635blqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  åˆå§‹åŒ– eventSource ç­‰çœç•¥  */</span> <br><br>eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;open&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connection opened&#x27;</span>)<br>&#125;)<br><br>eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received message: &#x27;</span> + event.<span class="hljs-property">data</span>);<br>&#125;)<br><br><span class="hljs-comment">/*  ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶  */</span> <br>eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;xxx&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received message: &#x27;</span> + event.<span class="hljs-property">data</span>);<br>&#125;)<br><br>eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Error occurred: &#x27;</span> + event.<span class="hljs-property">event</span>);<br>&#125;)<br></code></pre></td></tr></table></div></figure><p>ä¹Ÿå¯ä»¥é‡‡ç”¨å±æ€§ç›‘å¬ï¼ˆ<code>onopen</code>ã€<code>onmessage</code>ã€<code>onerror</code>ï¼‰çš„å½¢å¼ã€‚</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-2cb794lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-2cb794lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  åˆå§‹åŒ– eventSource ç­‰çœç•¥  */</span><br><br>eventSource.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connection opened&#x27;</span>)<br>&#125;<br><br>eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received message: &#x27;</span> + event.<span class="hljs-property">data</span>);<br>&#125;<br><br>eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Error occurred: &#x27;</span> + event.<span class="hljs-property">event</span>);<br>&#125;)<br></code></pre></td></tr></table></div></figure><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æ³¨æ„ï¼š<br/>- `EventSource` å¯¹è±¡çš„å±æ€§ç›‘å¬åªèƒ½ç›‘å¬é¢„å®šä¹‰çš„äº‹ä»¶ç±»å‹ï¼ˆ`open`ã€`message`ã€`error`ï¼‰ã€‚</br/>- ä¸èƒ½ç”¨äºç›‘å¬è‡ªå®šä¹‰äº‹ä»¶ç±»å‹ã€‚å¦‚æœè¦å®ç°è‡ªå®šä¹‰äº‹ä»¶ç±»å‹çš„ç›‘å¬ï¼Œå¯ä»¥ä½¿ç”¨ `addEventListener()` æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ Node.js å®ç° SSE çš„ç®€å•ç¤ºä¾‹ï¼š</p><p>æœåŠ¡ç«¯server.jsï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-x057o5lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-x057o5lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  eslint-disable-next-line no-undef  */</span> <br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><span class="hljs-comment">/*  eslint-disable-next-line no-undef  */</span> <br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br>http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">url</span><br>  <span class="hljs-keyword">if</span> (url === <span class="hljs-string">&#x27;/&#x27;</span> || url === <span class="hljs-string">&#x27;index.html&#x27;</span>) &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚æ ¹è·¯å¾„ï¼Œè¿”å› index.html æ–‡ä»¶  */</span> <br>    <span class="hljs-comment">/*  eslint-disable-next-line no-undef  */</span> <br>    fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;index.html&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>)<br>        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Error loading&#x27;</span>)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>&#125;)<br>        res.<span class="hljs-title function_">end</span>(data)<br>      &#125;<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;/sse&#x27;</span>)) &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚ /events è·¯å¾„ï¼Œå»ºç«‹ SSE è¿æ¥  */</span> <br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/event-stream&#x27;</span>,<br>      <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,<br>      <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,<br>      <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-comment">/*  å…è®¸è·¨åŸŸ  */</span> <br>    &#125;)<br><br>    <span class="hljs-comment">/*  æ¯éš” 1 ç§’å‘é€ä¸€æ¡æ¶ˆæ¯  */</span> <br>    <span class="hljs-keyword">let</span> id = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`event: customEvent\n`</span>)<br>      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`id: <span class="hljs-subst">$&#123;id&#125;</span>\n`</span>)<br>      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`retry: 30000\n`</span>)<br>      <span class="hljs-keyword">const</span> params = url.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;?&#x27;</span>)[<span class="hljs-number">1</span>]<br>      <span class="hljs-keyword">const</span> data = &#123; id, <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(), params &#125;<br>      res.<span class="hljs-title function_">write</span>(<span class="hljs-string">`data: <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data)&#125;</span>\n\n`</span>)<br>      id++<br>      <span class="hljs-keyword">if</span> (id &gt;= <span class="hljs-number">10</span>) &#123;<br>        <span class="hljs-built_in">clearInterval</span>(intervalId)<br>        res.<span class="hljs-title function_">end</span>()<br>      &#125;<br>    &#125;, <span class="hljs-number">1000</span>)<br><br>    <span class="hljs-comment">/*  å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶åœæ­¢å‘é€æ¶ˆæ¯  */</span><br>    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-built_in">clearInterval</span>(intervalId)<br>      id = <span class="hljs-number">0</span><br>      res.<span class="hljs-title function_">end</span>()<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚çš„è·¯å¾„æ— æ•ˆï¼Œè¿”å› 404 çŠ¶æ€ç   */</span> <br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>)<br>    res.<span class="hljs-title function_">end</span>()<br>  &#125;<br>&#125;).<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server listening on port 3000&#x27;</span>)<br></code></pre></td></tr></table></div></figure><p>æµè§ˆå™¨index-eventsource.htmlï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qgmyr3lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qgmyr3lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- &lt;!DOCTYPE html&gt;</span><br><span class="hljs-comment">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-comment">  &lt;head&gt;</span><br><span class="hljs-comment">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-comment">    &lt;link rel=&quot;icon&quot; href=&quot;/favicon.ico&quot;&gt;</span><br><span class="hljs-comment">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-comment">    &lt;title&gt;Vite App&lt;/title&gt;</span><br><span class="hljs-comment">  &lt;/head&gt;</span><br><span class="hljs-comment">  &lt;body&gt;</span><br><span class="hljs-comment">    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="hljs-comment">    &lt;script type=&quot;module&quot; src=&quot;/src/main.ts&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-comment">  &lt;/body&gt;</span><br><span class="hljs-comment">&lt;/html&gt; --&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>SSE Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>SSE Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;connectSSE()&quot;</span>&gt;</span>å»ºç«‹ SSE è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>  <br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;closeSSE()&quot;</span>&gt;</span>æ–­å¼€ SSE è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> messageElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;message&#x27;</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">let</span> eventSource</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">/*  å»ºç«‹ SSE è¿æ¥  */</span> </span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> <span class="hljs-title function_">connectSSE</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">      eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">&#x27;http://127.0.0.1:3000/sse?content=xxx&#x27;</span>)</span><br><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">/*  ç›‘å¬æ¶ˆæ¯äº‹ä»¶  */</span> </span><br><span class="language-javascript">      eventSource.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;customEvent&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>)</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;data&#x27;</span>,data);</span><br><span class="language-javascript">        messageElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`<span class="hljs-subst">$&#123;data.id&#125;</span> --- <span class="hljs-subst">$&#123;data.time&#125;</span> --- paramså‚æ•°ï¼š<span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(data.params)&#125;</span>`</span> + <span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span></span><br><span class="language-javascript">      &#125;)</span><br><span class="language-javascript"></span><br><span class="language-javascript">      eventSource.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        messageElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`SSE è¿æ¥æˆåŠŸï¼ŒçŠ¶æ€<span class="hljs-subst">$&#123;eventSource.readyState&#125;</span>&lt;br /&gt;`</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">      eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> &#123;</span><br><span class="language-javascript">        messageElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`SSE è¿æ¥é”™è¯¯ï¼ŒçŠ¶æ€<span class="hljs-subst">$&#123;eventSource.readyState&#125;</span>&lt;br /&gt;`</span></span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-comment">/*  æ–­å¼€ SSE è¿æ¥  */</span> </span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> <span class="hljs-title function_">closeSSE</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">      eventSource.<span class="hljs-title function_">close</span>()</span><br><span class="language-javascript">      messageElement.<span class="hljs-property">innerHTML</span> += <span class="hljs-string">`SSE è¿æ¥å…³é—­ï¼ŒçŠ¶æ€<span class="hljs-subst">$&#123;eventSource.readyState&#125;</span>&lt;br /&gt;`</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>node server-eventsource.js</code> å¯åŠ¨æœåŠ¡ç«¯ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>http://localhost:3000</code> å³å¯çœ‹åˆ° SSE æ•ˆæœï¼š</p><img src="eventsource.gif" alt="eventsource" style="zoom:50%;" /><img src="image-20231127113148975.png" alt="image-20231127113148975" style="zoom:50%;" /><img src="image-20231127110654448.png" alt="image-20231127110654448" style="zoom:50%;" /><img src="image-20231127110628347.png" alt="image-20231127110628347" style="zoom:50%;" /><p>SSE å·²å…·æœ‰å¹¿æ³›çš„çš„æµè§ˆå™¨<a href="https://link.juejin.cn/?target=https://caniuse.com/?search=Server%20-sent%20events">å…¼å®¹æ€§</a>ï¼Œå‡ ä¹é™¤ IE ä¹‹å¤–çš„æµè§ˆå™¨å‡å·²æ”¯æŒã€‚</p><p>å¯¹äºä¸æ”¯æŒ EventSource çš„æµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https://www.npmjs.com/package/eventsource">polyfill</a> å®ç°ã€‚åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ EventSourceï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-kkn8kqlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-kkn8kqlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span>(<span class="hljs-title function_">typeof</span>(<span class="hljs-title class_">EventSource</span>) !== â€œ<span class="hljs-literal">undefined</span>â€) &#123;<br><span class="hljs-comment">/*  æ”¯æŒ  */</span> <br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">/*  ä¸æ”¯æŒï¼Œä½¿ç”¨ polyfill  */</span> <br>&#125;<br></code></pre></td></tr></table></div></figure><p>è™½ç„¶ä½¿ç”¨ SSE æŠ€æœ¯å¯ä»¥å®ç° ChatGPT ä¸€æ ·çš„æ‰“å­—æœºæ•ˆæœï¼Œä½†æ˜¯é€šè¿‡ä¸Šæ–‡è¯·æ±‚ type å¯¹æ¯”å¯ä»¥å‘ç°ï¼Œ<mark>åœ¨ä½¿ç”¨ SSE æ—¶ï¼Œtype ä¸º <code>eventSource</code>ï¼Œè€Œ ChatGPT ä¸º <code>fetch</code></mark>ã€‚<mark>ä¸”å—æµè§ˆå™¨ EventSource API é™åˆ¶ï¼Œåœ¨ä½¿ç”¨ SSE æ—¶ä¸èƒ½è‡ªå®šä¹‰è¯·æ±‚å¤´ã€åªèƒ½å‘å‡º GET è¯·æ±‚ï¼Œä¸”åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­ï¼ŒURL é™åˆ¶ <a href="https://link.juejin.cn/?target=https://stackoverflow.com/questions/417142">2000ä¸ªå­—ç¬¦</a>ï¼Œä¹Ÿæ— æ³•æ»¡è¶³ ChatGPT å‚æ•°ä¼ é€’éœ€æ±‚ã€‚</mark></p><p>æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Fetch API å®ç°ä¸€ä¸ªæ›¿ä»£æ¥å£ï¼Œç”¨äº<strong>æ¨¡æ‹Ÿ</strong> SSE å®ç°ã€‚</p><p>Fetch API æ˜¯ä¸€ç§é€šç”¨çš„ HTTP è¯·æ±‚å’Œå“åº”æ¨¡å‹ï¼Œå®ƒå¯ä»¥ç”¨äºå‘é€å’Œæ¥æ”¶ä»»ä½•ç±»å‹çš„ HTTP è¯·æ±‚ï¼Œæ”¯æŒæ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®ã€‚ç”±äºå…¶å¯¹æµï¼ˆStreamï¼‰çš„æ”¯æŒï¼Œå¯ä»¥æ¨¡æ‹Ÿ Server-Sent Events (SSE)ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†é‡è¿å’Œæµå¼æ•°æ®ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ Fetch API æ¨¡æ‹Ÿ SSEï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ SSEï¼š</p><ul><li>å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼šå¦‚æœä½ éœ€è¦å‘é€æˆ–æ¥æ”¶äºŒè¿›åˆ¶æ•°æ®ï¼Œä½ å¿…é¡»ä½¿ç”¨ Fetch API æˆ–å…¶ä»–æŠ€æœ¯ï¼Œå› ä¸º SSE åªæ”¯æŒæ–‡æœ¬æ•°æ®ã€‚</li><li>åŒå‘é€šä¿¡ï¼šå¦‚æœä½ éœ€è¦è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä½ å¿…é¡»ä½¿ç”¨ Fetch API æˆ–å…¶ä»–æŠ€æœ¯ï¼Œå› ä¸º SSE åªæ”¯æŒå•å‘é€šä¿¡ã€‚</li><li>æ›´å¤§çš„çµæ´»æ€§ï¼šFetch API æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ï¼Œä¾‹å¦‚ï¼Œä½ å¯ä»¥æ§åˆ¶è¯·æ±‚å¤´ã€è¯·æ±‚æ–¹æ³•ã€å“åº”å¤„ç†ç­‰ã€‚</li></ul><p>ç®€å•å®ç°å¦‚ä¸‹ï¼š</p><p>æœåŠ¡ç«¯server-fetch.jsï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-shrqkrlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-shrqkrlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*  eslint-disable-next-line no-undef  */</span> <br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>)<br><span class="hljs-comment">/*  eslint-disable-next-line no-undef  */</span> <br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><br>http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">url</span><br>  <span class="hljs-keyword">if</span> (url === <span class="hljs-string">&#x27;/&#x27;</span> || url === <span class="hljs-string">&#x27;index-fetch.html&#x27;</span>) &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚æ ¹è·¯å¾„ï¼Œè¿”å› ndex-fetch.html æ–‡ä»¶  */</span> <br>    fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">&#x27;index-fetch.html&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">if</span> (err) &#123;<br>        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>)<br>        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;Error loading&#x27;</span>)<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>&#125;)<br>        res.<span class="hljs-title function_">end</span>(data)<br>      &#125;<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&#x27;/fetch-sse&#x27;</span>)) &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚ /events-fetch è·¯å¾„ï¼Œå»ºç«‹è¿æ¥  */</span> <br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/event-stream&#x27;</span>,<br>      <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,<br>      <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,<br>      <span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-comment">/*  å…è®¸è·¨åŸŸ  */</span><br>    &#125;)<br>    <span class="hljs-keyword">let</span> body = <span class="hljs-string">&#x27;&#x27;</span><br>    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> &#123;<br>      body += chunk<br>    &#125;)<br>    <br>    <span class="hljs-comment">/*  æ¯éš” 1 ç§’å‘é€ä¸€æ¡æ¶ˆæ¯  */</span> <br>    <span class="hljs-keyword">let</span> id = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> data = &#123; id, <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(), <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body) &#125;<br>      res.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data))<br>      id++<br>      <span class="hljs-keyword">if</span> (id &gt;= <span class="hljs-number">10</span>) &#123;<br>        <span class="hljs-built_in">clearInterval</span>(intervalId)<br>        res.<span class="hljs-title function_">end</span>()<br>      &#125;<br>    &#125;, <span class="hljs-number">1000</span>)<br><br>    <span class="hljs-comment">/*  å½“å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶åœæ­¢å‘é€æ¶ˆæ¯  */</span><br>    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>      <span class="hljs-built_in">clearInterval</span>(intervalId)<br>      id = <span class="hljs-number">0</span><br>      res.<span class="hljs-title function_">end</span>()<br>    &#125;)<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">/*  å¦‚æœè¯·æ±‚çš„è·¯å¾„æ— æ•ˆï¼Œè¿”å› 404 çŠ¶æ€ç   */</span> <br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>)<br>    res.<span class="hljs-title function_">end</span>()<br>  &#125;<br>&#125;).<span class="hljs-title function_">listen</span>(<span class="hljs-number">3001</span>)<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Server listening on port 3001&#x27;</span>)<br></code></pre></td></tr></table></div></figure><p>å®¢æˆ·ç«¯index.htmlï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-plc6xklqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-plc6xklqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>fetchSSE Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>fetchSSE Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;connectFetch()&quot;</span>&gt;</span>å»ºç«‹ fetchSSE è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;closeSSE()&quot;</span>&gt;</span>æ–­å¼€ fetchSSE è¿æ¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span><br><span class="language-xml"><span class="language-handlebars">    const messageElement = document.getElementById(&#x27;message&#x27;)</span></span><br><span class="language-xml"><span class="language-handlebars">    let controller</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    <span class="hljs-comment">&lt;!-- å»ºç«‹ FETCH-SSE è¿æ¥  --&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    const connectFetch = () =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">      controller = new AbortController()</span></span><br><span class="language-xml"><span class="language-handlebars">      fetchEventSource(&#x27;http://127.0.0.1:3001/fetch-sse&#x27;, &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        method: &#x27;POST&#x27;,</span></span><br><span class="language-xml"><span class="language-handlebars">        body: JSON.stringify(&#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          content: &#x27;xxx&#x27;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;),</span></span><br><span class="language-xml"><span class="language-handlebars">        signal: controller.signal,</span></span><br><span class="language-xml"><span class="language-handlebars">        onopen: () =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          messageElement.innerHTML += `FETCH è¿æ¥æˆåŠŸ<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>`</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">        onclose: () =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          messageElement.innerHTML += `FETCH è¿æ¥å…³é—­<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>`</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">        onmessage: (event) =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          const data = JSON.parse(event)</span></span><br><span class="language-xml"><span class="language-handlebars">          messageElement.innerHTML += `$&#123;data.id&#125; --- $&#123;data.time&#125; --- bodyå‚æ•°ï¼š$&#123;JSON.stringify(data.body)&#125;` + &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>&#x27;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;,</span></span><br><span class="language-xml"><span class="language-handlebars">        onerror: (e) =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          console.log(e)</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    <span class="hljs-comment">&lt;!-- æ–­å¼€ FETCH-SSE è¿æ¥  --&gt;</span></span></span><br><span class="language-xml"><span class="language-handlebars">    const closeSSE = () =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">      if (controller) &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">        controller.abort()</span></span><br><span class="language-xml"><span class="language-handlebars">        controller = undefined</span></span><br><span class="language-xml"><span class="language-handlebars">        messageElement.innerHTML += `FETCH è¿æ¥å…³é—­<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>`</span></span><br><span class="language-xml"><span class="language-handlebars">      &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><br><span class="language-xml"><span class="language-handlebars">    const fetchEventSource = (url, options) =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">      fetch(url, options)</span></span><br><span class="language-xml"><span class="language-handlebars">        .then(response =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          if (response.status === 200) &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">            options.onopen &amp;&amp; options.onopen()</span></span><br><span class="language-xml"><span class="language-handlebars">            return response.body</span></span><br><span class="language-xml"><span class="language-handlebars">          &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars">        .then(rb =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          const reader = rb.getReader()</span></span><br><span class="language-xml"><span class="language-handlebars">            const push = () =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">              <span class="hljs-comment">&lt;!-- done ä¸ºæ•°æ®æµæ˜¯å¦æ¥æ”¶å®Œæˆï¼Œboolean  --&gt;</span> </span></span><br><span class="language-xml"><span class="language-handlebars">              <span class="hljs-comment">&lt;!--  value ä¸ºè¿”å›æ•°æ®ï¼ŒUint8Array --&gt;</span> </span></span><br><span class="language-xml"><span class="language-handlebars">              return reader.read().then((&#123;done, value&#125;) =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                if (done) &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">                  options.onclose &amp;&amp; options.onclose()</span></span><br><span class="language-xml"><span class="language-handlebars">                  return</span></span><br><span class="language-xml"><span class="language-handlebars">                &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">                options.onmessage &amp;&amp; options.onmessage(new TextDecoder().decode(value))</span></span><br><span class="language-xml"><span class="language-handlebars">                <span class="hljs-comment">&lt;!--  æŒç»­è¯»å–æµä¿¡æ¯ --&gt;</span> </span></span><br><span class="language-xml"><span class="language-handlebars">                return push()</span></span><br><span class="language-xml"><span class="language-handlebars">              &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars">            &#125;</span></span><br><span class="language-xml"><span class="language-handlebars">            <span class="hljs-comment">&lt;!--  å¼€å§‹è¯»å–æµä¿¡æ¯ --&gt;</span> </span></span><br><span class="language-xml"><span class="language-handlebars">            return push()</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars">        .catch((e) =&gt; &#123;</span></span><br><span class="language-xml"><span class="language-handlebars">          options.error &amp;&amp; options.error(e)</span></span><br><span class="language-xml"><span class="language-handlebars">        &#125;)</span></span><br><span class="language-xml"><span class="language-handlebars">    &#125;</span></span><br><span class="language-xml"><span class="language-handlebars"></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></div></figure><p>ä¸åŒäº <code>XMLHttpRequest</code>ï¼Œ<code>fetch</code> å¹¶æœªåŸç”Ÿæä¾›ç»ˆæ­¢æ“ä½œæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ DOM API <code>[AbortController](https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController)</code> å’Œ <code>AbortSignal</code> å®ç° fetch è¯·æ±‚ç»ˆæ­¢æ“ä½œã€‚</p><p>SSE æŠ€æœ¯æ˜¯ä¸€ç§è½»é‡çº§çš„å®æ—¶é€šä¿¡æŠ€æœ¯ï¼ŒåŸºäº HTTP åè®®ï¼Œå…·æœ‰æœåŠ¡ç«¯æ¨é€ã€æ–­çº¿é‡è¿ã€ç®€å•è½»é‡ç­‰ä¼˜ç‚¹ã€‚ä½†æ˜¯ï¼ŒSSE æŠ€æœ¯ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ä¸èƒ½è¿›è¡ŒåŒå‘é€šä¿¡ã€è¿æ¥æ•°å—é™ã€ä»…æ”¯æŒ get è¯·æ±‚ç­‰ã€‚</p><p>SSE å¯ä»¥åœ¨ Web åº”ç”¨ç¨‹åºä¸­å®ç°è¯¸å¦‚è‚¡ç¥¨åœ¨çº¿æ•°æ®ã€æ—¥å¿—æ¨é€ã€èŠå¤©å®¤å®æ—¶äººæ•°ç­‰å³æ—¶æ•°æ®æ¨é€åŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSSE å¹¶ä¸æ˜¯é€‚ç”¨äºæ‰€æœ‰çš„å®æ—¶æ¨é€åœºæ™¯ã€‚åœ¨éœ€è¦é«˜å¹¶å‘ã€é«˜ååé‡å’Œä½å»¶è¿Ÿçš„åœºæ™¯ä¸‹ï¼ŒWebSockets å¯èƒ½æ›´åŠ é€‚åˆã€‚è€Œåœ¨éœ€è¦æ›´è½»é‡çº§çš„æ¨é€åœºæ™¯ä¸‹ï¼ŒSSE å¯èƒ½æ›´åŠ é€‚åˆã€‚</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events">https://developer.mozilla.org/zh-CN/docs/Web/API/Server-sent_events</a></p><p><a href="https://github.com/Azure/fetch-event-source">https://github.com/Azure/fetch-event-source</a></p><p>openaiå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://platform.openai.com/docs/introduction">https://platform.openai.com/docs/introduction</a></p><hr><p>é“¾æ¥aå»æ‰ä¸‹åˆ’çº¿ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-w112jelqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-w112jelqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123;textDecoration: &#x27;none&#x27;&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br></code></pre></td></tr></table></div></figure><hr>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue3</tag>
      
      <tag>CSS</tag>
      
      <tag>HTML</tag>
      
      <tag>TypeScript</tag>
      
      <tag>ElementPlus</tag>
      
      <tag>Vite</tag>
      
      <tag>pinia</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äºŒ.æ­å»ºåšå®¢</title>
    <link href="/2023/08/25/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/08/25/%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å‚è€ƒæ•™ç¨‹"><a href="#1-å‚è€ƒæ•™ç¨‹" class="headerlink" title="1.å‚è€ƒæ•™ç¨‹"></a>1.å‚è€ƒæ•™ç¨‹</h1><p><code>https://blog.senqiweb.cn/2022/08/26/kv1ltl/#è®¾ç½®å…¬é’¥å’Œç§é’¥</code></p><p>hexoå®˜ç½‘ï¼š<a href="https://hexo.io/zh-cn/">https://hexo.io/zh-cn/</a></p><p>hexoä¸»é¢˜ä¹‹fluidï¼š<a href="https://github.com/fluid-dev/hexo-theme-fluid">https://github.com/fluid-dev/hexo-theme-fluid</a></p><p>hexo fluidæ–‡æ¡£ï¼š<a href="https://hexo.fluid-dev.com/docs/guide">https://hexo.fluid-dev.com/docs/guide</a></p><ul><li>åˆ›å»ºæ–‡ä»¶ï¼šhexo new æ­å»ºåšå®¢</li><li>ç”Ÿæˆé™æ€æ–‡ä»¶ï¼šhexo g</li><li>é¢„è§ˆåšå®¢ï¼šhexo s</li><li>éƒ¨ç½²ç½‘ç«™ï¼šhexo d</li></ul><p><mark>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</mark></p><h1 id="2-é—®é¢˜"><a href="#2-é—®é¢˜" class="headerlink" title="2.é—®é¢˜"></a>2.é—®é¢˜</h1><p class="note note-success" style="border-left: 4px solid #f0ad4e;padding: 10px 15px;color: #777;background-color: #fdf8ea;">é‡åˆ°æƒ³è¦ä¿®æ”¹çš„æ ·å¼ç¬¬ä¸€æ­¥æ˜¯æ‰“å¼€æ§åˆ¶å°ï¼ï¼ï¼</p><p>å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/265077468">https://zhuanlan.zhihu.com/p/265077468</a></p><img src="image-20230827182307675.png" alt="image-20230827182307675" style="zoom:30%;" /><p>è®¾ç½®å›¾ç‰‡æ ¹ç›®å½•ï¼š</p><img src="image-20230825134728552.png" style="zoom:50%;" /><p>å¿…é¡»æ˜¯ä»¥ä¸‹æ ¼å¼ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-hhd280lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-hhd280lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;image-20230918163131185.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;image-20230918163131185&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;zoom:50%;&quot;</span> /&gt;</span><br></code></pre></td></tr></table></div></figure><p>typoraè‡ªå¸¦æ ¼å¼ä¸ç”Ÿæ•ˆï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-n5oynplqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-n5oynplqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">![image-20230918170715840](/image-20230918170715840.png)<br></code></pre></td></tr></table></div></figure><hr><p>æ·»åŠ æ¨±èŠ±æ•ˆæœï¼š<code>https://cnhuazhu.gitee.io/2021/02/19/Hexoé­”æ”¹/Hexoæ·»åŠ æ¨±èŠ±åŠ¨æ€æ•ˆæœèƒŒæ™¯/</code></p><p>æ·»åŠ åˆ°ä¸»é¢˜ä¸‹çš„layoutæ–‡ä»¶å¤¹ï¼š</p><img src="image-20230825111055130.png" style="zoom:50%;" /><p>git cloneåˆ°æœ¬åœ°çš„ä»£ç ï¼š</p><ol><li>åˆ é™¤node_modules</li><li>npm install</li><li>é‡æ–°ä¸‹è½½fluidä¸»é¢˜æ–‡ä»¶å¤¹  å¤åˆ¶åˆ°themes\fluidç›®å½•ä¸‹</li></ol><hr><p><mark>.deploy_git</mark>æ˜¯gitéƒ¨ç½²ç”¨çš„æ–‡ä»¶ã€‚å½“ä½ ä¸º git éƒ¨ç½²é€‰é¡¹è¿è¡Œhexo då‘½ä»¤æ—¶ï¼ŒHexo ä¼šåˆ›å»ºä¸€ä¸ªåä¸º.deploy_gitçš„æ–‡ä»¶å¤¹ï¼Œå¹¶å°†ç”Ÿæˆçš„æ–‡ä»¶å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ã€‚</p><img src="image-20230827181423475.png" alt="image-20230827181423475" style="zoom:40%;" /><ol><li>åˆ é™¤.deploy_gitæ–‡ä»¶å¤¹</li><li>è¾“å…¥<mark>git config --global core.autocrlf false</mark></li><li>ä¾æ¬¡æ‰§è¡Œï¼šhexo clean    hexo g    hexo d</li></ol><hr><p>æ–°å»º.gitignoreï¼šè¿‡æ»¤node_moduleså’Œdistæ–‡ä»¶å¤¹</p><img src="image-20230827184313722.png" alt="image-20230827184313722" style="zoom:40%;" /><hr><p>hexoä¸­é«˜äº®ä¸æ˜¾ç¤ºï¼š<code>==æˆ‘é«˜äº®äº†==</code>â†’ä½¿ç”¨<code>&lt;mark&gt;æˆ‘é«˜äº®äº†&lt;/mark&gt;</code></p><p>è‹±æ–‡é«˜äº®ç»Ÿä¸€ç”¨&#96;&#96;ï¼Œä¸­æ–‡é«˜äº®ç»Ÿä¸€ç”¨markã€‚</p><hr><p>githubè´¡çŒ®å›¾ï¼š<a href="https://github.com/2016rshah/githubchart-api">https://github.com/2016rshah/githubchart-api</a></p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-75ur3glqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-75ur3glqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://ghchart.rshah.org/409ba5/lan720&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%&quot;</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20230918163131185.png" alt="image-20230918163131185" style="zoom:50%;" /><img src="image-20230919160147542.png" alt="image-20230919160147542" style="zoom:50%;" /><p>æˆ–è€…</p><figure class="highlight yml"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-5zfpgglqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-5zfpgglqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">githubcalendar:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">priority:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">enable_page:</span> <span class="hljs-string">/archives/</span><br>  <span class="hljs-attr">user:</span> <span class="hljs-string">lan720</span><br>  <span class="hljs-attr">layout:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">class</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">container</span><br>    <span class="hljs-attr">index:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">githubcalendar_html:</span> <span class="hljs-string">&#x27;&lt;div id=&quot;github-calendar&quot; style=&quot;width:100%;height:auto;padding:10px;margin-bottom:20px&quot;&gt;&lt;div id=&quot;github_loading&quot; style=&quot;width:10%;height:100%;margin:0 auto;display: block&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;  viewBox=&quot;0 0 50 50&quot; style=&quot;enable-background:new 0 0 50 50&quot; xml:space=&quot;preserve&quot;&gt;&lt;path fill=&quot;#d0d0d0&quot; d=&quot;M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z&quot; transform=&quot;rotate(275.098 25 25)&quot;&gt;&lt;animateTransform attributeType=&quot;xml&quot; attributeName=&quot;transform&quot; type=&quot;rotate&quot; from=&quot;0 25 25&quot; to=&quot;360 25 25&quot; dur=&quot;0.6s&quot; repeatCount=&quot;indefinite&quot;&gt;&lt;/animateTransform&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/div&gt;&lt;div id=&quot;github_container&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span><br>  <span class="hljs-attr">pc_minheight:</span> <span class="hljs-string">200px</span><br>  <span class="hljs-attr">mobile_minheight:</span> <span class="hljs-string">0px</span><br>  <span class="hljs-attr">color:</span> <span class="hljs-string">&quot;[&#x27;#ebedf0&#x27;, &#x27;#f1f8ff&#x27;, &#x27;#dbedff&#x27;, &#x27;#c8e1ff&#x27;, &#x27;#79b8ff&#x27;, &#x27;#2188ff&#x27;, &#x27;#0366d6&#x27;, &#x27;#005cc5&#x27;, &#x27;#044289&#x27;, &#x27;#032f62&#x27;, &#x27;#05264c&#x27;]&quot;</span><br>  <span class="hljs-attr">api:</span> <span class="hljs-string">https://python-github-calendar-api.vercel.app/api</span><br>  <span class="hljs-comment"># api: https://gitcalendar.zfe.space/api</span><br>  <span class="hljs-comment"># api: https://python-gitee-calendar-api.vercel.app/api</span><br>  <span class="hljs-attr">calendar_js:</span> <span class="hljs-string">https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js</span><br>  <span class="hljs-attr">plus_style:</span> <span class="hljs-string">&quot;#github_container &gt; .position-relative &gt; .border&#123;border:0!important&#125;#github-calendar&#123;position: relative;margin-top: -2rem;background-color: var(--board-bg-color);transition: background-color 0.2s ease-in-out;border-radius: 0.5rem;z-index: 3;-webkit-box-shadow: 0 12px 15px 0 rgb(0 0 0 / 24%), 0 17px 50px 0 rgb(0 0 0 / 19%);box-shadow: 0 12px 15px 0 rgb(0 0 0 / 24%), 0 17px 50px 0 rgb(0 0 0 / 19%);&#125;&quot;</span><br></code></pre></td></tr></table></div></figure><hr><p class="note note-success" style="border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);">æ·»åŠ æ–°æ ·å¼</p><p>ä¿®æ”¹é¼ æ ‡æ ·å¼å’Œæ–‡å­—é€‰ä¸­æ ·å¼ï¼Œåœ¨themes&#x2F;fluid&#x2F;source&#x2F;css&#x2F;my&#x2F;mouse.stylä¸­æ·»åŠ ã€‚</p><p class="note note-success" style="border-left: 4px solid #d9534f;padding: 10px 15px;color: #777;background-color: #fcf1f2;">ä¸æ˜¯public/css/myæ–‡ä»¶å¤¹ï¼ç›´æ¥ä¿®æ”¹main.cssæ–‡ä»¶æ— æ•ˆï¼</p><img src="image-20230921162312844.png" alt="image-20230921162312844" style="zoom:50%;" /><p>åœ¨main.stylä¸­å¼•å…¥ï¼Œä¸æ˜¯mainï¼š</p><img src="image-20230921162342641.png" alt="image-20230921162342641" style="zoom:50%;" /><hr><p>æ’å…¥ä¾¿ç­¾ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ebce6wlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ebce6wlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-primary&quot;</span>&gt;</span>æ ‡ç­¾<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20230925140109254.png" alt="image-20230925140109254" style="zoom:40%;" /><p>ç”±äºTyporaä»…æ”¯æŒæ™®é€šçš„htmlæ ‡ç­¾ï¼Œä¸æ”¯æŒclassã€idã€data-*ç­‰è‡ªå®šä¹‰å±æ€§ï¼Œæ‰€ä»¥ä¿®æ”¹ä¸»é¢˜æ–‡ä»¶å¤¹ä¸ç”Ÿæ•ˆï¼Œåªèƒ½æ·»åŠ è¡Œå†…æ ·å¼ï¼š</p><ol><li><p>primaryï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-m2hehflqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-m2hehflqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-primary&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #6f42c1;padding: 10px 15px;color: #777;background-color: #f5f0fa;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li><li><p>secondaryï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-e9yas5lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-e9yas5lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-secondary&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #777777;padding: 10px 15px;color: #777;background-color: #f7f7f7;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li><li><p>successï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6tipfulqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6tipfulqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-success&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #42b983;padding: 10px 15px;color: #777;background-color: rgba(66, 185, 131, .1);&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li><li><p>dangerï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3ssg7mlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3ssg7mlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-danger&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #d9534f;padding: 10px 15px;color: #777;background-color: #fcf1f2;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li><li><p>warningï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-fbv6xmlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-fbv6xmlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-warning&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #f0ad4e;padding: 10px 15px;color: #777;background-color: #fdf8ea;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li><li><p>infoï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-3apcsflqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-3apcsflqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;note note-info&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border-left: 4px solid #428bca;padding: 10px 15px;color: #777;background-color: rgb(238, 247, 250);&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></div></figure></li></ol><p>æ’å…¥æ ‡ç­¾ï¼š</p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-ati26rlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-ati26rlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;label label-primary&quot;</span>&gt;</span>Label<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20230926175453969.png" alt="image-20230926175453969" style="zoom:60%;" /><hr><p>è§£å†³æµè§ˆå™¨ç«¯çš„è¯­æ³•é«˜äº®åº“highlight.jsä¸æ”¯æŒvueä»£ç é«˜äº®ï¼š</p><p><a href="https://github.com/highlightjs/highlightjs-vue/">https://github.com/highlightjs/highlightjs-vue/</a></p><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-qz6rlalqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-qz6rlalqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/highlightjs&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/highlightjs-vue&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  hljs.<span class="hljs-title function_">registerLanguage</span>(<span class="hljs-string">&quot;vue&quot;</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">hljsDefineVue</span>);</span><br><span class="language-javascript">  hljs.<span class="hljs-title function_">initHighlightingOnLoad</span>();</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20230926175206543.png" alt="image-20230926175206543" style="zoom:50%;" /><p>ä¸èƒ½å•ç‹¬ä½¿ç”¨<code>&lt;script&gt;&lt;/script&gt;</code>ï¼Œåœ¨<code>&lt;script&gt;&lt;/script&gt;</code>å‰é¢ä¸€å®šè¦å…ˆåŠ <code>&lt;template&gt;&lt;/template&gt;</code>æ‰èƒ½ç”Ÿæ•ˆï¼</p><hr><p>å¿…é¡»ä½¿ç”¨<code>&lt;br/&gt;</code>æ‰èƒ½æ¢è¡Œï¼š</p><img src="image-20231010144758522.png" alt="image-20231010144758522" style="zoom:50%;" /><hr><p>ä¿®æ”¹ç›®å½•æ ·å¼ï¼š</p><img src="image-20231013101526690.png" alt="image-20231013101526690" style="zoom:50%;" /><hr><p>hexoä¸­ä½¿ç”¨iconfontå›¾æ ‡ï¼š</p><ol><li><p>ç”Ÿæˆé˜¿é‡Œåœ¨çº¿é“¾æ¥ï¼š</p><img src="image-20231013162830707.png" alt="image-20231013162830707" style="zoom:50%;" /></li><li><p>ä¿®æ”¹custom_cssï¼š</p><img src="image-20231013162936840.png" alt="image-20231013162936840" style="zoom:50%;" /><p class="note note-success" style="border-left: 4px solid #d9534f;padding: 10px 15px;color: #777;background-color: #fcf1f2;">åœ¨_config.fluid.ymlä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹ä¿®æ”¹ï¼Œä¸æ˜¯_config.ymlæ–‡ä»¶å¤¹ï¼Œå¦åˆ™æ ·å¼ä¸ç”Ÿæ•ˆæˆ–è€…æ ·å¼è¢«è¦†ç›–ï¼</p></li><li><p>ä½¿ç”¨iconfontå›¾æ ‡ï¼š</p><img src="image-20231013163014621.png" alt="image-20231013163014621" style="zoom:50%;" /><p>ä½¿ç”¨å½©è‰²iconfontå›¾æ ‡ï¼šå‹¾é€‰å½©è‰²</p><img src="image-20231024145633308.png" alt="image-20231024145633308" style="zoom:50%;" /></li></ol><hr><p>ä»£ç å—æŠ˜å ï¼š</p><img src="image-20231012145306284.png" alt="image-20231012145306284" style="zoom:50%;" /><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-xtzbk6lqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-xtzbk6lqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-meta">&quot;use strict&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUuid</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>, <span class="hljs-number">8</span>) + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>);<br>&#125;<br><br>hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">filter</span>.<span class="hljs-title function_">register</span>(<br>  <span class="hljs-string">&quot;after_post_render&quot;</span>,<br>  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; line_number, lib &#125; = hexo.<span class="hljs-property">theme</span>.<span class="hljs-property">config</span>.<span class="hljs-property">code</span>.<span class="hljs-property">highlight</span>;<br><br>    <span class="hljs-keyword">let</span> reg;<br>    <span class="hljs-keyword">if</span> (lib === <span class="hljs-string">&quot;highlightjs&quot;</span>) &#123;<br>      <span class="hljs-keyword">if</span> (line_number) &#123;<br>        reg = <span class="hljs-regexp">/(&lt;figure class=&quot;highlight.+?&gt;)(.+?hljs (.*?)&quot;.+?)(&lt;\/figure&gt;)/gim</span>s;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        reg = <span class="hljs-regexp">/(&lt;div class=&quot;code-wrapper.+?&gt;)(.+?hljs (.*?)&quot;.+?)(&lt;\/div&gt;)/gim</span>s;<br>      &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lib === <span class="hljs-string">&quot;prismjs&quot;</span>) &#123;<br>      reg = <span class="hljs-regexp">/(&lt;div class=&quot;code-wrapper.+?&gt;)(.+?data-language=&quot;(.*?)&quot;.+?)(&lt;\/div&gt;)/gim</span>s;<br>    &#125;<br><br>    data.<span class="hljs-property">content</span> = data.<span class="hljs-property">content</span>.<span class="hljs-title function_">replace</span>(reg, <span class="hljs-function">(<span class="hljs-params">match, begin, inner, lang, end, offset, string</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> collapseId = <span class="hljs-string">`collapse-<span class="hljs-subst">$&#123;getUuid()&#125;</span>`</span>;<br>      <span class="hljs-keyword">const</span> collapseBtn = <span class="hljs-string">`&lt;i class=&quot;iconfont icon-github-fill&quot; type=&quot;button&quot; data-toggle=&quot;collapse&quot; data-target=&quot;#<span class="hljs-subst">$&#123;collapseId&#125;</span>&quot;&gt;&lt;/i&gt;`</span>;<br>      <span class="hljs-keyword">const</span> collapseDiv = <span class="hljs-string">`&lt;div class=&quot;collapse show&quot; id=&quot;<span class="hljs-subst">$&#123;collapseId&#125;</span>&quot;&gt;<span class="hljs-subst">$&#123;inner&#125;</span>&lt;/div&gt;`</span>;<br>      <span class="hljs-keyword">const</span> langSpan = <span class="hljs-string">`&lt;span&gt;<span class="hljs-subst">$&#123;lang&#125;</span>&lt;/span&gt;`</span>;<br>      <span class="hljs-keyword">return</span> begin + collapseBtn + langSpan + collapseDiv + end;<br>    &#125;);<br>    <span class="hljs-keyword">return</span> data;<br>  &#125;,<br>  <span class="hljs-number">10000</span><br>);<br></code></pre></td></tr></table></div></figure><img src="image-20231012145352943.png" alt="image-20231012145352943" style="zoom:50%;" /><figure class="highlight stylus"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-b0oy9alqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-b0oy9alqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">figure</span><span class="hljs-selector-class">.highlight</span> &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">230</span>, <span class="hljs-number">235</span>, <span class="hljs-number">241</span>);<br>    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0.5rem</span>;<br><br>    <span class="hljs-selector-tag">table</span> &#123;<br>        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0.5rem</span> <span class="hljs-number">0.5rem</span>;<br>    &#125;<br><br>    <span class="hljs-selector-class">.fas</span><span class="hljs-selector-class">.fa-angle-down</span> &#123;<br>        <span class="hljs-attribute">transform</span>: none;<br>        <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span> ease-in-out;<br><br>        &amp;<span class="hljs-selector-class">.collapsed</span> &#123;<br>            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">90deg</span>);<br>        &#125;<br>    &#125;<br><br>    &gt; <span class="hljs-selector-tag">i</span> &#123;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#777777</span>;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;<br>        <span class="hljs-attribute">line-height</span>: <span class="hljs-number">2rem</span>;<br>    &#125;<br><br>    &gt; <span class="hljs-selector-tag">span</span> &#123;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#777777</span>;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;<br>        <span class="hljs-attribute">font-weight</span>: bold;<br>    &#125;<br><br>    <span class="hljs-selector-tag">td</span><span class="hljs-selector-pseudo">:first-child</span> &#123;<br>        <span class="hljs-attribute">position</span>: sticky;<br>        <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>        <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><hr><p>ä¿®æ”¹æœ¬æ–‡æœ€åæ›´æ–°äºçš„æ—¶é—´çš„æ˜¾ç¤ºæ ¼å¼ï¼š</p><figure class="highlight avrasm"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-6ps5qelqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-6ps5qelqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">date_format:</span> <span class="hljs-string">&quot;LL HH:mm&quot;</span><br></code></pre></td></tr></table></div></figure><img src="image-20231013101210574.png" alt="image-20231013101210574" style="zoom:50%;" /><hr><p>æ·»åŠ å’Œé£å¤©æ°”ç»„ä»¶ï¼š<a href="https://widget.qweather.com/">https://widget.qweather.com/</a></p><img src="image-20231016161018794.png" alt="image-20231016161018794" style="zoom:50%;" /><figure class="highlight html"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-r2czrzlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-r2czrzlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;weather-plugin&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;he-plugin-simple&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-variable constant_">WIDGET</span> = &#123;</span><br><span class="language-javascript">        <span class="hljs-string">&quot;CONFIG&quot;</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-string">&quot;modules&quot;</span>: <span class="hljs-string">&quot;012&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;background&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;tmpColor&quot;</span>: <span class="hljs-string">&quot;FFFFFF&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;tmpSize&quot;</span>: <span class="hljs-string">&quot;16&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;cityColor&quot;</span>: <span class="hljs-string">&quot;FFFFFF&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;citySize&quot;</span>: <span class="hljs-string">&quot;16&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;aqiColor&quot;</span>: <span class="hljs-string">&quot;FFFFFF&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;aqiSize&quot;</span>: <span class="hljs-string">&quot;16&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;weatherIconSize&quot;</span>: <span class="hljs-string">&quot;24&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;alertIconSize&quot;</span>: <span class="hljs-string">&quot;18&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-comment">// &quot;padding&quot;: &quot;10px 10px 10px 10px&quot;,</span></span><br><span class="language-javascript">            <span class="hljs-string">&quot;shadow&quot;</span>: <span class="hljs-string">&quot;0&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;language&quot;</span>: <span class="hljs-string">&quot;auto&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;borderRadius&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;fixed&quot;</span>: <span class="hljs-string">&quot;false&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;vertical&quot;</span>: <span class="hljs-string">&quot;top&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;horizontal&quot;</span>: <span class="hljs-string">&quot;left&quot;</span>,</span><br><span class="language-javascript">            <span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;9cf07a14c8a74c4198ee7f49b868e0c8&quot;</span></span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></div></figure><img src="image-20231016160942811.png" alt="image-20231016160942811" style="zoom:50%;" /><img src="image-20231016160722999.png" alt="image-20231016160722999" style="zoom:50%;" /><hr><p>æ·»åŠ æ‰“èµåŠŸèƒ½ï¼š</p><figure class="highlight plaintext"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-1b880klqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-1b880klqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;!-- æ·»åŠ æ‰“èµæ¨¡å— --&gt;<br>&lt;div class=&quot;reward-container&quot;&gt;<br>    &lt;% if (theme.donate.enable) &#123; %&gt;<br>    &lt;button id=&quot;rewardBtn&quot; class=&quot;reward-btn&quot;&gt;<br>        &lt;% if (config.language==&#x27;zh-CN&#x27; ) &#123; %&gt;<br>        â¤ æ‰“èµ<br>        &lt;% &#125; else &#123; %&gt;<br>        Donate<br>        &lt;% &#125; %&gt;<br>    &lt;/button&gt;<br>    &lt;p class=&quot;tea&quot;&gt;â€œ&lt;%= theme.donate.message %&gt;â€&lt;/p&gt;<br>    &lt;div id=&quot;rewardImgContainer&quot; class=&quot;reward-img-container&quot;&gt;<br>        &lt;div class=&quot;singleImgContainer&quot;&gt;<br>            &lt;img id=&quot;wechatImg&quot; class=&quot;reward-img&quot; src=&quot;&lt;%= theme.donate.wechatpay %&gt;&quot; alt=&quot;å¾®ä¿¡äºŒç»´ç &quot;&gt;<br>            &lt;p class=&quot;wechatPay&quot;&gt;å¾®ä¿¡æ”¯ä»˜&lt;/p&gt;<br>        &lt;/div&gt;<br>        &lt;div class=&quot;singleImgContainer&quot;&gt;<br>            &lt;img id=&quot;alipayImg&quot; class=&quot;reward-img&quot; src=&quot;&lt;%= theme.donate.alipay %&gt;&quot; alt=&quot;æ”¯ä»˜å®äºŒç»´ç &quot;&gt;<br>            &lt;p class=&quot;aliPay&quot;&gt;æ”¯ä»˜å®æ”¯ä»˜&lt;/p&gt;<br>        &lt;/div&gt;<br>    &lt;/div&gt;<br>    &lt;% &#125; %&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></div></figure><img src="image-20231017105504390.png" alt="image-20231017105504390" style="zoom:50%;" /><p>æ·»åŠ ä¸»é¢˜é…ç½®ï¼š</p><figure class="highlight yaml"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-td3i0clqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-td3i0clqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Donate è‡ªå·±ä¸º Fluid ä¸»é¢˜å¢åŠ çš„æ‰“èµåŠŸèƒ½</span><br><span class="hljs-comment"># `message` æ˜¯æ‰“èµæç¤ºè¯­ï¼Œå¯è‡ªå®šä¹‰</span><br><span class="hljs-comment"># `alipay` æ˜¯æ”¯ä»˜å®ä»˜æ¬¾ç ï¼Œ `wechatpay` æ˜¯å¾®ä¿¡ä»˜æ¬¾ç ã€‚</span><br><span class="hljs-attr">donate:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">message:</span> <span class="hljs-string">è§‰å¾—ä¸é”™çš„è¯ï¼Œç»™ä¸ªæ‰“èµå§</span> <span class="hljs-string">à­§(à¹‘â€¢Ì€âŒ„â€¢Ìà¹‘)à«­</span> <br>  <span class="hljs-attr">alipay:</span> <span class="hljs-string">/image/alipay.png</span><br>  <span class="hljs-attr">wechatpay:</span> <span class="hljs-string">/image/wechatpay.png</span><br></code></pre></td></tr></table></div></figure><img src="image-20231017105639727.png" alt="image-20231017105639727" style="zoom:50%;" /><p>å›¾ç‰‡æ·»åŠ åœ¨imgæ–‡ä»¶å¤¹ä¸‹ï¼š</p><img src="image-20231017111859101.png" alt="image-20231017111859101" style="zoom:50%;" /><p>æ·»åŠ cssæ ·å¼ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-m8122xlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-m8122xlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.reward-container</span>&#123;<br>    <span class="hljs-attribute">display</span>: flex;<br>    <span class="hljs-attribute">flex-direction</span>: column;<br>    <span class="hljs-attribute">align-items</span>: center;<br>    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">50px</span>;<br><br>    <span class="hljs-selector-class">.tea</span>&#123;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8125em</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#999999</span>;<br>        <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;<br>    &#125;<br><br>    <span class="hljs-selector-class">.reward-btn</span>&#123;<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">24px</span>;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;<br>        <span class="hljs-attribute">background-color</span>: lavender;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#e3a850</span>;<br>        <span class="hljs-attribute">border</span>: none;<br>        <span class="hljs-attribute">cursor</span>: pointer;<br>        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;<br>    &#125;<br><br>    <span class="hljs-selector-class">.reward-img-container</span>&#123;<br>        <span class="hljs-attribute">display</span>: none;<br>        <span class="hljs-comment">/* å›¾ç‰‡å®¹å™¨çš„é€æ˜åº¦ */</span><br>        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">/* è¿‡æ¸¡æ•ˆæœ,ä½¿åŠ¨ç”»æ›´å¹³æ»‘ */</span><br>        <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">2s</span> ease;<br>    &#125;<br><br>    <span class="hljs-selector-class">.reward-img</span>&#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;<br>        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* å•ä¸ªå›¾ç‰‡çš„å®¹å™¨ */</span><br>    <span class="hljs-selector-class">.singleImgContainer</span>&#123;<br>        <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;<br>        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>        <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20px</span>;<br>        <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20px</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* å¾®ä¿¡æ”¯ä»˜å’Œæ”¯ä»˜å®æ”¯ä»˜çš„æ–‡å­—æ ·å¼ */</span><br>    <span class="hljs-selector-class">.wechatPay</span>,<span class="hljs-selector-class">.aliPay</span>&#123;<br>        <span class="hljs-attribute">text-align</span>: center;<br>        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8125em</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#999999</span>;<br>        <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">0px</span>;<br>        <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">0px</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231026104933191.png" alt="image-20231026104933191" style="zoom:50%;" /><p>main.stylä¸­å¼•å…¥cssæ–‡ä»¶ï¼š</p><img src="image-20231017110023550.png" alt="image-20231017110023550" style="zoom:50%;" /><p>æ·»åŠ jsæ–‡ä»¶ï¼š</p><figure class="highlight js"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-f3muvjlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-f3muvjlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> rewardBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;rewardBtn&#x27;</span>);<br><span class="hljs-keyword">const</span> rewardImgContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;rewardImgContainer&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(rewardBtn)&#123;<br>rewardBtn.<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = (rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">&#x27;none&#x27;</span> || rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">&#x27;&#x27;</span>) ? <span class="hljs-string">&#x27;inline-flex&#x27;</span> : <span class="hljs-string">&#x27;none&#x27;</span><br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = (rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> === <span class="hljs-string">&#x27;0&#x27;</span> || rewardImgContainer.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> === <span class="hljs-string">&#x27;&#x27;</span>) ? <span class="hljs-string">&#x27;1&#x27;</span> : <span class="hljs-string">&#x27;0&#x27;</span><br>&#125;, <span class="hljs-number">10</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231017105921936.png" alt="image-20231017105921936" style="zoom:50%;" /><p>å¼•å…¥jsæ–‡ä»¶ï¼š</p><img src="image-20231017105843646.png" alt="image-20231017105843646" style="zoom:50%;" /><hr><p>åª’ä½“æŸ¥è¯¢ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-yb05uglqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-yb05uglqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">100vh</span>)<br>#board &#123;<br>    <span class="hljs-attribute">margin-top</span>: -<span class="hljs-number">1rem</span> <span class="hljs-meta">!important</span>;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">83%</span> <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231019110918493.png" alt="image-20231019110918493" style="zoom:50%;" /><hr><p>è§£å†³ç§»åŠ¨ç«¯å­—ä½“ä¸ç”Ÿæ•ˆé—®é¢˜ï¼š</p><p class="note note-success" style="border-left: 4px solid #428bca;padding: 10px 15px;color: #777;background-color: #eef7fa;">ä¸­æ–‡å­—ä½“å¯ä»¥åœ¨http://www.reeji.com/ä¸ŠæŸ¥æ‰¾</p><ol><li>ä¸‹è½½ttfæ–‡ä»¶ï¼š</li></ol><img src="image-20231020101213689.png" alt="image-20231020101213689" style="zoom:50%;" /><ol start="2"><li>ä½¿ç”¨<code>@font-face</code>ï¼šå…è®¸ç½‘é¡µå¼€å‘è€…ä¸ºå…¶ç½‘é¡µæŒ‡å®šåœ¨çº¿å­—ä½“ï¼›å­—ä½“èƒ½ä»è¿œç¨‹æœåŠ¡å™¨æˆ–è€…ç”¨æˆ·æœ¬åœ°å®‰è£…çš„å­—ä½“åŠ è½½ã€‚å¦‚æœæä¾›äº† local() å‡½æ•°ï¼Œä»ç”¨æˆ·æœ¬åœ°æŸ¥æ‰¾æŒ‡å®šçš„å­—ä½“åç§°ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†ä¸€ä¸ªåŒ¹é…é¡¹ï¼Œæœ¬åœ°å­—ä½“å°±ä¼šè¢«ä½¿ç”¨ã€‚å¦åˆ™ï¼Œå­—ä½“å°±ä¼šä½¿ç”¨ url() å‡½æ•°ä¸‹è½½çš„èµ„æºã€‚åœ¨åŒæ—¶ä½¿ç”¨ url() å’Œ local() åŠŸèƒ½æ—¶ï¼Œä¸ºäº†ç”¨æˆ·å·²ç»å®‰è£…çš„å­—ä½“å‰¯æœ¬åœ¨éœ€è¦ä½¿ç”¨æ—¶è¢«ä½¿ç”¨ï¼Œå¦‚æœåœ¨ç”¨æˆ·æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°å­—ä½“å‰¯æœ¬å°±ä¼šå»ä½¿ç”¨æˆ·ä¸‹è½½çš„å‰¯æœ¬æŸ¥æ‰¾å­—ä½“ã€‚@font-face è§„åˆ™ä¸ä»…ä»…ä½¿ç”¨åœ¨ CSS çš„é¡¶å±‚ï¼Œè¿˜å¯ä»¥ç”¨åœ¨ä»»ä½• CSS æ¡ä»¶ç»„è§„åˆ™ä¸­ã€‚</li></ol><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-96vhthlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-96vhthlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-keyword">@font-face</span>&#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;KaiTi&#x27;</span>;<br>    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;./mycustom/ttf/KaiTi.ttf&#x27;</span>); <br>&#125;<br><br><span class="hljs-keyword">@font-face</span>&#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Times New Roman&#x27;</span>;<br>    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">&#x27;./mycustom/ttf/Times New Roman.ttf&#x27;</span>); <br>&#125;<br><br><span class="hljs-selector-tag">html</span>,<br><span class="hljs-selector-tag">body</span> &#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Times New Roman&#x27;</span>,KaiTi <span class="hljs-meta">!important</span>;<br>&#125;<br><br><span class="hljs-selector-class">.markdown-body</span>&#123;<br>    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Times New Roman&#x27;</span>,KaiTi <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></div></figure><img src="image-20231020111623065.png" alt="image-20231020111623065" style="zoom:50%;" /><p>ä¸èƒ½åœ¨ä¸€ä¸ª CSS é€‰æ‹©å™¨ä¸­å®šä¹‰<code>@font-face</code>ã€‚ä¾‹å¦‚ï¼Œè¿™æ ·å†™æ˜¯æ— æ•ˆçš„ï¼š</p><figure class="highlight css"><i class="iconfont icon-window-down" type="button" data-toggle="collapse" data-target="#collapse-8yv21qlqv4htb0" style="font-size:1.5em;"></i><div class="collapse show" id="collapse-8yv21qlqv4htb0"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.className</span> &#123;<br>  <span class="hljs-keyword">@font-face</span> &#123;<br>    <span class="hljs-attribute">font-family</span>: MyHelvetica;<br>    <span class="hljs-attribute">src</span>: <span class="hljs-built_in">local</span>(<span class="hljs-string">&quot;Helvetica Neue Bold&quot;</span>), <span class="hljs-built_in">local</span>(<span class="hljs-string">&quot;HelveticaNeue-Bold&quot;</span>),<br>      <span class="hljs-built_in">url</span>(<span class="hljs-string">MgOpenModernaBold.ttf</span>);<br>    <span class="hljs-attribute">font-weight</span>: bold;<br>  &#125;<br></code></pre></td></tr></table></div></figure><ol start="3"><li>åœ¨main.stylä¸­å¼•ç”¨ï¼š</li></ol><img src="image-20231020102237376.png" alt="image-20231020102237376" style="zoom:50%;" /><p>æ•ˆæœï¼š</p><img src="image-20231020103554840.png" alt="image-20231020103554840" style="zoom:50%;" /><hr><p>ä¿®æ”¹ä¸»é¢˜æ˜æš—èƒŒæ™¯è‰²ï¼š</p><img src="image-20231025172617227.png" alt="image-20231025172617227" style="zoom:50%;" /><hr><p>è®¾ç½®åˆ†é¡µï¼šä¿®æ”¹<code>per_page</code>çš„å€¼</p><img src="image-20231229154630421.png" alt="image-20231229154630421" style="zoom:50%;" />]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€.ä¸Šä¼ å¤§æ–‡ä»¶åˆ°Github</title>
    <link href="/2023/08/24/%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%B0Github/"/>
    <url>/2023/08/24/%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%B0Github/</url>
    
    <content type="html"><![CDATA[<p>Githubæ–‡æ¡£ï¼š<a href="https://docs.github.com/zh">https://docs.github.com/zh</a></p><p>ä¸Šä¼ è¶…è¿‡100Mçš„å•ä¸ªæ–‡ä»¶åˆ°githubï¼šå¯å…ˆè¿›è¡Œpdfå‹ç¼©</p><p>ä¸‹è½½lfsï¼š<a href="https://git-lfs.com/">https://git-lfs.com/</a></p><ol><li><p>Githubæ–°å»ºç©ºä»“åº“</p></li><li><p>æœ¬åœ°æ–°å»ºç©ºæ–‡ä»¶å¤¹</p></li><li><p>git lfs install</p></li><li><p>git init</p></li><li><p>git lfs track &quot;*.zip&quot; </p><ol><li>è¿½è¸ªå•ä¸ªæ–‡ä»¶ï¼š<code>git lfs track &quot;FrameworkFold/XXXFramework/xxx&quot;</code></li><li>è¿½è¸ªæŒ‡å®šç±»å‹çš„æ–‡ä»¶ï¼š<code>git lfs track &quot;*.dmg&quot;</code></li><li>ä¸å†ä½¿ç”¨ Git LFS ç®¡ç†æŒ‡å®šçš„æ–‡ä»¶ï¼š<code>git lfs untrack &quot;*.dmg&quot;</code></li><li>è¿½è¸ªæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š<code>git lfs track &quot;FrameworkFold/*&quot;</code></li><li>æšä¸¾ç›®å‰æ‰€æœ‰è¢« Git LFS ç®¡ç†çš„å…·ä½“æ–‡ä»¶ï¼š<code>git lfs ls-files</code></li></ol></li><li><p>git add .gitattributes</p></li><li><p>git config --global user.email &quot;<a href="mailto:&#x32;&#49;&#x39;&#x37;&#57;&#x31;&#51;&#54;&#54;&#x35;&#x40;&#x71;&#113;&#46;&#x63;&#x6f;&#109;">&#x32;&#49;&#x39;&#x37;&#57;&#x31;&#51;&#54;&#54;&#x35;&#x40;&#x71;&#113;&#46;&#x63;&#x6f;&#109;</a>&quot;</p></li><li><p>git config --global <a href="http://user.name/">user.name</a> &quot;lan720&quot;</p></li><li><p>git commit -m &quot;æäº¤ .gitattributes æ–‡ä»¶&quot;</p></li><li><p>git remote add origin <a href="mailto:git@github.com">git@github.com</a>:lan720&#x2F;study.git</p></li><li><p>git push origin master</p></li><li><p>åŠ å…¥ ä»£ç éšæƒ³å½•1.assets.zip</p></li><li><p>git add .</p></li><li><p>git commit -m &quot;æäº¤&quot;</p></li><li><p>git push origin master</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
      <tag>lfs</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
